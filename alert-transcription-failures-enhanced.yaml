displayName: Transcription Service Failures
documentation:
  content: |
    High rate of transcription failures detected (AssemblyAI or Auphonic).
    This blocks episode creation and affects user experience.
    
    Common causes:
    - AssemblyAI API key expired or invalid
    - Auphonic API outage or rate limiting
    - Audio file format incompatibility
    - Network timeouts to external services
    - Invalid API request parameters
    - Audio files too large or corrupted
    
    Recommended actions:
    - Verify API keys are valid and not expired
    - Check external service status pages
    - Review audio file formats being submitted
    - Check for pattern in file sizes causing failures
    - Verify network connectivity to external APIs
    - Look for error codes in API responses
  mimeType: text/markdown

conditions:
  - displayName: Transcription Error Rate > 10%
    conditionThreshold:
      filter: |
        resource.type = "cloud_run_revision"
        AND resource.labels.service_name = "podcast-api"
        AND (
          textPayload =~ "AssemblyAI.*failed"
          OR textPayload =~ "Auphonic.*error"
          OR textPayload =~ "Transcription failed"
          OR textPayload =~ "Failed to transcribe"
        )
        AND severity >= ERROR
      aggregations:
        - alignmentPeriod: 300s
          perSeriesAligner: ALIGN_RATE
          crossSeriesReducer: REDUCE_SUM
          groupByFields:
            - resource.service_name
      comparison: COMPARISON_GT
      thresholdValue: 0.1
      duration: 300s

alertStrategy:
  autoClose: 3600s

notificationChannels:
  - projects/podcast612/notificationChannels/7975467987455629516

combiner: OR
enabled: true
