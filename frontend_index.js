import{b as Qi,n as Xi,p as Zi,r as s,j as e,t as el,q as tl,v as pr,R as $t,S as cr,E as en,w as In,D as sl,C as al,P as rl,a as nl,L as dr,x as il,y as ll,z as ol,A as cl}from"./vendor-rNBhf-Kq.js";import{S as dl,R as Tn,I as Pn,F as Mn,a as Rn,T as Dn,b as ul,c as Fn,d as Ln,P as ml,C as Un,V as hl,L as $n,e as On,f as pl,g as xl,h as zn,i as fl,j as gl,k as Bn,l as yl,O as Wn,m as bl,n as qn,o as jl,p as Vn,D as Yn,q as vl,r as Hn,s as wl,t as Gn,u as Nl,v as Kn,w as Jn,A as Qn,x as Xn,y as Zn,z as ei,B as _l}from"./vendor-radix-ChtAHuUv.js";import{C as Br,a as Sl,b as ti,X as _a,L as St,A as Yt,S as Ra,c as Cl,d as Ds,e as kl,T as $s,U as ks,P as Ls,f as ra,g as Us,G as tn,M as Ys,F as sa,h as ur,B as Wr,i as El,j as si,W as Pr,k as Mr,l as aa,m as ai,n as Al,o as as,p as Da,q as ws,r as Il,s as va,t as Tl,u as ri,v as vs,w as Xt,x as Rr,y as ni,z as ir,E as Pl,D as Dr,R as wa,H as ii,I as Ml,J as Rl,K as Dl,N as sn,O as Fl,Q as Fr,V as li,Y as Ll,Z as Ul,_ as oi,$ as Lr,a0 as ci,a1 as $l,a2 as di,a3 as Ol,a4 as ui,a5 as mr,a6 as qr,a7 as Sr,a8 as zl,a9 as Bl,aa as an,ab as ta,ac as Wl,ad as Vr,ae as ql,af as Vl,ag as mi,ah as hi,ai as Yl,aj as pi,ak as Hl,al as Gl,am as Kl,an as Jl,ao as Ql,ap as Xl,aq as Yr,ar as hr,as as Zl,at as eo,au as Ur,av as Ia,aw as Cs,ax as to,ay as xi,az as Za,aA as rn,aB as so,aC as nn,aD as er}from"./vendor-icons-tKWvICx1.js";import{u as fi,o as gi,r as ao}from"./vendor-wavesurfer-Bd69dcKY.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function r(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=r(o);fetch(o.href,l)}})();window.React||(window.React=Qi);window.ReactDOM||(window.ReactDOM=Xi);const ro={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE:"",VITE_GOOGLE_CLIENT_ID:""};try{const t=ro||{};t.VITE_SENTRY_DSN?(Zi({dsn:t.VITE_SENTRY_DSN,tracesSampleRate:Number(t.VITE_SENTRY_TRACES_SAMPLE_RATE||"0"),environment:t.VITE_APP_ENV||t.MODE||"dev",beforeSend(a){return(t.DEV||t.MODE==="development")&&!t.VITE_SENTRY_ENABLE_DEV?null:a}}),console.log("[sentry] initialized")):console.log("[sentry] disabled (no DSN)")}catch(t){console.warn("[sentry] init failed",t)}function is(t){return t&&typeof t=="object"&&(t.error||t.detail||t.message)}const no=new Set(["localhost","127.0.0.1","0.0.0.0","::1","[::1]"]);function io(){if(typeof window>"u"||typeof window.location>"u")return"";const t=window.location.hostname||"";return no.has(t)?"":"https://api.podcastplusplus.com"}function lo(){return io()}const oo=lo();function Fa(t){return Array.isArray(t)?t:!t||typeof t!="object"?[]:Array.isArray(t.items)?t.items:Array.isArray(t.results)?t.results:Array.isArray(t.data)?t.data:Array.isArray(t.records)?t.records:[]}function Vt(t){const a=oo;return t?/^https?:\/\//i.test(t)?t:a?`${a}${t}`:t:a||""}async function pa(t,a={}){const r=Vt(t),n=await fetch(r,{credentials:"include",headers:{...a.headers||{}},...a}),o=n.headers.get&&n.headers.get("content-type"),l=o&&o.includes("application/json"),d=l?await n.json().catch(()=>({})):await n.text().catch(()=>"");if(!n.ok){if(l){const N=d&&typeof d=="object"?d:{message:String(d||"Request failed")};throw{status:n.status,...N}}throw{status:n.status,message:String(d||"Request failed")}}return l?d:{ok:!0,data:d}}function Cr(t){return t==null?void 0:JSON.stringify(t)}function G(t){const a=(r={})=>{const n=t||(()=>{try{return localStorage.getItem("authToken")}catch{return null}})();return n?{Authorization:`Bearer ${n}`,...r||{}}:{...r||{}}};return{get:(r,n={})=>pa(r,{...n,method:"GET",headers:a(n.headers)}),post:(r,n,o={})=>pa(r,{...o,method:"POST",headers:a({"Content-Type":"application/json",...o.headers||{}}),body:Cr(n)}),put:(r,n,o={})=>pa(r,{...o,method:"PUT",headers:a({"Content-Type":"application/json",...o.headers||{}}),body:Cr(n)}),patch:(r,n,o={})=>pa(r,{...o,method:"PATCH",headers:a({"Content-Type":"application/json",...o.headers||{}}),body:Cr(n)}),del:(r,n={})=>pa(r,{...n,method:"DELETE",headers:a(n.headers)}),raw:(r,n={})=>pa(r,{...n,headers:a(n.headers)})}}function Hr(t){return Vt(t)}const yi=s.createContext(null),co=({children:t})=>{const[a,r]=s.useState(()=>{try{return localStorage.getItem("authToken")}catch{return null}}),[n,o]=s.useState(null),[l,d]=s.useState(!0),[N,i]=s.useState(null),[u,j]=s.useState(!1),c=s.useRef(!1),m=s.useRef(0),I=s.useRef(0),x=s.useRef(2e3),v=6e4;s.useEffect(()=>{try{a?localStorage.setItem("authToken",a):localStorage.removeItem("authToken")}catch{}},[a]);const _=C=>{r(C),i(null)},k=()=>{r(null),o(null),i(null),j(!0)},h=s.useCallback(async(C={force:!1})=>{if(!a){o(null),j(!0);return}const M=Date.now();if(!(!C.force&&!l&&M-I.current<x.current)&&!(c.current&&!C.force)){c.current=!0,I.current=M;try{const g=await G(a).get("/api/users/me");o(g),i(null),d(!0),m.current=0,x.current=2e3,j(!0)}catch(b){if(b&&b.status===401){o(null),r(null),j(!0);return}const g=b&&typeof b.detail=="object"?b.detail:null;if(g&&g.maintenance||b&&b.maintenance){const U=g?.message||g?.detail||"We are performing maintenance and will be back soon.";i({message:U,detail:g||{}}),o(null),j(!0),d(!0);return}l&&d(!1),m.current+=1,x.current=Math.min(x.current*2,v),j(!0)}finally{c.current=!1}}},[a,l]);s.useEffect(()=>{h()},[a,h]),s.useEffect(()=>{function C(M){const b=M.detail&&M.detail.token;b&&b!==a&&r(b)}return window.addEventListener("ppp-token-captured",C),()=>window.removeEventListener("ppp-token-captured",C)},[a]);const y=s.useCallback(async C=>{if(!a)throw new Error("Not authenticated");const b=await G(a).post("/api/auth/terms/accept",{version:C});return o(b),b},[a]),p={token:a,user:n,login:_,logout:k,refreshUser:h,isAuthenticated:!!a,backendOnline:l,hydrated:u,acceptTerms:y,maintenanceInfo:N};return e.jsx(yi.Provider,{value:p,children:t})},Ht=()=>s.useContext(yi);function at(...t){return el(tl(t))}const uo=pr("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),A=s.forwardRef(({className:t,variant:a,size:r,asChild:n=!1,...o},l)=>{const d=n?dl:"button";return e.jsx(d,{className:at(uo({variant:a,size:r,className:t})),ref:l,...o})});A.displayName="Button";const Ce=s.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:at("rounded-xl border bg-card text-card-foreground shadow",t),...a}));Ce.displayName="Card";const Je=s.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:at("flex flex-col space-y-1.5 p-6",t),...a}));Je.displayName="CardHeader";const Xe=s.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:at("font-semibold leading-none tracking-tight",t),...a}));Xe.displayName="CardTitle";const Zt=s.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:at("text-sm text-muted-foreground",t),...a}));Zt.displayName="CardDescription";const Ae=s.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:at("p-6 pt-0",t),...a}));Ae.displayName="CardContent";const Gr=s.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:at("flex items-center p-6 pt-0",t),...a}));Gr.displayName="CardFooter";const mo=pr("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function pt({className:t,variant:a,...r}){return e.jsx("div",{className:at(mo({variant:a}),t),...r})}const La=s.forwardRef(({className:t,...a},r)=>e.jsx(Tn,{ref:r,className:at("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...a}));La.displayName=Tn.displayName;const xr=s.forwardRef(({className:t,...a},r)=>e.jsx(Pn,{ref:r,className:at("aspect-square h-full w-full",t),...a}));xr.displayName=Pn.displayName;const Ua=s.forwardRef(({className:t,...a},r)=>e.jsx(Mn,{ref:r,className:at("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...a}));Ua.displayName=Mn.displayName;const ho=1,po=1e6;let kr=0;function xo(){return kr=(kr+1)%Number.MAX_SAFE_INTEGER,kr.toString()}const Er=new Map,ln=t=>{if(Er.has(t))return;const a=setTimeout(()=>{Er.delete(t),Ma({type:"REMOVE_TOAST",toastId:t})},po);Er.set(t,a)},fo=(t,a)=>{switch(a.type){case"ADD_TOAST":return{...t,toasts:[a.toast,...t.toasts].slice(0,ho)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(r=>r.id===a.toast.id?{...r,...a.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=a;return r?ln(r):t.toasts.forEach(n=>{ln(n.id)}),{...t,toasts:t.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return a.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(r=>r.id!==a.toastId)}}},lr=[];let or={toasts:[]};function Ma(t){or=fo(or,t),lr.forEach(a=>{a(or)})}function wt({...t}){const a=xo(),r=o=>Ma({type:"UPDATE_TOAST",toast:{...o,id:a}}),n=()=>Ma({type:"DISMISS_TOAST",toastId:a});return Ma({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:o=>{o||n()}}}),{id:a,dismiss:n,update:r}}function Lt(){const[t,a]=s.useState(or);return s.useEffect(()=>(lr.push(a),()=>{const r=lr.indexOf(a);r>-1&&lr.splice(r,1)}),[t]),{...t,toast:wt,dismiss:r=>Ma({type:"DISMISS_TOAST",toastId:r})}}const bi={plusplus:{key:"plusplus",name:"Podcast Plus Plus",shortName:"Plus Plus",heroH1:"Podcasting magic, doubled.",heroSub:"Plus Plus automates the busywork so you can stay in the creative flow.",colors:{primary:"#0FA3B1",accent:"#FFB703"}}},ji="plusplus",vi=s.createContext({brand:bi[ji],setBrandKey:()=>{}});function go({children:t}){const a=s.useMemo(()=>bi[ji],[]);return s.useEffect(()=>{if(typeof document>"u")return;const r=document.documentElement;r.classList.remove("brand-ppp","brand-nsc","brand-plusplus"),r.classList.add(`brand-${a.key}`),r.setAttribute("data-brand",a.key),document.title=a.name},[a]),e.jsx(vi.Provider,{value:{brand:a,setBrandKey:()=>{}},children:t})}const fr=()=>s.useContext(vi);function gr({size:t=28,lockup:a=!0,src:r}){const{brand:n}=fr(),o=Math.max(24,t),[l,d]=$t.useState(!1),N=r||"/logo-plusplus.svg";return e.jsxs("div",{className:"flex items-center gap-3","aria-label":n.name,children:[l?e.jsx("div",{className:"flex items-center justify-center rounded-lg font-semibold tracking-tight logo",style:{width:o,height:o,fontSize:o*.55,backgroundColor:"rgba(15, 163, 177, 0.12)",color:"#0FA3B1"},"aria-hidden":"true",children:"++"}):e.jsxs("picture",{children:[e.jsx("source",{srcSet:N,type:"image/svg+xml"}),e.jsx("img",{className:"logo",src:"/logo-plusplus.png",alt:n.name,width:o,height:o,style:{width:o,height:o,objectFit:"contain"},onError:()=>d(!0)})]}),a&&e.jsx("span",{className:"font-semibold",style:{fontSize:t*.6},children:n.name})]})}const Ye=s.forwardRef(({className:t,type:a,...r},n)=>{const o=a==="file",l="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",d=o?["border-0 p-0 h-auto","file:mr-3 file:px-3 file:py-1.5 file:border file:border-input file:rounded-md file:bg-background file:text-sm file:font-medium file:text-foreground file:hover:bg-accent file:hover:text-accent-foreground file:cursor-pointer"].join(" "):"file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground";return e.jsx("input",{type:a,className:at(l,d,t),ref:n,...r})});Ye.displayName="Input";const yo=pr("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ve=s.forwardRef(({className:t,...a},r)=>e.jsx(Rn,{ref:r,className:at(yo(),t),...a}));ve.displayName=Rn.displayName;const Jt=fl,Qt=gl,Wt=s.forwardRef(({className:t,children:a,...r},n)=>e.jsxs(Dn,{ref:n,className:at("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...r,children:[a,e.jsx(ul,{asChild:!0,children:e.jsx(Br,{className:"h-4 w-4 opacity-50"})})]}));Wt.displayName=Dn.displayName;const wi=s.forwardRef(({className:t,...a},r)=>e.jsx(Fn,{ref:r,className:at("flex cursor-default items-center justify-center py-1",t),...a,children:e.jsx(Sl,{className:"h-4 w-4"})}));wi.displayName=Fn.displayName;const Ni=s.forwardRef(({className:t,...a},r)=>e.jsx(Ln,{ref:r,className:at("flex cursor-default items-center justify-center py-1",t),...a,children:e.jsx(Br,{className:"h-4 w-4"})}));Ni.displayName=Ln.displayName;const qt=s.forwardRef(({className:t,children:a,position:r="popper",...n},o)=>e.jsx(ml,{children:e.jsxs(Un,{ref:o,className:at("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...n,children:[e.jsx(wi,{}),e.jsx(hl,{className:at("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),e.jsx(Ni,{})]})}));qt.displayName=Un.displayName;const bo=s.forwardRef(({className:t,...a},r)=>e.jsx($n,{ref:r,className:at("px-2 py-1.5 text-sm font-semibold",t),...a}));bo.displayName=$n.displayName;const yt=s.forwardRef(({className:t,children:a,...r},n)=>e.jsxs(On,{ref:n,className:at("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(pl,{children:e.jsx(ti,{className:"h-4 w-4"})})}),e.jsx(xl,{children:a})]}));yt.displayName=On.displayName;const jo=s.forwardRef(({className:t,...a},r)=>e.jsx(zn,{ref:r,className:at("-mx-1 my-1 h-px bg-muted",t),...a}));jo.displayName=zn.displayName;const bs=s.forwardRef(({className:t,...a},r)=>e.jsx("textarea",{className:at("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...a}));bs.displayName="Textarea";function vo({value:t,onChange:a}){const r=t||{auto_fill_ai:!0,title_instructions:"",notes_instructions:"",tags_instructions:"",tags_always_include:[],auto_generate_tags:!0},n=s.useMemo(()=>(r.tags_always_include||[]).join(", "),[r.tags_always_include]),[o,l]=s.useState(n);s.useEffect(()=>{l(n)},[n]);const d=i=>{const u=(i||"").split(",").map(m=>m.trim()).filter(Boolean),j=new Set,c=[];for(const m of u){const I=m.toLowerCase();if(!j.has(I)&&(j.add(I),c.push(m),c.length>=20))break}l(c.join(", ")),a?.({...r,tags_always_include:c})},N=i=>a?.({...r,...i});return e.jsxs("section",{className:"space-y-3 border rounded-md p-3 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-medium",children:"AI Content"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!r.auto_fill_ai,onChange:i=>N({auto_fill_ai:!!i.target.checked})}),e.jsx("span",{children:"Auto fill fields with AI suggestions?"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Title instructions"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",rows:3,placeholder:'e.g., Use format "E### – Film – Hook". Keep ≤ 80 chars.',value:r.title_instructions||"",onChange:i=>N({title_instructions:i.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Notes/Description instructions"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",rows:4,placeholder:"e.g., Snarky tone. Provide time-stamped overview of major points.",value:r.notes_instructions||"",onChange:i=>N({notes_instructions:i.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tags instructions (optional)"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",rows:3,placeholder:"e.g., Focus on movie, director, year. No spoilers in tags.",value:r.tags_instructions||"",onChange:i=>N({tags_instructions:i.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:r.auto_generate_tags===!1,onChange:i=>N({auto_generate_tags:!i.target.checked})}),e.jsx("span",{children:"Do not automatically generate tags"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"When checked, the system will not auto-generate tags for episodes using this template."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Always include these tags (comma-separated)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",placeholder:"e.g., star wars, podcast, film",value:o,onChange:i=>{l(i.target.value)},onBlur:()=>d(o),onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),d(o))}}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We’ll add these first, then the AI fills the rest (max 20 total; each ≤ 30 chars)."})]})]})}const Kt=s.forwardRef(({className:t,...a},r)=>e.jsx(Bn,{className:at("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...a,ref:r,children:e.jsx(yl,{className:at("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Kt.displayName=Bn.displayName;const on=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],tr=t=>[...t].sort((a,r)=>{const n=Number(a.day_of_week??0)-Number(r.day_of_week??0);return n!==0?n:String(a.time_of_day||"").localeCompare(String(r.time_of_day||""))}),cn=t=>({id:t.id||null,day_of_week:Number(t.day_of_week??0),time_of_day:String(t.time_of_day||"").slice(0,5)||"05:00",enabled:t.enabled!==!1,advance_minutes:Number(t.advance_minutes??60)||60,timezone:t.timezone||null,next_scheduled:t.next_scheduled||null,next_scheduled_local:t.next_scheduled_local||null,next_scheduled_date:t.next_scheduled_date||null,next_scheduled_time:t.next_scheduled_time||null}),wo=t=>{const a=t.next_scheduled||(t.next_scheduled_local?`${t.next_scheduled_local}:00`:null);if(!a)return"—";const r=new Date(a);return Number.isNaN(r.getTime())?t.next_scheduled_date&&t.next_scheduled_time?`${t.next_scheduled_date} ${t.next_scheduled_time}`:"—":r.toLocaleString(void 0,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})},No=(t="UTC")=>{try{return Intl?.DateTimeFormat?.().resolvedOptions?.().timeZone||t}catch{return t}};function _o({token:t,templateId:a,userTimezone:r,isNewTemplate:n,onDirtyChange:o}){const l=s.useMemo(()=>No(r||"UTC"),[r]),[d,N]=s.useState(!1),[i,u]=s.useState(!1),[j,c]=s.useState(null),[m,I]=s.useState([]),[x,v]=s.useState(l),[_,k]=s.useState(!1),[h,y]=s.useState("05:00"),[p,C]=s.useState(()=>new Set([0])),[M,b]=s.useState({timezone:l,slots:[]});s.useEffect(()=>{typeof o=="function"&&o(_)},[_,o]),s.useEffect(()=>{if(!a||a==="new"||n){const P=l;I([]),k(!1),c(null),N(!1),v(P),b({timezone:P,slots:[]}),typeof o=="function"&&o(!1);return}let z=!1;return N(!0),(async()=>{try{const E=await G(t).get(`/api/recurring/templates/${a}/schedules`);if(z)return;const ne=Array.isArray(E?.schedules)?E.schedules:[],ee=tr(ne.map(cn)),he=ee.map(H=>({...H})),D=E?.timezone||ee[0]?.timezone||l;I(he),v(D),b({timezone:D,slots:he.map(H=>({...H}))}),k(!1),c(null),typeof o=="function"&&o(!1)}catch(P){z||c(P?.message||"Failed to load recurring schedule")}finally{z||N(!1)}})(),()=>{z=!0}},[a,t,n,r,l,o]);const g=s.useCallback(z=>{C(P=>{const E=new Set(P);return E.has(z)?E.delete(z):E.add(z),E})},[]),U=s.useCallback(()=>{p.size===0||!h||I(z=>{const P=[...z];let E=0;return p.forEach(ne=>{const ee=Number(ne);P.some(D=>Number(D.day_of_week)===ee&&String(D.time_of_day)===String(h))||(P.push({id:null,day_of_week:ee,time_of_day:h,enabled:!0,advance_minutes:60,timezone:x,next_scheduled:null,next_scheduled_local:null,next_scheduled_date:null,next_scheduled_time:null}),E+=1)}),E>0?(k(!0),tr(P)):P})},[p,h,x]),se=s.useCallback((z,P,E=!1)=>{I(ne=>{const ee=[...ne];return ee[z]={...ee[z],...P},E?tr(ee):ee}),k(!0)},[]),Z=s.useCallback(z=>{I(P=>{const E=[...P];return E.splice(z,1),E}),k(!0)},[]),F=s.useCallback(async()=>{if(!(!a||a==="new")){u(!0),c(null);try{const z=G(t),P={timezone:x,schedules:m.map(H=>({id:H.id||void 0,day_of_week:Number(H.day_of_week??0),time_of_day:String(H.time_of_day||"").slice(0,5),enabled:H.enabled!==!1,advance_minutes:Number(H.advance_minutes??60)||60,timezone:H.timezone||x}))},E=await z.put(`/api/recurring/templates/${a}/schedules`,P),ne=Array.isArray(E?.schedules)?E.schedules:[],he=tr(ne.map(cn)).map(H=>({...H})),D=E?.timezone||x;I(he),v(D),b({timezone:D,slots:he.map(H=>({...H}))}),k(!1),typeof o=="function"&&o(!1),wt({title:"Recurring schedule updated",description:"Future episodes from this template will use the new time slots."})}catch(z){const P=z?.message||"Failed to save recurring schedule";c(P),wt({variant:"destructive",title:"Save failed",description:P})}finally{u(!1)}}},[a,t,m,x,o]),re=m.length>0,O=s.useMemo(()=>Array.from(p).sort((z,P)=>z-P),[p]);return!a||a==="new"||n?e.jsxs(Ce,{className:"shadow-sm",children:[e.jsxs(Je,{children:[e.jsx(Xe,{children:"Recurring Publish Schedule"}),e.jsx(Zt,{children:"Save your template first to plan automatic publish slots."})]}),e.jsx(Ae,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Once this template is saved, you can choose the days and times it should publish automatically. Each new episode will pick the next open slot."})})]}):e.jsxs(Ce,{className:"shadow-sm",children:[e.jsxs(Je,{children:[e.jsx(Xe,{children:"Recurring Publish Schedule"}),e.jsx(Zt,{children:"Tell Plus Plus when episodes made from this template should go live. We’ll skip conflicts with already scheduled episodes."})]}),e.jsxs(Ae,{className:"space-y-6",children:[j&&e.jsx("div",{className:"rounded border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:j}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-[1fr_auto] md:items-end",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Scheduling uses your local timezone (",e.jsx("span",{className:"font-medium text-slate-700",children:x}),")."]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-[repeat(2,minmax(0,1fr))] md:grid-cols-[repeat(2,minmax(0,1fr))]",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Time"}),e.jsx(Ye,{type:"time",value:h,onChange:z=>y(z.target.value),className:"h-9"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:on.map((z,P)=>{const E=p.has(P);return e.jsx("button",{type:"button",onClick:()=>g(P),className:`rounded border px-2 py-1 text-xs font-medium transition-colors ${E?"border-blue-500 bg-blue-50 text-blue-700":"border-slate-200 bg-white text-slate-600"}`,children:z},z)})}),O.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select at least one day."})]})]})]}),e.jsxs(A,{onClick:U,disabled:p.size===0||!h,children:["Add slot",p.size>1?"s":""]})]}),d?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading recurring slots…"}):re?e.jsx("div",{className:"space-y-3",children:m.map((z,P)=>e.jsxs("div",{className:"flex flex-col gap-3 rounded border border-slate-200 bg-white p-3 md:flex-row md:items-center",children:[e.jsxs("div",{className:"flex flex-1 flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Day"}),e.jsx("select",{value:String(z.day_of_week),onChange:E=>se(P,{day_of_week:Number(E.target.value)},!0),className:"h-9 rounded border border-slate-300 px-2 text-sm",children:on.map((E,ne)=>e.jsx("option",{value:ne,children:E},E))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Time"}),e.jsx(Ye,{type:"time",value:z.time_of_day,onChange:E=>se(P,{time_of_day:E.target.value},!0),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Kt,{id:`slot-enabled-${P}`,checked:z.enabled!==!1,onCheckedChange:E=>se(P,{enabled:!!E})}),e.jsx(ve,{htmlFor:`slot-enabled-${P}`,className:"text-sm text-slate-700",children:z.enabled!==!1?"Enabled":"Paused"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Next publish"}),e.jsxs("div",{className:"text-sm text-slate-700",children:[wo(z),e.jsxs("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",z.timezone||x,")"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(A,{type:"button",variant:"destructive",size:"sm",onClick:()=>Z(P),children:"Remove"})})]},z.id||`${z.day_of_week}-${z.time_of_day}-${P}`))}):e.jsx("div",{className:"rounded border border-dashed border-slate-300 bg-slate-50 p-4 text-sm text-slate-600",children:"No recurring slots yet. Add your publish days and time above, then click Save."}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 border-t border-slate-200 pt-4",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:_?"You have unsaved schedule changes.":"Changes saved."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{type:"button",variant:"outline",disabled:!_||i,onClick:()=>{I(M.slots.map(z=>({...z}))),v(M.timezone||r||"UTC"),k(!1),typeof o=="function"&&o(!1)},children:"Cancel"}),e.jsx(A,{type:"button",onClick:F,disabled:i||!_,children:i?"Saving…":"Save schedule"})]})]})]})]})}async function So(t){const r=await G().post("/api/media/tts",t),n=Array.isArray(r)?r[0]:r?.item||r;if(!n?.filename)throw new Error("TTS succeeded but no file was returned.");return n}async function yr(t="",a=1,r=50){const n=await fetch(`/api/elevenlabs/voices?search=${encodeURIComponent(t)}&page=${a}&size=${r}`,{credentials:"include"});if(!n.ok)throw new Error(await n.text());return n.json()}function $a({value:t,onChange:a,onClose:r,onSelect:n,token:o}){const[l,d]=s.useState(""),[N,i]=s.useState([]),[u,j]=s.useState(!1),[c,m]=s.useState(t||null),[I,x]=s.useState(null);s.useEffect(()=>{m(t||null)},[t]),s.useEffect(()=>{let y=!1;async function p(){j(!0);try{if(o){const M=await G(o).get(`/api/elevenlabs/voices?search=${encodeURIComponent(l)}&page=1&size=50`),b=Array.isArray(M?.items)?M.items:Array.isArray(M)?M:[];y||i(b)}else{const C=await yr(l,1,50);y||i(C.items||[])}}catch(C){y||i([]),console.error("Failed to load voices:",C)}finally{y||j(!1)}}return p(),()=>{y=!0}},[l,o]);const v=N||[],_=y=>{if(!y||typeof y!="object")return"";const C=["gender","accent","age","style"].map(b=>y[b]).filter(Boolean);return C.length?C.join(" · "):Object.entries(y).slice(0,3).map(([b,g])=>`${b}:${g}`).join(" · ")},k=y=>{const p=typeof y=="string"?y:y?.voice_id,C=typeof y=="string"?null:y;m(p);try{a&&a(p)}catch{}try{n&&C&&n(C)}catch{}},h=y=>{x(p=>p===y?null:y)};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:r}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg w-full max-w-3xl max-h-[85vh] flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Choose a Voice"}),e.jsx("button",{onClick:r,className:"text-sm text-gray-600 hover:text-gray-900",children:"Close"})]}),e.jsx("div",{className:"p-4",children:e.jsx("input",{type:"text",value:l,onChange:y=>d(y.target.value),placeholder:"Search voices by name or label...",className:"w-full border rounded-md px-3 py-2 focus:outline-none focus:ring"})}),e.jsxs("div",{className:"px-4 pb-4 overflow-y-auto",style:{maxHeight:"60vh"},children:[u&&e.jsx("div",{className:"text-sm text-gray-500 p-2",children:"Loading…"}),!u&&v.length===0&&e.jsx("div",{className:"text-sm text-gray-500 p-2",children:"No voices found."}),e.jsx("ul",{className:"space-y-3",children:v.map(y=>{const p=c&&y.voice_id===c,C=_(y.labels),M=!!y.preview_url,b=I===y.voice_id&&!!y.preview_url,g=y.common_name||y.name||"Unnamed voice";return e.jsxs("li",{className:`border rounded-md p-3 ${p?"border-blue-500 ring-1 ring-blue-300":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:g}),y.description&&e.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:y.description}),C&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:C})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[M&&e.jsx("button",{onClick:()=>h(y.voice_id),className:"text-sm px-2 py-1 border rounded hover:bg-gray-50",children:b?"Hide":"Preview"}),e.jsx("button",{onClick:()=>k(y),disabled:!!p,className:`text-sm px-2 py-1 border rounded ${p?"bg-gray-200 text-gray-700 cursor-default":"bg-blue-600 text-white hover:bg-blue-700"}`,children:p?"Selected":"Select"})]})]}),b&&e.jsx("div",{className:"mt-2",children:e.jsx("audio",{controls:!0,src:y.preview_url||void 0,controlsList:"nodownload",className:"w-full"})})]},y.voice_id)})})]})]})]})}const na=vl,Co=bl,_i=s.forwardRef(({className:t,...a},r)=>e.jsx(Wn,{ref:r,className:at("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a}));_i.displayName=Wn.displayName;const Hs=s.forwardRef(({className:t,children:a,...r},n)=>e.jsxs(Co,{children:[e.jsx(_i,{}),e.jsxs(qn,{ref:n,className:at("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[a,e.jsxs(jl,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(_a,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Hs.displayName=qn.displayName;const Gs=({className:t,...a})=>e.jsx("div",{className:at("flex flex-col space-y-1.5 text-center sm:text-left",t),...a});Gs.displayName="DialogHeader";const ia=({className:t,...a})=>e.jsx("div",{className:at("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a});ia.displayName="DialogFooter";const Ks=s.forwardRef(({className:t,...a},r)=>e.jsx(Vn,{ref:r,className:at("text-lg font-semibold leading-none tracking-tight",t),...a}));Ks.displayName=Vn.displayName;const Ns=s.forwardRef(({className:t,...a},r)=>e.jsx(Yn,{ref:r,className:at("text-sm text-muted-foreground",t),...a}));Ns.displayName=Yn.displayName;const ko={auto_fill_ai:!0,title_instructions:"",notes_instructions:"",tags_instructions:"",tags_always_include:[],auto_generate_tags:!0},$r={intro:e.jsx(ur,{className:"w-5 h-5 text-blue-500"}),outro:e.jsx(ur,{className:"w-5 h-5 text-purple-500"}),content:e.jsx(sa,{className:"w-5 h-5 text-green-500"}),commercial:e.jsx(Ys,{className:"w-5 h-5 text-orange-500"})},dn={static:e.jsx(sa,{className:"w-4 h-4 mr-2"}),tts:e.jsx(Ys,{className:"w-4 h-4 mr-2"})},Kr=1.35,Si=[{level:1,ratio:.1,description:"Barely audible under the host"},{level:2,ratio:.2,description:"Very soft background bed"},{level:3,ratio:.3,description:"Gentle supporting layer"},{level:4,ratio:.4,description:"Noticeable but still tucked under"},{level:5,ratio:.5,description:"Balanced bed under the voice"},{level:6,ratio:.6,description:"Present with a mild punch"},{level:7,ratio:.7,description:"Energetic mix that rides with the host"},{level:8,ratio:.8,description:"Almost level with the dialogue"},{level:9,ratio:.9,description:"Bold mix that demands attention"},{level:10,ratio:1,description:"Same volume as the main mix"},{level:11,ratio:Kr,description:"Spinal Tap mode – louder than the main mix"}],Na=4,un=t=>{(typeof t!="number"||Number.isNaN(t))&&(t=Na);const a=Math.max(1,Math.min(11,t));let r;if(a<=10)r=a/10;else{const n=Kr-1;r=1+(a-10)*n}return r<=0?-60:20*Math.log10(r)},Eo=t=>{if(typeof t!="number"||Number.isNaN(t))return Na;const a=Math.pow(10,t/20);if(!isFinite(a)||a<=0)return Na;if(a<=1)return Math.max(1,Math.min(10,a*10));const r=Kr-1,n=10+(a-1)/r;return Math.max(10,Math.min(11,n))},Ao=t=>{const a=Math.round(t),r=Si.find(n=>n.level===a);return r?r.description:""},sr=({type:t,onClick:a,disabled:r})=>e.jsxs(A,{variant:"outline",className:"flex flex-col h-24 justify-center items-center gap-2 text-gray-700 hover:bg-gray-100 hover:text-blue-600 transition-colors disabled:opacity-50",onClick:()=>a(t),disabled:r,children:[$r[t],e.jsx("span",{className:"text-sm font-semibold",children:t.charAt(0).toUpperCase()+t.slice(1)})]});function Ci({templateId:t,onBack:a,token:r,onTemplateSaved:n}){const{user:o}=Ht(),[l,d]=s.useState(null),[N,i]=s.useState(!0),[u,j]=s.useState(!1),[c,m]=s.useState(null),[I,x]=s.useState([]),[v,_]=s.useState([]),[k,h]=s.useState(null),y=s.useRef(!1),[p,C]=s.useState(null),[M,b]=s.useState(!1),[g,U]=s.useState(null),[se,Z]=s.useState(!1),[F,re]=s.useState(null),[O,z]=s.useState(""),[P,E]=s.useState(null),[ne,ee]=s.useState(1),[he,D]=s.useState(""),[H,ge]=s.useState([]),[V,je]=s.useState(!1),[_e,T]=s.useState({}),[K,le]=s.useState(!1),[me,te]=s.useState(!1),[Ne,Be]=s.useState(!1);s.useEffect(()=>{const S=async()=>{try{const J=await G(r).get("/api/elevenlabs/voices?size=200"),Se=Array.isArray(J?.items)?J.items:Array.isArray(J)?J:[];ge(Se),!P&&p&&E(p)}catch{ge([])}};se&&H.length===0&&S()},[se]);const ke=t==="new",B=s.useMemo(()=>{if(!l||!k)return!1;try{return JSON.stringify(l)!==JSON.stringify(k)}catch{return!0}},[l,k])||Ne,xe=S=>{S&&x($=>[...Array.isArray($)?$.filter(Se=>Se?.filename!==S.filename):[],S])};s.useEffect(()=>{if(typeof window>"u"||!B)return;const S=$=>{$.preventDefault(),$.returnValue=""};return window.addEventListener("beforeunload",S),()=>window.removeEventListener("beforeunload",S)},[B]),s.useEffect(()=>{l&&h(S=>{if(S)return S;try{return JSON.parse(JSON.stringify(l))}catch{return S}})},[l]);const ie=s.useMemo(()=>I.filter(S=>S.category==="intro"),[I]),W=s.useMemo(()=>I.filter(S=>S.category==="outro"),[I]),Pe=s.useMemo(()=>I.filter(S=>S.category==="music"),[I]),Ue=s.useMemo(()=>I.filter(S=>S.category==="commercial"),[I]);s.useEffect(()=>{(async()=>{h(null),i(!0);try{const $=G(r),[J,Se,We]=await Promise.all([$.get("/api/media/"),$.get("/api/podcasts/"),ke?Promise.resolve(null):$.get(`/api/templates/${t}`)]),Ve=Array.isArray(J)?J:J?.items||[],lt=Array.isArray(Se)?Se:Se?.items||[];x(Ve),_(lt),d(ke?{name:"My New Podcast Template",is_active:!0,podcast_id:lt.length>0?lt[lt.length-1].id:null,segments:[{id:crypto.randomUUID(),segment_type:"intro",source:{source_type:"static",filename:""}},{id:crypto.randomUUID(),segment_type:"content",source:{source_type:"static",filename:""}},{id:crypto.randomUUID(),segment_type:"outro",source:{source_type:"static",filename:""}}],background_music_rules:[],timing:{content_start_offset_s:0,outro_start_offset_s:0}}:We||null),m(null)}catch($){m($?.message||String($))}finally{i(!1)}})()},[t,r,ke]),s.useEffect(()=>{if(!l||K)return;!!(Array.isArray(l.background_music_rules)&&l.background_music_rules.length>0||l.timing&&((l.timing.content_start_offset_s||0)!==0||(l.timing.outro_start_offset_s||0)!==0)||l.ai_settings&&Object.keys(l.ai_settings).length>0)&&le(!0)},[l,K]),s.useEffect(()=>{if(!l)return;const S=l.default_elevenlabs_voice_id||l.voice_id||Array.isArray(l.segments)&&l.segments.find($=>$?.source?.source_type==="tts"&&$?.source?.voice_id)?.source?.voice_id||null;C(S||null),U(null)},[l]),s.useEffect(()=>{if(!p||g)return;let S=!1;return(async()=>{try{const J=await G(r).get(`/api/elevenlabs/voice/${encodeURIComponent(p)}/resolve`),Se=J?.common_name||J?.name||null;S||U(Se)}catch{}})(),()=>{S=!0}},[p,g,r]);const $e=(S,$)=>{d(J=>({...J,[S]:$}))},Fe=(S,$)=>{const J={...l.timing,[S]:$};d(Se=>({...Se,timing:J}))},Ge=(S,$,J)=>{const Se=[...l.background_music_rules];Se[S][$]=J,d(We=>({...We,background_music_rules:Se}))},ct=()=>{const S={id:crypto.randomUUID(),apply_to_segments:["content"],music_filename:"",start_offset_s:0,end_offset_s:0,fade_in_s:2,fade_out_s:3,volume_db:Number(un(Na).toFixed(1))};d($=>({...$,background_music_rules:[...$.background_music_rules||[],S]}))},et=S=>{const $=[...l.background_music_rules];$.splice(S,1),d(J=>({...J,background_music_rules:$}))},[dt,jt]=s.useState(null),[xt,R]=s.useState(!1),ye=s.useRef(null),ae=s.useRef(null),f=s.useCallback((S,$)=>{const J=typeof $=="number"?$:parseFloat($),Se=Na,We=Math.max(1,Math.min(11,Number.isFinite(J)?J:Se)),Ve=Number(un(We).toFixed(1));Ge(S,"volume_db",Ve)},[Ge]),Y=s.useCallback(S=>{if(!xt){jt(S),ae.current=S;try{ye.current&&ye.current.click()}catch{}}},[xt]),Q=async S=>{const $=S?.target?.files?.[0],J=ae.current;if(!$||J==null){S?.target&&(S.target.value=""),jt(null),ae.current=null;return}R(!0);try{const Se=G(r),We=new FormData;We.append("files",$);const Ve=await Se.raw("/api/media/upload/music",{method:"POST",body:We}),lt=Array.isArray(Ve)?Ve[0]:Ve;if(!lt?.filename)throw new Error("Upload succeeded but no file was returned.");const Ct={id:lt.id||crypto.randomUUID(),filename:lt.filename,friendly_name:lt.friendly_name||void 0,category:lt.category||"music",content_type:lt.content_type||"audio/mpeg"};xe(Ct),Ge(J,"music_filename",Ct.filename);try{wt({title:"Music uploaded",description:"Your track is now available in the template."})}catch{}}catch(Se){const We=Se?.message||"Could not upload music.";try{wt({variant:"destructive",title:"Upload failed",description:We})}catch{}}finally{if(R(!1),jt(null),ae.current=null,S?.target)try{S.target.value=""}catch{}}},ue=()=>{if(y.current){y.current=!1,a&&a();return}B&&typeof window<"u"&&!window.confirm("Leave the template editor without saving changes?")||a&&a()},Ie=(S,$)=>{d(J=>({...J,segments:J.segments.map(Se=>Se.id===S?{...Se,source:$}:Se)}))},Re=S=>{const $={id:crypto.randomUUID(),segment_type:S,source:{source_type:"static",filename:""}},J=[...l.segments],Se=J.findIndex(We=>We.segment_type==="content");S==="intro"?J.splice(Se!==-1?Se:0,0,$):S==="outro"?J.push($):J.splice(Se!==-1?Se+1:J.length,0,$),d(We=>({...We,segments:J}))},Le=S=>{d($=>({...$,segments:$.segments.filter(J=>J.id!==S)}))},nt=S=>{if(!S.destination)return;const $=Array.from(l.segments),[J]=$.splice(S.source.index,1);$.splice(S.destination.index,0,J);const Se=$.findIndex(Ve=>Ve.segment_type==="content"),We=$.findIndex(Ve=>Ve.segment_type==="outro");Se!==-1&&(J.segment_type==="intro"&&S.destination.index>Se||J.segment_type==="content"&&$.some((Ve,lt)=>Ve.segment_type==="intro"&&lt>S.destination.index))||We!==-1&&(J.segment_type==="outro"&&Se!==-1&&S.destination.index<Se||J.segment_type==="content"&&S.destination.index>We)||d(Ve=>({...Ve,segments:$}))},He=async()=>{if(l){j(!0),m(null);try{if(!l.podcast_id)throw new Error("A show is required for this template. Please select one.");const S=G(r),$={...l};p?$.default_elevenlabs_voice_id=p:$.default_elevenlabs_voice_id=null,Array.isArray($.segments)&&($.segments=$.segments.map(Se=>{if(Se.segment_type!=="content"){const We=Se?.source?.source_type;if(We==="static"){const Ve=Se?.source?.filename||"";return{...Se,source:{source_type:"static",filename:Ve}}}if(We==="tts"){const Ve=(Se?.source?.text_prompt||"").trim(),lt=Se?.source?.voice_id||void 0,Ct={source_type:"tts"};return Ve&&(Ct.text_prompt=Ve),lt&&(Ct.voice_id=lt),{...Se,source:Ct}}return{...Se,source:{source_type:"static",filename:Se?.source?.filename||""}}}return{...Se,source:{source_type:"static",filename:""}}}));const J=!Ne;ke?await S.post("/api/templates/",$):await S.put(`/api/templates/${t}`,$);try{h(JSON.parse(JSON.stringify(l)))}catch{}if(n&&n(),J)y.current=!0,ue();else try{wt({title:"Template saved",description:"Recurring schedule changes are still unsaved."})}catch{}}catch(S){m(S.message||String(S))}finally{j(!1)}}},it=l?.segments?.some(S=>S.segment_type==="content")??!1,w=s.useCallback(S=>{const{status:$,type:J,step:Se}=S;if([cr.FINISHED,cr.SKIPPED].includes($)){te(!1);return}if(J===en.TARGET_NOT_FOUND){te(!1);return}J===en.STEP_BEFORE&&Se?.target==='[data-tour="template-advanced"]'&&le(!0)},[te,le]),q=s.useMemo(()=>[{target:'[data-tour="template-quickstart"]',title:"Template overview",content:"We will walk through the three key tasks: link a show, build your segment flow, and fine-tune timing before saving.",disableBeacon:!0},{target:'[data-tour="template-basics"]',title:"Start with the basics",content:v.length===0?"Create a show first so you can attach this template. Once a show exists, you will unlock publishing options here.":"Give the template a clear name and connect it to the show it belongs to. That ensures new episodes pick up the right defaults."},{target:'[data-tour="template-add"]',title:"Add your building blocks",content:"Use these buttons to add intro, content, outro, or ad segments. You can always drag to reorder later."},{target:'[data-tour="template-structure"]',title:"Customize each segment",content:it?"Edit scripts, upload clips, and adjust voices right inside this list. Drag handles let you reorder in seconds.":"Drop in a Content segment so you can drag your uploaded audio into the right spot, then adjust intros, outros, and ads here."},{target:'[data-tour="template-advanced"]',title:"Fine-tune timing & music",content:"Advanced controls handle crossfades, background music rules, and AI defaults. Open this panel whenever you need detailed tweaks."},{target:'[data-tour="template-save"]',title:"Save & reuse",content:"When everything looks right, save the template. New episodes will use these defaults automatically."}],[v.length,it]);return N?e.jsx("div",{className:"flex justify-center items-center p-10",children:e.jsx(St,{className:"w-8 h-8 animate-spin"})}):c?e.jsxs("p",{className:"text-red-500 p-4",children:["Error: ",c]}):l?e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen space-y-6",children:[e.jsx(In,{steps:q,run:me,continuous:!0,showSkipButton:!0,scrollToFirstStep:!0,disableOverlayClose:!0,callback:w,styles:{options:{zIndex:1e4}},spotlightClicks:!0}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(A,{onClick:ue,variant:"ghost",className:"text-gray-700",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Template Editor"}),e.jsxs("div",{className:"flex items-center gap-3",children:[B&&!u&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Unsaved changes"}),e.jsx(A,{onClick:He,disabled:u,className:"bg-blue-600 hover:bg-blue-700 text-white",children:u?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ra,{className:"w-4 h-4 mr-2"}),"Save Template"]})})]})]}),e.jsxs(Ce,{className:"border border-slate-200 bg-slate-50","data-tour":"template-quickstart",children:[e.jsxs(Je,{className:"flex flex-col gap-1 pb-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(Cl,{className:"h-5 w-5 text-primary","aria-hidden":"true"}),e.jsx(Xe,{className:"text-base",children:"Template quickstart"})]}),e.jsx(Zt,{className:"text-sm text-slate-600 sm:text-right",children:"Three checkpoints to get from blank template to publish-ready episodes."})]}),e.jsxs(Ae,{className:"space-y-3 text-sm text-slate-700",children:[e.jsxs("ol",{className:"list-decimal space-y-1 pl-5",children:[e.jsx("li",{children:"Name the template and attach it to the show it powers."}),e.jsx("li",{children:"Add intro, content, and outro segments—drag to match your flow."}),e.jsx("li",{children:"Open Advanced options to dial in timing, music, and AI defaults."})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"Prefer a tour? We’ll highlight each area for you."}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>{le(!1),te(!0)},children:"Start guided tour"})]})]})]}),e.jsx(Ce,{className:"shadow-sm","data-tour":"template-status",children:e.jsxs(Ae,{className:"p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Xe,{className:"text-lg",children:"Template status"}),e.jsx(Zt,{children:"Mark a template inactive to hide it from selection without deleting it."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-sm px-2 py-1 rounded-full border ${l?.is_active!==!1?"bg-green-50 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-300"}`,children:l?.is_active!==!1?"Active":"Inactive"}),e.jsx(A,{variant:"outline",onClick:()=>$e("is_active",l?.is_active===!1),children:l?.is_active!==!1?"Disable":"Enable"})]})]})}),e.jsx(Ce,{className:"shadow-sm","data-tour":"template-basics",children:e.jsxs(Ae,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx(ve,{htmlFor:"template-name",className:"text-sm font-medium text-gray-600",children:"Template Name"}),e.jsx(Ye,{id:"template-name",className:"text-2xl font-bold border-0 border-b-2 border-gray-200 focus:border-blue-500 transition-colors p-0",value:l.name||"",onChange:S=>$e("name",S.target.value)})]}),e.jsxs("div",{children:[e.jsx(ve,{className:"text-sm font-medium text-gray-600",children:"Show (Required)"}),v.length===0?e.jsx("div",{className:"mt-2 p-3 border rounded bg-yellow-50 text-sm text-yellow-700",children:"You have no shows yet. Create a show first in the Show Manager, then return to create a template."}):e.jsxs(Jt,{value:l.podcast_id||"",onValueChange:S=>$e("podcast_id",S),children:[e.jsx(Wt,{className:"mt-2",children:e.jsx(Qt,{placeholder:"Select a show"})}),e.jsx(qt,{children:v.map(S=>e.jsx(yt,{value:S.id,children:S.name},S.id))})]})]})]})}),e.jsx(_o,{token:r,templateId:l?.id??t,userTimezone:o?.timezone||null,isNewTemplate:ke,onDirtyChange:Be}),e.jsx(Ce,{className:"shadow-sm",children:e.jsx(Ae,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs(ve,{className:"text-sm font-medium text-gray-600 flex items-center gap-1",children:["Default AI Voice",e.jsx(Ds,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",title:"Set a default voice for template AI voice prompts."})]}),e.jsx("div",{className:"text-sm text-gray-800 mt-1",children:g||"Not set"})]}),e.jsx("div",{className:"mt-2 sm:mt-0",children:e.jsx(A,{variant:"outline",onClick:()=>b(!0),children:"Choose voice"})})]})})}),e.jsxs(Ce,{"data-tour":"template-add",children:[e.jsxs(Je,{children:[e.jsx(Xe,{children:"Add Segments"}),e.jsx(Zt,{children:"Add the building blocks for your episode."})]}),e.jsxs(Ae,{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(sr,{type:"intro",onClick:Re}),e.jsx(sr,{type:"content",onClick:Re,disabled:it}),e.jsx(sr,{type:"outro",onClick:Re}),e.jsx(sr,{type:"commercial",onClick:Re})]})]}),e.jsxs(Ce,{"data-tour":"template-structure",children:[e.jsxs(Je,{children:[e.jsx(Xe,{children:"Episode Structure"}),e.jsx(Zt,{children:"Drag and drop segments to reorder them."})]}),e.jsx(Ae,{children:e.jsx(sl,{onDragEnd:nt,children:e.jsx(al,{droppableId:"segments",children:S=>e.jsxs("div",{...S.droppableProps,ref:S.innerRef,className:"space-y-4",children:[l.segments.map(($,J)=>e.jsx(rl,{draggableId:$.id,index:J,isDragDisabled:$.segment_type==="content",children:(Se,We)=>e.jsx("div",{ref:Se.innerRef,...Se.draggableProps,...Se.dragHandleProps,children:e.jsx(Io,{segment:$,onDelete:()=>Le($.id),onSourceChange:Ie,mediaFiles:{intro:ie,outro:W,commercial:Ue},isDragging:We.isDragging,onOpenTTS:Ve=>{re($),z(Ve?.script??""),E(Ve?.voice_id??p??null),ee(Ve?.speaking_rate&&!Number.isNaN(Ve.speaking_rate)?Ve.speaking_rate:1),D(Ve?.friendly_name??""),Z(!0)},justCreatedTs:_e[$.id]||null,templateVoiceId:p||null,token:r,onMediaUploaded:xe})})},$.id)),S.placeholder]})})})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Advanced options"}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>le(S=>!S),children:K?"Hide advanced":"Show advanced"})]}),K&&e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[2fr_1fr]","data-tour":"template-advanced",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ce,{children:[e.jsxs(Je,{children:[e.jsxs(Xe,{className:"flex items-center gap-2",children:[e.jsx(kl,{className:"w-6 h-6 text-gray-600"})," Advanced Settings"]}),e.jsx(Zt,{children:"Fine-tune the timing and background music for your podcast."})]}),e.jsxs(Ae,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs(ve,{className:"flex items-center gap-1",children:["Content Start Delay (seconds)",e.jsx(Ds,{className:"h-3.5 w-3.5 text-muted-foreground","aria-hidden":"true",title:"Delay before main content begins after intro. Use negatives to overlap."})]}),e.jsx(Ye,{type:"number",step:"0.5",value:l.timing?.content_start_offset_s,onChange:S=>Fe("content_start_offset_s",parseFloat(S.target.value||0))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Delay / overlap (negative overlaps intro). Default 0."})]}),e.jsxs("div",{children:[e.jsxs(ve,{className:"flex items-center gap-1",children:["Outro Start Delay (seconds)",e.jsx(Ds,{className:"h-3.5 w-3.5 text-muted-foreground","aria-hidden":"true",title:"Delay before the outro begins. Use negatives to overlap."})]}),e.jsx(Ye,{type:"number",step:"0.5",value:l.timing?.outro_start_offset_s,onChange:S=>Fe("outro_start_offset_s",parseFloat(S.target.value||0))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Delay / overlap (negative overlaps content tail). Default 0."})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold mb-2 flex items-center gap-1",children:["Background Music",e.jsx(Ds,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",title:"Apply looping music or stingers to specific sections."})]}),e.jsx("div",{className:"space-y-4",children:(l.background_music_rules||[]).map((S,$)=>e.jsxs("div",{className:"p-4 border rounded-lg bg-gray-50 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(ve,{className:"font-semibold",children:["Music Rule #",$+1]}),e.jsxs(A,{variant:"destructive",size:"sm",onClick:()=>et($),children:[e.jsx($s,{className:"w-4 h-4 mr-2"}),"Remove"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ve,{children:"Apply to Section"}),e.jsxs(Jt,{value:S.apply_to_segments[0],onValueChange:J=>Ge($,"apply_to_segments",[J]),children:[e.jsx(Wt,{children:e.jsx(Qt,{})}),e.jsxs(qt,{children:[e.jsx(yt,{value:"intro",children:"Intro Section"}),e.jsx(yt,{value:"content",children:"Content Section"}),e.jsx(yt,{value:"outro",children:"Outro Section"})]})]})]}),e.jsxs("div",{children:[e.jsx(ve,{children:"Music File"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Jt,{value:S.music_filename,onValueChange:J=>Ge($,"music_filename",J),children:[e.jsx(Wt,{children:e.jsx(Qt,{placeholder:"Select music..."})}),e.jsx(qt,{children:Pe.map(J=>e.jsx(yt,{value:J.filename,children:J.friendly_name||J.filename.split("_").slice(1).join("_")},J.id))})]}),e.jsxs(A,{type:"button",variant:"outline",size:"sm",onClick:()=>Y($),disabled:xt&&dt===$,children:[xt&&dt===$?e.jsx(St,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ks,{className:"w-4 h-4 mr-2"}),"Upload"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(ve,{children:"Start Offset (sec)"}),e.jsx(Ye,{type:"number",step:"0.5",value:S.start_offset_s,onChange:J=>Ge($,"start_offset_s",parseFloat(J.target.value||0))})]}),e.jsxs("div",{children:[e.jsx(ve,{children:"End Offset (sec)"}),e.jsx(Ye,{type:"number",step:"0.5",value:S.end_offset_s,onChange:J=>Ge($,"end_offset_s",parseFloat(J.target.value||0))})]}),e.jsxs("div",{children:[e.jsx(ve,{children:"Fade In (sec)"}),e.jsx(Ye,{type:"number",step:"0.5",value:S.fade_in_s,onChange:J=>Ge($,"fade_in_s",parseFloat(J.target.value||0))})]}),e.jsxs("div",{children:[e.jsx(ve,{children:"Fade Out (sec)"}),e.jsx(Ye,{type:"number",step:"0.5",value:S.fade_out_s,onChange:J=>Ge($,"fade_out_s",parseFloat(J.target.value||0))})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ve,{className:"flex items-center gap-1",children:"Loudness"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Scale 1–11"})]}),e.jsx("div",{className:"space-y-2",children:(()=>{const J=Eo(S.volume_db),Se=Number.isFinite(J)?J:Na;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ye,{type:"range",min:"1",max:"11",step:"0.1",value:Se,onChange:We=>f($,parseFloat(We.target.value)),className:"w-full"}),e.jsx(Ye,{type:"number",min:"1",max:"11",step:"0.1",value:Se.toFixed(1),onChange:We=>f($,parseFloat(We.target.value)),className:"w-24"})]}),e.jsx("div",{className:"grid grid-cols-11 text-[10px] font-semibold uppercase tracking-wide text-muted-foreground",children:Si.map(({level:We})=>e.jsx("span",{className:"text-center",children:We},We))}),e.jsx("p",{className:"text-xs text-gray-500",children:Ao(Se)})]})})()})]})]},S.id))}),e.jsx("input",{ref:ye,type:"file",accept:"audio/*",className:"hidden",onChange:Q}),e.jsxs(A,{onClick:ct,variant:"outline",className:"mt-4",children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Add Music Rule"]})]})]})]}),e.jsx(vo,{value:l?.ai_settings||ko,onChange:S=>d($=>({...$,ai_settings:S}))})]}),e.jsxs(Ce,{className:"border border-slate-200 bg-slate-50 self-start",children:[e.jsx(Je,{children:e.jsxs(Xe,{className:"text-base flex items-center gap-2 text-slate-800",children:[e.jsx(ra,{className:"h-4 w-4 text-amber-500","aria-hidden":"true"}),"Background music cheat sheet"]})}),e.jsxs(Ae,{className:"space-y-3 text-sm text-slate-700",children:[e.jsx("p",{children:"Need a refresher on how the controls interact? Keep these guidelines in mind while you dial things in."}),e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Us,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-primary","aria-hidden":"true"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Offsets"})," slide music earlier or later. Negative values create crossfades with the neighboring segment."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Us,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-primary","aria-hidden":"true"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Fade in/out"})," smooth the transitions. Longer fades work best for ambient tracks, shorter fades for stingers."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Us,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-primary","aria-hidden":"true"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Loudness"})," now uses a 1–11 scale: 1 is barely audible, 10 matches the host, and 11 pushes the music slightly hotter."]})]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Save when things sound right—your episode builder will inherit these timing rules."})]})]})]}),e.jsx("div",{className:"flex justify-end items-center mt-6",children:e.jsx(A,{"data-tour":"template-save",onClick:He,disabled:u||!l.podcast_id||v.length===0,className:"bg-blue-600 hover:bg-blue-700 text-white",children:u?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ra,{className:"w-4 h-4 mr-2"}),"Save Template"]})})}),M&&e.jsx($a,{value:p||null,onChange:S=>C(S),onSelect:S=>U(S?.common_name||S?.name||null),onClose:()=>b(!1),token:r}),e.jsx(na,{open:se,onOpenChange:S=>{Z(S)},children:e.jsxs(Hs,{className:"sm:max-w-[600px]",children:[e.jsxs(Gs,{children:[e.jsx(Ks,{children:"Generate with AI voice (one-time)"}),e.jsx(Ns,{children:"We'll synthesize this once and save it to your library. You won't need to regenerate it every episode."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{children:[e.jsx(ve,{children:"Script"}),e.jsx(bs,{value:O,onChange:S=>{z(S.target.value);const $=(S.target.value||"").trim().split(/\s+/).slice(0,6).join(" "),J=F?F.segment_type.charAt(0).toUpperCase()+F.segment_type.slice(1):"Segment";he||D(`${J} AI voice – ${$}`.trim())},placeholder:"e.g., Welcome to the show...",className:"mt-1",rows:5})]}),e.jsxs("div",{children:[e.jsx(ve,{children:"Voice"}),e.jsxs(Jt,{value:P||"",onValueChange:S=>E(S),children:[e.jsx(Wt,{className:"mt-1",children:e.jsx(Qt,{placeholder:"Select a voice"})}),e.jsx(qt,{children:H.map(S=>e.jsx(yt,{value:S.voice_id||S.id||"",children:S.common_name||S.name||S.voice_id||S.id},S.voice_id||S.id||S.name))})]})]}),e.jsxs("div",{children:[e.jsx(ve,{children:"Friendly name (optional)"}),e.jsx(Ye,{value:he,onChange:S=>D(S.target.value),placeholder:"e.g., Victoria's Intro"})]})]}),e.jsxs(ia,{children:[e.jsx(A,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),e.jsx(A,{disabled:V||!O||!P,onClick:async()=>{if(F){je(!0);try{const S=F.segment_type,$=S==="intro"||S==="outro"||S==="commercial"?S:"sfx";let J=!1;try{const Ct=await G(r).post("/api/media/tts/precheck",{text:O,speaking_rate:ne&&!Number.isNaN(ne)?ne:1,category:$});if(Ct?.spam_block){wt({variant:"destructive",title:"Please wait",description:Ct?.message||"You just created a similar clip. Please wait a few seconds or reuse it."}),je(!1);return}if(Ct?.warn_may_cost){if(!window.confirm(Ct?.message||"We noticed high usage here. Anything else you create may count against your plan's minutes. Continue?")){je(!1);return}J=!0}}catch{}const Se=await So({text:O,voice_id:P,provider:"elevenlabs",category:$,friendly_name:he&&he.trim()?he.trim():void 0,speaking_rate:ne&&!Number.isNaN(ne)?ne:void 0,confirm_charge:J}),We=Se?.filename;if(!We)throw new Error("AI voice did not return a filename");const Ve={id:Se?.id||crypto.randomUUID(),filename:We,friendly_name:Se?.friendly_name||he||We,category:$,content_type:"audio/mpeg"};xe(Ve),Ie(F.id,{source_type:"static",filename:We}),T(lt=>({...lt,[F.id]:Date.now()}));try{wt({title:"AI voice ready",description:"Audio saved to Media and linked to this segment."})}catch{}Z(!1)}catch(S){const $=S?.detail?.error?.message||S?.detail,J=(typeof $=="string"?$:S?.message)||"Could not create audio.";wt({variant:"destructive",title:"AI voice failed",description:J})}finally{je(!1)}}},children:V?"Creating clip...":"Create clip"})]})]})})]}):null}const Io=({segment:t,onDelete:a,onSourceChange:r,mediaFiles:n,isDragging:o,onOpenTTS:l,justCreatedTs:d,templateVoiceId:N,token:i,onMediaUploaded:u})=>{const j=n[t.segment_type]||[],[c,m]=s.useState(!1),I=(t?.source?.filename||"").trim(),x=j.find(E=>E.filename===I),v=/\.(mp3|wav|m4a|aac|flac|ogg)$/i.test(I),_=!!I&&(I.toLowerCase().startsWith("file-")||!v),k=!I||!x,[h,y]=s.useState(I),[p,C]=s.useState(!1),[M,b]=s.useState(null),g=s.useRef(null),[U,se]=s.useState(!1),[Z,F]=s.useState(0);s.useEffect(()=>{if(!d){F(0);return}let E;const ne=()=>{const ee=Math.floor((Date.now()-d)/1e3),he=Math.max(0,30-ee);F(he)};return ne(),30-Math.floor((Date.now()-d)/1e3)>0&&(E=setInterval(ne,1e3)),()=>{E&&clearInterval(E)}},[d]),s.useEffect(()=>{const E=t?.source?.voice_id;if(!E){b(null);return}let ne=!1;return(async()=>{try{const he=await G(i).get(`/api/elevenlabs/voice/${encodeURIComponent(E)}/resolve`),D=he?.common_name||he?.name||null;ne||b(D)}catch{}})(),()=>{ne=!0}},[t?.source?.voice_id,i]);const re=(E,ne)=>{const ee={...t.source,[E]:ne};E==="source_type"&&(ee.prompt=void 0,ee.script=void 0,ne==="static"&&(ee.filename=""),ne==="tts"&&(ee.voice_id=t?.source?.voice_id||N||null,ee.text_prompt=t?.source?.text_prompt||"",delete ee.filename)),r(t.id,ee)},O=async E=>{if(E){se(!0);try{const ne=G(i),ee=new FormData;ee.append("files",E);const he=t.segment_type,D=he==="intro"||he==="outro"||he==="commercial"?he:"sfx",H=await ne.raw(`/api/media/upload/${D}`,{method:"POST",body:ee}),ge=Array.isArray(H)?H[0]:H,V=ge&&ge.filename?{id:ge.id||crypto.randomUUID(),filename:ge.filename,friendly_name:ge.friendly_name||void 0,category:D,content_type:ge.content_type||"audio/mpeg"}:null;if(!V)throw new Error("Upload succeeded but no file was returned.");typeof u=="function"&&u(V),r(t.id,{source_type:"static",filename:V.filename})}catch(ne){try{wt({variant:"destructive",title:"Upload failed",description:ne?.message||"Could not upload audio."})}catch{}}finally{se(!1);try{g.current&&(g.current.value="")}catch{}}}};if(t.segment_type==="content")return e.jsxs(Ce,{className:`transition-shadow ${o?"shadow-2xl scale-105":"shadow-md"} border-green-500 border-2`,children:[e.jsxs(Je,{className:"flex flex-row items-center justify-between p-4 bg-green-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(tn,{className:"w-5 h-5 text-gray-400"}),$r.content,e.jsx("span",{className:"font-semibold text-green-800",children:"Main Content"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Cannot be deleted"})]}),e.jsx(Ae,{className:"p-6",children:e.jsx("p",{className:"text-gray-600 italic",children:"The main content for your episode will be added here during episode creation. This block serves as a placeholder for its position in the template."})})]});const z=t?.source?.source_type,P=z==="ai_generated"||z==="tts"&&(typeof t?.source?.script=="string"||typeof t?.source?.prompt=="string");return e.jsxs(Ce,{className:`transition-shadow ${o?"shadow-2xl scale-105":"shadow-md"}`,children:[e.jsxs(Je,{className:"flex flex-row items-center justify-between p-4 bg-gray-100 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(tn,{className:"w-5 h-5 text-gray-400"}),$r[t.segment_type],e.jsx("span",{className:"font-semibold text-gray-800",children:t.segment_type.charAt(0).toUpperCase()+t.segment_type.slice(1)}),d?e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 border border-blue-200",children:"Created with AI voice"}):null,t?.source?.source_type==="static"&&k&&e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-yellow-50 text-yellow-800 border border-yellow-200",title:_?"This looks like a temporary file id. Choose another audio file.":"The referenced audio file could not be found. Select an audio file to reconnect it.",children:"Missing audio file"})]}),e.jsx(A,{variant:"ghost",size:"icon",onClick:a,className:"text-red-500 hover:bg-red-100 hover:text-red-700 w-8 h-8",children:e.jsx($s,{className:"w-4 h-4"})})]}),e.jsxs(Ae,{className:"p-6 space-y-4",children:[P&&e.jsxs("div",{className:"p-3 rounded-md border border-yellow-200 bg-yellow-50 text-yellow-800 flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-sm",children:"Legacy segment type. Convert to file (recommended)."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{size:"sm",variant:"outline",onClick:()=>{const E={script:t?.source?.script||t?.source?.prompt||"",voice_id:t?.source?.voice_id||void 0,speaking_rate:t?.source?.speaking_rate||void 0,friendly_name:`${t.segment_type.charAt(0).toUpperCase()+t.segment_type.slice(1)} AI voice – Legacy`};l(E)},children:"Convert now"}),e.jsx(A,{size:"sm",variant:"ghost",children:"Keep legacy"})]})]}),e.jsxs("div",{children:[e.jsxs(ve,{className:"text-sm font-medium text-gray-600 flex items-center gap-1",children:["Audio Source",e.jsx(Ds,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",title:"Choose between existing audio files or per-episode AI voice prompts."})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(Jt,{value:t?.source?.source_type||"static",onValueChange:E=>re("source_type",E),children:[e.jsx(Wt,{className:"w-full mt-1",children:e.jsx(Qt,{placeholder:"Select source type..."})}),e.jsxs(qt,{children:[e.jsxs(yt,{value:"static",children:[dn.static," Audio file (upload or choose)"]}),e.jsxs(yt,{value:"tts",children:[dn.tts," Per episode AI voice"]})]})]})}),e.jsxs(A,{type:"button",variant:"outline",onClick:()=>l(),disabled:Z>0,children:[e.jsx(Ys,{className:"w-4 h-4 mr-2"}),Z>0?`Generate with AI voice (${Z}s)`:"Generate with AI voice (one-time)"]}),d&&Z>0&&e.jsx("span",{className:"text-xs text-muted-foreground",title:"We saved the last AI voice clip in your Media. Reuse it or wait a moment before creating another.",children:"Recently created — reuse the saved file or wait a moment."}),t?.source?.source_type==="static"&&k&&e.jsx(A,{type:"button",variant:"secondary",size:"sm",title:"Select an existing audio file for this segment",onClick:()=>{y(I||""),m(!0)},children:"Choose audio"})]})]}),e.jsxs("div",{children:[t?.source?.source_type==="static"&&e.jsxs("div",{children:[e.jsx(ve,{children:"Audio File"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(Jt,{value:x?t.source.filename:"",onValueChange:E=>re("filename",E),children:[e.jsx(Wt,{className:"w-full",children:e.jsx(Qt,{placeholder:`Select a ${t.segment_type} file...`})}),e.jsx(qt,{children:j.map(E=>e.jsx(yt,{value:E.filename,children:E.friendly_name||E.filename.split("_").slice(1).join("_")},E.id))})]}),e.jsx(A,{variant:"outline",size:"icon",onClick:()=>g.current?.click(),disabled:U,children:U?e.jsx(St,{className:"w-4 h-4 animate-spin"}):e.jsx(ks,{className:"w-4 h-4"})}),e.jsx("input",{type:"file",ref:g,className:"hidden",accept:"audio/*",onChange:E=>O(E.target.files?.[0])})]})]}),t?.source?.source_type==="tts"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(ve,{children:"Prompt Label (shown during episode creation)"}),e.jsx(Ye,{value:t?.source?.text_prompt||"",onChange:E=>re("text_prompt",E.target.value),placeholder:"e.g., Intro script"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(ve,{children:"Default Voice (optional)"}),e.jsx("div",{className:"text-sm text-gray-800 mt-1",children:M||t?.source?.voice_id||"Not set"})]}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>C(!0),children:"Choose voice"})]}),p&&e.jsx($a,{value:t?.source?.voice_id||N||null,onChange:E=>re("voice_id",E),onSelect:E=>b(E?.common_name||E?.name||null),onClose:()=>C(!1),token:i}),e.jsx("p",{className:"text-xs text-gray-500",children:"This will create a text box during episode creation. The audio is generated per episode."})]})]})]}),e.jsx(na,{open:c,onOpenChange:m,children:e.jsxs(Hs,{className:"sm:max-w-[520px]",children:[e.jsxs(Gs,{children:[e.jsx(Ks,{children:"Reconnect audio file"}),e.jsx(Ns,{children:"Pick an existing audio item to reconnect this segment."})]}),e.jsx("div",{className:"space-y-3 py-2",children:e.jsxs("div",{children:[e.jsx(ve,{children:"Select file"}),e.jsxs(Jt,{value:h||"",onValueChange:y,children:[e.jsx(Wt,{className:"mt-1",children:e.jsx(Qt,{placeholder:`Select a ${t.segment_type} file...`})}),e.jsx(qt,{children:j.map(E=>e.jsx(yt,{value:E.filename,children:E.friendly_name||E.filename.split("_").slice(1).join("_")},E.id))})]}),j.length===0&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"No files available for this section yet."})]})}),e.jsxs(ia,{children:[e.jsx(A,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(A,{disabled:!h,onClick:()=>{h&&(r(t.id,{source_type:"static",filename:h}),m(!1))},children:"Use audio"})]})]})})]})};function To({token:t,templates:a,initialStep:r,testInject:n,preselectedMainFilename:o,preselectedTranscriptReady:l,creatorMode:d="standard",preselectedStartStep:N}){const{user:i}=Ht(),[u,j]=s.useState(r||1),[c,m]=s.useState(null),[I,x]=s.useState(null),[v,_]=s.useState(null),[k,h]=s.useState(null),[y,p]=s.useState(!1),C=s.useRef(null),[M,b]=s.useState(!1),[g,U]=s.useState(!1),[se,Z]=s.useState(!1),[F,re]=s.useState(null),[O,z]=s.useState(null),[P,E]=s.useState(""),[ne,ee]=s.useState(""),[he,D]=s.useState({}),[H,ge]=s.useState([]),[V,je]=s.useState(!1),[_e,T]=s.useState(null),[K,le]=s.useState(null),[me,te]=s.useState(!1),Ne=s.useRef(!1),[Be,ke]=s.useState({flubber:null,intern:null,sfx:null}),[De,B]=s.useState({flubber:null,intern:null,sfx:null}),[xe,ie]=s.useState(!0),[W,Pe]=s.useState(!1),[Ue,$e]=s.useState({has_elevenlabs:!1,has_google_tts:!1,has_any_sfx_triggers:!1}),[Fe,Ge]=s.useState(!1),[ct,et]=s.useState(.8),[dt,jt]=s.useState(!1),[xt,R]=s.useState(null),[ye,ae]=s.useState(null),[f,Y]=s.useState({season:"1",episodeNumber:"",title:"",description:"",coverArt:null,coverArtPreview:null,cover_image_path:null,cover_crop:null}),[Q,ue]=s.useState(!1),[Ie,Re]=s.useState(!1),Le=s.useRef({title:null,notes:null,tags:null}),nt=s.useRef(""),He=s.useRef({templateId:null,date:null,time:null,manual:!1}),it=s.useRef(!1),[w,q]=s.useState(null),[S,$]=s.useState([]),[J,Se]=s.useState(null),[We,Ve]=s.useState("draft"),[lt,Ct]=s.useState("public"),[Et,ut]=s.useState(""),[mt,we]=s.useState(""),[Ee,Me]=s.useState(!1),[Ze,tt]=s.useState(null),[ot,ft]=s.useState(!1),[Rt,Tt]=s.useState(!1),[Gt,hs]=s.useState(null),[ps,os]=s.useState({}),[_s,At]=s.useState(!1),vt=s.useRef(null),Ss=s.useRef(null),us=s.useRef(null),[bt,zt]=s.useState(!1),[js,es]=s.useState("crop"),[xs,Is]=s.useState(!1),[Os,ls]=s.useState(null),[fs,ms]=s.useState(null),Wa=s.useMemo(()=>{if(u>=6)return!1;const L=!!(I||v),ce=!!(f?.coverArt||f?.cover_image_path);return!!(y||M||g||Ee||L||ce)},[u,y,M,g,Ee,I,v,f]);s.useEffect(()=>{let L=!1;try{o&&!v&&(_(o),B({flubber:null,intern:null,sfx:null}),ie(!1),j(typeof N=="number"?N:5),l===!0&&(ft(!0),it.current=!0),L=!0)}catch{}if(!L){try{const ce=localStorage.getItem("ppp_uploaded_filename"),fe=localStorage.getItem("ppp_uploaded_hint"),be=localStorage.getItem("ppp_start_step"),oe=localStorage.getItem("ppp_transcript_ready");v||(ce?(_(ce),B({flubber:null,intern:null,sfx:null}),ie(!1)):fe&&(_(fe),B({flubber:null,intern:null,sfx:null}),ie(!1))),be==="5"&&j(5),oe==="1"&&(ft(!0),it.current=!0)}catch{}try{localStorage.removeItem("ppp_start_step"),localStorage.removeItem("ppp_transcript_ready")}catch{}}},[o,l,v]),s.useEffect(()=>{if(n)try{n.selectedTemplate&&m(n.selectedTemplate),n.uploadedFilename&&_(n.uploadedFilename),typeof n.transcriptReady=="boolean"&&ft(!!n.transcriptReady),n.episodeDetails&&Y(L=>({...L,...n.episodeDetails}))}catch{}},[n]),s.useEffect(()=>{if(c||!Array.isArray(a))return;const L=a.filter(ce=>ce?.is_active!==!1);L.length===1&&(m(L[0]),u===1&&j(2))},[a,c,u]),s.useEffect(()=>{const L=c?.id||null;if(!L){He.current={templateId:null,date:null,time:null,manual:!1};return}He.current.templateId!==L&&(He.current={templateId:L,date:null,time:null,manual:!1})},[c?.id]);const gs=s.useCallback(async()=>{try{const ce=await G(t).get("/api/billing/usage");return ce&&R(ce),ce}catch{return null}},[t]);s.useEffect(()=>{const L=G(t),ce=async()=>{try{const be=await L.get("/api/media/");ge(Fa(be))}catch(be){ee(be.message)}},fe=async()=>{};ce(),fe(),(async()=>{try{if(!!!(i&&(i.is_admin||i.role==="admin"))){jt(!1);return}const oe=await L.get("/api/admin/settings");oe&&typeof oe.test_mode<"u"&&jt(!!oe.test_mode)}catch{jt(!1)}})(),gs(),(async()=>{try{const be=await L.get("/api/users/me/capabilities");be&&$e({has_elevenlabs:!!be.has_elevenlabs,has_google_tts:!!be.has_google_tts,has_any_sfx_triggers:!!be.has_any_sfx_triggers})}catch{}})()},[t,i,gs]),s.useEffect(()=>{const L=c?.id;if(!L||!t)return;const ce=He.current;if(ce.manual&&ce.templateId===L||ce.templateId===L&&ce.date&&ce.time&&!ce.manual)return;let fe=!1;return(async()=>{try{const oe=await G(t).get(`/api/recurring/templates/${L}/next`);if(fe)return;const Oe=oe?.next_publish_date,qe=oe?.next_publish_time;Oe&&qe?(ut(Oe),we(qe),Ve(st=>st==="now"?st:"schedule"),He.current={templateId:L,date:Oe,time:qe,manual:!1}):He.current={templateId:L,date:null,time:null,manual:!1}}catch(be){console.warn("Failed to fetch template recurring slot",be)}})(),()=>{fe=!0}},[c?.id,t]),s.useEffect(()=>{const L=He.current;!L.templateId||L.manual||!L.date||!L.time||(Et!==L.date||mt!==L.time)&&(L.manual=!0)},[Et,mt]);const Js=Ue.has_elevenlabs||Ue.has_google_tts,Ts=Ue.has_any_sfx_triggers,Sa={flubber:!0,intern:Js,sfx:Ts},la=L=>L==="yes"||L==="no"||L==="unknown"?L:null,qa=(L,ce)=>{["flubber","intern","sfx"].includes(L)&&ke(fe=>{const be=la(ce);return{...fe,[L]:be===null?fe?.[L]??null:be}})},rs=[];Be.flubber===null&&rs.push("Flubber"),Js&&Be.intern===null&&rs.push("Intern"),Ts&&Be.sfx===null&&rs.push("Sound Effects");const oa=rs.length===0;s.useEffect(()=>{if(!I){ms(null);return}let L=null;const ce=new Audio,fe=()=>{const oe=ce&&isFinite(ce.duration)?ce.duration:null;ms(oe&&oe>0?oe:null),L&&URL.revokeObjectURL(L)},be=()=>{ms(null),L&&URL.revokeObjectURL(L)};ce.addEventListener("loadedmetadata",fe),ce.addEventListener("error",be);try{L=URL.createObjectURL(I),ce.src=L,ce.load()}catch{if(ms(null),L)try{URL.revokeObjectURL(L)}catch{}}return()=>{if(ce.removeEventListener("loadedmetadata",fe),ce.removeEventListener("error",be),L)try{URL.revokeObjectURL(L)}catch{}}},[I]);const jr=s.useMemo(()=>{if(!Rt||!Gt||!c?.segments)return null;try{return c.segments.find(L=>L.id===Gt)||null}catch{return null}},[Rt,Gt,c]),Va=L=>{Gt&&m(ce=>{if(!ce?.segments)return ce;const fe=ce.segments.map(be=>be.id===Gt&&be?.source?.source_type==="tts"?{...be,source:{...be.source,voice_id:L}}:be);return{...ce,segments:fe}})};s.useEffect(()=>{if(u!==3)return;const L=new Set;try{(c?.segments||[]).forEach(be=>{if(be?.source?.source_type==="tts"&&be?.source?.voice_id){const oe=String(be.source.voice_id);oe&&oe.toLowerCase()!=="default"&&L.add(oe)}})}catch{}if(!L.size)return;let ce=!0;for(const be of L)if(!ps[be]){ce=!1;break}if(ce)return;let fe=!1;return(async()=>{try{At(!0);const be=await yr("",1,200),oe={};for(const qe of be?.items||[]){const st=qe.common_name||qe.name||"";st&&(oe[qe.voice_id]=st)}fe||os(qe=>({...qe,...oe}));const Oe=Array.from(L).filter(qe=>qe&&qe.toLowerCase()!=="default"&&!oe[qe]);if(Oe.length){const qe=G(t);for(const st of Oe)try{const Ke=await qe.get(`/api/elevenlabs/voice/${encodeURIComponent(st)}/resolve`),_t=Ke?.common_name||Ke?.name||"";_t&&!fe&&os(kt=>({...kt,[st]:_t}))}catch{}}}catch{}finally{fe||At(!1)}})(),()=>{fe=!0}},[u,c?.id,t]);const Qs=s.useMemo(()=>{if(!fs||!isFinite(fs)||fs<=0)return null;const L=fs/60,ce=Math.max(0,Math.floor(L*.75)),fe=Math.max(1,Math.ceil(L*1.25));return{low:ce,high:fe}},[fs]),ts=s.useRef(!1);s.useEffect(()=>{try{const L=localStorage.getItem("ppp_publish_mode");L&&["now","draft","schedule"].includes(L)&&Ve(L),ts.current=!!L;const ce=localStorage.getItem("ppp_publish_visibility");ce&&["public","unpublished"].includes(ce)&&Ct(ce),localStorage.getItem("ppp_explicit_flag")==="true"&&Y(kt=>({...kt,is_explicit:!0}));const be=localStorage.getItem("ppp_schedule_datetime");let oe;if(be){const kt=new Date(be);!isNaN(kt.getTime())&&kt.getTime()>Date.now()+10*6e4&&(oe=kt)}if(!oe){oe=new Date(Date.now()+60*6e4);const kt=oe.getMinutes(),ns=Math.ceil(kt/5)*5;ns>=60?(oe.setHours(oe.getHours()+1),oe.setMinutes(0)):oe.setMinutes(ns),oe.setSeconds(0,0)}const Oe=oe.getFullYear(),qe=String(oe.getMonth()+1).padStart(2,"0"),st=String(oe.getDate()).padStart(2,"0"),Ke=String(oe.getHours()).padStart(2,"0"),_t=String(oe.getMinutes()).padStart(2,"0");ut(`${Oe}-${qe}-${st}`),we(`${Ke}:${_t}`)}catch{}},[]),s.useEffect(()=>{try{if(c?.ai_settings?.auto_generate_tags===!1){const L=localStorage.getItem("ppp_last_tags");L&&!f.tags&&Y(ce=>({...ce,tags:L}))}}catch{}},[c]),s.useEffect(()=>{ts.current||Ve(dt?"draft":"now")},[dt]),s.useEffect(()=>{try{localStorage.setItem("ppp_publish_mode",We)}catch{}},[We]),s.useEffect(()=>{try{localStorage.setItem("ppp_publish_visibility",lt)}catch{}},[lt]),s.useEffect(()=>{try{if(Et&&mt){const L=new Date(`${Et}T${mt}:00`).toISOString();localStorage.setItem("ppp_schedule_datetime",L)}}catch{}},[Et,mt]),s.useEffect(()=>{try{localStorage.setItem("ppp_explicit_flag",f.is_explicit?"true":"false")}catch{}},[f.is_explicit]),s.useEffect(()=>{try{c?.ai_settings?.auto_generate_tags===!1&&f.tags?localStorage.setItem("ppp_last_tags",f.tags):localStorage.removeItem("ppp_last_tags")}catch{}},[f.tags,c]),s.useEffect(()=>{if(u!==5||!c||!ot)return;const L=`${v||""}|${O||""}|${c?.id||""}`;if(nt.current===L)return;const ce=!!c?.ai_settings?.auto_fill_ai,fe=c?.ai_settings?.auto_generate_tags!==!1,be=c?.ai_settings?.tags_always_include||[];(async()=>{try{if(ce&&!f.title){ue(!0);const oe=await Ja();oe&&!/[a-f0-9]{16,}/i.test(oe)&&Bs("title",oe)}}finally{ue(!1)}try{if(ce&&!f.description?.length){Re(!0);const oe=await Qa();oe&&!/[a-f0-9]{16,}/i.test(oe)&&Bs("description",oe)}}finally{Re(!1)}if(fe){const oe=await Nr(),Oe=new Set,qe=[];for(const st of[...be,...oe]){const Ke=String(st).trim();if(!Ke)continue;const _t=Ke.toLowerCase();if(Oe.has(_t)||(Oe.add(_t),qe.push(Ke)),qe.length>=20)break}qe.sort((st,Ke)=>st.localeCompare(Ke)),Bs("tags",qe.join(", "))}nt.current=L})()},[u,c?.id,ot,v,O]),s.useEffect(()=>{it.current=ot},[ot]),s.useEffect(()=>{Le.current={title:null,notes:null,tags:null},nt.current="",u===5&&ft(!1)},[v,O,c?.id]),s.useEffect(()=>{if(u!==5||!v&&!O||ot)return;let L=!1;const ce=G(t),fe=async()=>{if(!L){try{const oe=[];O&&oe.push(`episode_id=${encodeURIComponent(O)}`),v&&oe.push(`hint=${encodeURIComponent(v)}`);const Oe=`/api/ai/transcript-ready${oe.length?`?${oe.join("&")}`:""}`;if((await ce.get(Oe))?.ready){ft(!0);return}}catch{}L||setTimeout(fe,5e3)}},be=setTimeout(fe,250);return()=>{L=!0,clearTimeout(be)}},[u,v,O,t,ot]),s.useEffect(()=>{if(!ot||!v&&!O)return;let L=!1;const ce=G(t);ie(!1),B({flubber:null,intern:null,sfx:null});const fe=[];O&&fe.push(`episode_id=${encodeURIComponent(O)}`),v&&fe.push(`hint=${encodeURIComponent(v)}`);const be=`/api/ai/intent-hints${fe.length?`?${fe.join("&")}`:""}`,oe=async(Oe=0)=>{try{const qe=await ce.get(be);if(L)return;const st=qe&&qe.intents?qe.intents:{};B(st);const Ke=Number(st?.flubber?.count??0),_t=Number(st?.intern?.count??0),kt=Number(st?.sfx?.count??0);ke(ns=>{const Xs={...ns};let ha=!1;return ns.flubber===null&&Ke===0&&(Xs.flubber="no",ha=!0),ns.intern===null&&_t===0&&(Xs.intern="no",ha=!0),ns.sfx===null&&kt===0&&(Xs.sfx="no",ha=!0),ha?Xs:ns}),ie(!0)}catch(qe){if(L)return;const st=qe&&typeof qe=="object"?qe.status:null;if(st&&[404,409,425].includes(st)&&Oe<5){setTimeout(()=>{L||oe(Oe+1)},750);return}B(null),ie(!0)}};return oe(),()=>{L=!0}},[ot,v,O,t]),s.useEffect(()=>{if(c||!Array.isArray(a))return;const L=a.filter(ce=>ce?.is_active!==!1);L.length===1&&(m(L[0]),u===1&&j(2))},[a,c,u]);const zs=s.useCallback(async()=>{try{const L=G(t),ce=[];c&&c.podcast_id&&ce.push(`podcast_id=${encodeURIComponent(c.podcast_id)}`);const fe=`/api/episodes/last/numbering${ce.length?`?${ce.join("&")}`:""}`,be=await L.get(fe);Y(be?oe=>{if(oe.episodeNumber&&String(oe.episodeNumber).trim()||oe.season&&String(oe.season).trim()!=="1")return oe;const Oe=be.season_number!=null?String(be.season_number):"1",qe=be.episode_number!=null?String(Number(be.episode_number)+1):"1";return{...oe,season:Oe,episodeNumber:qe}}:oe=>oe.episodeNumber&&String(oe.episodeNumber).trim()||oe.season&&String(oe.season).trim()!=="1"?oe:{...oe,season:"1",episodeNumber:"1"})}catch{}},[t,c?.podcast_id]);s.useEffect(()=>{zs()},[zs]),s.useEffect(()=>{u===5&&zs()},[u,zs]),s.useEffect(()=>{if(!w)return;const L=G(t),ce=setInterval(async()=>{try{const fe=await L.get(`/api/episodes/status/${w}`);if(E(fe.status),fe.status==="processed"||fe.status==="error")if(clearInterval(ce),b(!1),fe.status==="processed"){if(fe.episode&&O&&fe.episode.id&&fe.episode.id!==O){b(!0),setTimeout(()=>{q(be=>be)},750);return}Z(!0),re(fe.episode),We==="schedule"?wt({title:"Scheduled",description:"Episode assembled & ready to schedule."}):We==="draft"&&wt({title:"Draft Ready",description:"Episode assembled (draft)."})}else ee(fe.error||"An error occurred during processing."),wt({variant:"destructive",title:"Error",description:fe.error||"An error occurred during processing."})}catch{clearInterval(ce),ee("Failed to poll for job status."),b(!1)}},5e3);return()=>clearInterval(ce)},[w,t,O,We]);const Ft=s.useMemo(()=>[{number:1,title:"Select Template",icon:"BookText"},{number:2,title:d==="preuploaded"?"Choose Audio":"Upload Audio",icon:d==="preuploaded"?"Library":"FileUp"},{number:3,title:"Customize Segments",icon:"Wand2"},{number:4,title:"Cover Art",icon:"FileImage"},{number:5,title:"Details & Schedule",icon:"Settings"},{number:6,title:"Assemble",icon:"Globe"}],[d]),Ya=(u-1)/(Ft.length-1)*100,Ha=async L=>{try{const fe=await G(t).get(`/api/templates/${L.id}`),oe={...L,...fe,ai_settings:{...{auto_fill_ai:!0,title_instructions:"",notes_instructions:"",tags_instructions:"",tags_always_include:[],auto_generate_tags:!0},...fe?.ai_settings||L?.ai_settings||{}}},Oe=Array.isArray(oe.segments)?[...oe.segments]:[],qe=Oe.find(Ke=>Ke?.source?.source_type==="tts"&&Ke?.source?.voice_id)?.source?.voice_id||null,st=Oe.map(Ke=>Ke?.source?.source_type==="tts"?{...Ke,source:{...Ke.source,voice_id:Ke.source.voice_id||qe||Ke.source.voice_id}}:Ke);m({...oe,segments:st})}catch{const ce={auto_fill_ai:!0,title_instructions:"",notes_instructions:"",tags_instructions:"",tags_always_include:[],auto_generate_tags:!0};m(fe=>({...L||fe,ai_settings:{...ce,...(L||{}).ai_settings||{}}}))}j(2)},Ga=async L=>{if(!L)return;const ce=1024*1024;if(!(L.type||"").toLowerCase().startsWith("audio/")){ee("Please select an audio file.");return}let fe=500;try{const st=await(await fetch("/api/public/config")).json().catch(()=>({})),Ke=parseInt(String(st?.max_upload_mb||"500"),10);isFinite(Ke)&&!isNaN(Ke)&&(fe=Math.min(Math.max(Ke,10),2048))}catch{}if(L.size>fe*ce){ee(`Audio exceeds ${fe}MB limit.`);return}x(L),ke({flubber:null,intern:null,sfx:null}),B({flubber:null,intern:null,sfx:null}),ie(!1),te(!1),Ne.current=!1,p(!0),ls(0),E("Uploading audio file..."),ee("");const be=new FormData;be.append("files",L),be.append("friendly_names",JSON.stringify([L.name]));const oe=t||(()=>{try{return localStorage.getItem("authToken")}catch{return null}})(),Oe=()=>new Promise((qe,st)=>{try{if(typeof XMLHttpRequest>"u"){G(t).raw("/api/media/upload/main_content",{method:"POST",body:be}).then(qe).catch(st);return}const Ke=new XMLHttpRequest;C.current=Ke,Ke.open("POST",Vt("/api/media/upload/main_content")),Ke.withCredentials=!0,oe&&Ke.setRequestHeader("Authorization",`Bearer ${oe}`),Ke.responseType="json",Ke.upload.onprogress=_t=>{if(!_t.lengthComputable)return;const kt=Math.min(100,Math.round(_t.loaded/_t.total*100));ls(kt)},Ke.onerror=()=>{st(new Error("Upload failed. Please try again."))},Ke.onload=()=>{C.current=null;const _t=(()=>{if(Ke.response!=null)return Ke.response;try{return JSON.parse(Ke.responseText||"")}catch{return null}})();if(Ke.status>=200&&Ke.status<300){qe(_t);return}const kt=_t&&(_t.error||_t.detail||_t.message)||`Upload failed with status ${Ke.status}`;st(new Error(kt))},Ke.onabort=()=>{C.current=null,st(new Error("Upload cancelled"))},Ke.send(be)}catch(Ke){st(Ke)}});try{const qe=await Oe(),Ke=(Array.isArray(qe)?qe:qe?.files||[])[0]?.filename;_(Ke);try{Ke&&localStorage.setItem("ppp_uploaded_filename",Ke)}catch{}E("Upload successful!"),ls(100)}catch(qe){ee(qe.message),E(""),x(null);try{localStorage.removeItem("ppp_uploaded_filename")}catch{}ls(null)}finally{p(!1),setTimeout(()=>ls(null),400)}},ca=s.useCallback(L=>{if(!L){h(null),_(null),ft(!1),it.current=!1,B({flubber:null,intern:null,sfx:null}),ie(!1),ke({flubber:null,intern:null,sfx:null});return}const ce=L.filename||null;if(h(ce),x(null),ce){_(ce);try{localStorage.setItem("ppp_uploaded_filename",ce)}catch{}}const fe=!!L.transcript_ready;ft(fe),it.current=fe;const be=L.intents||{};B(be),ie(!0),ke(oe=>{const Oe={...oe},qe=Number(be?.flubber?.count??0),st=Number(be?.intern?.count??0),Ke=Number(be?.sfx?.count??0);return qe===0?Oe.flubber="no":Oe.flubber===null&&(Oe.flubber="yes"),st===0?Oe.intern="no":Oe.intern===null&&(Oe.intern="yes"),Ke===0?Oe.sfx="no":Oe.sfx===null&&(Oe.sfx="yes"),Oe})},[]);s.useEffect(()=>{u===2&&(I||v)&&xe&&!oa&&!Ne.current&&(te(!0),Ne.current=!0)},[u,I,v,oa,xe]);const vr=()=>{try{C.current&&typeof C.current.abort=="function"&&C.current.abort()}catch{}try{localStorage.removeItem("ppp_uploaded_filename"),localStorage.removeItem("ppp_uploaded_hint"),localStorage.removeItem("ppp_start_step"),localStorage.removeItem("ppp_transcript_ready")}catch{}x(null),_(null),ls(null),ft(!1),it.current=!1,ke({flubber:null,intern:null,sfx:null}),B({flubber:null,intern:null,sfx:null}),ie(!0),te(!1),E(""),ee(""),j(1);try{if(window.dispatchEvent(new Event("ppp:navigate-dashboard")),typeof window<"u"){const L=window.location.origin||"",ce=L?`${L}/`:"/";window.location.hash&&!window.location.pathname.includes("/dashboard")?window.location.href=L+"/":window.location.href=ce}}catch{}},Ca=async L=>{if(!(L?.type||"").toLowerCase().startsWith("image/"))throw new Error("Cover must be an image file.");if(L.size>15*1048576)throw new Error("Cover image exceeds 15MB limit.");const be=new FormData;be.append("files",L),be.append("friendly_names",JSON.stringify([L.name]));const oe=G(t),Oe=new AbortController,qe=(()=>{if(!L?.size)return 45e3;const ns=15e3+Math.ceil(L.size/1048576)*4e3;return Math.min(Math.max(ns,2e4),9e4)})(),st=setTimeout(()=>Oe.abort(),qe);let Ke;try{Ke=await oe.raw("/api/media/upload/episode_cover",{method:"POST",body:be,signal:Oe.signal})}catch(kt){try{const ns=new FormData;ns.append("file",L);const Xs=new AbortController,ha=setTimeout(()=>Xs.abort(),qe);let Xa;try{Xa=await oe.raw("/api/media/upload/cover_art",{method:"POST",body:ns,signal:Xs.signal})}finally{clearTimeout(ha)}Ke=[{filename:Xa?.filename||Xa?.path||Xa?.stored_as}]}catch(ns){throw kt&&kt.name==="AbortError"?new Error("Cover upload timed out. Please check your connection and try again."):ns}}finally{clearTimeout(st)}const _t=Ke?.[0]?.filename;if(!_t)throw new Error("Cover upload: no filename returned.");return Y(kt=>({...kt,cover_image_path:_t})),_t},wr=L=>{L&&(Y(ce=>({...ce,coverArt:L,coverArtPreview:null,cover_image_path:null})),zt(!0))},Ka=async()=>{if(!(!f.coverArt||!us.current))try{Is(!0);const L=await us.current.getProcessedBlob();if(!L)throw new Error("Could not process image.");const ce=new File([L],f.coverArt.name.replace(/\.[^.]+$/,"")+"-square.jpg",{type:"image/jpeg"});await Ca(ce);const fe=new FileReader;fe.onloadend=()=>{Y(be=>({...be,coverArtPreview:fe.result}))},fe.readAsDataURL(L),zt(!1),wt({title:"Cover saved",description:"Square cover uploaded."})}catch(L){wt({variant:"destructive",title:"Cover upload failed",description:L.message||String(L)})}finally{Is(!1)}},da=(L,ce)=>{D(fe=>({...fe,[L]:ce}))},Bs=(L,ce)=>{Y(fe=>({...fe,[L]:ce}))},Ja=async(L={})=>{if(!!!L.force&&Le.current.title)return Le.current.title;const fe=G(t),be={episode_id:O||crypto.randomUUID(),podcast_id:c?.podcast_id,transcript_path:null,hint:v||null,base_prompt:"",extra_instructions:c?.ai_settings?.title_instructions||""};let oe="";try{oe=(await fe.post("/api/ai/title",be))?.title||""}catch(Oe){if(Oe&&Oe.status===409){ft(!1);try{wt({title:"Transcript not ready",description:"Transcript not ready yet — still processing",variant:"default"})}catch{}return""}try{if(Oe&&Oe.status===429)wt({variant:"destructive",title:"AI Title error",description:"Too many requests — please slow down and try again."});else{const qe=Oe&&Oe.status?` (${Oe.status})`:"";wt({variant:"destructive",title:"AI Title error",description:`Request failed${qe}. Please try again.`})}}catch{}return""}return Le.current.title=oe,oe},Qa=async(L={})=>{if(!!!L.force&&Le.current.notes)return Le.current.notes;const fe=G(t),be={episode_id:O||crypto.randomUUID(),podcast_id:c?.podcast_id,transcript_path:null,hint:v||null,base_prompt:"",extra_instructions:c?.ai_settings?.notes_instructions||""};let oe="";try{oe=(await fe.post("/api/ai/notes",be))?.description||""}catch(Oe){if(Oe&&Oe.status===409){ft(!1);try{wt({title:"Transcript not ready",description:"Transcript not ready yet — still processing",variant:"default"})}catch{}return""}try{if(Oe&&Oe.status===429)wt({variant:"destructive",title:"AI Description error",description:"Too many requests — please slow down and try again."});else{const qe=Oe&&Oe.status?` (${Oe.status})`:"";wt({variant:"destructive",title:"AI Description error",description:`Request failed${qe}. Please try again.`})}}catch{}return""}return Le.current.notes=oe,oe},Nr=async()=>{if(Le.current.tags)return Le.current.tags;const L=G(t),ce={episode_id:O||crypto.randomUUID(),podcast_id:c?.podcast_id,transcript_path:null,hint:v||null,tags_always_include:c?.ai_settings?.tags_always_include||[]},fe=await L.post("/api/ai/tags",ce),be=Array.isArray(fe?.tags)?fe.tags:[];return Le.current.tags=be,be},X=async()=>{if(!Q){ue(!0);try{const L=await Ja({force:!0});L&&!/[a-f0-9]{16,}/i.test(L)&&Bs("title",L)}finally{ue(!1)}}},ze=async()=>{if(!Ie){Re(!0);try{const ce=(await Qa({force:!0})||"").replace(/^(?:\*\*?)?description:?\*?\*?\s*/i,"").replace(/^#+\s*description\s*/i,"").trim();ce&&Bs("description",ce)}finally{Re(!1)}}},de=L=>{if(!L)return[];let ce=Array.isArray(L)?L:String(L).split(",");const fe=[];for(let be of ce){const oe=String(be).trim();if(!oe)continue;let Oe=oe.slice(0,30);if(fe.includes(Oe)||fe.push(Oe),fe.length>=20)break}return fe},Qe=async()=>{await Ka()},Te=async()=>{if(ua){ee("Monthly episode quota reached. Upgrade your plan to continue."),window.dispatchEvent(new Event("ppp:navigate-billing"));return}if(!v||!c||!f.title){ee("A template, title, and audio file are required.");return}if((!f.season||!String(f.season).trim())&&Y(L=>({...L,season:"1"})),We==="schedule"){if(!Et||!mt){ee("Pick date & time for scheduling");return}const L=new Date(`${Et}T${mt}:00`);if(isNaN(L.getTime())||L.getTime()<Date.now()+10*6e4){ee("Scheduled time must be at least 10 minutes in the future.");return}}if(f.coverArt&&!f.cover_image_path)try{E("Processing cover before assembly..."),await Qe()}catch{ee("Cover processing failed; you can retry or remove the cover.");return}Z(!1),re(null),Me(!1),z(null),b(!0),E("Assembling your episode..."),ee(""),j(6);try{const L=G(t),ce={title:f.title,description:f.description,season:f.season,episodeNumber:f.episodeNumber,cover_image_path:f.cover_image_path||null,explicit:f.is_explicit||!1,tags:de(f.tags)};let fe;try{fe=await L.post("/api/episodes/assemble",{template_id:c.id,main_content_filename:v,output_filename:f.title.toLowerCase().replace(/\s+/g,"-"),tts_values:he,episode_details:ce,flubber_cuts_ms:Array.isArray(K)&&K.length?K:null,intents:Be})}catch(be){if(be&&be.status===402){const oe=be.detail&&typeof be.detail=="object"?be.detail:{};if(oe.code==="INSUFFICIENT_MINUTES"){const qe=Number(oe.minutes_required)||0,st=Number(oe.minutes_remaining),Ke=oe.renewal_date||oe.renewalDate||null,_t=fs&&fs>0?fs:qe>0?qe*60:null;ae({requiredMinutes:qe,remainingMinutes:Number.isFinite(st)?Math.max(0,st):null,renewalDate:Ke,message:oe.message||be.message||"Not enough processing minutes remain.",durationSeconds:_t}),E(""),b(!1),ee("");try{await gs()}catch{}return}const Oe="Monthly episode quota reached. Upgrade your plan to continue.";ee(Oe),E(""),wt({variant:"destructive",title:"Quota Reached",description:Oe}),b(!1),window.dispatchEvent(new Event("ppp:navigate-billing"));return}throw be}fe.episode_id&&z(fe.episode_id),q(fe.job_id),Me(!0),E(`Episode assembly has been queued. Job ID: ${fe.job_id}`)}catch(L){ee(L.message||L?.detail?.message||"Assembly failed"),E(""),b(!1)}},rt=L=>{le(L||[]),je(!1),j(3)},Nt=()=>{le([]),je(!1),j(3)},Ut=async(L=Be)=>{const ce={flubber:la(L?.flubber??Be.flubber)??"no",intern:Js?la(L?.intern??Be.intern)??"no":"no",sfx:Ts?la(L?.sfx??Be.sfx)??"no":"no"};if(ke(ce),Ne.current=!0,te(!1),v&&(ce.flubber==="yes"||ce.flubber==="unknown")){E("Scanning for retakes (flubber)..."),Pe(!0);const be=G(t),oe={filename:v,intents:{flubber:ce.flubber}};let Oe=[];try{for(let qe=0;qe<20;qe++)try{const st=await be.post("/api/flubber/prepare-by-file",oe);Oe=Array.isArray(st?.contexts)?st.contexts:[];break}catch(st){if(st&&st.status===425){await new Promise(Ke=>setTimeout(Ke,1e3));continue}break}}catch{}finally{Pe(!1)}if(Oe.length>0)return T(Oe),je(!0),!1;if(ce.flubber==="yes")return Ge(!0),!1}return j(3),!0},Ps=async()=>{if(!F){ee("Assembled episode required.");return}let L=J;if(!L&&c&&c.podcast_id&&(L=c.podcast_id),!L){ee("Template is not linked to a show (podcast). Update template to include its show."),wt({variant:"destructive",title:"Missing show",description:"Template needs a show association."});return}U(!0),E("Publishing your episode..."),ee("");const ce=We==="schedule";let fe=null,be=null;if(ce&&Et&&mt)try{const oe=new Date(`${Et}T${mt}:00`);if(!isNaN(oe.getTime())&&oe.getTime()>Date.now()+60*1e3)fe=new Date(oe.getTime()).toISOString(),be=`${Et} ${mt}`;else{wt({variant:"destructive",title:"Invalid schedule time",description:"Pick a future date/time (>= 1 minute ahead)."}),U(!1);return}}catch{wt({variant:"destructive",title:"Invalid schedule time",description:"Unable to parse date/time."}),U(!1);return}try{const oe=ce?"unpublished":lt,Oe={spreaker_show_id:L,publish_state:oe};fe&&(Oe.publish_at=fe,be&&(Oe.publish_at_local=be));let st=await G(t).post(`/api/episodes/${F.id}/publish`,Oe);(!st||typeof st!="object")&&(st={});const Ke=!!fe,_t=oe==="unpublished"&&!Ke,kt=st.message||(Ke?"Episode scheduled for future publish.":_t?"Episode uploaded privately to Spreaker.":"Episode published publicly.");E(kt),wt({title:"Success!",description:kt});try{F?.id&&tt(F.id)}catch{}j(6)}catch(oe){const Oe=oe&&oe.message?oe.message:typeof oe=="string"?oe:"Publish failed";ee(Oe),E(""),wt({variant:"destructive",title:"Error",description:Oe})}finally{U(!1)}},ss=xt?.episodes_remaining_this_month,ka=xt?.max_episodes_month,_r=typeof ss=="number"&&typeof ka=="number"&&ss>0&&ss<=Math.ceil(ka*.1),ua=typeof ss=="number"&&ss<=0,Ea=xt?.processing_minutes_used_this_month,Ws=xt?.max_processing_minutes_month,Ms=typeof Ws=="number"&&typeof Ea=="number"?Ws-Ea:null,pe=typeof Ms=="number"&&typeof Ws=="number"&&Ms>0&&Ms<=Math.ceil(Ws*.1),ht=typeof Ms=="number"&&Ms<=0,gt=!f.title||!f.title.trim(),Pt=!f.episodeNumber||!String(f.episodeNumber).trim(),qs=ua,Aa=!gt&&!Pt&&!qs;s.useEffect(()=>{if(u!==5||!dt)return;const L=new Date,ce=String(L.getHours()).padStart(2,"0"),fe=String(L.getMinutes()).padStart(2,"0"),be=`${ce}${fe}`,oe=String(L.getDate()),Oe=(()=>{try{if(I?.name)return I.name.replace(/\.[^./\\]+$/,"");if(v)return String(v).replace(/\.[^./\\]+$/,"")}catch{}return"Episode"})();Y(qe=>({...qe,title:qe.title&&qe.title.trim()?qe.title:`Test - ${Oe}`,season:oe,episodeNumber:be}))},[u,I,v,dt]),s.useEffect(()=>{if(!se||!Ee||!F)return;if(Ze&&F.id===Ze){Me(!1);return}if(We==="draft"){Me(!1),E("Draft created (processing complete).");return}let L=We==="schedule",ce=null,fe=null;if(L){const be=new Date(`${Et}T${mt}:00`);if(!isNaN(be.getTime())&&be.getTime()>Date.now()+9*6e4)ce=be.toISOString().replace(/\.\d{3}Z$/,"Z"),fe=`${Et} ${mt}`;else{wt({variant:"destructive",title:"Schedule invalid",description:"Falling back to draft."}),Me(!1);return}}(async()=>{U(!0);try{await cs({scheduleEnabled:L,publish_at:ce,publish_at_local:fe})}finally{U(!1),Me(!1)}})()},[se,Ee,F,We,Et,mt]);const cs=async({scheduleEnabled:L,publish_at:ce,publish_at_local:fe})=>{let be=J;if(!be&&c&&c.podcast_id&&(be=c.podcast_id),!be){wt({variant:"destructive",title:"Missing show",description:"Template needs a show association."});return}const Oe={spreaker_show_id:be,publish_state:L?"unpublished":lt};ce&&(Oe.publish_at=ce,fe&&(Oe.publish_at_local=fe));try{const qe=G(t);let st=await qe.post(`/api/episodes/${F.id}/publish`,Oe);const Ke=L?"Episode scheduled successfully.":"Episode published successfully.";wt({title:"Publish",description:Ke}),E(Ke);try{F?.id&&tt(F.id)}catch{}try{const _t=await qe.get(`/api/episodes/${F.id}/publish/status`);_t.spreaker_episode_id?E(kt=>kt.includes("Spreaker ID")?kt:kt+" (Spreaker ID "+_t.spreaker_episode_id+")"):_t.last_error&&wt({variant:"destructive",title:"Publish downstream error",description:_t.last_error})}catch{}}catch(qe){wt({variant:"destructive",title:"Publish failed",description:qe.message||String(qe)})}},Bt=async()=>{try{const ce=await G(t).post("/api/episodes/ai/metadata",{audio_filename:v,current_title:f.title||null,current_description:f.description||null,prompt:f.description||f.title||v,max_tags:12});ce&&(Y(fe=>({...fe,title:fe.title||ce.title,description:fe.description?.length?fe.description:ce.description,tags:fe.tags&&fe.tags.length?fe.tags:(ce.tags||[]).join(", ")})),wt({title:"AI Suggestions Applied",description:"Title, description, and tags populated."}))}catch(L){wt({variant:"destructive",title:"AI Suggest Failed",description:L.message||String(L)})}},ds={remainingEpisodes:ss,maxEpisodes:ka,nearQuota:_r,quotaExceeded:ua,minutesRemaining:Ms,minutesCap:Ws,minutesNearCap:pe,minutesExceeded:ht},It=()=>{Y(L=>({...L,coverArt:null,coverArtPreview:null,cover_image_path:null,cover_crop:null})),zt(!1)},ys=L=>{Y(ce=>({...ce,cover_crop:L}))};return s.useEffect(()=>{if(se){try{localStorage.removeItem("ppp_uploaded_filename"),localStorage.removeItem("ppp_uploaded_hint")}catch{}gs()}},[se,gs]),{currentStep:u,setCurrentStep:j,steps:Ft,progressPercentage:Ya,selectedTemplate:c,setSelectedTemplate:m,uploadedFile:I,uploadedFilename:v,fileInputRef:vt,coverArtInputRef:Ss,coverCropperRef:us,isUploading:y,isUploadingCover:xs,isAssembling:M,isPublishing:g,assemblyComplete:se,assembledEpisode:F,statusMessage:P,error:ne,ttsValues:he,mediaLibrary:H,showFlubberReview:V,flubberContexts:_e,showIntentQuestions:me,intents:Be,intentDetections:De,intentDetectionReady:xe,intentVisibility:Sa,intentsComplete:oa,pendingIntentLabels:rs,showFlubberScan:W,capabilities:Ue,flubberNotFound:Fe,fuzzyThreshold:ct,testMode:dt,usage:xt,episodeDetails:f,isAiTitleBusy:Q,isAiDescBusy:Ie,jobId:w,spreakerShows:S,selectedSpreakerShow:J,publishMode:We,publishVisibility:lt,scheduleDate:Et,scheduleTime:mt,autoPublishPending:Ee,transcriptReady:ot,showVoicePicker:Rt,voicePickerTargetId:Gt,voiceNameById:ps,voicesLoading:_s,coverNeedsUpload:bt,coverMode:js,audioDurationSec:fs,processingEstimate:Qs,quotaInfo:ds,missingTitle:gt,missingEpisodeNumber:Pt,blockingQuota:qs,canProceedToStep5:Aa,activeSegment:jr,minutesRemaining:Ms,minutesNearCap:pe,minutesCap:Ws,minutesDialog:ye,setMinutesDialog:ae,refreshUsage:gs,buildActive:Wa,cancelBuild:vr,handleTemplateSelect:Ha,handleFileChange:Ga,handlePreuploadedSelect:ca,uploadProgress:Os,handleCoverFileSelected:wr,handleUploadProcessedCover:Ka,handleTtsChange:da,handleDetailsChange:Bs,handleAISuggestTitle:X,handleAISuggestDescription:ze,handleAssemble:Te,handleFlubberConfirm:rt,handleFlubberCancel:Nt,handleIntentSubmit:Ut,handleIntentAnswerChange:qa,handlePublish:Ps,handleVoiceChange:Va,handleAISuggest:Bt,retryFlubberSearch:async()=>{if(Ge(!1),!v){j(3);return}try{Pe(!0);const L=G(t),ce={filename:v,intents:{flubber:"yes"},fuzzy_threshold:ct};let fe=[];for(let be=0;be<20;be++)try{const oe=await L.post("/api/flubber/prepare-by-file",ce);fe=Array.isArray(oe?.contexts)?oe.contexts:[];break}catch(oe){if(oe&&oe.status===425){await new Promise(Oe=>setTimeout(Oe,1e3));continue}break}Pe(!1),fe.length?(T(fe),je(!0)):j(3)}catch{Pe(!1),j(3)}},skipFlubberRetry:()=>{Ge(!1),j(3)},setShowVoicePicker:Tt,setVoicePickerTargetId:hs,setFuzzyThreshold:et,setShowIntentQuestions:te,setShowFlubberScan:Pe,setFlubberNotFound:Ge,setStatusMessage:E,setEpisodeDetails:Y,setPublishMode:Ve,setPublishVisibility:Ct,setScheduleDate:ut,setScheduleTime:we,setCoverNeedsUpload:zt,setCoverMode:es,selectedPreupload:k,setUsage:R,setError:ee,clearCover:It,updateCoverCrop:ys}}function Po({templates:t,onTemplateSelect:a}){return e.jsxs("div",{className:"space-y-8",children:[e.jsx(Je,{className:"text-center",children:e.jsx(Xe,{style:{color:"#2C3E50"},children:"Step 1: Choose a Template"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(r=>e.jsx(Ce,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>a(r),children:e.jsxs(Ae,{className:"p-6 text-center space-y-4",children:[e.jsx(Wr,{className:"w-12 h-12 mx-auto text-blue-600"}),e.jsx("h3",{className:"text-xl font-semibold",children:r.name}),e.jsx("p",{className:"text-gray-500 text-sm",children:r.description||"No description available."})]})},r.id))})]})}function Mo({uploadedFile:t,uploadedFilename:a,isUploading:r,uploadProgress:n=null,onFileChange:o,fileInputRef:l,onBack:d,onNext:N=()=>{},onEditAutomations:i,onIntentChange:u,onIntentSubmit:j,canProceed:c=!1,pendingIntentLabels:m=[],intents:I={},intentVisibility:x={}}){const v=M=>{M.target.files?.[0]&&o(M.target.files[0])},_=M=>{M.preventDefault(),M.dataTransfer.files?.[0]&&o(M.dataTransfer.files[0])},k=Array.isArray(m)&&m.length>0,h=k?m.join(", "):"",y=M=>{try{if(!M)return"";let b=M.split(/[\\/]/).pop();return b=b.replace(/\.[a-z0-9]{2,5}$/i,""),b=b.replace(/^(?:[a-f0-9]{8,}|[a-f0-9-]{20,})[_-]+/i,""),b=b.replace(/[._-]+/g," ").trim(),b.length&&(b=b[0].toUpperCase()+b.slice(1)),b}catch{return M}},p=s.useRef(!1);s.useEffect(()=>{!p.current&&(t||a)&&k&&typeof i=="function"&&(p.current=!0,setTimeout(()=>{try{i()}catch{}},150))},[t,a,k,i]);const C=async()=>{if(typeof j=="function"){const M=await j(I);if(M===!1||M===!0)return}N()};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(Je,{className:"text-center",children:e.jsx(Xe,{style:{color:"#2C3E50"},children:"Step 2: Upload Main Content"})}),(r||typeof n=="number"&&n<100)&&e.jsxs("div",{className:"rounded-md border border-slate-200 bg-white p-3","aria-live":"polite",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-700",children:"Uploading audio…"}),e.jsxs("span",{className:"text-slate-600",children:[Math.max(0,Math.min(100,Number(n)||0)),"%"]})]}),e.jsx("div",{className:"mt-2 h-2 w-full rounded-full bg-slate-200 overflow-hidden",children:e.jsx("div",{className:"h-full bg-slate-600 transition-all duration-200",style:{width:`${Math.max(5,Math.min(100,Number(n)||5))}%`}})})]}),e.jsxs(Ce,{className:"border border-slate-200 bg-slate-50","data-tour-id":"episode-upload-guide",children:[e.jsx(Je,{className:"flex flex-col gap-1 pb-2 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs(Xe,{className:"text-base flex items-center gap-2 text-slate-800",children:[e.jsx(ra,{className:"h-4 w-4 text-amber-500","aria-hidden":"true"}),"Audio prep checklist"]})}),e.jsxs(Ae,{className:"space-y-3 text-sm text-slate-700",children:[e.jsx("p",{children:"Give the automation a strong starting point with a clean, final mix. We’ll normalize levels on upload, but the clearer the file the better the downstream edit."}),e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsx("li",{children:"Use WAV or MP3 files under 200 MB for the smoothest upload."}),e.jsx("li",{children:"Trim long silences and keep background music subtle—we re-check loudness automatically."}),e.jsx("li",{children:"Re-uploading? Drop the same filename and we’ll detect it so you can skip the wait."})]}),e.jsxs("details",{className:"rounded-lg border border-dashed border-slate-300 bg-white/80 p-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-slate-800",children:"How intent questions work"}),e.jsxs("div",{className:"mt-2 space-y-2 text-slate-600",children:[e.jsx("p",{children:"When we ask about episode intent or offers, those answers steer intro/outro copy, ad reads, and show notes. Update them any time before you assemble."}),e.jsx("p",{children:"Skip for now if you’re unsure—we’ll remind you before publishing and you can fill them in from Automations."})]})]})]})]}),e.jsx(Ce,{className:"border-2 border-dashed border-gray-200 bg-white",children:e.jsx(Ae,{className:"p-8",children:e.jsxs("div",{className:"border-2 border-dashed rounded-xl p-12 text-center",onDragOver:M=>M.preventDefault(),onDrop:_,children:[t||a?e.jsxs("div",{className:"space-y-6",children:[e.jsx(El,{className:"w-16 h-16 mx-auto text-green-600"}),e.jsx("p",{className:`text-xl font-semibold ${r?"text-slate-600":"text-green-600"}`,children:r?"Uploading your audio…":"File Ready!"}),t&&e.jsx("p",{className:"text-gray-600",children:y(t.name)}),!t&&a&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-600",children:["Server file: ",a]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We found your previously uploaded audio — you can continue without re-uploading."})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ys,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-700",children:"Drag your audio file here"}),e.jsx("p",{className:"text-gray-500",children:"or"}),e.jsx(A,{onClick:()=>l.current?.click(),size:"lg",className:"text-white",style:{backgroundColor:"#2C3E50"},disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-5 h-5 mr-2 animate-spin"})," Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ks,{className:"w-5 h-5 mr-2"})," Choose Audio File"]})})]}),r&&e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsx("div",{className:"h-2 w-full rounded-full bg-slate-200 overflow-hidden",children:e.jsx("div",{className:"h-full bg-slate-600 transition-all duration-200",style:{width:`${Math.min(100,Math.max(5,typeof n=="number"?n:5))}%`}})}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Uploading",typeof n=="number"?`… ${n}%`:"…"]})]}),e.jsx("input",{ref:l,type:"file",accept:"audio/*",onChange:v,className:"hidden"})]})})}),(t||a)&&e.jsxs(Ce,{className:"border border-slate-200 bg-slate-50",children:[e.jsx(Je,{className:"pb-2",children:e.jsx(Xe,{className:"text-lg text-slate-900",children:"Before we customize anything…"})}),e.jsxs(Ae,{className:"space-y-4",children:[k?e.jsxs("div",{className:"rounded-md border border-amber-200 bg-amber-50 p-3 text-sm text-amber-800",children:["We need your answer about ",h,"."]}):e.jsx("div",{className:"text-sm text-slate-600",children:"These answers are saved automatically and you can change them later."}),typeof i=="function"&&k&&e.jsx("div",{className:"text-right",children:e.jsx(A,{variant:"ghost",size:"sm",onClick:i,className:"text-slate-600 hover:text-slate-900",children:"Answer now"})})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 pt-8 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs(A,{onClick:d,variant:"outline",size:"lg",children:[e.jsx(Yt,{className:"w-5 h-5 mr-2"}),"Back to Templates"]}),(t||a)&&e.jsx("div",{className:"flex w-full flex-col gap-3 sm:w-auto sm:flex-row sm:items-center sm:justify-end",children:e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(A,{onClick:C,size:"lg",className:"text-white",style:{backgroundColor:"#2C3E50"},disabled:!(c||a),children:"Continue"})})})]})]})}function Ro({selectedTemplate:t,mediaLibrary:a,uploadedFile:r,ttsValues:n,onTtsChange:o,onBack:l,onNext:d,onOpenVoicePicker:N,voiceNameById:i,voicesLoading:u}){const j=c=>{if(c.segment_type==="content")return e.jsxs("div",{className:"mt-2 bg-blue-50 p-3 rounded-md",children:[e.jsx("p",{className:"font-semibold text-blue-800",children:"Your Uploaded Audio:"}),e.jsx("p",{className:"text-gray-700",children:r?.name||"No file uploaded"})]});if(c.source.source_type==="tts"){const m=c?.source?.voice_id||"",I=i[m];return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-gray-500",title:m||void 0,children:["Voice: ",I||m||"default",u&&!I?"…":""]}),e.jsx(A,{size:"sm",variant:"outline",onClick:()=>N(c.id),children:"Change voice"})]}),e.jsx(ve,{htmlFor:c.id,className:"text-sm font-medium text-gray-700 mb-2 block",children:c.source.text_prompt||"AI voice script"}),e.jsx(bs,{id:c.id,placeholder:"Enter text to be converted to speech...",className:"min-h-[100px] resize-none text-base bg-white",value:n[c.id]||"",onChange:x=>o(c.id,x.target.value)})]})}if(c.source.source_type==="static"){const m=a.find(x=>x.filename.endsWith(c.source.filename)),I=m?m.friendly_name:c.source.filename;return e.jsxs("p",{className:"text-gray-600 mt-2",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Audio File:"})," ",I]})}return e.jsx("p",{className:"text-red-500 mt-2",children:"Unknown segment source type"})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs(Je,{className:"text-center",children:[e.jsx(Xe,{style:{color:"#2C3E50"},children:"Step 3: Customize Your Episode"}),e.jsx("p",{className:"text-md text-gray-500 pt-2",children:"Review the structure and fill in the required text for any AI-generated segments."})]}),e.jsxs(Ce,{className:"border border-slate-200 bg-slate-50","data-tour-id":"episode-segment-guide",children:[e.jsx(Je,{className:"flex flex-col gap-1 pb-2 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs(Xe,{className:"text-base flex items-center gap-2 text-slate-800",children:[e.jsx(ra,{className:"h-4 w-4 text-amber-500","aria-hidden":"true"}),"How these segments play out"]})}),e.jsxs(Ae,{className:"space-y-3 text-sm text-slate-700",children:[e.jsx("p",{children:"Each block below becomes a chapter in your final episode. Tweak the script, switch voices, or swap in uploaded clips—changes are saved immediately."}),e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Us,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-primary","aria-hidden":"true"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Content"})," anchors your uploaded audio. Intro/outro and ad slots wrap around it automatically."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Us,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-primary","aria-hidden":"true"}),e.jsxs("span",{children:[e.jsx("strong",{children:"TTS segments"})," use the template’s default voice—edit the script here or tap “Change voice” for a different tone."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Us,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-primary","aria-hidden":"true"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Static clips"})," pull from your media library. Upload new stingers or music in the Template step if you need variety."]})]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Pro tip: want to reuse this structure later? Save these updates back to the template once you love the flow."})]})]}),e.jsx(Ce,{className:"border-0 shadow-lg bg-white",children:e.jsx(Ae,{className:"p-6 space-y-4",children:t&&t.segments?t.segments.map((c,m)=>e.jsxs("div",{className:"p-4 rounded-md bg-gray-50 border border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-lg text-gray-800 capitalize",children:c.segment_type.replace("_"," ")}),j(c)]},c.id||m)):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-lg text-gray-600",children:"This template has no segments to display."})})})}),e.jsxs("div",{className:"flex justify-between pt-8",children:[e.jsxs(A,{onClick:l,variant:"outline",size:"lg",children:[e.jsx(Yt,{className:"w-5 h-5 mr-2"}),"Back to Upload"]}),e.jsxs(A,{onClick:d,size:"lg",className:"px-8 py-3 text-lg font-semibold text-white",style:{backgroundColor:"#2C3E50"},children:["Continue to Details",e.jsx(Yt,{className:"w-5 h-5 ml-2 rotate-180"})]})]})]})}const br=s.forwardRef(function({sourceFile:a,existingUrl:r,value:n,onChange:o,disabled:l,onModeChange:d},N){const i=s.useRef(null),u=s.useRef(null),[j,c]=s.useState(null),[m,I]=s.useState({w:0,h:0}),[x,v]=s.useState({x:0,y:0,size:0}),[_,k]=s.useState(()=>{try{return localStorage.getItem("ppp_cover_mode")||"crop"}catch{return"crop"}}),[h,y]=s.useState(!1),p=s.useRef({dx:0,dy:0}),C=s.useRef(null);s.useEffect(()=>{if(a){const O=URL.createObjectURL(a);return c(O),()=>URL.revokeObjectURL(O)}c(r||null)},[a,r]);const M=s.useCallback(()=>{const O=i.current;if(!O)return;const z=O.naturalWidth,P=O.naturalHeight;if(I({w:z,h:P}),!a&&n){const E=n.split(",").map(ne=>parseFloat(ne.trim()));if(E.length===4&&E.every(ne=>!isNaN(ne))){const[ne,ee,he,D]=E,H=Math.min(z,P,Math.max(0,he-ne),Math.max(0,D-ee));v({x:Math.max(0,ne),y:Math.max(0,ee),size:H});return}}if(a){const E=Math.min(z,P),ne=(z-E)/2,ee=(P-E)/2;v({x:ne,y:ee,size:E})}},[n]);s.useEffect(()=>{if(!a)return;if(_==="pad"){o?.(null);return}if(!m.w||!x.size)return;const O=Math.round(x.x),z=Math.round(x.y),P=Math.round(x.x+x.size),E=Math.round(x.y+x.size),ne=`${O},${z},${P},${E}`;C.current!==ne&&(C.current=ne,o?.(ne))},[x,m,_,o]);const b=O=>{if(l||_!=="crop"||!a||!i.current||!u.current)return;O.preventDefault();const z=u.current.getBoundingClientRect(),P=i.current.getBoundingClientRect(),E=O.clientX-P.left,ne=O.clientY-P.top,ee=m.w?P.width/m.w:1,he=x.x*ee,D=x.y*ee,H=x.size*ee;E>=he&&E<=he+H&&ne>=D&&ne<=D+H&&(p.current={dx:E-he,dy:ne-D,imageOffsetX:P.left-z.left,imageOffsetY:P.top-z.top},y(!0))},g=O=>{if(!h||l||!i.current)return;const z=i.current.getBoundingClientRect(),P=O.clientX-z.left,E=O.clientY-z.top,ne=m.w?z.width/m.w:1;let ee=(P-p.current.dx)/ne,he=(E-p.current.dy)/ne;ee=Math.max(0,Math.min(ee,m.w-x.size)),he=Math.max(0,Math.min(he,m.h-x.size)),v(D=>({...D,x:ee,y:he}))},U=()=>y(!1);s.useEffect(()=>(window.addEventListener("mousemove",g),window.addEventListener("mouseup",U),()=>{window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",U)}),[g]);const se=O=>{const z=parseFloat(O.target.value);if(!m.w)return;const P=Math.min(m.w,m.h),E=Math.max(10,Math.min(P,z)),ne=x.x+x.size/2,ee=x.y+x.size/2;let he=ne-E/2,D=ee-E/2;he=Math.max(0,Math.min(he,m.w-E)),D=Math.max(0,Math.min(D,m.h-E)),v(H=>({...H,x:he,y:D,size:E}))},Z=()=>(Math.min(m.w,m.h),Math.round(x.size)),F=(()=>{try{if(!i.current||!m.w)return null;const O=document.createElement("canvas");if(!(_==="pad"?Math.max(m.w,m.h):x.size))return null;O.width=200,O.height=200;const P=O.getContext("2d");if(_==="pad"){const E=Math.max(m.w,m.h);P.fillStyle="#FFFFFF",P.fillRect(0,0,200,200);const ne=200/E,ee=(E-m.w)/2,he=(E-m.h)/2;P.drawImage(i.current,0,0,m.w,m.h,ee*ne,he*ne,m.w*ne,m.h*ne)}else{const E=200/x.size;P.drawImage(i.current,x.x,x.y,x.size,x.size,0,0,200,200)}return O.toDataURL("image/png")}catch{return null}})(),re=s.useCallback(()=>{if(!i.current||!m.w)return null;const O=2048,z=_==="pad"?Math.max(m.w,m.h):x.size||Math.min(m.w,m.h);if(!z)return null;const P=Math.min(z,O),E=document.createElement("canvas");E.width=P,E.height=P;const ne=E.getContext("2d");if(ne.fillStyle="#FFFFFF",ne.fillRect(0,0,P,P),_==="pad"){const ee=Math.max(m.w,m.h),he=P/ee,D=Math.round(m.w*he),H=Math.round(m.h*he),ge=Math.round((P-D)/2),V=Math.round((P-H)/2);ne.drawImage(i.current,0,0,m.w,m.h,ge,V,D,H)}else ne.drawImage(i.current,x.x,x.y,x.size,x.size,0,0,P,P);return new Promise(ee=>E.toBlob(he=>ee(he),"image/jpeg",.88))},[x,m,_]);return s.useImperativeHandle(N,()=>({async getProcessedBlob(){return await re()},getMode(){return _}}),[re,_]),s.useEffect(()=>{d?.(_);try{localStorage.setItem("ppp_cover_mode",_)}catch{}},[_,d]),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{ref:u,className:"relative border rounded overflow-hidden max-h-72 bg-gray-50 flex items-center justify-center",style:{cursor:h?"grabbing":"grab",userSelect:"none"},onMouseDown:b,children:[j?e.jsx("img",{ref:i,src:j,alt:"Cover",onLoad:M,className:"max-w-full max-h-72 select-none",draggable:!1}):e.jsx("div",{className:"text-xs text-gray-500 p-4",children:"No image selected"}),j&&x.size>0&&_==="crop"&&(()=>{if(!i.current||!u.current)return null;const O=i.current.getBoundingClientRect(),z=u.current.getBoundingClientRect(),P=O.width||1,E=O.height||1,ne=O.left-z.left,ee=O.top-z.top,he=P/m.w,D=E/m.h,H=ne+x.x*he,ge=ee+x.y*D,V=x.size*he,je=x.size*D;return e.jsx("div",{className:"absolute border-2 border-blue-500/90 shadow-[0_0_0_9999px_rgba(0,0,0,0.35)] box-content",style:{left:H,top:ge,width:V,height:je},title:"Drag to move. Use slider to resize."})})()]}),m.w>0&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[11px]",children:[e.jsx("button",{type:"button",disabled:l||!a,onClick:()=>k("crop"),className:`px-2 py-1 rounded border ${_==="crop"?"bg-blue-600 text-white border-blue-600":"bg-white"} ${a?"":"opacity-40 cursor-not-allowed"}`,children:"Crop"}),e.jsx("button",{type:"button",disabled:l||!a,onClick:()=>k("pad"),className:`px-2 py-1 rounded border ${_==="pad"?"bg-blue-600 text-white border-blue-600":"bg-white"} ${a?"":"opacity-40 cursor-not-allowed"}`,children:"Pad"}),e.jsx("span",{className:"text-gray-500",children:"Mode"})]}),_==="crop"&&a&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-[10px] uppercase tracking-wide text-gray-500",children:"Crop Size (pixels)"}),e.jsx("input",{type:"range",min:10,max:Math.min(m.w,m.h),value:Z(),onChange:se,disabled:l}),e.jsxs("div",{className:"text-[11px] text-gray-500",children:[Math.round(x.size),"px square • Drag box to reposition."]})]}),_==="pad"&&a&&e.jsxs("div",{className:"text-[11px] text-gray-500",children:["Entire image will be centered on white square (",Math.max(m.w,m.h),"px)."]})]}),F&&e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("div",{className:"text-[11px] text-gray-500",children:"Preview:"}),e.jsx("img",{src:F,alt:"Crop preview",className:"w-16 h-16 rounded border object-cover"}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Stored as ",n||""]})]})]})});function Do({episodeDetails:t,coverArtInputRef:a,coverCropperRef:r,coverNeedsUpload:n,isUploadingCover:o,onCoverFileSelected:l,onCoverCropChange:d,onCoverModeChange:N,onRemoveCover:i,onBack:u,onSkip:j,onContinue:c}){return e.jsxs("div",{className:"space-y-8",children:[e.jsx(Je,{className:"text-center",children:e.jsx(Xe,{style:{color:"#2C3E50"},children:"Step 4: Cover Art"})}),e.jsx(Ce,{className:"border-0 shadow-lg bg-white",children:e.jsx(Ae,{className:"p-8 space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[!t.coverArt&&!t.coverArtPreview&&!!t.cover_image_path&&e.jsxs("div",{className:"flex flex-col md:flex-row gap-10 items-start",children:[e.jsx("div",{className:"w-48 h-48 rounded-lg overflow-hidden border bg-gray-50",children:(()=>{const m=String(t.cover_image_path||"").replace(/^\/+/,""),I=m.split("/").pop(),x=m.startsWith("http")?m:Hr(`/static/media/${I}`);return e.jsx("img",{src:x,alt:"Cover (saved)",className:"w-full h-full object-cover"})})()}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("p",{className:"text-gray-600",children:["Using saved square cover",t.cover_image_path&&e.jsxs(e.Fragment,{children:[" ","as ",e.jsx("span",{className:"text-green-600",children:t.cover_image_path})]}),"."]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>a.current?.click(),children:[e.jsx(ks,{className:"w-4 h-4 mr-1"}),"Replace"]}),e.jsx(A,{size:"sm",variant:"ghost",onClick:i,children:"Remove"})]}),e.jsx("input",{ref:a,type:"file",accept:"image/*",onChange:m=>l(m.target.files?.[0]),className:"hidden"})]})]}),!t.coverArt&&!t.coverArtPreview&&!t.cover_image_path&&e.jsxs("div",{className:"border-2 border-dashed rounded-xl p-10 text-center",onDragOver:m=>m.preventDefault(),onDrop:m=>{m.preventDefault(),m.dataTransfer.files?.[0]&&l(m.dataTransfer.files[0])},children:[e.jsx(si,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Drag & drop a cover image or click below."}),e.jsxs(A,{className:"mt-4",variant:"outline",onClick:()=>a.current?.click(),children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),"Choose Image"]}),e.jsx("input",{ref:a,type:"file",accept:"image/*",onChange:m=>l(m.target.files?.[0]),className:"hidden"}),e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"Recommended: ≥1400x1400 JPG/PNG."})]}),t.coverArt&&!t.coverArtPreview&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(br,{ref:r,sourceFile:t.coverArt,existingUrl:null,value:t.cover_crop,onChange:d,onModeChange:N}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>a.current?.click(),children:[e.jsx(ks,{className:"w-4 h-4 mr-1"}),"Replace"]}),e.jsx(A,{size:"sm",variant:"ghost",onClick:i,children:"Remove"})]})]}),t.coverArtPreview&&e.jsxs("div",{className:"flex flex-col md:flex-row gap-10 items-start",children:[e.jsx("div",{className:"w-48 h-48 rounded-lg overflow-hidden border bg-gray-50",children:e.jsx("img",{src:t.coverArtPreview,alt:"Cover preview",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("p",{className:"text-gray-600",children:["Square cover uploaded",t.cover_image_path&&e.jsxs(e.Fragment,{children:[" ","as ",e.jsx("span",{className:"text-green-600",children:t.cover_image_path})]}),"."]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>a.current?.click(),children:[e.jsx(ks,{className:"w-4 h-4 mr-1"}),"Replace"]}),e.jsx(A,{size:"sm",variant:"ghost",onClick:i,children:"Remove"})]}),e.jsx("input",{ref:a,type:"file",accept:"image/*",onChange:m=>l(m.target.files?.[0]),className:"hidden"})]})]})]})})}),e.jsxs("div",{className:"flex justify-between pt-8",children:[e.jsxs(A,{onClick:u,variant:"outline",size:"lg",children:[e.jsx(Yt,{className:"w-5 h-5 mr-2"}),"Back"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(A,{onClick:j,variant:"outline",size:"lg",children:"Skip"}),e.jsxs(A,{onClick:c,size:"lg",disabled:o,className:"px-8 py-3 text-lg font-semibold text-white disabled:opacity-70",style:{backgroundColor:"#2C3E50"},children:[n?"Upload & Continue":"Continue",e.jsx(Yt,{className:"w-5 h-5 ml-2 rotate-180"})]})]})]})]})}function Fo({episodeDetails:t,transcriptReady:a,isAssembling:r,isPublishing:n,isAiTitleBusy:o,isAiDescBusy:l,publishMode:d,publishVisibility:N,scheduleDate:i,scheduleTime:u,canProceed:j,blockingQuota:c,missingTitle:m,missingEpisodeNumber:I,onBack:x,onAssemble:v,onDetailsChange:_,onSuggestTitle:k,onSuggestDescription:h,onPublishModeChange:y,onPublishVisibilityChange:p,onScheduleDateChange:C,onScheduleTimeChange:M}){return e.jsxs("div",{className:"space-y-8",children:[e.jsx(Je,{className:"text-center",children:e.jsx(Xe,{style:{color:"#2C3E50"},children:"Step 5: Episode Details & Scheduling"})}),e.jsxs(Ce,{className:"border border-slate-200 bg-slate-50","data-tour-id":"episode-details-guide",children:[e.jsx(Je,{className:"flex flex-col gap-1 pb-2 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs(Xe,{className:"text-base flex items-center gap-2 text-slate-800",children:[e.jsx(ra,{className:"h-4 w-4 text-amber-500","aria-hidden":"true"}),"Publishing checklist"]})}),e.jsxs(Ae,{className:"space-y-3 text-sm text-slate-700",children:[e.jsx("p",{children:"This is the last stop before you assemble or publish. Use it as a quick final review so you never miss a required field."}),e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Us,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-primary","aria-hidden":"true"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Title & description"}),": keep keywords up front. Try the AI helpers for a punchy first draft."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Us,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-primary","aria-hidden":"true"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Numbering & tags"}),": confirm season/episode numbers and add 3–5 tags so auto-generated show notes stay relevant."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Us,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-primary","aria-hidden":"true"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Scheduling"}),": choosing “Schedule” opens the calendar—pick a local date/time and we’ll convert it to UTC for you."]})]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Need to brainstorm? The front-page guide has examples for titles, calls-to-action, and launch checklists."})]})]}),e.jsx(Ce,{className:"border-0 shadow-lg bg-white",children:e.jsxs(Ae,{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:e.jsxs("div",{className:"col-span-2 md:col-span-1",children:[e.jsx(ve,{htmlFor:"title",children:"Episode Title *"}),e.jsx(Ye,{id:"title",placeholder:"e.g., The Future of AI",value:t.title,onChange:b=>_("title",b.target.value)}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsxs(A,{type:"button",variant:"secondary",onClick:k,disabled:!a||r||n||o,children:[e.jsx(Pr,{className:"w-4 h-4 mr-1"})," AI Suggest Title"]}),!a&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(St,{className:"w-3 h-3 animate-spin"})," Waiting for transcript…"]})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx(ve,{htmlFor:"season",children:"Season Number *"}),e.jsx(Ye,{id:"season",type:"number",placeholder:"e.g., 1",value:t.season,onChange:b=>_("season",b.target.value)})]}),e.jsxs("div",{children:[e.jsx(ve,{htmlFor:"episodeNumber",children:"Episode Number *"}),e.jsx(Ye,{id:"episodeNumber",type:"number",placeholder:"e.g., 12",value:t.episodeNumber,onChange:b=>_("episodeNumber",b.target.value)})]}),e.jsxs("div",{className:"flex items-center pt-6 gap-2",children:[e.jsx("input",{id:"explicitFlag",type:"checkbox",checked:!!t.is_explicit,onChange:b=>_("is_explicit",b.target.checked)}),e.jsx(ve,{htmlFor:"explicitFlag",className:"cursor-pointer",children:"Explicit"})]})]}),e.jsxs("div",{children:[e.jsx(ve,{htmlFor:"description",children:"Episode Description"}),e.jsx(bs,{id:"description",placeholder:"Describe what this episode is about...",className:"min-h-[120px]",value:t.description,onChange:b=>_("description",b.target.value)}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsxs(A,{type:"button",variant:"secondary",onClick:h,disabled:!a||r||n||l,children:[e.jsx(Pr,{className:"w-4 h-4 mr-1"})," AI Suggest Description"]}),!a&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(St,{className:"w-3 h-3 animate-spin"})," Waiting for transcript…"]})]})]}),e.jsxs("div",{children:[e.jsx(ve,{htmlFor:"tags",children:"Tags (comma separated, max 20)"}),e.jsx(bs,{id:"tags",placeholder:"tag1, tag2",className:"min-h-[64px]",value:t.tags||"",onChange:b=>_("tags",b.target.value)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Each tag ≤30 chars. Enforced on publish."})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsx(ve,{className:"font-medium",children:"Publish Options"}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pubmode",value:"now",checked:d==="now",onChange:()=>y("now")}),"Publish Immediately (after assembly)"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pubmode",value:"draft",checked:d==="draft",onChange:()=>y("draft")}),"Save as Draft (no publish)"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pubmode",value:"schedule",checked:d==="schedule",onChange:()=>y("schedule")}),"Schedule Publish"]})]}),d==="schedule"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-date",className:"text-xs font-medium mb-1 block",children:"Date"}),e.jsx("input",{id:"schedule-date","aria-label":"Schedule date",type:"date",className:"border rounded p-2 w-full",value:i,onChange:b=>C(b.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-time",className:"text-xs font-medium mb-1 block",children:"Time"}),e.jsx("input",{id:"schedule-time","aria-label":"Schedule time",type:"time",step:300,className:"border rounded p-2 w-full",value:u,onChange:b=>M(b.target.value)})]}),e.jsx("div",{className:"col-span-2 text-xs text-gray-500",children:"Must be ≥10 minutes in the future. Converted to UTC automatically."})]}),d==="now"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-xs font-medium",children:"Visibility:"}),e.jsxs("div",{className:"flex gap-4 mt-1 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"vis",value:"public",checked:N==="public",onChange:()=>p("public")}),"Public"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"vis",value:"unpublished",checked:N==="unpublished",onChange:()=>p("unpublished")}),"Private"]})]})]})]})]})}),e.jsxs("div",{className:"flex justify-between pt-8",children:[e.jsxs(A,{onClick:x,variant:"outline",size:"lg",children:[e.jsx(Yt,{className:"w-5 h-5 mr-2"}),"Back"]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs(A,{onClick:v,disabled:!j||r,size:"lg",className:"px-8 py-3 text-lg font-semibold text-white disabled:opacity-70",style:{backgroundColor:"#2C3E50"},children:[r?"Assembling...":"Save and continue",e.jsx(Yt,{className:"w-5 h-5 ml-2 rotate-180"})]}),!j&&e.jsx("div",{className:"text-xs text-red-600 mt-2 max-w-sm text-right",children:c?"Quota exceeded – upgrade or wait for reset.":m?"Enter a title to continue.":I?"Enter an episode number to continue.":""})]})]})]})}function Lo({assemblyComplete:t,processingEstimate:a,publishMode:r,assembledEpisode:n,statusMessage:o,onBack:l}){return t?e.jsxs("div",{className:"space-y-8",children:[e.jsx(Je,{className:"text-center",children:e.jsxs(Xe,{style:{color:"#2C3E50"},children:["Step 6: ",r==="draft"?"Draft Ready":r==="schedule"?"Scheduled":"Completed"]})}),e.jsx(Ce,{className:"border-0 shadow-lg bg-white",children:e.jsxs(Ae,{className:"p-6 space-y-6",children:[e.jsx("h3",{className:"text-2xl font-bold",children:n.title}),e.jsx("p",{className:"text-gray-600",children:n.description}),n.final_audio_url&&e.jsxs("div",{className:"mt-4",children:[e.jsx(ve,{children:"Listen to the final episode:"}),e.jsx("audio",{controls:!0,src:n.final_audio_url,className:"w-full mt-2",children:"Your browser does not support the audio element."})]}),e.jsxs("div",{className:"p-4 border rounded bg-gray-50 text-sm",children:[r==="draft"&&"Episode saved as draft.",r==="schedule"&&"Episode assembled and scheduled.",r==="now"&&"Episode assembled; publish dispatched."]}),o&&o.includes("Removed fillers")&&e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:o.split(" | ").slice(1).join(" | ")}),o&&e.jsx("div",{className:"text-sm text-gray-600",children:o}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(A,{onClick:l,children:"Back to Dashboard"})})]})})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsx(Je,{className:"text-center",children:e.jsx(Xe,{style:{color:"#2C3E50"},children:"Step 6: Assembly In Progress"})}),e.jsx(Ce,{className:"border-0 shadow-lg bg-white",children:e.jsxs(Ae,{className:"p-8 space-y-6 text-center",children:[e.jsx(St,{className:"w-16 h-16 mx-auto text-blue-600 animate-spin"}),e.jsx("p",{className:"text-xl font-semibold text-blue-600 mt-4",children:"We're assembling your episode in the background."}),a?e.jsxs("p",{className:"text-gray-700 max-w-xl mx-auto",children:["Processing time for this episode should be approximately ",a.low,"-",a.high," min. You can stay here or go back to the dashboard and we'll let you know when it's done."]}):e.jsx("p",{className:"text-gray-600 max-w-xl mx-auto",children:"You can safely leave this screen. You'll receive a notification when it's ready. This typically takes a few minutes depending on length and cleanup."}),e.jsx("div",{className:"text-sm text-gray-500",children:"If you stay, this page will auto-update when complete."}),e.jsx(A,{onClick:l,variant:"outline",className:"mt-4",children:"Back to Dashboard"})]})})]})}const Jr=s.forwardRef(({className:t,value:a,...r},n)=>e.jsx(Hn,{ref:n,className:at("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",t),...r,children:e.jsx(wl,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));Jr.displayName=Hn.displayName;const Uo={BookText:Wr,FileUp:Al,Library:ai,Wand2:Pr,FileImage:si,Settings:aa,Globe:Mr};function $o({onBack:t,selectedTemplate:a,steps:r,currentStep:n,progressPercentage:o,isUploading:l,uploadProgress:d,usage:N,minutesNearCap:i,minutesRemaining:u,onCancelBuild:j,buildActive:c,children:m}){return e.jsxs("div",{className:"bg-gray-50 min-h-screen",children:[e.jsx("header",{className:"border-b border-gray-200 px-4 py-6 bg-white shadow-sm sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(A,{variant:"ghost",className:"text-gray-600",onClick:t,children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsx("h1",{className:"text-3xl font-bold",style:{color:"#2C3E50"},children:"Episode Creator"}),e.jsxs("div",{className:"w-48 text-right space-y-1",children:[a&&e.jsxs("div",{className:"text-sm text-gray-500 truncate",title:`Template: ${a.name}`,children:["Template: ",a.name]}),typeof j=="function"&&n>1&&n<6&&c&&e.jsx(A,{variant:"outline",size:"sm",className:"text-red-700 border-red-300 hover:bg-red-50",onClick:()=>{window.confirm("Cancel this build and discard in-progress state? You will need to start over.")&&j()},children:"Cancel Build"})]})]})})}),e.jsx("div",{className:"px-4 py-6 bg-white border-b border-gray-100",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsx(Jr,{value:o,className:"h-2 mb-6"}),e.jsx("div",{className:"flex justify-between",children:r.map(I=>{const x=Uo[I.icon]||Wr,v=n>=I.number;return e.jsxs("div",{className:`flex flex-col items-center transition-all w-40 text-center ${v?"text-blue-600":"text-gray-600"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mb-3 transition-all ${v?"text-white shadow-lg":"bg-gray-100 text-gray-600"}`,style:{backgroundColor:v?"#2C3E50":void 0},children:n>I.number?e.jsx(as,{className:"w-6 h-6"}):e.jsx(x,{className:"w-6 h-6"})}),e.jsx("div",{className:"font-semibold text-sm",children:I.title})]},I.number)})}),(l||typeof d=="number"&&d<100)&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-700",children:"Uploading audio…"}),e.jsxs("span",{className:"text-slate-600",children:[Math.max(0,Math.min(100,Number(d)||0)),"%"]})]}),e.jsx("div",{className:"h-2 w-full rounded-full bg-slate-200 overflow-hidden",children:e.jsx("div",{className:"h-full bg-slate-600 transition-all duration-200",style:{width:`${Math.max(5,Math.min(100,Number(d)||5))}%`}})})]})]})}),e.jsx("div",{className:"px-4 py-2 bg-yellow-50 border-b border-yellow-100 text-sm",children:N&&e.jsxs("div",{className:`text-center ${i?"text-amber-600 font-medium":""}`,children:["Processing minutes remaining this month:"," ",e.jsx("span",{className:"font-semibold",children:N?.max_processing_minutes_month==null?"∞":u??"—"}),N?.max_processing_minutes_month==null?" (unlimited during beta)":i?" (near limit)":""]})}),e.jsx("main",{className:"container mx-auto max-w-6xl px-4 py-8",role:"main","aria-label":"Episode Creator main content",tabIndex:-1,children:m})]})}function Oo({open:t,onSkip:a}){return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-md p-6 shadow-lg flex flex-col items-center gap-3",children:[e.jsx(St,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("div",{className:"text-sm text-gray-700",children:"Scanning for retakes (this can take a few minutes on long audio)…"}),e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsx(A,{variant:"outline",size:"sm",onClick:a,children:"Skip for now"})})]})}):null}function zo({open:t,fuzzyThreshold:a,onThresholdChange:r,onRetry:n,onSkip:o}){return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs(Ce,{className:"w-full max-w-md",children:[e.jsx(Je,{children:e.jsx(Xe,{className:"text-base",children:"No retakes detected"})}),e.jsxs(Ae,{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"You answered “Yes” to Flubber but nothing was found. Try a fuzzier search?"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Fuzzy threshold (0.5–0.95):"}),e.jsx("input",{type:"range",min:.5,max:.95,step:.05,value:a,onChange:l=>r(parseFloat(l.target.value)),className:"w-full"}),e.jsxs("div",{className:"text-xs",children:["Current: ",a.toFixed(2)]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(A,{variant:"ghost",onClick:o,children:"Skip"}),e.jsx(A,{onClick:n,children:"Retry"})]})]})]})}):null}function Bo({src:t,height:a=96,start:r,end:n,onReady:o,onMarkersChange:l,onCut:d,markerEnd:N}){const i=s.useRef(null),u=s.useRef(null),j=s.useRef(null),[c,m]=s.useState(null),[I,x]=s.useState(!1);s.useEffect(()=>{if(!i.current)return;const k=fi.create({container:i.current,waveColor:"#9CA3AF",progressColor:"#1F2937",cursorColor:"#111827",height:a,normalize:!0,backend:"webaudio"}),h=k.registerPlugin(gi.create());u.current=k,j.current=h,k.on("ready",()=>{typeof o=="function"&&o(k);try{m(k.getDuration())}catch{}if(typeof r=="number"){const y=Math.max(0,r),p=typeof n=="number"&&n>y?n:y+.2;h.clear(),h.addRegion({id:"cut",start:y,end:p,color:"rgba(239, 68, 68, 0.25)",drag:!0,resize:!0})}}),k.on("play",()=>x(!0)),k.on("pause",()=>x(!1)),k.on("finish",()=>x(!1)),h.on("region-updated",y=>{y.id==="cut"&&typeof l=="function"&&l({start:y.start,end:y.end})}),h.on("region-created",y=>{y.id==="cut"&&typeof l=="function"&&l({start:y.start,end:y.end})}),h.on("region-removed",y=>{y.id==="cut"&&typeof l=="function"&&l({start:void 0,end:void 0})});try{k.load(t)}catch{}return()=>{try{k.destroy()}catch{}u.current=null,j.current=null,m(null),x(!1)}},[t,a]),s.useEffect(()=>{const k=j.current;if(!u.current||!k)return;const y=k.getRegions().find(p=>p.id==="cut");if(typeof r=="number"){const p=Math.max(0,r),C=typeof n=="number"&&n>p?n:p+.2;y?y.setOptions({start:p,end:C}):k.addRegion({id:"cut",start:p,end:C,color:"rgba(239, 68, 68, 0.25)",drag:!0,resize:!0})}else y&&y.remove()},[r,n]);const v=()=>{const k=u.current;if(k)try{k.playPause()}catch{}},_=()=>{if(typeof d!="function")return;const k=u.current;if(!k)return;let h=0;try{h=k.getCurrentTime()||0}catch{}d(h)};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:i}),typeof N=="number"&&c&&c>0&&e.jsx("div",{style:{position:"absolute",top:0,bottom:0,width:"2px",backgroundColor:"rgba(239,68,68,0.9)",left:`${Math.max(0,Math.min(1,N/c))*100}%`,pointerEvents:"none"}})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:v,className:"px-2 py-1 text-xs rounded border bg-white hover:bg-gray-50",children:I?"Pause":"Play"}),typeof d=="function"&&e.jsx("button",{type:"button",onClick:_,className:"px-2 py-1 text-xs rounded border bg-red-50 text-red-700 hover:bg-red-100",children:"Cut"})]})]})}function Wo({contexts:t,open:a,onConfirm:r,onCancel:n}){const[o,l]=s.useState(()=>{const x={};return(t||[]).forEach(v=>{x[v.flubber_index]=!0}),x}),[d,N]=s.useState(null),[i,u]=s.useState({}),j=s.useMemo(()=>(t||[]).filter(x=>o[x.flubber_index]),[t,o]),c=s.useMemo(()=>[...j].sort((x,v)=>(x.flubber_time_s||0)-(v.flubber_time_s||0)),[j]);if(!a)return null;const m=()=>c.map(x=>{const v=x.flubber_index,_=i[v]||{},k=typeof _.startAbs=="number"?_.startAbs:Math.max(0,(x.flubber_time_s||0)-.75),h=x.computed_end_s??(x.flubber_end_s||x.flubber_time_s||0)+.2,y=Math.max(k+.05,typeof _.endAbs=="number"?_.endAbs:h);return[Math.round(k*1e3),Math.round(y*1e3)]}),I=c.length>=1;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs(Ce,{className:"w-full max-w-3xl max-h-[80vh] overflow-hidden",children:[e.jsxs(Je,{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Xe,{className:"text-base",children:"Review Retakes (Flubber)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:n,children:"Close"}),e.jsxs(A,{size:"sm",disabled:!I,onClick:()=>r(m()),children:[e.jsx(Da,{className:"w-4 h-4 mr-1"}),"Apply Selected"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-700",children:[e.jsx("div",{children:"Click Play, seek on waveform, then press Cut to mark from now to auto end."}),e.jsxs("span",{className:"ml-auto",children:["Marked: ",c.length]})]})]}),e.jsxs(Ae,{className:"space-y-3 overflow-y-auto",children:[(!t||t.length===0)&&e.jsx("div",{className:"text-xs text-gray-600",children:"No flubber instances detected."}),(t||[]).map(x=>{const v=d===x.flubber_index;return e.jsxs("div",{className:`border rounded p-2 flex flex-col gap-2 bg-white ${v?"border-green-500":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-[11px] font-mono",children:["t=",Number(x.flubber_time_s||0).toFixed(2),"s window [",Number(x.snippet_start_s||0).toFixed(1)," – ",Number(x.snippet_end_s||0).toFixed(1),"]"]}),e.jsx("div",{className:"flex items-center gap-2",children:o[x.flubber_index]?e.jsxs(A,{size:"xs",variant:"outline",onClick:()=>{l(_=>({..._,[x.flubber_index]:!1})),u(_=>{const k={..._};return delete k[x.flubber_index],k})},children:[e.jsx(_a,{className:"w-3.5 h-3.5 mr-1"}),"Uncut"]}):e.jsxs(A,{size:"xs",onClick:()=>{const _=audioRefs.current[x.flubber_index],k=_&&typeof _.currentTime=="number"?_.currentTime:0,h=Math.max(0,(x.snippet_start_s||0)+k),y=x.computed_end_s??(x.flubber_end_s||x.flubber_time_s||0)+.2;u(p=>({...p,[x.flubber_index]:{startAbs:h,endAbs:y}})),l(p=>({...p,[x.flubber_index]:!0})),N(x.flubber_index)},children:[e.jsx(Da,{className:"w-3.5 h-3.5 mr-1"}),"Cut"]})})]}),x.url?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Bo,{src:x.url,height:80,start:o[x.flubber_index]&&i[x.flubber_index]?.startAbs!=null?i[x.flubber_index].startAbs-(x.snippet_start_s||0):void 0,end:o[x.flubber_index]&&i[x.flubber_index]?.endAbs!=null?i[x.flubber_index].endAbs-(x.snippet_start_s||0):void 0,markerEnd:(x.computed_end_s??(x.flubber_end_s||x.flubber_time_s||0)+.2)-(x.snippet_start_s||0),onMarkersChange:({start:_,end:k})=>{if(typeof _=="number"){const h=Math.max(0,(x.snippet_start_s||0)+_);N(x.flubber_index),u(y=>({...y,[x.flubber_index]:{...y[x.flubber_index]||{},startAbs:h}}))}if(typeof k=="number"){const h=Math.max(0,(x.snippet_start_s||0)+k);u(y=>({...y,[x.flubber_index]:{...y[x.flubber_index]||{},endAbs:h}}))}},onCut:_=>{const k=Math.max(0,(x.snippet_start_s||0)+(_||0)),h=x.computed_end_s??(x.flubber_end_s||x.flubber_time_s||0)+.2;u(y=>({...y,[x.flubber_index]:{...y[x.flubber_index]||{},startAbs:k,endAbs:h}})),l(y=>({...y,[x.flubber_index]:!0})),N(x.flubber_index)}}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] text-gray-600",children:[e.jsxs("div",{children:["Auto end: ",(x.computed_end_s??(x.flubber_end_s||0)+.2).toFixed(2),"s"]}),e.jsx("div",{className:"flex gap-2"})]})]}):e.jsx("div",{className:"text-[11px] text-gray-500",children:"Snippet not available"})]},x.flubber_index)})]})]})})}const xa=t=>t==="yes"||t==="no"||t==="unknown"?t:"no";function qo({open:t,onSubmit:a,onCancel:r,hide:n,initialAnswers:o,detectedIntents:l}){const[d,N]=s.useState({flubber:"no",intern:"no",sfx:"no"}),[i,u]=s.useState(!1);if(s.useEffect(()=>{if(t){const p=o||{};N({flubber:xa(p.flubber),intern:xa(p.intern),sfx:xa(p.sfx)}),u(!1)}},[t,o]),!t)return null;const j=n||{},c=["flubber","intern","sfx"].filter(p=>!j[p]).every(p=>["yes","no","unknown"].includes(d[p])),m=l||{},I=p=>{const C=m?.[p]||{},M=Number(C?.count??0),b=Array.isArray(C?.matches)?C.matches:[];return{count:M,matches:b}},x=(p,C,M)=>{const b=I(p);if(b.count>0){if(p==="flubber")return{detected:!0,label:`We detected ${b.count===1?"a Flubber marker":`${b.count} Flubber markers`}. Should we process those?`,description:`We heard ${b.count} possible redo${b.count===1?"":"s"} in your transcript.`};if(p==="intern")return{detected:!0,label:`We detected ${b.count===1?"an Intern command":`${b.count} Intern commands`}. Should we process those?`,description:`We heard ${b.count} intern cue${b.count===1?"":"s"} in your transcript.`};if(p==="sfx"){const g=Array.from(new Set(b.matches.map(se=>(se?.label||se?.phrase||"").trim()).filter(Boolean)));let U=`We heard ${b.count} sound effect cue${b.count===1?"":"s"}.`;return g.length===1?U=`Cue word detected: ${g[0]}.`:g.length===2?U=`Cue words detected: ${g[0]} and ${g[1]}.`:g.length>2&&(U=`Cue words detected: ${g.slice(0,3).join(", ")}${g.length>3?"…":""}.`),{detected:!0,label:"We detected sound effect cues. Should we process those?",description:U}}}return{detected:!1,label:C,description:M}},v=x("flubber","Is there a Flubber?","If you recorded any redos or mistakes, we can look for them automatically so you can trim them in the next step."),_=x("intern","Is there an Intern?","Tell us if the AI intern voice should speak in this recording. We only ask when voices are available on your account."),k=x("sfx","Are there any word Sound Effects?","Answer yes if you have cue words that should drop music or SFX during assembly."),h=({name:p,label:C,description:M,detected:b})=>e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:`w-64 text-[13px] font-medium ${b?"text-emerald-700":""}`,children:[C,b&&e.jsx("span",{className:"ml-2 inline-flex items-center rounded bg-emerald-100 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-emerald-700",children:"Detected"})]}),["yes","no","unknown"].map(g=>e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:p,value:g,checked:d[p]===g,onChange:()=>N(U=>({...U,[p]:g}))}),e.jsx("span",{className:"capitalize",children:g==="unknown"?"I Don't Remember":g})]},g))]}),(b||i)&&M&&e.jsx("div",{className:`text-xs ${b?"text-emerald-700":"text-muted-foreground"} ml-0 md:ml-[16.5rem] -mt-1`,children:M})]}),y=()=>a({flubber:j.flubber?"no":xa(d.flubber),intern:j.intern?"no":xa(d.intern),sfx:j.sfx?"no":xa(d.sfx)});return nl.createPortal(e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/40",role:"dialog","aria-modal":"true",children:e.jsxs(Ce,{className:"w-full max-w-2xl",children:[e.jsx(Je,{className:"flex items-center justify-between",children:e.jsx(Xe,{className:"text-base",children:"Before We Start"})}),e.jsxs(Ae,{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("button",{type:"button",onClick:()=>u(p=>!p),className:"text-xs text-slate-600 hover:text-slate-900 underline",children:i?"Hide details":"What does this mean?"})}),!j.flubber&&e.jsx(h,{name:"flubber",label:v.label,description:v.description,detected:v.detected}),!j.intern&&e.jsx(h,{name:"intern",label:_.label,description:_.description,detected:_.detected}),!j.sfx&&e.jsx(h,{name:"sfx",label:k.label,description:k.description,detected:k.detected}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx(A,{variant:"ghost",onClick:r,children:"Cancel"}),e.jsx(A,{onClick:y,disabled:!c,children:"Continue"})]})]})]})}),document.body)}function ki({onBack:t,token:a,templates:r=[],podcasts:n,initialStep:o,testInject:l,preselectedMainFilename:d,preselectedTranscriptReady:N,creatorMode:i="standard",preuploadedItems:u=[],preuploadedLoading:j=!1,onRefreshPreuploaded:c=()=>{},preselectedStartStep:m}){const I=To({token:a,templates:r,initialStep:o,testInject:l,preselectedMainFilename:d,preselectedTranscriptReady:N,creatorMode:i,preselectedStartStep:m}),{currentStep:x,setCurrentStep:v,steps:_,progressPercentage:k,selectedTemplate:h,handleTemplateSelect:y,uploadedFile:p,uploadedFilename:C,selectedPreupload:M,isUploading:b,uploadProgress:g,handleFileChange:U,handlePreuploadedSelect:se,fileInputRef:Z,mediaLibrary:F,ttsValues:re,handleTtsChange:O,setShowVoicePicker:z,setVoicePickerTargetId:P,voiceNameById:E,voicesLoading:ne,coverArtInputRef:ee,coverCropperRef:he,coverNeedsUpload:D,handleCoverFileSelected:H,handleUploadProcessedCover:ge,episodeDetails:V,updateCoverCrop:je,setCoverMode:_e,clearCover:T,isUploadingCover:K,handleDetailsChange:le,transcriptReady:me,isAssembling:te,isPublishing:Ne,isAiTitleBusy:Be,isAiDescBusy:ke,publishMode:De,publishVisibility:B,scheduleDate:xe,scheduleTime:ie,canProceedToStep5:W,blockingQuota:Pe,missingTitle:Ue,missingEpisodeNumber:$e,handleAISuggestTitle:Fe,handleAISuggestDescription:Ge,handleAssemble:ct,assemblyComplete:et,processingEstimate:dt,assembledEpisode:jt,statusMessage:xt,showFlubberScan:R,setShowFlubberScan:ye,showFlubberReview:ae,flubberContexts:f,handleFlubberConfirm:Y,handleFlubberCancel:Q,showIntentQuestions:ue,handleIntentSubmit:Ie,intents:Re,intentDetections:Le,intentDetectionReady:nt,handleIntentAnswerChange:He,intentVisibility:it,capabilities:w,intentsComplete:q,pendingIntentLabels:S,flubberNotFound:$,fuzzyThreshold:J,setFuzzyThreshold:Se,retryFlubberSearch:We,skipFlubberRetry:Ve,usage:lt,minutesNearCap:Ct,minutesRemaining:Et,minutesDialog:ut,setMinutesDialog:mt,activeSegment:we,showVoicePicker:Ee,handleVoiceChange:Me,setPublishMode:Ze,setPublishVisibility:tt,setScheduleDate:ot,setScheduleTime:ft,setShowIntentQuestions:Rt,cancelBuild:Tt,buildActive:Gt}=I,hs={flubber:Number(Le?.flubber?.count??0),intern:Number(Le?.intern?.count??0),sfx:Number(Le?.sfx?.count??0)},ps={flubber:!1,intern:!(w.has_elevenlabs||w.has_google_tts),sfx:!w.has_any_sfx_triggers},os=nt?{flubber:ps.flubber||hs.flubber===0,intern:ps.intern||hs.intern===0,sfx:ps.sfx||hs.sfx===0}:ps,_s=es=>{if(!es||!isFinite(es)||es<=0)return null;const xs=Math.floor(es/60),Is=Math.round(es%60),Os=[];return xs>0&&Os.push(`${xs} min${xs===1?"":"s"}`),Os.push(`${Is} sec${Is===1?"":"s"}`),Os.join(" ")},At=ut?.durationSeconds!=null?_s(ut.durationSeconds):ut?.requiredMinutes?_s(ut.requiredMinutes*60):null,vt=typeof ut?.remainingMinutes=="number"?_s(Math.max(0,ut.remainingMinutes)*60):null,Ss=ut?.renewalDate?(()=>{try{return new Date(ut.renewalDate).toLocaleDateString(void 0,{month:"long",day:"numeric",year:"numeric"})}catch{return ut.renewalDate}})():null,us=()=>mt(null),bt=()=>{try{localStorage.setItem("ppp_billing_intent","upgrade")}catch{}window.dispatchEvent(new Event("ppp:navigate-billing")),us()},zt=()=>{try{localStorage.setItem("ppp_billing_intent","purchase-minutes")}catch{}window.dispatchEvent(new Event("ppp:navigate-billing")),us()},js=(()=>{switch(x){case 1:return e.jsx(Po,{templates:r,onTemplateSelect:y});case 2:return i==="preuploaded"?e.jsx(StepSelectPreprocessed,{items:u,loading:j,selectedFilename:M||C,onSelect:se,onBack:()=>v(1),onNext:()=>v(3),onRefresh:c,intents:Re,pendingIntentLabels:S,intentsComplete:q,onIntentSubmit:Ie,onEditAutomations:()=>Rt(!0)}):e.jsx(Mo,{uploadedFile:p,uploadedFilename:C,isUploading:b,uploadProgress:g,onFileChange:U,fileInputRef:Z,onBack:()=>v(1),onNext:()=>v(3),onEditAutomations:()=>Rt(!0),onIntentChange:He,onIntentSubmit:Ie,canProceed:!!(p||C)&&q&&!b,pendingIntentLabels:S,intents:Re,intentVisibility:it});case 3:return e.jsx(Ro,{selectedTemplate:h,mediaLibrary:F,uploadedFile:p,ttsValues:re,onTtsChange:O,onBack:()=>v(2),onNext:()=>v(4),onOpenVoicePicker:es=>{P(es),z(!0)},voiceNameById:E,voicesLoading:ne});case 4:return e.jsx(Do,{episodeDetails:V,coverArtInputRef:ee,coverCropperRef:he,coverNeedsUpload:D,isUploadingCover:K,onCoverFileSelected:H,onCoverCropChange:je,onCoverModeChange:_e,onRemoveCover:T,onBack:()=>v(3),onSkip:()=>v(5),onContinue:async()=>{try{V.coverArt&&D&&await ge()}catch{}finally{v(5)}}});case 5:return e.jsx(Fo,{episodeDetails:V,transcriptReady:me,isAssembling:te,isPublishing:Ne,isAiTitleBusy:Be,isAiDescBusy:ke,publishMode:De,publishVisibility:B,scheduleDate:xe,scheduleTime:ie,canProceed:W,blockingQuota:Pe,missingTitle:Ue,missingEpisodeNumber:$e,onBack:()=>v(4),onAssemble:ct,onDetailsChange:le,onSuggestTitle:Fe,onSuggestDescription:Ge,onPublishModeChange:Ze,onPublishVisibilityChange:tt,onScheduleDateChange:ot,onScheduleTimeChange:ft});case 6:return e.jsx(Lo,{assemblyComplete:et,processingEstimate:dt,publishMode:De,assembledEpisode:jt||{},statusMessage:xt,onBack:t});default:return e.jsx("div",{children:"Invalid Step"})}})();return e.jsxs(e.Fragment,{children:[e.jsx($o,{onBack:t,selectedTemplate:h,steps:_,currentStep:x,progressPercentage:k,isUploading:b,uploadProgress:g,usage:lt,minutesNearCap:Ct,buildActive:Gt,minutesRemaining:Et,onCancelBuild:Tt,children:js}),e.jsx(Oo,{open:R,onSkip:()=>{ye(!1),v(3)}}),ae&&e.jsx(Wo,{contexts:f||[],open:ae,onConfirm:Y,onCancel:Q}),ue&&e.jsx(qo,{open:ue,onSubmit:Ie,onCancel:()=>{Rt(!1),v(3)},initialAnswers:Re,hide:os,detectedIntents:Le}),e.jsx(zo,{open:$,fuzzyThreshold:J,onThresholdChange:Se,onRetry:We,onSkip:Ve}),e.jsx(na,{open:!!ut,onOpenChange:es=>{es||us()},children:e.jsxs(Hs,{className:"max-w-md",children:[e.jsxs(Gs,{children:[e.jsx(Ks,{children:"Not enough processing minutes"}),e.jsx(Ns,{children:ut?.message||"This episode cannot be assembled because it exceeds your remaining processing minutes."})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[At&&e.jsxs("p",{children:["This episode is ",e.jsx("strong",{children:At})," long."]}),vt&&e.jsxs("p",{children:["Your plan has ",e.jsx("strong",{children:vt})," remaining",Ss?` until ${Ss}`:"","."]}),!At&&ut?.requiredMinutes&&e.jsxs("p",{children:["Estimated processing time: ",e.jsxs("strong",{children:[ut.requiredMinutes," minute",ut.requiredMinutes===1?"":"s"]}),"."]})]}),e.jsxs(ia,{className:"flex flex-col space-y-2 sm:flex-row sm:space-y-0 sm:space-x-2 sm:justify-end",children:[e.jsx(A,{variant:"outline",onClick:bt,className:"w-full sm:w-auto",children:"Upgrade Plan"}),e.jsx(A,{variant:"outline",onClick:zt,className:"w-full sm:w-auto",children:"Buy Minutes"}),e.jsx(A,{variant:"ghost",onClick:us,className:"w-full sm:w-auto",children:"Cancel"})]})]})}),Ee&&we&&e.jsx($a,{value:we?.source?.voice_id||null,onChange:es=>Me(es),onClose:()=>{z(!1),P(null)}})]})}function Vo({loading:t=!1,hasReadyAudio:a=!1,errorMessage:r="",onRetry:n,onBack:o,onChooseUpload:l,onChooseLibrary:d,onChooseRecord:N}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsxs(A,{variant:"ghost",onClick:o,className:"px-0 text-slate-600 hover:text-slate-900",children:[e.jsx(Yt,{className:"w-4 h-4 mr-1"})," Dashboard"]}),e.jsx("span",{className:"text-slate-400",children:"/"}),e.jsx("span",{children:"Start New Episode"})]}),e.jsxs(Ce,{className:"border border-slate-200 shadow-sm",children:[e.jsxs(Je,{children:[e.jsx(Xe,{className:"text-2xl",style:{color:"#2C3E50"},children:"How do you want to start?"}),e.jsx(Zt,{className:"text-slate-600 text-sm",children:"Upload new audio to process in the background, pick from your finished uploads, or record right now."})]}),e.jsxs(Ae,{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("button",{type:"button",onClick:l,className:"border border-slate-200 rounded-xl p-6 text-left hover:border-blue-400 hover:shadow-sm transition",children:[e.jsx(ks,{className:"w-6 h-6 text-blue-500 mb-4"}),e.jsx("div",{className:"font-semibold text-slate-800 mb-1",children:"Upload new audio"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Send us your raw mix. We’ll process and transcribe it automatically, then notify you when it’s ready."})]}),e.jsxs("div",{className:`relative ${a?"":"group"}`,children:[e.jsxs("button",{type:"button",onClick:a?d:void 0,disabled:!a||t,title:a?void 0:"You must upload audio first",className:`border rounded-xl p-6 text-left transition ${a?"border-emerald-200 hover:border-emerald-500 hover:shadow-sm":"border-slate-200 bg-slate-100 cursor-not-allowed text-slate-400"}`,children:[e.jsx(ai,{className:`w-6 h-6 mb-4 ${a?"text-emerald-500":"text-slate-400"}`}),e.jsx("div",{className:"font-semibold text-slate-800 mb-1",children:"Use processed audio"}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Jump straight into editing with transcripts and automations ready. ",a?"":"Upload audio first and we will unlock this option."]})]}),!a&&e.jsx("div",{className:"absolute left-0 -bottom-2 translate-y-full z-10 hidden group-hover:block",children:e.jsx("div",{className:"max-w-xs rounded-md border border-red-200 bg-white shadow-md p-2",children:e.jsx("span",{className:"text-sm text-red-600",children:"You must upload audio first"})})})]}),e.jsxs("button",{type:"button",onClick:N,className:"border border-slate-200 rounded-xl p-6 text-left hover:border-purple-400 hover:shadow-sm transition",children:[e.jsx(Ys,{className:"w-6 h-6 text-purple-500 mb-4"}),e.jsx("div",{className:"font-semibold text-slate-800 mb-1",children:"Record your show"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Capture your episode now. Once the recording finishes we’ll process it just like an upload and alert you when it’s ready."})]})]})]}),r&&e.jsx(Ce,{className:"border border-red-200 bg-red-50",children:e.jsxs(Ae,{className:"flex items-start justify-between gap-3 text-sm text-red-700",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ws,{className:"w-5 h-5 mt-1"}),e.jsx("div",{children:r})]}),n&&e.jsx("button",{type:"button",onClick:n,className:"ml-4 shrink-0 inline-flex items-center rounded-md border border-red-300 bg-white px-2 py-1 text-xs font-medium text-red-700 hover:bg-red-50",children:"Try again"})]})}),!a&&!r&&e.jsx(Ce,{className:"border border-amber-200 bg-amber-50",children:e.jsxs(Ae,{className:"flex items-start gap-3 text-sm text-amber-800",children:[e.jsx(ws,{className:"w-5 h-5 mt-1"}),e.jsx("div",{children:"We’ll email you as soon as each upload is transcribed so you can come back and assemble without waiting."})]})})]})}const Qr=s.forwardRef(({className:t,...a},r)=>e.jsx(Gn,{ref:r,className:at("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...a,children:e.jsx(Nl,{className:at("flex items-center justify-center text-current"),children:e.jsx(ti,{className:"h-4 w-4"})})}));Qr.displayName=Gn.displayName;function Yo({token:t,onBack:a,onDone:r,defaultEmail:n="",onUploaded:o=()=>{}}){const{toast:l}=Lt(),[d,N]=s.useState(null),[i,u]=s.useState(""),[j,c]=s.useState(!0),[m,I]=s.useState(n||""),[x,v]=s.useState(!1),[_,k]=s.useState(""),[h,y]=s.useState(""),p=s.useMemo(()=>{if(i)return i;if(!d)return"";try{return d.name.replace(/\.[a-z0-9]+$/i,"").replace(/[._-]+/g," ").trim()}catch{return d.name}},[d,i]),C=g=>{const U=g.target.files?.[0];U&&(N(U),u(""),k(""),y(""))},M=async g=>{if(g.preventDefault(),!d){y("Select an audio file to upload.");return}v(!0),y(""),k("");try{const U=new FormData;U.append("files",d),p&&U.append("friendly_names",JSON.stringify([p])),U.append("notify_when_ready",j?"true":"false"),j&&m&&U.append("notify_email",m),await G(t).raw("/api/media/upload/main_content",{method:"POST",body:U}),k("Upload received! We will notify you once it is processed."),N(null),u(""),o()}catch(U){y(U?.message||"Upload failed."),l({variant:"destructive",title:"Upload failed",description:U?.message||"Unable to upload audio."})}finally{v(!1)}},b=!!d;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsxs(A,{variant:"ghost",onClick:a,className:"px-0 text-slate-600 hover:text-slate-900",children:[e.jsx(Yt,{className:"w-4 h-4 mr-1"})," Back"]}),e.jsx("span",{className:"text-slate-400",children:"/"}),e.jsx("span",{children:"Upload Audio"})]}),e.jsxs(Ce,{className:"border border-slate-200 shadow-sm",children:[e.jsxs(Je,{children:[e.jsx(Xe,{className:"text-2xl",style:{color:"#2C3E50"},children:"Upload audio for processing"}),e.jsx(Zt,{className:"text-slate-600 text-sm",children:"We’ll transcribe everything as soon as it lands. Come back when you get the notification and you can jump straight to assembly."})]}),e.jsx(Ae,{children:e.jsxs("form",{className:"space-y-6",onSubmit:M,children:[e.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-xl p-8 text-center",children:[e.jsx("input",{type:"file",accept:"audio/*",id:"preupload-file",className:"hidden",onChange:C}),e.jsxs("label",{htmlFor:"preupload-file",className:"inline-flex flex-col items-center gap-3 cursor-pointer",children:[e.jsx(ks,{className:"w-10 h-10 text-blue-500"}),e.jsx("span",{className:"text-sm text-slate-600",children:b?d.name:"Drag & drop or click to choose an audio file"})]})]}),b&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Friendly name"}),e.jsx(Ye,{value:i,onChange:g=>u(g.target.value),placeholder:"My episode draft",className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qr,{id:"preupload-notify",checked:j,onCheckedChange:g=>c(!!g)}),e.jsx("label",{htmlFor:"preupload-notify",className:"text-sm text-slate-700",children:"Email me when it’s ready"})]}),j&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Notification email"}),e.jsx(Ye,{type:"email",value:m,onChange:g=>I(g.target.value),placeholder:"you@example.com",className:"mt-1"})]})]}),h&&e.jsxs("div",{className:"flex items-start gap-2 text-sm text-red-600",children:[e.jsx(Il,{className:"w-4 h-4 mt-0.5"}),e.jsx("span",{children:h})]}),_&&e.jsxs("div",{className:"flex items-start gap-2 text-sm text-emerald-600",children:[e.jsx(va,{className:"w-4 h-4 mt-0.5"}),e.jsx("span",{children:_})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(A,{type:"button",variant:"ghost",onClick:r,children:"Return to dashboard"}),e.jsxs(A,{type:"submit",disabled:!b||x,children:[x?e.jsx(St,{className:"w-4 h-4 mr-2 animate-spin"}):null,x?"Uploading…":"Upload audio"]})]})]})})]})]})}function Ei({onBack:t,token:a}){const[r,n]=s.useState([]),[o,l]=s.useState(!0),[d,N]=s.useState(null),[i,u]=s.useState([]),[j,c]=s.useState("music"),[m,I]=s.useState(!1),[x,v]=s.useState(null),[_,k]=s.useState(""),[h,y]=s.useState(""),{toast:p}=Lt(),[C,M]=s.useState(null),[b,g]=s.useState(null),[U,se]=s.useState({}),Z=async()=>{l(!0);try{const K=await G(a).get("/api/media/");n(Fa(K))}catch(T){N(T.message)}finally{l(!1)}};s.useEffect(()=>{a&&Z()},[a]),s.useEffect(()=>()=>{try{b?.pause()}catch{}},[b]);const F=T=>{const me={intro:52428800,outro:52428800,music:52428800,commercial:52428800,sfx:26214400}[j]??50*1048576,te=Array.from(T.target.files||[]),Ne=[];for(const Be of te){if(!(Be.type||"").toLowerCase().startsWith("audio/")){p({variant:"destructive",title:"Invalid file type",description:`${Be.name}: only audio files are allowed for ${j}.`});continue}if(Be.size>me){const De=Math.floor(me/1048576);p({variant:"destructive",title:"File too large",description:`${Be.name}: exceeds ${De}MB limit for ${j}.`});continue}Ne.push({file:Be,friendly_name:Be.name.split(".").slice(0,-1).join(".")})}u(Ne)},re=(T,K)=>{const le=[...i];le[T].friendly_name=K,u(le)},O=async()=>{if(i.length===0)return;I(!0),N(null);const T=new FormData,K=[];for(const le of i)T.append("files",le.file),K.push(le.friendly_name);T.append("friendly_names",JSON.stringify(K));try{await G(a).raw(`/api/media/upload/${j}`,{method:"POST",body:T}),u([]),document.getElementById("media-upload").value="",p({title:"Success!",description:"Media uploaded successfully."}),Z()}catch(le){N(le.message)}finally{I(!1)}},z=T=>{v(T.id),k(T.friendly_name||T.filename.split("_").slice(1).join("_")),y(T.trigger_keyword||"")},P=()=>{v(null),k(""),y("")},E=async T=>{try{const K={friendly_name:_,trigger_keyword:h||null};await G(a).put(`/api/media/${T}`,K),p({title:"Saved"}),n(me=>me.map(te=>te.id===T?{...te,friendly_name:_,trigger_keyword:h||null}:te)),P()}catch(K){p({title:"Error",description:K.message,variant:"destructive"})}},ne=async T=>{if(window.confirm("Are you sure you want to permanently delete this file?"))try{await G(a).del(`/api/media/${T}`),n(le=>le.filter(me=>me.id!==T)),p({description:"File deleted."})}catch(K){N(K.message)}},ee=s.useMemo(()=>r.reduce((T,K)=>((T[K.category]=T[K.category]||[]).push(K),T),{}),[r]),he=s.useMemo(()=>{const T=["intro","outro","music","sfx","commercial"],K=Object.keys(ee);return T.filter(le=>K.includes(le)).concat(K.filter(le=>!T.includes(le)))},[ee]),D=async T=>{if(!T?.id)return null;try{const le=await G(a).get(`/api/media/preview?id=${encodeURIComponent(T.id)}&resolve=true`);return le?.path||le?.url||null}catch(K){return p({variant:"destructive",title:"Preview failed",description:K?.message||"Could not resolve preview URL"}),null}},H=async T=>{try{if(!T)return;if(C===T.id){try{b?.pause()}catch{}M(null),g(null);return}if(b)try{b.pause()}catch{}const K=await D(T);if(!K)return;const le=new Audio(K);g(le),M(T.id),le.onended=()=>{M(null),g(null)},le.play().catch(me=>{M(null),g(null),p({variant:"destructive",title:"Preview failed to play",description:me?.message||"Unknown error"})})}catch(K){M(null),g(null),p({variant:"destructive",title:"Preview failed",description:K?.message||"Unknown error"})}},ge=(T,K)=>!!(U[T]||new Set).has(K),V=(T,K)=>{se(le=>{const me=new Set(le[T]||[]);return me.has(K)?me.delete(K):me.add(K),{...le,[T]:me}})},je=T=>{se(K=>({...K,[T]:new Set}))},_e=async T=>{const K=Array.from(U[T]||[]);if(K.length&&window.confirm(`Delete ${K.length} selected ${T} item(s)? This cannot be undone.`))try{const le=G(a);for(const me of K)try{await le.del(`/api/media/${me}`)}catch{}n(me=>me.filter(te=>!(te.category===T&&K.includes(te.id)))),je(T),p({description:`Deleted ${K.length} ${T} item(s).`})}catch(le){N(le.message)}};return e.jsxs("div",{className:"p-6",children:[e.jsxs(A,{onClick:t,variant:"ghost",className:"mb-4",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs(Ce,{className:"mb-6",children:[e.jsx(Je,{children:e.jsx(Xe,{children:"Upload New Media"})}),e.jsxs(Ae,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{htmlFor:"media-category",children:"Category"}),e.jsxs(Jt,{value:j,onValueChange:c,children:[e.jsx(Wt,{id:"media-category",children:e.jsx(Qt,{})}),e.jsx(qt,{children:["intro","outro","music","commercial","sfx"].map(T=>e.jsx(yt,{value:T,children:T.charAt(0).toUpperCase()+T.slice(1)},T))})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(ve,{htmlFor:"media-upload",children:"File(s)"}),e.jsx(Ye,{id:"media-upload",type:"file",accept:"audio/*",multiple:!0,onChange:F})]})]}),i.length>0&&e.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[e.jsx(ve,{children:"Files to Upload:"}),i.map((T,K)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{value:T.friendly_name,onChange:le=>re(K,le.target.value),className:"flex-grow",placeholder:"Enter a friendly name"}),e.jsx("p",{className:"text-sm text-gray-500 truncate",children:T.file.name})]},K))]}),e.jsx(A,{onClick:O,disabled:m||i.length===0,className:"w-full mt-4",children:m?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"mr-2 h-4 w-4 animate-spin"})," Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ks,{className:"w-4 h-4 mr-2"})," Upload ",i.length," File(s)"]})})]}),d&&e.jsx("p",{className:"text-sm text-red-500 p-6 pt-0",children:d})]}),o&&e.jsx("p",{children:"Loading media library..."}),e.jsx("div",{className:"space-y-6",children:he.map(T=>{const K=ee[T]||[],le=T==="commercial";return e.jsxs(Ce,{children:[e.jsx(Je,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Xe,{className:"capitalize flex items-center gap-2",children:[T.replace("_"," "),le&&e.jsx("span",{className:"text-xs text-gray-500",children:"(Coming Soon)"})]}),!le&&U[T]?.size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{variant:"destructive",size:"sm",onClick:()=>_e(T),children:["Delete selected ",T]}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>je(T),children:"Clear"})]})]})}),e.jsx(Ae,{children:e.jsx("div",{className:`space-y-2 ${le?"opacity-60 pointer-events-none":""}`,children:K.map(me=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>V(T,me.id),className:`inline-flex items-center justify-center h-6 w-6 rounded-md border ${ge(T,me.id)?"bg-red-50 text-red-600 border-red-300":"bg-white text-muted-foreground border-muted-foreground/30"}`,title:ge(T,me.id)?"Unselect":"Select",children:ge(T,me.id)?e.jsx(Tl,{className:"w-3 h-3"}):e.jsx(ri,{className:"w-3 h-3"})}),e.jsx(ur,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}),e.jsx("div",{className:"flex flex-col gap-1",children:x===me.id?e.jsxs(e.Fragment,{children:[e.jsx(Ye,{value:_,onChange:te=>k(te.target.value),className:"h-8"}),(T==="sfx"||T==="commercial")&&e.jsx(Ye,{value:h,onChange:te=>y(te.target.value.toLowerCase()),className:"h-8",placeholder:"Trigger keyword (optional)"})]}):e.jsxs("div",{className:"flex items-start gap-2 flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:me.friendly_name||me.filename.split("_").slice(1).join("_")}),me.trigger_keyword&&(T==="sfx"||T==="commercial")&&e.jsx("span",{className:"text-[10px] uppercase tracking-wide bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:me.trigger_keyword})]}),(T==="intro"||T==="outro")&&(me.transcript_text||me.transcript||me.subtitle)&&e.jsx("span",{className:"text-xs italic text-gray-500",children:me.transcript_text||me.transcript||me.subtitle})]})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button","aria-label":C===me.id?"Pause preview":"Play preview",onClick:()=>H(me),className:`inline-flex items-center justify-center h-8 w-8 rounded border mr-1 ${C===me.id?"bg-blue-600 text-white border-blue-600":"bg-white text-foreground border-muted-foreground/30"}`,title:"Preview",disabled:le,children:C===me.id?e.jsx(vs,{className:"w-4 h-4"}):e.jsx(Xt,{className:"w-4 h-4"})}),x===me.id?e.jsxs(e.Fragment,{children:[e.jsx(A,{onClick:()=>E(me.id),variant:"ghost",size:"icon",className:"h-8 w-8 text-green-600 hover:text-green-700",children:e.jsx(Ra,{className:"w-4 h-4"})}),e.jsx(A,{onClick:P,variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500 hover:text-gray-700",children:e.jsx(Rr,{className:"w-4 h-4"})})]}):e.jsx(A,{onClick:()=>z(me),variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500 hover:text-gray-700",disabled:le,children:e.jsx(ni,{className:"w-4 h-4"})}),e.jsx(A,{onClick:()=>ne(me.id),variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-700",disabled:le,children:e.jsx($s,{className:"w-4 h-4"})})]})]},me.id))})})]},T)})})]})}function Ho({episodes:t,onEdit:a,onDelete:r,formatPublishAt:n}){const[o,l]=s.useState(null),d=s.useRef({}),N=i=>{if(o&&o!==i){const j=d.current[o];if(j)try{j.pause(),j.currentTime=0}catch{}}const u=d.current[i];if(u)if(o===i&&!u.paused)u.pause(),l(null);else try{u.play(),l(i)}catch{}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"New Grid Concept"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 xl:grid-cols-5 gap-4",children:t.slice(0,15).map(i=>{const u=i.cover_url||`/api/episodes/${i.id}/cover`;return e.jsxs("div",{className:"group relative rounded-lg overflow-hidden border bg-white shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"aspect-square bg-gray-100 relative",children:[e.jsx("img",{src:u,alt:"cover",className:"absolute inset-0 w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-between p-2 text-white",children:[e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx("button",{onClick:()=>a?.(i),className:"bg-white/20 hover:bg-white/30 rounded p-1",title:"Edit",children:e.jsx(ir,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r?.(i),className:"bg-white/20 hover:bg-white/30 rounded p-1",title:"Delete",children:e.jsx($s,{className:"w-4 h-4"})}),e.jsx("button",{className:"bg-white/20 hover:bg-white/30 rounded p-1",title:"More",children:e.jsx(Pl,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>N(i.id),className:"bg-white/25 hover:bg-white/40 rounded-full w-10 h-10 flex items-center justify-center mx-auto mb-2",title:"Play preview",children:o===i.id?e.jsx(vs,{className:"w-5 h-5"}):e.jsx(Xt,{className:"w-5 h-5 ml-0.5"})}),e.jsx("div",{className:"text-center text-[10px] font-medium line-clamp-2 leading-tight",children:i.title||"Untitled"})]})]})]}),e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsx("div",{className:"text-xs font-semibold leading-snug line-clamp-2",title:i.title,children:i.title||"Untitled Episode"}),e.jsxs("div",{className:"text-[10px] text-gray-500 flex items-center gap-1",title:i.publish_at||"",children:[i.publish_at&&e.jsx(Dr,{className:"w-3 h-3"}),i.publish_at?n(i.publish_at):"-"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>N(i.id),className:`text-[10px] px-2 py-1 rounded border inline-flex items-center gap-1 ${o===i.id?"bg-blue-600 text-white border-blue-600":"hover:bg-gray-100"}`,children:[o===i.id?e.jsx(vs,{className:"w-3 h-3"}):e.jsx(Xt,{className:"w-3 h-3"}),o===i.id?"Pause":"Play"]}),typeof i.plays_total=="number"&&e.jsxs("span",{className:"text-[10px] text-gray-500",children:[i.plays_total," plays"]})]}),e.jsx("audio",{ref:j=>{j&&(d.current[i.id]=j)},src:i.playback_url||i.stream_url||i.final_audio_url||"",preload:"none",onEnded:()=>l(j=>j===i.id?null:j),className:"hidden"})]})]},i.id)})})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"New List Concept (Micro Player)"}),e.jsxs("div",{className:"bg-white border rounded-md overflow-hidden divide-y",children:[t.slice(0,20).map(i=>{const u=o===i.id;return e.jsxs("div",{className:"flex items-stretch gap-3 px-3 py-2 hover:bg-gray-50 text-sm",children:[e.jsx("button",{onClick:()=>N(i.id),className:`mt-0.5 rounded-full w-8 h-8 flex items-center justify-center border ${u?"bg-blue-600 text-white border-blue-600":"hover:bg-gray-100"}`,children:u?e.jsx(vs,{className:"w-4 h-4"}):e.jsx(Xt,{className:"w-4 h-4 ml-0.5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"font-medium truncate",title:i.title,children:i.title||"Untitled Episode"}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>a?.(i),className:"text-[11px] text-blue-600 hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>r?.(i),className:"text-[11px] text-red-600 hover:underline",children:"Delete"})]})]}),i.description&&e.jsx("div",{className:"text-[11px] text-gray-500 line-clamp-1",title:i.description,children:i.description}),e.jsxs("div",{className:"mt-1 flex items-center gap-4 text-[10px] text-gray-500",children:[i.publish_at&&e.jsx("span",{children:n(i.publish_at)}),typeof i.plays_total=="number"&&e.jsxs("span",{children:[i.plays_total," plays"]}),i.status&&e.jsx("span",{className:"uppercase tracking-wide text-[9px] font-semibold px-1.5 py-0.5 rounded bg-gray-100 border",children:i.status})]}),e.jsx("audio",{ref:j=>{j&&(d.current[i.id]=j)},src:i.playback_url||i.stream_url||i.final_audio_url||"",preload:"none",onEnded:()=>l(j=>j===i.id?null:j),className:"hidden"})]})]},i.id)}),t.length===0&&e.jsx("div",{className:"px-3 py-6 text-center text-xs text-gray-500",children:"No episodes loaded."})]})]})]})}function Go({episodeId:t,token:a,onClose:r}){const[n,o]=s.useState(!0),[l,d]=s.useState(""),[N,i]=s.useState([]),[u,j]=s.useState({}),[c,m]=s.useState(!1),[I,x]=s.useState(null),v=async()=>{if(t){o(!0),d(""),x(null);try{const p=await G(a).get(`/api/flubber/contexts/${t}`);i(p.contexts||[]);const C={};p.contexts?.forEach(M=>{C[M.flubber_index]=!0}),j(C)}catch(y){d(y.message)}finally{o(!1)}}};s.useEffect(()=>{v()},[t]);const _=y=>j(p=>({...p,[y]:!p[y]})),k=async()=>{const y=N.filter(p=>u[p.flubber_index]).map(p=>({start_s:Math.max(0,p.flubber_time_s-.75),end_s:p.flubber_time_s+.25}));if(!y.length){d("No cuts selected");return}m(!0),d(""),x(null);try{const C=await G(a).post(`/api/flubber/apply/${t}`,y);x(C)}catch(p){d(p.message)}finally{m(!1)}},h=async()=>{if(t){o(!0),d("");try{await G(a).post(`/api/flubber/prepare/${t}`,{}),await v()}catch(y){d(y.message)}finally{o(!1)}}};return e.jsxs(Ce,{className:"mt-4",children:[e.jsxs(Je,{className:"flex flex-row items-center justify-between",children:[e.jsx(Xe,{className:"text-base",children:"Manual Flubber Review"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:h,disabled:n,children:[e.jsx(Da,{className:"w-4 h-4 mr-1"}),"Prepare"]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:v,disabled:n,children:[e.jsx(wa,{className:"w-4 h-4 mr-1"}),"Reload"]}),e.jsx(A,{variant:"ghost",size:"sm",onClick:r,children:"Close"})]})]}),e.jsxs(Ae,{className:"space-y-4",children:[n&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(St,{className:"w-4 h-4 animate-spin"})," Loading contexts..."]}),l&&e.jsx("div",{className:"text-sm text-red-600",children:l}),!n&&!l&&N.length===0&&e.jsx("div",{className:"text-xs text-gray-500",children:"No flubber contexts found."}),!n&&N.length>0&&e.jsx("div",{className:"space-y-3",children:N.map(y=>e.jsxs("div",{className:"border rounded p-2 flex flex-col gap-2 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs font-mono",children:["t=",y.flubber_time_s.toFixed(2),"s window [",y.snippet_start_s.toFixed(1)," – ",y.snippet_end_s.toFixed(1),"]"]}),e.jsxs("label",{className:"flex items-center gap-1 text-xs cursor-pointer",children:[e.jsx(Qr,{checked:!!u[y.flubber_index],onCheckedChange:()=>_(y.flubber_index)})," Cut"]})]}),e.jsx("audio",{controls:!0,className:"w-full",src:y.url,preload:"metadata"}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Relative flubber @ ",y.relative_flubber_ms,"ms inside snippet"]})]},y.flubber_index))}),N.length>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(A,{onClick:k,disabled:c,className:"flex items-center gap-1",children:[c?e.jsx(St,{className:"w-4 h-4 animate-spin"}):e.jsx(Da,{className:"w-4 h-4"}),c?"Applying...":"Apply Selected Cuts"]}),I&&e.jsxs("div",{className:"text-xs text-green-600",children:["Removed ",(I.removed_ms/1e3).toFixed(2),"s → ",I.cleaned_audio_new]})]})]})]})}const Ko=({audioUrl:t,initialCuts:a=[],onCutsChange:r,height:n=120,zoomWindows:o=[15,30,60,120],onDuration:l},d)=>{const N=s.useRef(null),i=s.useRef(null),u=s.useRef(null),[j,c]=s.useState(!1),[m,I]=s.useState(null),[x,v]=s.useState(60),[_,k]=s.useState(null),[h,y]=s.useState(0),[p,C]=s.useState("0:00");s.useEffect(()=>{if(!N.current||!t)return;const O=gi.create(),z=ao.create({height:18,style:{color:"#6b7280",fontSize:"10px"},formatTimeCallback:V=>{if(!isFinite(V))return"0:00";const je=Math.max(0,Math.floor(V)),_e=Math.floor(je/60),T=je%60;return`${_e}:${String(T).padStart(2,"0")}`}}),P=fi.create({container:N.current,url:t,height:n,waveColor:"#68a0ff",progressColor:"#1e40af",cursorColor:"#111827",normalize:!0,plugins:[O,z]});i.current=P,u.current=O;const E=()=>{c(!0);const V=Math.round(P.getDuration()*1e3);I(V);try{l?.(V)}catch{}if(Array.isArray(a))for(const je of a){const _e=Math.max(0,(je.start_ms||0)/1e3),T=Math.max(_e+.02,(je.end_ms||0)/1e3);O.addRegion({start:_e,end:T,color:"rgba(239,68,68,0.25)"})}U(x)},ne=V=>{console.warn("WaveSurfer error",V)},ee=V=>{k(V?.id||null),b()},he=V=>{k(V?.id||null),b()},D=()=>{k(null),b()},H=V=>{k(V?.id||null)},ge=V=>{y(V),C(Z(V))};return P.on("ready",E),P.on("error",ne),P.on("timeupdate",ge),O.on("region-updated",ee),O.on("region-created",he),O.on("region-removed",D),O.on("region-clicked",H),()=>{try{O.unAll()}catch{}try{P.destroy()}catch{}i.current=null,u.current=null,c(!1)}},[t]);const M=()=>{const O=u.current;return O?typeof O.getRegions=="function"?O.getRegions():Object.values(O.list||{}):[]},b=()=>{if(!u.current)return;const z=M().map(P=>({start_ms:Math.round(P.start*1e3),end_ms:Math.round(P.end*1e3)})).filter(P=>P.end_ms>P.start_ms+20).sort((P,E)=>P.start_ms-E.start_ms);r?.(z)};s.useImperativeHandle(d,()=>({getCuts:()=>M().map(z=>({start_ms:Math.round(z.start*1e3),end_ms:Math.round(z.end*1e3)})).filter(z=>z.end_ms>z.start_ms+20).sort((z,P)=>z.start_ms-P.start_ms)}),[]),s.useEffect(()=>{const O=P=>{if(P.key!=="Delete")return;const E=u.current;if(!E)return;const ne=Object.keys(E.list||{}),ee=ne[ne.length-1];ee&&(E.removeRegion(ee),b())},z=N.current;if(z)return z.tabIndex=0,z.addEventListener("keydown",O),()=>{try{z.removeEventListener("keydown",O)}catch{}}},[]);const g=()=>{const O=i.current,z=u.current;if(!O||!z)return;const P=O.getCurrentTime(),E=O.getDuration(),ne=P,ee=Math.min(E,P+2);z.addRegion({start:ne,end:ee,color:"rgba(239,68,68,0.25)"})},U=O=>{const z=i.current;if(z){v(O);try{const P=N.current?.clientWidth||800,E=Math.max(20,Math.round(P/O));z.zoom(E)}catch{}}},se=()=>{if(u.current){try{const z=M();for(const P of z)try{P.remove()}catch{}}catch{}b()}},Z=O=>{if(!isFinite(O))return"0:00:00";const z=Math.max(0,Math.floor(O)),P=Math.floor(z/3600),E=z%3600,ne=Math.floor(E/60),ee=E%60;return`${P}:${String(ne).padStart(2,"0")}:${String(ee).padStart(2,"0")}`},F=O=>{if(!O)return 0;const z=String(O).trim();if(/^\d+(?:\.\d+)?$/.test(z))return parseFloat(z);let P=/^(\d+):(\d{2}):(\d{2})(?:\.(\d{1,3}))?$/.exec(z);if(P){const E=parseInt(P[1],10),ne=parseInt(P[2],10),ee=parseInt(P[3],10),he=P[4]?parseInt(P[4].padEnd(3,"0"),10):0;return E*3600+ne*60+ee+he/1e3}if(P=/^(\d+):(\d{2})(?:\.(\d{1,3}))?$/.exec(z),P){const E=parseInt(P[1],10),ne=parseInt(P[2],10),ee=P[3]?parseInt(P[3].padEnd(3,"0"),10):0;return E*60+ne+ee/1e3}return 0},re=()=>{const O=i.current;if(!O)return;const z=F(p),P=Math.max(0,Math.min(O.getDuration()||0,z));try{O.setTime(P)}catch{}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>i.current?.playPause(),children:i.current?.isPlaying()?"Pause":"Play"}),e.jsx("button",{className:"text-xs px-2 py-1 border rounded",onClick:g,children:"+ Cut Selection"}),e.jsx("button",{className:"text-xs px-2 py-1 border rounded",onClick:se,children:"Clear all cuts"}),e.jsx("div",{className:"ml-2 text-xs text-gray-600",children:"Zoom:"}),o.map(O=>e.jsxs("button",{className:`text-xs px-2 py-1 border rounded ${x===O?"bg-gray-800 text-white":""}`,onClick:()=>U(O),children:[O,"s"]},O)),e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-xs text-gray-700",children:[e.jsx("span",{children:"Time:"}),e.jsx("input",{className:"w-20 border rounded px-1 py-[2px] text-xs",value:p,onChange:O=>C(O.target.value),onBlur:re,onKeyDown:O=>{O.key==="Enter"&&(O.preventDefault(),re())},title:"hh:mm:ss, mm:ss, or seconds"}),e.jsx("span",{className:"ml-2 text-gray-500",children:j?m?`${Math.round(m/1e3)}s`:"":"Loading…"})]})]}),e.jsx("div",{ref:N,className:"w-full select-none"}),e.jsx("div",{className:"text-[11px] text-gray-500",children:"Tip: Drag edges to adjust a region. Click to select, Delete key to remove."})]})},Jo=s.forwardRef(Ko);function Qo({episodeId:t,token:a,onClose:r}){const[n,o]=s.useState(!0),[l,d]=s.useState(""),[N,i]=s.useState(null),[u,j]=s.useState([]),[c,m]=s.useState(null),[I,x]=s.useState(!1),[v,_]=s.useState(""),k=s.useRef(null);s.useEffect(()=>{let b=!0;return(async()=>{try{const U=await G(a).get(`/api/episodes/${t}/edit-context`);if(!b)return;i(U?.duration_ms??null),j(Array.isArray(U?.existing_cuts)?U.existing_cuts:[]),_(U?.audio_url||"")}catch(g){const U=is(g)?g.detail||g.error||g.message:String(g);d(U||"Failed to load edit context")}finally{o(!1)}})(),()=>{b=!1}},[t,a]);const h=b=>{if(b==null||b==="")return 0;const g=String(b).trim();if(/^\d+(?:\.\d+)?$/.test(g))return Math.round(parseFloat(g)*1e3);const U=/^(\d+):(\d{1,2})(?:\.(\d{1,3}))?$/.exec(g);if(!U)return parseInt(g,10)||0;const se=parseInt(U[1],10),Z=parseInt(U[2],10),F=U[3]?parseInt(U[3].padEnd(3,"0"),10):0;return se*6e4+Z*1e3+F},y=b=>{if(!isFinite(b)||b==null)return"";const g=Math.max(0,b/1e3),U=Math.floor(g/60),se=Math.floor(g%60),Z=Math.floor((g-Math.floor(g))*100);return`${U}:${String(se).padStart(2,"0")}.${String(Z).padStart(2,"0")}`},p=(b,g,U)=>j(se=>se.map((Z,F)=>F===b?{...Z,[g]:g==="start_ms"||g==="end_ms"?h(U):U}:Z)),C=b=>j(g=>g.filter((U,se)=>se!==b)),M=async()=>{x(!0),d("");try{const b=G(a),g=k.current?.getCuts?k.current.getCuts():u,U=await b.post(`/api/episodes/${t}/manual-edit/commit`,{cuts:g});U&&typeof U.duration_ms=="number"&&i(U.duration_ms),r?.(),U&&U.status==="done"?alert("Edits applied. A new final file has been saved."):alert("Edit job queued. The final file will update shortly.")}catch(b){const g=is(b)?b.detail||b.error||b.message:String(b);d(g||"Commit failed")}finally{x(!1)}};return n?e.jsx("div",{className:"p-4 text-sm",children:"Loading editor…"}):e.jsxs("div",{className:"p-4 space-y-3",children:[l&&e.jsx("div",{className:"text-xs text-red-600",children:typeof l=="string"?l:l.message||"Error"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Duration: ",N!=null?(()=>{const b=Math.floor(N/1e3),g=Math.floor(b/3600),U=Math.floor(b%3600/60),se=b%60;return`${g}:${String(U).padStart(2,"0")}:${String(se).padStart(2,"0")}`})():"—"]}),!!v&&e.jsx("div",{className:"border rounded p-2",children:e.jsx(Jo,{ref:k,audioUrl:v,initialCuts:u,onCutsChange:j,height:140,zoomWindows:[15,30,60,120],onDuration:b=>i(b)})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"text-sm font-medium",children:"Cuts"})}),e.jsx("div",{className:"space-y-2",children:u.map((b,g)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsxs("label",{className:"col-span-3 text-xs text-gray-500",children:["Start (mm:ss.ss)",e.jsx("input",{type:"text",className:"mt-1 w-full border rounded px-2 py-1 text-sm",value:y(b.start_ms),onChange:U=>p(g,"start_ms",U.target.value)})]}),e.jsxs("label",{className:"col-span-3 text-xs text-gray-500",children:["End (mm:ss.ss)",e.jsx("input",{type:"text",className:"mt-1 w-full border rounded px-2 py-1 text-sm",value:y(b.end_ms),onChange:U=>p(g,"end_ms",U.target.value)})]}),e.jsxs("div",{className:"col-span-3 text-xs text-gray-500",children:["Length: ",y(Math.max(0,b.end_ms-b.start_ms||0))]}),e.jsx("div",{className:"col-span-3 text-right",children:e.jsx("button",{onClick:()=>C(g),className:"text-xs px-2 py-1 rounded border",children:"Clear this Cut"})})]},g))})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:async()=>{const b=k.current?.getCuts?k.current.getCuts():u,U=(Array.isArray(b)?b.length:0)===1?"this section":"these sections";window.confirm(`Are you sure you want to cut ${U}? This action cannot be undone.`)&&await M()},disabled:I,className:"px-3 py-1 rounded bg-blue-600 text-white text-sm disabled:opacity-50",children:I?"Saving…":"Commit"})})]})}function Xo({episodeId:t,token:a,onClose:r}){return s.useEffect(()=>{const n=o=>{o.key==="Escape"&&r?.()};return document.addEventListener("keydown",n),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",n),document.body.style.overflow=""}},[r]),e.jsxs("div",{className:"fixed inset-0 z-[1000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:r}),e.jsxs("div",{className:"absolute inset-4 bg-white rounded shadow-xl flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:"Manual Editor"}),e.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:r,children:"Close"})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(Qo,{episodeId:t,token:a,onClose:r})})]})]})}const Zs=t=>String(t||"").toLowerCase(),Zo=t=>!t||/[zZ]|[+\-]\d{2}:?\d{2}$/.test(t)?t:/\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(t)?t.replace(" ","T")+"Z":/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/.test(t)?t+"Z":t,Fs=t=>{if(!t)return null;const a=new Date(Zo(t));return isNaN(a.getTime())?null:a},fa=t=>Fs(t.publish_at)||Fs(t.processed_at)||Fs(t.created_at)||new Date(0),mn=t=>{const a=Fs(t);return a?Date.now()-a.getTime()<24*3600*1e3:!1},Ar=t=>{if(!t)return"";try{const a=Fs(t);if(!a)return t;const r=a.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),n=a.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"}),o=Date.now(),l=Math.round((a.getTime()-o)/6e4);let d="";if(Math.abs(l)<1440*7){if(l>0)d=l<60?`in ${l}m`:l<1440?`in ${Math.round(l/60)}h`:`in ${Math.round(l/60/24)}d`;else if(l<0){const N=Math.abs(l);d=N<60?`${N}m ago`:N<1440?`${Math.round(N/60)}h ago`:`${Math.round(N/60/24)}d ago`}}return`${r} ${n}${d?" - "+d:""}`}catch{return t}};function Ai({token:t,onBack:a}){const[r,n]=s.useState([]),[o,l]=s.useState(!1),[d,N]=s.useState(""),[i,u]=s.useState("grid"),[j,c]=s.useState(""),[m,I]=s.useState("all"),[x,v]=s.useState("newest"),[_,k]=s.useState(null),[h,y]=s.useState({title:"",description:"",publish_state:"",tags:"",is_explicit:!1,image_crop:"",cover_file:null,cover_uploading:!1,season_number:null,episode_number:null}),[p,C]=s.useState(!1),[M,b]=s.useState(!1),[g,U]=s.useState(!1),[se,Z]=s.useState(new Set),[F,re]=s.useState(null),[O,z]=s.useState(!1),[P,E]=s.useState(""),[ne,ee]=s.useState(!1),he=w=>{k(w),y({title:w.title||"",description:w.description||"",publish_state:"",tags:(w.tags||[]).join(", "),is_explicit:!!w.is_explicit,image_crop:w.image_crop||"",cover_file:null,cover_uploading:!1,season_number:w.season_number??null,episode_number:w.episode_number??null}),b(!1)},D=()=>{p||k(null)},H=()=>_&&(h.title!==(_.title||"")||h.description!==(_.description||"")||h.publish_state&&h.publish_state.trim()!==""||h.tags!==(Array.isArray(_.tags)?_.tags.join(", "):"")||h.is_explicit!==!!_.is_explicit||h.image_crop!==(_.image_crop||"")||!!h.cover_file||h.season_number!==(_.season_number??null)||h.episode_number!==(_.episode_number??null)),ge=s.useRef(null),[V,je]=s.useState(null),[_e,T]=s.useState(""),[K,le]=s.useState(""),[me,te]=s.useState(!1),[Ne,Be]=s.useState(""),[ke,De]=s.useState(null),[B,xe]=s.useState(null),[ie,W]=s.useState(null),[Pe,Ue]=s.useState(""),[$e,Fe]=s.useState(null),[Ge,ct]=s.useState(""),et=async w=>{if(w){Ue(""),W(w.id);try{await G(t).post(`/api/episodes/${w.id}/retry`,{}),n(S=>S.map($=>$.id===w.id?{...$,status:"processing"}:$)),setTimeout(Y,1200)}catch(q){const S=is(q)?q.detail||q.error||q.message:String(q);Ue(S||"Retry failed")}finally{W(null)}}},dt=async w=>{if(w){n(q=>q.map(S=>S.id===w?{...S,_publishing:!0}:S));try{const q=G(t);await q.post(`/api/episodes/${w}/publish`,{publish_state:"public"}),n(J=>J.map(Se=>Se.id===w?{...Se,_publishing:!1}:Se));const S=Date.now(),$=async()=>{try{const J=await q.get(`/api/episodes/${w}/publish/status`);if(J&&(J.status==="published"||J.spreaker_episode_id||J.last_error)){await Y(),J.last_error&&alert(J.last_error);return}}catch{}if(Date.now()-S<4e3)setTimeout($,600);else try{await Y()}catch{}};setTimeout($,600)}catch(q){const S=is(q)?q.detail||q.error||q.message:String(q);alert(S||"Failed to publish"),n($=>$.map(J=>J.id===w?{...J,_publishing:!1}:J))}}},jt=w=>{je(w),te(!1),Be("");const q=new Date(Date.now()+60*6e4),S=q.getFullYear(),$=String(q.getMonth()+1).padStart(2,"0"),J=String(q.getDate()).padStart(2,"0"),Se=q.getMinutes(),We=Math.ceil(Se/5)*5;We>=60&&(q.setHours(q.getHours()+1),q.setMinutes(0));const Ve=String(q.getHours()).padStart(2,"0"),lt=String(We>=60?0:We).padStart(2,"0");T(`${S}-${$}-${J}`),le(`${Ve}:${lt}`)},xt=async w=>{if(w){ct(""),Fe(w.id);try{await G(t).post(`/api/episodes/${w.id}/republish`,{}),n(S=>S.map($=>$.id===w.id?{...$,_republishing:!0}:$)),setTimeout(Y,1500)}catch(q){const S=is(q)?q.detail||q.error||q.message:String(q);ct(S||"Republish failed")}finally{Fe(null)}}},R=s.useCallback(w=>{try{const q=new Set;for(const S of w||[])if(S&&S.season_number!=null&&S.episode_number!=null){const $=`${S.podcast_id||"pod"}:${S.season_number}:${S.episode_number}`;if(q.has($)){U(!0);return}q.add($)}U(!1)}catch{U(!1)}},[]),ye=()=>{me||je(null)},ae=async()=>{if(V){te(!0),Be("");try{if(!_e||!K)throw new Error("Date & time required");const w=new Date(`${_e}T${K}:00`);if(isNaN(w.getTime()))throw new Error("Invalid date/time");if(w.getTime()<=Date.now()+60*1e3)throw new Error("Choose a time at least 1 minute in the future");let q=w.toISOString();q=q.replace(/\.\d{3}Z$/,"Z"),n($=>$.map(J=>J.id===V.id?{...J,_scheduling:!0}:J)),await G(t).post(`/api/episodes/${V.id}/publish`,{publish_state:"public",publish_at:q,publish_at_local:`${_e} ${K}`}),n($=>$.map(J=>J.id===V.id?{...J,status:"scheduled",publish_at:q,publish_at_local:`${_e} ${K}`,_scheduling:!1}:J)),je(null)}catch(w){const q=is(w)?w.detail||w.error||w.message:String(w);Be(q||"Failed to schedule"),n(S=>S.map($=>$.id===V.id?{...$,_scheduling:!1}:$))}finally{te(!1)}}},f=async()=>{if(!_)return;if(!H()){D();return}C(!0);const w={};try{const q=_.season_number??null,S=_.episode_number??null,$=h.season_number??null,J=h.episode_number??null,Se=$!==q,We=J!=null&&S!=null&&J>S;h.title!==(_.title||"")&&(w.title=h.title.trim()),h.description!==(_.description||"")&&(w.description=h.description),h.publish_state&&(w.publish_state=h.publish_state);const Ve=h.tags.split(",").map(ut=>ut.trim()).filter(Boolean);Ve.join("")!==(Array.isArray(_.tags)?_.tags.join(""):"")&&(w.tags=Ve),h.is_explicit!==!!_.is_explicit&&(w.is_explicit=h.is_explicit),h.image_crop!==(_.image_crop||"")&&(w.image_crop=h.image_crop),h.season_number!==(_.season_number??null)&&(w.season_number=h.season_number),h.episode_number!==(_.episode_number??null)&&(w.episode_number=h.episode_number);let lt=null;if(h.cover_file){y(ut=>({...ut,cover_uploading:!0}));try{const ut=new FormData;let mt=h.cover_file;if(ge.current)try{const Ee=await ge.current.getProcessedBlob();Ee&&(mt=new File([Ee],h.cover_file.name.replace(/\.[^.]+$/,"")+"-square.jpg",{type:"image/jpeg"})),ge.current.getMode&&ge.current.getMode()==="pad"&&w.image_crop&&delete w.image_crop}catch{}ut.append("file",mt);const we=G(t);try{const Ee=await we.raw("/api/media/upload/cover_art",{method:"POST",body:ut});lt=Ee?.filename||Ee?.path||Ee?.stored_as||null}catch(Ee){console.warn("Cover upload failed",Ee)}}catch(ut){console.warn("Cover upload error",ut)}y(ut=>({...ut,cover_uploading:!1}))}lt&&(w.cover_image_path=lt);const Ct=G(t);if($!=null&&J!=null){const ut=r.find(mt=>mt.id!==_.id&&(mt.season_number??null)===$&&(mt.episode_number??null)===J&&mt.podcast_id===_.podcast_id);if(ut&&window.confirm(`Episode number E${J} is already used in season S${$} by "${ut.title||"Untitled"}". Swap numbers (that one becomes E${S||"—"})?`))try{await Ct.patch(`/api/episodes/${ut.id}`,{episode_number:S})}catch{}}const Et=await Ct.patch(`/api/episodes/${_.id}`,w);if(n(ut=>ut.map(mt=>mt.id===_.id?{...mt,...Et?.episode||{},...Et?.episode?{}:{title:w.title??mt.title,description:w.description??mt.description,tags:w.tags??mt.tags,is_explicit:w.is_explicit??mt.is_explicit,image_crop:w.image_crop??mt.image_crop,cover_path:lt||mt.cover_path,season_number:w.season_number??mt.season_number,episode_number:w.episode_number??mt.episode_number}}:mt)),(Se||We)&&r&&r.length){const ut=[...r].sort((Ee,Me)=>fa(Ee)-fa(Me)),mt=ut.findIndex(Ee=>Ee.id===_.id),we=mt>=0?ut.slice(mt+1):[];if(Se&&we.length>0&&window.confirm(`Also change the season to ${$??"—"} for ${we.length} episode(s) after this one?`))for(const Me of we)try{await Ct.patch(`/api/episodes/${Me.id}`,{season_number:$})}catch{}if(We&&we.length>0&&S!=null){const Ee=J-S;if(window.confirm(`Increment the episode number by +${Ee} for ${we.length} episode(s) after this one?`))for(const Ze of we){const tt=(Ze.episode_number??0)+Ee;try{await Ct.patch(`/api/episodes/${Ze.id}`,{episode_number:tt})}catch{}}}}D();try{await Y()}catch{}}catch(q){const S=is(q)?q.detail||q.error||q.message:String(q);alert(S||"Failed to save changes")}finally{C(!1)}},Y=s.useCallback(async()=>{l(!0),N("");const w=new AbortController;try{let q=[];const S=G(t),$=await S.get("/api/episodes/?limit=500",{signal:w.signal});q=Array.isArray($?.items)?$.items:[];const J=$?.total??q.length;for(let Se=q.length;Se<J;Se+=500){let We;try{We=await S.get(`/api/episodes/?limit=500&offset=${Se}`,{signal:w.signal})}catch{break}const Ve=Array.isArray(We?.items)?We.items:[];if(!Ve.length||(q=q.concat(Ve),Ve.length<500))break}try{const Se=await S.get("/api/spreaker/analytics/plays/episodes?window=last30d",{signal:w.signal});if(Array.isArray(Se?.items)&&Se.items.length){const We=new Map(Se.items.map(Ve=>[String(Ve.episode_id),Ve.plays_total]));q=q.map(Ve=>({...Ve,plays_total:We.has(String(Ve.id))?We.get(String(Ve.id)):Ve.plays_total}))}}catch{}n(q),R(q)}catch(q){if(q.name!=="AbortError"){const S=is(q)?q.detail||q.error||q.message:String(q);N(S||"Failed to load episodes.")}}finally{l(!1)}return()=>w.abort()},[t,R]);s.useEffect(()=>{Y()},[Y]),s.useEffect(()=>{if(!_){b(!1);return}const w=h.season_number??null,q=h.episode_number??null;if(w==null||q==null){b(!1);return}const S=r.some($=>$.id!==_.id&&($.season_number??null)===w&&($.episode_number??null)===q&&$.podcast_id===_.podcast_id);b(S)},[_,h.season_number,h.episode_number,r]);const Q=w=>{re(w),z(!1),E(""),ee(!1)},ue=async(w=!1)=>{if(F){z(!0),E("");try{await G(t).post(`/api/episodes/${F.id}/unpublish`,{force:w}),n(S=>S.map($=>$.id===F.id?{...$,status:"processed",publish_at:null,spreaker_episode_id:null}:$)),re(null),setTimeout(Y,800)}catch(q){q&&typeof q=="object"&&q.status===409&&ee(!0);const S=is(q)?q.detail||q.error||q.message:String(q);E(S||"Failed to unpublish")}finally{z(!1)}}},Ie=async w=>{if(w&&window.confirm(`Delete this episode permanently? This cannot be undone.
Deleting does not return processing minutes.`)){Z(q=>new Set(q).add(w));try{await G(t).del(`/api/episodes/${w}`),n(S=>S.filter($=>$.id!==w))}catch(q){const S=is(q)?q.detail||q.error||q.message:String(q);N(S||"Delete failed")}finally{Z(q=>{const S=new Set(q);return S.delete(w),S})}}},Re=w=>{switch(Zs(w)){case"published":return e.jsxs(pt,{className:"bg-green-600 hover:bg-green-600",children:[e.jsx(va,{className:"w-4 h-4 mr-1"}),"Published"]});case"scheduled":return e.jsxs(pt,{className:"bg-purple-600 hover:bg-purple-600",children:[e.jsx(Dr,{className:"w-4 h-4 mr-1"}),"Scheduled"]});case"processed":return e.jsxs(pt,{className:"bg-blue-600 hover:bg-blue-600",children:[e.jsx(li,{className:"w-4 h-4 mr-1"}),"Processed"]});case"processing":return e.jsxs(pt,{className:"bg-amber-600 hover:bg-amber-600",children:[e.jsx(St,{className:"w-4 h-4 mr-1 animate-spin"}),"Processing"]});case"error":return e.jsxs(pt,{className:"bg-red-600 hover:bg-red-600",children:[e.jsx(ws,{className:"w-4 h-4 mr-1"}),"Error"]});default:return e.jsx(pt,{variant:"outline",children:w||"Unknown"})}},Le=s.useMemo(()=>{let w=[...r];if(j.trim()){const q=j.trim().toLowerCase();w=w.filter(S=>(S.title||"").toLowerCase().includes(q)||(S.description||"").toLowerCase().includes(q))}switch(m!=="all"&&(w=w.filter(q=>String(q.status||"").toLowerCase()===m)),x){case"oldest":w.sort((q,S)=>fa(q)-fa(S));break;case"title":w.sort((q,S)=>(q.title||"").localeCompare(S.title||""));break;case"status":w.sort((q,S)=>(q.status||"").localeCompare(S.status||""));break;case"plays":w.sort((q,S)=>(S.plays_total||0)-(q.plays_total||0));break;case"newest":default:w.sort((q,S)=>fa(S)-fa(q))}return w},[r,j,m,x]),nt=()=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6",children:Le.map(w=>{const q=w.cover_url||`/api/episodes/${w.id}/cover`;let S=w.playback_url||w.stream_url||w.final_audio_url||"";S&&!S.startsWith("http")&&!S.startsWith("/")&&(S=`/${S}`);const $=S&&w.final_audio_exists===!1&&w.playback_type!=="stream",J=Zs(w.status)==="scheduled"||Zs(w.status)==="published"&&mn(w.publish_at);let Se=!1;const We=Zs(w.status);if(We==="error"&&(Se=!0),We==="processing"){const Ve=Fs(w.processed_at)||Fs(w.created_at)||new Date(0),lt=Date.now()-Ve.getTime(),Ct=typeof w.duration_ms=="number"&&w.duration_ms>0?w.duration_ms:900*1e3,Et=Math.round(Ct*1.25);lt>Et&&(Se=!0)}return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ce,{className:"group overflow-hidden border border-gray-200 relative",children:[e.jsxs("div",{className:"w-full h-36 bg-gray-100 flex items-center justify-center relative",children:[e.jsx("img",{src:q,alt:"Cover",className:"w-full h-full object-cover",onError:Ve=>{Ve.currentTarget.style.display="none";const lt=Ve.currentTarget.nextSibling;lt&&(lt.style.display="flex")}}),e.jsxs("div",{className:"hidden w-full h-full items-center justify-center text-gray-400",children:[e.jsx(Fl,{className:"w-8 h-8 mr-2"})," No cover"]}),J&&e.jsxs("button",{className:"absolute top-1 left-1 bg-white/85 hover:bg-white text-amber-700 border border-amber-300 rounded p-1 shadow-sm text-[11px] font-medium opacity-0 group-hover:opacity-100 transition-opacity",title:"Unpublish episode (revert to processed)",onClick:()=>Q(w),children:[e.jsx(sn,{className:"w-3 h-3 inline mr-1"}),"Unpublish"]}),e.jsxs(A,{variant:"destructive",size:"sm",className:"absolute top-2 right-2 flex items-center gap-1 bg-white/90 text-red-600 hover:bg-white shadow-sm opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete episode",onClick:()=>Ie(w.id),disabled:se.has(w.id),children:[se.has(w.id)?e.jsx(St,{className:"w-4 h-4 animate-spin"}):e.jsx($s,{className:"w-4 h-4"}),"Delete"]}),Se&&e.jsxs("button",{className:"absolute bottom-1 left-1 bg-white/90 hover:bg-white text-amber-700 border border-amber-300 rounded px-2 py-1 shadow-sm text-[11px] font-medium flex items-center gap-1",title:"Retry processing",onClick:()=>et(w),disabled:ie===w.id,children:[ie===w.id?e.jsx(St,{className:"w-3 h-3 animate-spin"}):e.jsx(Fr,{className:"w-3 h-3"}),"Retry"]}),w.status==="processed"&&e.jsxs("div",{className:"absolute bottom-1 right-1 flex gap-1 items-center",children:[e.jsx("button",{className:"bg-white/85 hover:bg-white text-purple-700 border border-purple-300 rounded p-1 shadow-sm",title:"Cut for edits",onClick:()=>De(Ve=>Ve===w.id?null:w.id),children:e.jsx(Da,{className:"w-4 h-4"})}),e.jsx("button",{className:"bg-white/85 hover:bg-white text-blue-700 border border-blue-300 rounded p-1 shadow-sm",title:"Open Manual Editor",onClick:()=>xe(Ve=>Ve===w.id?null:w.id),children:e.jsx(ir,{className:"w-4 h-4"})}),w.needs_republish||w.publish_error?e.jsx("button",{className:"bg-amber-600 hover:bg-amber-700 text-white text-[11px] font-medium px-2 py-1 rounded shadow disabled:opacity-60",onClick:()=>xt(w),title:"Retry publishing to Spreaker",disabled:$e===w.id,children:$e===w.id?"Retrying…":"Retry Publish"}):e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white text-[11px] font-medium px-2 py-1 rounded shadow disabled:opacity-60",onClick:()=>dt(w.id),title:"Publish now",children:"Publish"}),e.jsx("button",{className:"bg-purple-600 hover:bg-purple-700 text-white text-[11px] font-medium px-2 py-1 rounded shadow disabled:opacity-60",onClick:()=>jt(w),title:"Schedule future publication",children:"Schedule"})]})]}),e.jsxs(Je,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx(Xe,{className:"text-base font-semibold leading-tight line-clamp-2",title:w.title,children:w.season_number!=null&&w.episode_number!=null?`S${w.season_number}E${w.episode_number} · ${w.title||"Untitled Episode"}`:w.title||"Untitled Episode"}),e.jsxs(A,{variant:"secondary",size:"sm",className:"flex items-center gap-1",onClick:()=>he(w),children:[e.jsx(ir,{className:"w-4 h-4"}),"Edit"]}),typeof w.plays_total=="number"&&e.jsxs(pt,{variant:"secondary",className:"text-[11px] font-medium",children:[w.plays_total," plays"]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[Re(w.status),w.cleanup_stats&&e.jsxs("span",{className:"text-[10px] text-gray-500",children:["FW:",w.cleanup_stats.fillers_removed," PC:",w.cleanup_stats.pauses_compressed]}),w.publish_at&&e.jsxs("span",{className:"text-[11px] text-gray-500 flex items-center gap-1",title:w.publish_at,children:[e.jsx(Dr,{className:"w-3 h-3"})," ",w.status==="scheduled"?"Publishes":"Publish",": ",Ar(w.publish_at)]}),w.playback_type==="local"&&e.jsx("span",{className:"text-[10px] text-gray-500",children:"Local file"})]})]}),e.jsxs(Ae,{className:"space-y-2 pt-0",children:[w.description&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-3",children:w.description}),S?e.jsx("audio",{controls:!0,src:S,className:"w-full",preload:"none"}):e.jsxs("div",{className:"text-gray-500 text-xs flex items-center",children:[e.jsx(Xt,{className:"w-3 h-3 mr-1"}),"No audio"]}),$&&e.jsx("div",{className:"text-[10px] text-red-600",children:"File missing on server"}),w.has_transcript&&w.transcript_url&&e.jsxs("a",{href:w.transcript_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs text-blue-600 hover:text-blue-700 underline",children:[e.jsx(sa,{className:"w-3 h-3"}),"View transcript"]})]})]}),B===w.id&&e.jsx(Xo,{episodeId:w.id,token:t,onClose:()=>xe(null)}),ke===w.id&&e.jsx(Go,{episodeId:w.id,token:t,onClose:()=>De(null)})]},w.id)})}),He=()=>e.jsxs("div",{className:"border border-gray-200 rounded-md overflow-hidden divide-y",children:[e.jsxs("div",{className:"grid grid-cols-12 bg-gray-50 text-[11px] uppercase tracking-wide text-gray-500 px-3 py-2 font-medium",children:[e.jsx("div",{className:"col-span-5",children:"Episode"}),e.jsx("div",{className:"col-span-2",children:"Status"}),e.jsx("div",{className:"col-span-2",children:"Publish"}),e.jsx("div",{className:"col-span-2",children:"Plays"}),e.jsx("div",{className:"col-span-1 text-right",children:"Actions"})]}),Le.map(w=>{let q=w.playback_url||w.stream_url||w.final_audio_url||"";q&&!q.startsWith("http")&&!q.startsWith("/")&&(q=`/${q}`);const S=Zs(w.status)==="scheduled"||Zs(w.status)==="published"&&mn(w.publish_at);let $=!1;{const J=Zs(w.status);if(J==="error"&&($=!0),J==="processing"){const Se=Fs(w.processed_at)||Fs(w.created_at)||new Date(0),We=Date.now()-Se.getTime(),Ve=typeof w.duration_ms=="number"&&w.duration_ms>0?w.duration_ms:900*1e3,lt=Math.round(Ve*1.25);We>lt&&($=!0)}}return e.jsxs("div",{className:"group grid grid-cols-12 items-start px-3 py-3 gap-2 text-sm hover:bg-gray-50",children:[e.jsxs("div",{className:"col-span-5 flex flex-col",children:[e.jsx("span",{className:"font-medium truncate",title:w.title,children:w.season_number!=null&&w.episode_number!=null?`S${w.season_number}E${w.episode_number} · ${w.title||"Untitled Episode"}`:w.title||"Untitled Episode"}),w.description&&e.jsx("span",{className:"text-[11px] text-gray-500 line-clamp-1",title:w.description,children:w.description}),w.has_transcript&&w.transcript_url&&e.jsx("a",{href:w.transcript_url,target:"_blank",rel:"noopener noreferrer",className:"text-[11px] text-blue-600 hover:text-blue-700 underline mt-1",children:"Transcript"})]}),e.jsx("div",{className:"col-span-2 flex items-center flex-wrap gap-1",children:Re(w.status)}),e.jsx("div",{className:"col-span-2 text-[11px] text-gray-600",children:w.publish_at?Ar(w.publish_at,w.publish_at_local):"-"}),e.jsx("div",{className:"col-span-2 text-[11px]",children:typeof w.plays_total=="number"?w.plays_total:"-"}),e.jsxs("div",{className:"col-span-1 flex justify-end",children:[S&&e.jsx("button",{className:"mr-2 text-amber-600 hover:text-amber-700 text-xs underline opacity-0 group-hover:opacity-100 transition-opacity",title:"Unpublish episode (revert to processed)",onClick:()=>Q(w),children:"Unpublish"}),$&&e.jsx("button",{className:"mr-2 text-amber-700 hover:text-amber-800 text-xs underline",title:"Retry processing",onClick:()=>et(w),disabled:ie===w.id,children:ie===w.id?"Retrying…":"Retry"}),e.jsxs(A,{variant:"destructive",size:"sm",className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete episode",onClick:()=>Ie(w.id),disabled:se.has(w.id),children:[se.has(w.id)?e.jsx(St,{className:"w-4 h-4 animate-spin"}):e.jsx($s,{className:"w-4 h-4"}),"Delete"]}),e.jsxs(A,{variant:"outline",size:"sm",className:"ml-2 flex items-center gap-1",onClick:()=>he(w),children:[e.jsx(ir,{className:"w-4 h-4"}),"Edit"]}),e.jsx("button",{className:"ml-2 text-purple-600 hover:text-purple-700 text-xs underline",title:"Cut for edits",onClick:()=>De(J=>J===w.id?null:w.id),children:"Cut for edits"}),w.status==="processed"&&(w.needs_republish||w.publish_error)?e.jsx("button",{className:"ml-2 text-amber-700 hover:text-amber-800 text-xs underline",onClick:()=>xt(w),disabled:$e===w.id,children:$e===w.id?"Retrying…":"Retry Publish"}):w.status==="processed"&&e.jsx("button",{className:"ml-2 text-green-600 hover:text-green-700 text-xs underline",onClick:()=>dt(w.id),children:"Publish"}),w.status==="processed"&&e.jsx("button",{className:"ml-1 text-purple-600 hover:text-purple-700 text-xs underline",onClick:()=>jt(w),children:"Schedule"})]}),q&&e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("audio",{controls:!0,src:q,className:"w-full",preload:"none"})})]},w.id)}),Le.length===0&&e.jsx("div",{className:"px-3 py-6 text-center text-sm text-gray-500",children:"No matching episodes."})]}),it=()=>e.jsx("div",{className:"rounded-lg",children:e.jsx(Ho,{episodes:Le,onEdit:w=>he(w),onDelete:w=>Ie(w.id),formatPublishAt:Ar})});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a&&e.jsxs(A,{onClick:a,variant:"ghost",className:"text-gray-700 hover:bg-gray-100",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsx("h2",{className:"text-2xl font-bold",children:"Episode History"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(A,{onClick:Y,variant:"outline",size:"sm",className:"h-8",children:[e.jsx(wa,{className:"w-4 h-4 mr-1"}),"Refresh"]}),e.jsxs("div",{className:"flex items-center border rounded px-2 h-8 bg-white",children:[e.jsx(ii,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search...",className:"ml-2 outline-none text-sm placeholder:text-gray-400 bg-transparent",value:j,onChange:w=>c(w.target.value)})]}),e.jsxs("select",{className:"h-8 border rounded text-sm px-2 bg-white",value:m,onChange:w=>I(w.target.value),children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"published",children:"Published"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"processed",children:"Processed"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"error",children:"Error"})]}),e.jsxs("select",{className:"h-8 border rounded text-sm px-2 bg-white",value:x,onChange:w=>v(w.target.value),children:[e.jsx("option",{value:"newest",children:"Newest"}),e.jsx("option",{value:"oldest",children:"Oldest"}),e.jsx("option",{value:"title",children:"Title"}),e.jsx("option",{value:"status",children:"Status"}),e.jsx("option",{value:"plays",children:"Plays"})]}),e.jsxs("div",{className:"flex border rounded overflow-hidden",children:[e.jsx("button",{className:`px-2 h-8 text-sm flex items-center gap-1 ${i==="grid"?"bg-gray-200 font-medium":"bg-white hover:bg-gray-50"}`,onClick:()=>u("grid"),title:"Grid view",children:e.jsx(Ml,{className:"w-4 h-4"})}),e.jsx("button",{className:`px-2 h-8 text-sm flex items-center gap-1 border-l ${i==="mosaic"?"bg-gray-200 font-medium":"bg-white hover:bg-gray-50"}`,onClick:()=>u("mosaic"),title:"Mosaic view",children:e.jsx(Rl,{className:"w-4 h-4"})}),e.jsx("button",{className:`px-2 h-8 text-sm flex items-center gap-1 border-l ${i==="list"?"bg-gray-200 font-medium":"bg-white hover:bg-gray-50"}`,onClick:()=>u("list"),title:"List view",children:e.jsx(Dl,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:[r.length," total"]}),j&&e.jsxs("span",{children:["• ",Le.length," match"]}),g&&e.jsx("span",{className:"text-red-600",children:"• Warning: duplicate Season/Episode combinations exist. Edit to resolve."})]})]}),o&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(St,{className:"w-5 h-5 mr-2 animate-spin"}),"Loading..."]}),d&&e.jsx("div",{className:"text-red-600 text-sm",children:d}),Pe&&e.jsx("div",{className:"text-amber-700 text-sm",children:Pe}),!o&&(i==="grid"?nt():i==="mosaic"?it():He()),_&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-end z-50",children:e.jsxs("div",{className:"w-full max-w-md h-full bg-white shadow-xl flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Edit Episode"}),e.jsx("button",{onClick:D,className:"text-gray-500 hover:text-gray-800 text-sm",children:"Close"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Season Number"}),e.jsx("input",{type:"number",min:"0",className:"w-full border rounded px-2 py-1 text-sm",value:h.season_number??"",onChange:w=>y(q=>({...q,season_number:w.target.value===""?null:parseInt(w.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Episode Number"}),e.jsx("input",{type:"number",min:"0",className:"w-full border rounded px-2 py-1 text-sm",value:h.episode_number??"",onChange:w=>y(q=>({...q,episode_number:w.target.value===""?null:parseInt(w.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Title"}),e.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:h.title,onChange:w=>y(q=>({...q,title:w.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Description / Show Notes"}),e.jsx("textarea",{rows:6,className:"w-full border rounded px-2 py-1 text-sm resize-vertical",value:h.description,onChange:w=>y(q=>({...q,description:w.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Visibility"}),e.jsxs("select",{className:"w-full border rounded px-2 py-1 text-sm",value:h.publish_state,onChange:w=>y(q=>({...q,publish_state:w.target.value})),children:[e.jsx("option",{value:"",children:"(no change)"}),e.jsx("option",{value:"public",children:"Public"}),e.jsx("option",{value:"unpublished",children:"Unpublished"}),e.jsx("option",{value:"limited",children:"Limited"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Tags (comma separated)"}),e.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:h.tags,onChange:w=>y(q=>({...q,tags:w.target.value})),placeholder:"tag1, tag2"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"explicitFlag",type:"checkbox",className:"h-4 w-4",checked:h.is_explicit,onChange:w=>y(q=>({...q,is_explicit:w.target.checked}))}),e.jsx("label",{htmlFor:"explicitFlag",className:"text-xs font-medium text-gray-600",children:"Explicit content"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600",children:"Cover Image & Crop"}),e.jsx("input",{type:"file",accept:"image/*",className:"w-full text-xs",onChange:w=>y(q=>({...q,cover_file:w.target.files?.[0]||null}))}),h.cover_uploading&&e.jsx("div",{className:"text-[11px] text-blue-600",children:"Uploading cover..."}),e.jsx(br,{ref:ge,sourceFile:h.cover_file,existingUrl:_?.cover_url||(_?`/api/episodes/${_.id}/cover`:null),value:h.cover_file?h.image_crop:_?.image_crop||"",onChange:w=>y(q=>{if(!q.cover_file)return q;const S=w||"";return q.image_crop===S?q:{...q,image_crop:S}}),disabled:p||!h.cover_file})]}),e.jsx("div",{className:"text-[11px] text-gray-500",children:"Saving updates local DB & pushes supported fields (title, description, visibility, cover when implemented) to Spreaker immediately if already published."})]}),e.jsxs("div",{className:"px-4 py-3 border-t flex items-center justify-end gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:D,disabled:p,children:"Cancel"}),M&&e.jsx("div",{className:"text-[11px] text-red-600 mr-auto",children:"Duplicate season/episode for this podcast"}),e.jsx(A,{size:"sm",onClick:f,disabled:p||!H()||M,children:p?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-4 h-4 mr-1 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})}),F&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded shadow-lg p-5 space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 text-amber-700",children:[e.jsx(sn,{className:"w-5 h-5"}),"Unpublish Episode"]}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[e.jsxs("p",{children:["Revert ",e.jsx("strong",{children:F.title||"Untitled Episode"})," back to processed? It will be removed from the feed and can be republished."]}),e.jsx("p",{className:"text-[11px] text-gray-500",children:"Allowed within 24 hours of original publication. Remote delete attempted."}),P&&e.jsx("div",{className:"text-red-600 text-xs",children:P}),ne&&!O&&e.jsx("div",{className:"text-amber-700 text-[11px]",children:"Outside standard window. You may force unpublish anyway."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(A,{variant:"outline",size:"sm",disabled:O,onClick:()=>re(null),children:"Cancel"}),ne&&e.jsx(A,{variant:"destructive",size:"sm",disabled:O,onClick:()=>ue(!0),children:O?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-4 h-4 mr-1 animate-spin"}),"Forcing..."]}):"Force Unpublish"}),!ne&&e.jsx(A,{size:"sm",disabled:O,onClick:()=>ue(!1),children:O?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-4 h-4 mr-1 animate-spin"}),"Unpublishing..."]}):"Unpublish"})]})]})}),V&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded shadow-lg p-5 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-700",children:"Schedule Publication"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-3",children:[e.jsxs("p",{children:["Pick a local date & time to publish ",e.jsx("strong",{children:V.title||"Untitled Episode"}),". We'll convert it to UTC for the server."]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Date"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:_e,onChange:w=>T(w.target.value)}),e.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Time"}),e.jsx("input",{type:"time",step:300,className:"border rounded px-2 py-1 text-sm",value:K,onChange:w=>le(w.target.value)})]}),e.jsx("p",{className:"text-[11px] text-gray-500",children:"Must be at least 1 minute in the future. Local time is converted to exact UTC ISO for Spreaker."}),Ne&&e.jsx("div",{className:"text-red-600 text-xs",children:Ne})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(A,{variant:"outline",size:"sm",disabled:me,onClick:ye,children:"Cancel"}),e.jsx(A,{size:"sm",disabled:me||!_e||!K,onClick:ae,children:me?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-4 h-4 mr-1 animate-spin"}),"Scheduling..."]}):"Schedule"})]})]})}),!o&&r.length===0&&e.jsx("div",{className:"text-gray-500",children:"No episodes yet."})]})}const ec=[{code:"en",label:"English"},{code:"es",label:"Spanish"},{code:"fr",label:"French"},{code:"de",label:"German"},{code:"it",label:"Italian"},{code:"pt",label:"Portuguese"},{code:"pt-br",label:"Portuguese (Brazil)"},{code:"nl",label:"Dutch"},{code:"sv",label:"Swedish"},{code:"no",label:"Norwegian"},{code:"da",label:"Danish"},{code:"fi",label:"Finnish"},{code:"pl",label:"Polish"},{code:"ru",label:"Russian"},{code:"ja",label:"Japanese"},{code:"zh",label:"Chinese"},{code:"ar",label:"Arabic"}];function tc({isOpen:t,onClose:a,podcast:r,onSave:n,token:o,userEmail:l,userFirstName:d,userLastName:N}){const[i,u]=s.useState({name:"",description:"",cover_path:"",podcast_type:"",language:"",copyright_line:"",owner_name:"",author_name:"",spreaker_show_id:"",contact_email:"",category_id:"",category_2_id:"",category_3_id:""}),[j,c]=s.useState([]),[m,I]=s.useState({loading:!1,error:"",loaded:!1}),[x,v]=s.useState(null),[_,k]=s.useState(!1),[h,y]=s.useState(""),[p,C]=s.useState(!1),[M,b]=s.useState(null),[g,U]=s.useState(""),se=s.useRef(null),[Z,F]=s.useState(null),[re,O]=s.useState("crop"),{toast:z}=Lt(),P=(i.name||"").trim().length<4,E=V=>{if(!V)return"";if(typeof V=="string")return V;const je=T=>typeof T=="string"?T:T&&typeof T=="object"?JSON.stringify(T):T==null?"":String(T),_e=V.detail||V.error||V.message||V.reason||V.msg;return _e?je(_e):typeof V.status=="number"?`Request failed (${V.status})`:je(V)},ne=s.useRef(!1);s.useEffect(()=>{if(!r||m.loaded||ne.current&&t)return;ne.current=!0;const je=(()=>{try{const me=navigator?.language||navigator?.languages?.[0]||"";if(!me)return"";const te=String(me).toLowerCase();if(te.startsWith("pt-br"))return"pt-br";const Ne=te.split("-")[0];return new Set(["en","es","fr","de","it","pt","pt-br","nl","sv","no","da","fi","pl","ru","ja","zh","ar"]).has(Ne)?Ne:"en"}catch{return"en"}})()||"en",_e="episodic",T=r?.owner_name||[d,N].filter(Boolean).join(" "),K=r?.author_name||[d,N].filter(Boolean).join(" "),le=r?.contact_email||l||"";u({name:r.name||"",description:r.description||"",cover_path:r.cover_path||"",podcast_type:r.podcast_type||_e,language:r.language||je,copyright_line:r.copyright_line||"",owner_name:T||"",author_name:K||"",spreaker_show_id:r.spreaker_show_id||"",contact_email:le,category_id:r.category_id?String(r.category_id):"",category_2_id:r.category_2_id?String(r.category_2_id):"",category_3_id:r.category_3_id?String(r.category_3_id):""}),y(r.spreaker_show_id||""),U(ee(r.cover_path))},[r,m.loaded,t,l]),s.useEffect(()=>{async function V(){if(!(!t||!r?.id||!o)){I(je=>({...je,loading:!0,error:""}));try{const T=(await G(o).get(`/api/spreaker/show/${r.id}?mapped=true`)).mapped||{},K=["name","description","language","author_name","owner_name","copyright_line","category_id","category_2_id","category_3_id","contact_email","podcast_type","spreaker_show_id","cover_path"];u(le=>{const me={...le};return K.forEach(te=>{T[te]!==void 0&&T[te]!==null&&(me[te]=String(T[te]))}),me}),v(T),T.cover_path&&U(ee(T.cover_path)),I({loading:!1,error:"",loaded:!0})}catch(je){const _e=E(is(je)&&(je.detail||je.error||je.message)||je),T=je&&typeof je=="object"&&"status"in je?je.status:void 0;I({loading:!1,error:T===404?"":_e||"Failed remote fetch",loaded:!1})}}}V()},[t,r?.id,o]),s.useEffect(()=>{async function V(){try{const _e=await G(o).get("/api/spreaker/categories");c(_e.categories||[])}catch{}}t&&V()},[t,o]);const ee=V=>V?V.startsWith("http")?V:`/static/media/${V.replace(/^\/+/,"").split("/").pop()}`:"",he=V=>{const{id:je,value:_e}=V.target;u(T=>({...T,[je]:_e}))},D=(V,je)=>{u(_e=>({..._e,[V]:je}))},H=V=>{const je=V.target.files?.[0];je&&(b(je),U(URL.createObjectURL(je)),F(null))},ge=async V=>{if(V.preventDefault(),P){z({title:"Name too short",description:"Podcast title must be at least 4 characters.",variant:"destructive"});return}if(h&&i.spreaker_show_id&&i.spreaker_show_id!==h&&!p){z({title:"Confirmation Required",description:"Check the confirmation box to change the Spreaker Show ID.",variant:"destructive"});return}k(!0);try{let je;const _e=G(o);if(M){const T=new FormData;Object.entries(i).forEach(([K,le])=>{le!=null&&le!==""&&T.append(K,le)});try{const K=await se.current?.getProcessedBlob?.();K?T.append("cover_image",new File([K],"cover.jpg",{type:"image/jpeg"})):T.append("cover_image",M)}catch{T.append("cover_image",M)}h&&i.spreaker_show_id!==h&&p&&T.append("allow_spreaker_id_change","true"),je=await _e.raw(`/api/podcasts/${r.id}`,{method:"PUT",body:T})}else{const T={...i};h&&i.spreaker_show_id!==h&&p&&(T.allow_spreaker_id_change=!0),je=await _e.put(`/api/podcasts/${r.id}`,T)}n(je),z({title:"Success",description:"Podcast updated successfully."}),a()}catch(je){const _e=is(je)?je.detail||je.error||je.message:String(je);z({title:"Error",description:_e,variant:"destructive"})}finally{k(!1)}};return e.jsx(na,{open:t,onOpenChange:a,children:e.jsxs(Hs,{className:"sm:max-w-[520px] w-full md:w-[520px]",children:[e.jsxs(Gs,{children:[e.jsx(Ks,{children:"Edit Podcast"}),e.jsx(Ns,{children:"Make changes to your podcast here. Click save when you're done."})]}),e.jsxs("form",{onSubmit:ge,className:"space-y-4",children:[e.jsxs("div",{className:"text-xs -mb-1 flex items-center justify-between",children:[e.jsxs("span",{className:"text-muted-foreground",children:[m.loading&&"Loading Spreaker metadata...",!m.loading&&m.loaded&&"Values loaded from Spreaker",!m.loading&&!m.loaded&&m.error&&"Remote load failed — using local data"]}),e.jsx("button",{type:"button",className:"underline text-blue-600",onClick:async()=>{I({loading:!0,error:"",loaded:!1});try{const _e=(await G(o).get(`/api/spreaker/show/${r.id}?mapped=true`)).mapped||{},T=["name","description","language","author_name","owner_name","copyright_line","category_id","category_2_id","category_3_id","contact_email","podcast_type","spreaker_show_id","cover_path"];u(K=>{const le={...K};return T.forEach(me=>{_e[me]!==void 0&&_e[me]!==null&&(le[me]=String(_e[me]))}),le}),v(_e),_e.cover_path&&U(ee(_e.cover_path)),I({loading:!1,error:"",loaded:!0})}catch(V){const je=E(is(V)&&(V.detail||V.error||V.message)||V),_e=V&&typeof V=="object"&&"status"in V?V.status:void 0;I({loading:!1,error:_e===404?"":je,loaded:!1})}},children:"Refresh"})]}),e.jsxs("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto pr-1",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{htmlFor:"name",children:"Name"}),e.jsx(Ye,{id:"name",value:i.name,onChange:he}),P&&e.jsx("p",{className:"text-[11px] text-amber-700",children:"Minimum 4 characters."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{htmlFor:"spreaker_show_id",children:"Spreaker Show ID"}),e.jsx(Ye,{id:"spreaker_show_id",value:i.spreaker_show_id,onChange:he})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{htmlFor:"description",children:"Description"}),e.jsx(bs,{id:"description",rows:5,value:i.description,onChange:he})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{htmlFor:"podcast_type",children:"Podcast Type"}),e.jsxs(Jt,{value:i.podcast_type,onValueChange:V=>D("podcast_type",V),children:[e.jsx(Wt,{children:e.jsx(Qt,{placeholder:"Select type"})}),e.jsxs(qt,{children:[e.jsx(yt,{value:"episodic",children:"Episodic"}),e.jsx(yt,{value:"serial",children:"Serial"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{htmlFor:"language",children:"Language"}),e.jsxs(Jt,{value:i.language,onValueChange:V=>D("language",V),children:[e.jsx(Wt,{children:e.jsx(Qt,{placeholder:"Select language"})}),e.jsx(qt,{className:"max-h-64 overflow-y-auto",children:ec.map(V=>e.jsx(yt,{value:V.code,children:V.label},V.code))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{htmlFor:"owner_name",children:"Owner Name"}),e.jsx(Ye,{id:"owner_name",value:i.owner_name,onChange:he})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{htmlFor:"author_name",children:"Author Name"}),e.jsx(Ye,{id:"author_name",value:i.author_name,onChange:he})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{htmlFor:"copyright_line",children:"Copyright Line"}),e.jsx(Ye,{id:"copyright_line",value:i.copyright_line,onChange:he})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{htmlFor:"contact_email",children:"Contact Email"}),e.jsx(Ye,{id:"contact_email",type:"email",value:i.contact_email,onChange:he})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{children:"Cover"}),!M&&e.jsxs("div",{className:"flex items-start gap-4",children:[g&&e.jsx("img",{src:g,alt:"cover preview",className:"w-16 h-16 rounded object-cover border"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Ye,{type:"file",accept:"image/*",onChange:H}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Leave blank to keep existing cover."})]})]}),M&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(br,{ref:se,sourceFile:M,existingUrl:null,value:Z,onChange:V=>F(V),onModeChange:V=>O(V)}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"We’ll upload a square image based on your selection."})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{children:"Categories"}),e.jsxs("div",{className:"space-y-1",children:[["category_id","category_2_id","category_3_id"].map((V,je)=>{const _e=i[V]===""?void 0:String(i[V]);return e.jsxs(Jt,{value:_e,onValueChange:T=>{T==="__none__"?D(V,""):D(V,T)},children:[e.jsx(Wt,{children:e.jsx(Qt,{placeholder:je===0?"Primary category":"Optional"})}),e.jsxs(qt,{className:"max-h-60 overflow-y-auto",children:[je>0&&e.jsx(yt,{value:"__none__",children:"(none)"}),j.map(T=>e.jsx(yt,{value:String(T.category_id),children:T.name},T.category_id))]})]},V)}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Primary + up to two optional categories."})]})]}),(r?.rss_url_locked||r?.rss_url)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{children:"RSS Feed"}),e.jsx(Ye,{value:r.rss_url_locked||r.rss_url,readOnly:!0,className:"text-xs"})]}),r?.rss_url_locked&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{children:"RSS (Locked)"}),e.jsx(Ye,{value:r.rss_url_locked,readOnly:!0,className:"text-xs"})]})]}),h&&i.spreaker_show_id!==h&&e.jsxs("div",{className:"col-span-4 -mt-2 mb-2 p-3 border border-amber-300 bg-amber-50 rounded text-xs space-y-2",children:[e.jsx("p",{className:"font-semibold text-amber-800",children:"Changing the Spreaker Show ID can break existing episode links."}),e.jsxs("label",{className:"flex items-start gap-2 text-amber-900",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:V=>C(V.target.checked)}),e.jsx("span",{children:"I understand the risk and want to proceed with changing the Show ID."})]})]}),e.jsxs(ia,{children:[e.jsx(A,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),e.jsxs(A,{type:"submit",disabled:_||P,children:[_?e.jsx(St,{className:"w-4 h-4 animate-spin mr-2"}):"","Save changes"]})]})]})]})})}const sc={},ga=({children:t})=>e.jsx("div",{className:"py-4",children:t}),hn={podcastName:"",podcastDescription:"",coverArt:null,elevenlabsApiKey:""},ac=({open:t,onOpenChange:a,token:r,onPodcastCreated:n})=>{const[o,l]=s.useState(1),[d,N]=s.useState(()=>({...hn})),[i,u]=s.useState(!1),{toast:j}=Lt(),c=s.useRef(null),m=s.useRef(!1),I=s.useCallback(()=>{l(1),N(()=>({...hn})),u(!1),c.current&&(clearInterval(c.current),c.current=null)},[]),x=s.useMemo(()=>{const Z=d.podcastName.trim().length>0,F=d.podcastDescription.trim().length>0,re=(d.elevenlabsApiKey||"").trim().length>0;return o>1||Z||F||!!d.coverArt||re||i},[d,o,i]),v=s.useCallback(()=>{u(Z=>(Z||j({title:"Success!",description:"Your Spreaker account is now connected."}),!0))},[j]),_=s.useCallback(async()=>{if(!r)return!1;try{if((await G(r).get("/api/auth/users/me"))?.spreaker_access_token)return v(),!0}catch{}return!1},[v,r]),k=sc?.VITE_ENABLE_BYOK==="true",h=[{id:"welcome",title:"Welcome"},{id:"showDetails",title:"About your show"},{id:"coverArt",title:"Podcast Cover Art (optional)"},{id:"spreaker",title:"Connect hosting"},...k?[{id:"elevenlabs",title:"AI voices (optional)"}]:[],{id:"finish",title:"All set"}],y=h.length,p=h[o-1]?.id;s.useEffect(()=>{const Z=F=>{if(F.origin!==window.location.origin)return;const re=F.data;(re==="spreaker_connected"||re&&re.type==="spreaker_connected")&&(v(),c.current&&(clearInterval(c.current),c.current=null),_().catch(()=>{}))};return window.addEventListener("message",Z),()=>window.removeEventListener("message",Z)},[v,_]),s.useEffect(()=>()=>{c.current&&(clearInterval(c.current),c.current=null)},[]);const C=()=>l(Z=>Math.min(Z+1,y)),M=()=>l(Z=>Math.max(Z-1,1)),b=Z=>{const{id:F,value:re,files:O}=Z.target;N(z=>({...z,[F]:O?O[0]:re}))},g=async()=>{try{if(!r)throw new Error("Not signed in");const Z=new URLSearchParams({access_token:r}).toString(),F=Vt(`/api/auth/spreaker/start?${Z}`),re=window.open(F,"spreakerAuth","width=600,height=700");if(!re)throw new Error("Popup blocked. Please allow popups and try again.");c.current&&(clearInterval(c.current),c.current=null),c.current=setInterval(async()=>{(!re||re.closed)&&(c.current&&(clearInterval(c.current),c.current=null),await _())},1e3)}catch(Z){j({title:"Connection Error",description:Z?.message||"Could not connect to Spreaker.",variant:"destructive"})}};s.useEffect(()=>{if(!t||!x||typeof window>"u")return;const Z=F=>{F.preventDefault(),F.returnValue=""};return window.addEventListener("beforeunload",Z),()=>window.removeEventListener("beforeunload",Z)},[t,x]);const U=Z=>{if(Z){a(!0);return}if(m.current){m.current=!1,a(!1),I();return}x&&!(!(typeof window<"u")||window.confirm("Leave the setup wizard? Your details will be lost."))||(a(!1),I())},se=async()=>{try{if(d.elevenlabsApiKey)try{await G(r).put("/api/users/me/elevenlabs-key",{api_key:d.elevenlabsApiKey})}catch{try{j({variant:"destructive",title:"ElevenLabs key not saved",description:"You can add it later in Settings."})}catch{}}const Z=new FormData;Z.append("name",d.podcastName),Z.append("description",d.podcastDescription),d.coverArt&&Z.append("cover_image",d.coverArt);const F=await G(r).raw("/api/podcasts/",{method:"POST",body:Z});if(F&&F.status&&F.status>=400){const O=F;throw new Error(O.detail||"Failed to create the podcast show.")}const re=F;j({title:"Success!",description:"Your new podcast show has been created."}),n(re)}catch(Z){j({title:"An Error Occurred",description:Z.message,variant:"destructive"})}finally{m.current=!0,a(!1),I()}};return e.jsx(na,{open:t,onOpenChange:U,children:e.jsxs(Hs,{className:"sm:max-w-[550px]",children:[e.jsxs(Gs,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(A,{type:"button",variant:"ghost",size:"sm",onClick:()=>U(!1),className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Yt,{className:"h-4 w-4"}),"Back"]}),e.jsx(Ks,{className:"flex-1 text-center",children:"Let's Create Your First Podcast!"}),e.jsx(A,{type:"button",variant:"ghost",size:"icon",onClick:()=>U(!1),"aria-label":"Close setup",children:e.jsx(_a,{className:"h-4 w-4"})})]}),e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Step ",o," of ",y]})]}),p==="welcome"&&e.jsxs(ga,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Welcome"}),e.jsx("p",{className:"text-sm text-gray-600",children:"We'll guide you one step at a time. You can't break anything, and we save as you go."})]}),p==="showDetails"&&e.jsxs(ga,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"About your show"}),e.jsx(Ns,{className:"mb-4",children:"Tell us the name and what it's about. You can change this later."}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ve,{htmlFor:"podcastName",className:"text-right",children:"Name"}),e.jsx(Ye,{id:"podcastName",value:d.podcastName,onChange:b,className:"col-span-3",placeholder:"e.g., 'The Morning Cup'"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ve,{htmlFor:"podcastDescription",className:"text-right",children:"Description"}),e.jsx(bs,{id:"podcastDescription",value:d.podcastDescription,onChange:b,className:"col-span-3",placeholder:"e.g., 'A daily podcast about the latest tech news.'"})]})]})]}),p==="coverArt"&&e.jsxs(ga,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Cover art"}),e.jsx(Ns,{className:"mb-2",children:"Upload a square image (at least 1400x1400). We'll preview how it looks."}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"No artwork yet? You can skip and add it later."}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ve,{htmlFor:"coverArt",className:"text-right",children:"Image"}),e.jsx(Ye,{id:"coverArt",type:"file",onChange:b,className:"col-span-3",accept:"image/png, image/jpeg"})]})]}),p==="spreaker"&&e.jsxs(ga,{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:["Connect hosting",e.jsx(Ds,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",title:"Spreaker hosts your episodes and publishes them to podcast directories."})]}),e.jsx(Ns,{className:"mb-2",children:"We partner with Spreaker to host your podcast."}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Keep your phone nearby in case a code is needed."}),e.jsx("div",{className:"flex justify-center items-center p-6 bg-gray-50 rounded-md",children:i?e.jsxs(A,{variant:"secondary",disabled:!0,className:"bg-green-500 text-white hover:bg-green-500",children:[e.jsx(as,{className:"w-5 h-5 mr-2"}),"Connected"]}):e.jsx(A,{onClick:g,children:"Connect to Spreaker"})})]}),p==="elevenlabs"&&e.jsxs(ga,{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:["AI voices (optional)",e.jsx(Ds,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",title:"Provide an ElevenLabs API key if you want to use AI narration."})]}),e.jsx(Ns,{className:"mb-2",children:"Want AI voices? You can always turn this on later."}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"If you're not sure, choose 'Skip'-you won't lose anything."}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ve,{htmlFor:"elevenlabsApiKey",className:"text-right",children:"ElevenLabs API Key"}),e.jsx(Ye,{id:"elevenlabsApiKey",type:"password",value:d.elevenlabsApiKey,onChange:b,className:"col-span-3",placeholder:"(Optional) Paste your key here"})]})]}),p==="finish"&&e.jsxs(ga,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"All set"}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Nice work. You can publish now or explore your dashboard first."}),e.jsx("p",{className:"text-xs text-gray-500",children:"There's a short tour on the next screen if you'd like it."})]}),e.jsxs(ia,{children:[o>1&&e.jsx(A,{variant:"outline",onClick:M,children:"Back"}),o<y&&e.jsx(A,{onClick:C,children:"Continue"}),o===y&&e.jsx(A,{onClick:se,children:"Finish"})]})]})})},pn={not_started:{label:"Not started",badge:"secondary"},in_progress:{label:"In progress",badge:"outline"},completed:{label:"Completed",badge:"default"},skipped:{label:"Skipped",badge:"outline"}},rc=[{value:"not_started",label:"Not started"},{value:"in_progress",label:"In progress"},{value:"completed",label:"Completed"},{value:"skipped",label:"Skipped"}],nc={automatic:"Handled automatically",assisted:"Assisted submission",manual:"Manual submission"},ic={automatic:"default",assisted:"secondary",manual:"outline"};function lc(t){return t?nc[t]||t:"Manual submission"}function oc({open:t,onOpenChange:a,podcast:r,token:n}){const{toast:o}=Lt(),[l,d]=s.useState(!1),[N,i]=s.useState(""),[u,j]=s.useState([]),[c,m]=s.useState({}),[I,x]=s.useState(""),[v,_]=s.useState(""),[k,h]=s.useState({}),[y,p]=s.useState({}),C=r?.id;s.useEffect(()=>{if(!t)return;if(!n||!C){j([]),m({}),x(""),_("");return}let F=!1;return d(!0),i(""),G(n).get(`/api/podcasts/${C}/distribution/checklist`).then(re=>{if(F)return;const O=Array.isArray(re?.items)?re.items:[];j(O),m(Object.fromEntries(O.map(z=>[z.key,z.notes||""]))),x(re?.rss_feed_url||""),_(re?.spreaker_show_url||"")}).catch(re=>{if(F)return;const O=re?.detail||re?.message||"Unable to load distribution checklist.";i(O)}).finally(()=>{F||d(!1)}),()=>{F=!0}},[t,n,C]);const M=s.useMemo(()=>Object.fromEntries(u.map(F=>[F.key,F.status])),[u]),b=!C||!n,g=async()=>{if(I)try{if(navigator?.clipboard?.writeText)await navigator.clipboard.writeText(I);else throw new Error("Clipboard API unavailable");o({title:"RSS feed copied"})}catch(F){o({title:"Copy failed",description:F?.message||"Unable to copy RSS feed. Please copy it manually.",variant:"destructive"})}},U=async(F,re)=>{if(!(!C||!n)){h(O=>({...O,[F]:!0}));try{const O=await G(n).put(`/api/podcasts/${C}/distribution/checklist/${encodeURIComponent(F)}`,re);j(z=>z.map(P=>P.key===F?O:P)),m(z=>({...z,[F]:O?.notes||""})),o({title:O?.name?`${O.name} saved`:"Checklist updated"})}catch(O){const z=O?.detail||O?.message||"Unable to save changes.";o({title:"Save failed",description:z,variant:"destructive"})}finally{h(O=>{const z={...O};return delete z[F],z})}}},se=(F,re)=>{const O=c[F]??"";U(F,{status:re,notes:O})},Z=F=>{const re=M[F]??"not_started";U(F,{status:re,notes:c[F]??""})};return e.jsx(na,{open:t,onOpenChange:F=>{F||i(""),a?.(F)},children:e.jsxs(Hs,{className:"max-w-4xl",children:[e.jsxs(Gs,{children:[e.jsxs(Ks,{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"Distribute your podcast"}),r?.name?e.jsx("span",{className:"text-base font-normal text-muted-foreground",children:r.name}):null]}),e.jsxs(Ns,{className:"space-y-3",children:[e.jsx("p",{children:"Work through the checklist below to submit your show to the major podcast directories. We provide direct links, instructions, and keep track of what has been completed."}),I?e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:"RSS feed:"}),e.jsx("code",{className:"rounded bg-muted px-2 py-1 text-xs break-all",children:I}),e.jsxs(A,{type:"button",variant:"outline",size:"sm",onClick:g,children:[e.jsx(Ll,{className:"mr-2 h-4 w-4"})," Copy"]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Publish your first episode or link a Spreaker show to generate the RSS feed automatically."}),v?e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Spreaker show URL: ",e.jsx("a",{href:v,target:"_blank",rel:"noreferrer",className:"text-primary underline",children:v})]}):null]})]}),N?e.jsx("div",{className:"rounded-md border border-destructive/40 bg-destructive/10 px-3 py-2 text-sm text-destructive",children:N}):null,l?e.jsxs("div",{className:"flex items-center justify-center py-12 text-muted-foreground",children:[e.jsx(St,{className:"mr-2 h-5 w-5 animate-spin"})," Loading distribution checklist…"]}):null,!l&&!N?e.jsxs("div",{className:"max-h-[65vh] space-y-4 overflow-y-auto pr-1",children:[u.map(F=>{const re=pn[F.status]||pn.not_started,O=lc(F.automation),z=!!k[F.key],P=!!y[F.key];return e.jsxs("div",{className:"rounded-lg border bg-card px-4 py-4 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:F.name}),e.jsx(pt,{variant:re.badge,children:re.label}),e.jsx(pt,{variant:ic[F.automation]||"outline",children:O})]}),F.summary?e.jsx("p",{className:"text-sm text-muted-foreground",children:F.summary}):null,F.automation_notes?e.jsx("p",{className:"text-xs text-muted-foreground",children:F.automation_notes}):null]}),e.jsxs("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[e.jsx("button",{type:"button",className:"text-xs text-primary underline",onClick:()=>p(E=>({...E,[F.key]:!P})),children:P?"Collapse":"Expand"}),F.action_label&&F.action_url?e.jsx(A,{type:"button",variant:"outline",size:"sm",asChild:!0,disabled:!!F.disabled_reason,children:e.jsxs("a",{href:F.action_url,target:"_blank",rel:"noreferrer",children:[e.jsx(Ul,{className:"mr-2 h-4 w-4"})," ",F.action_label]})}):null,F.docs_url?e.jsx("a",{href:F.docs_url,target:"_blank",rel:"noreferrer",className:"text-xs text-primary underline",children:"Platform documentation"}):null]})]}),F.disabled_reason?e.jsx("div",{className:"mt-3 rounded-md border border-yellow-500/50 bg-yellow-500/10 px-3 py-2 text-sm text-yellow-900 dark:text-yellow-100",children:F.disabled_reason}):null,P&&Array.isArray(F.instructions)&&F.instructions.length>0?e.jsx("ol",{className:"mt-3 list-decimal space-y-1 pl-5 text-sm text-muted-foreground",children:F.instructions.map((E,ne)=>e.jsx("li",{children:E},ne))}):null,P&&e.jsxs("div",{className:"mt-4 grid gap-4 md:grid-cols-[minmax(0,220px)_minmax(0,1fr)] md:items-start",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{htmlFor:`status-${F.key}`,children:"Status"}),e.jsxs(Jt,{value:F.status||"not_started",onValueChange:E=>se(F.key,E),disabled:b,children:[e.jsx(Wt,{id:`status-${F.key}`,children:e.jsx(Qt,{placeholder:"Select status"})}),e.jsx(qt,{children:rc.map(E=>e.jsx(yt,{value:E.value,children:E.label},E.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{htmlFor:`notes-${F.key}`,children:"Notes"}),e.jsx(bs,{id:`notes-${F.key}`,value:c[F.key]??"",onChange:E=>m(ne=>({...ne,[F.key]:E.target.value})),placeholder:"Add reminders or follow-up steps for your team",rows:3,disabled:b}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Only visible inside Plus Plus."}),e.jsxs(A,{type:"button",size:"sm",variant:"outline",onClick:()=>Z(F.key),disabled:b||z,children:[z?e.jsx(St,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Save notes"]})]})]})]})]},F.key)}),u.length===0?e.jsx("div",{className:"rounded-md border border-dashed border-muted px-4 py-8 text-center text-sm text-muted-foreground",children:"No distribution destinations available yet."}):null]}):null]})})}const xn={};function Ii({onBack:t,token:a,podcasts:r,setPodcasts:n}){const[o,l]=s.useState(null),[d,N]=s.useState(""),[i,u]=s.useState(!1),[j,c]=s.useState(!1),[m,I]=s.useState(null),[x,v]=s.useState(!1),[_,k]=s.useState(null),[h,y]=s.useState(null),[p,C]=s.useState(!1),[M,b]=s.useState(null),{toast:g}=Lt(),[U,se]=s.useState(!1),[Z,F]=s.useState(null),[re,O]=s.useState({}),[z,P]=s.useState(null),[E,ne]=s.useState(null);s.useEffect(()=>{(async()=>{try{const W=await G(a).get("/api/auth/users/me");F(W||null),se(!!W?.spreaker_access_token)}catch{se(!1)}})()},[a]),s.useEffect(()=>{if(!a||!r||r.length===0)return;let W=!1;return(async()=>{try{const Pe=G(a),Ue=await Promise.all(r.map(async $e=>{try{const Fe=await Pe.get(`/api/episodes/summary?podcast_id=${encodeURIComponent($e.id)}`);return[String($e.id),Fe]}catch{return[String($e.id),{total:0,unpublished_or_unscheduled:0}]}}));if(!W){const $e=Object.fromEntries(Ue);O($e)}}catch{}})(),()=>{W=!0}},[a,r]);const ee=W=>{const Pe=[];return(W?.name||"").trim().length<4&&Pe.push("name"),W?.podcast_type||Pe.push("podcast_type"),W?.language||Pe.push("language"),W?.contact_email||Pe.push("contact_email"),Pe},he=async W=>{try{if(!U){const Pe=new URLSearchParams({access_token:a}).toString(),Ue=Vt(`/api/auth/spreaker/start?${Pe}`),$e=window.open(Ue,"spreakerAuth","width=600,height=700"),Fe=setInterval(async()=>{if(!$e||$e.closed){clearInterval(Fe);try{const ct=!!(await G(a).get("/api/auth/users/me"))?.spreaker_access_token;se(ct),ct?(g({title:"Connected to Spreaker",description:"You can now publish your podcast."}),ge(W)):g({title:"Not connected",description:"Please try connecting again.",variant:"destructive"})}catch{}}},1e3);return}ge(W)}catch(Pe){g({title:"Unable to publish",description:Pe?.message||"Please try again.",variant:"destructive"})}},D=xn?.VITE_ONBOARDING_FULLPAGE??xn?.ONBOARDING_FULLPAGE,H=D===void 0?!0:String(D).toLowerCase()==="true",ge=W=>{I(W),c(!0)},V=()=>{I(null),c(!1)},je=W=>{n(Pe=>Pe.map(Ue=>Ue.id===W.id?W:Ue)),V()},_e=W=>{l(W),N("")},T=()=>{l(null)},K=()=>{if(H)try{window.location.href="/onboarding?from=manager&reset=1"}catch{}else v(!0)},le=W=>{n(Pe=>[W,...Pe]),v(!1)},me=async()=>{if(o){u(!0);try{if(!(await fetch(Vt(`/api/podcasts/${o.id}`),{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok)throw new Error("Failed to delete the show.");n(Pe=>Pe.filter(Ue=>Ue.id!==o.id)),g({title:"Success",description:`Show "${o.name}" has been deleted.`}),T()}catch(W){g({title:"Error",description:W.message,variant:"destructive"})}finally{u(!1)}}},te=W=>{b(W),C(!0)},Ne=W=>{C(W),W||b(null)},Be=async W=>{if(!W||!W.id)return;const Pe=!!W?.import_status?.needs_full_import,Ue=Pe?"import the remaining episodes from Spreaker":"scan Spreaker for missing episodes";if(window.confirm(`We will ${Ue} for "${W.name}". Continue?`)){k(W.id);try{const Fe=await G(a).post(`/api/podcasts/${W.id}/recover-from-spreaker`),Ge=Fe?.recovered_count||0;Ge>0?g({title:Pe?"Import complete":"Recovery complete",description:Pe?`Imported ${Ge} additional episode${Ge===1?"":"s"} from Spreaker. The rest of your library is now available locally.`:`Successfully recovered and created records for ${Ge} missing episodes. Please refresh the episode history to see them.`}):g({title:"Scan Complete",description:"No missing episodes were found on Spreaker for this show."}),Fe?.import_status&&n(ct=>ct.map(et=>et.id===W.id?{...et,import_status:Fe.import_status}:et))}catch($e){const Fe=$e?.detail||$e?.message||"An unknown error occurred.";g({variant:"destructive",title:"Recovery Failed",description:Fe})}finally{k(null)}}},ke=async(W,Pe={})=>{if(!W||!W.id)return;const $e=(re[String(W.id)]||{unpublished_or_unscheduled:0}).unpublished_or_unscheduled||0;if($e<2){g({title:"Nothing to publish",description:"There are fewer than 2 unpublished or unscheduled episodes."});return}if(window.confirm(`Publish ${$e} episode(s) from "${W.name}" to Spreaker now?`)){y(W.id);try{const Fe=G(a),Ge={publish_state:Pe.publish_state||"public",include_already_linked:!1},ct=await Fe.post(`/api/podcasts/${W.id}/publish-all`,Ge),et=ct?.started??0,dt=(ct?.skipped_no_audio??0)+(ct?.skipped_already_linked??0);g({title:"Batch publish enqueued",description:`Started ${et}. Skipped ${dt}. Errors ${ct?.errors??0}.`})}catch(Fe){const Ge=Fe?.detail||Fe?.message||"Failed to start batch publish.";g({variant:"destructive",title:"Publish All failed",description:Ge})}finally{y(null)}}},De=async W=>{if(!W)return;const Pe=window.prompt("Enter existing Spreaker show ID (numeric):");if(Pe){if(!/^[0-9]+$/.test(Pe)){g({variant:"destructive",title:"Invalid show id",description:"Must be numeric."});return}P(W.id);try{const Fe=(await G(a).post(`/api/podcasts/${W.id}/link-spreaker-show`,{show_id:String(Pe)}))?.podcast||{...W,spreaker_show_id:String(Pe)};n(Ge=>Ge.map(ct=>ct.id===W.id?Fe:ct)),g({title:"Linked",description:"Spreaker show linked successfully."})}catch(Ue){g({variant:"destructive",title:"Failed to link",description:Ue?.detail||Ue?.message||"Please try again."})}finally{P(null)}}},B=async W=>{if(W){if(!U){g({variant:"destructive",title:"Not connected",description:"Connect Spreaker first."});return}if(window.confirm(`Create a new Spreaker show for "${W.name}"?`)){ne(W.id);try{const Ue=await G(a).post(`/api/podcasts/${W.id}/create-spreaker-show`,{title:W.name,description:W.description||"",language:W.language||"en"}),$e=Ue?.podcast||W;n(Fe=>Fe.map(Ge=>Ge.id===W.id?$e:Ge)),g({title:"Show created",description:`Linked Spreaker show ${Ue?.spreaker_show_id||""}`})}catch(Pe){g({variant:"destructive",title:"Failed to create show",description:Pe?.detail||Pe?.message||"Please try again."})}finally{ne(null)}}}},xe=({icon:W,children:Pe,className:Ue="",variant:$e="outline",...Fe})=>e.jsxs(A,{variant:$e,className:`w-full justify-start ${Ue}`,...Fe,children:[W?e.jsx(W,{className:"w-4 h-4 mr-2"}):null,Pe]}),ie=r.filter(W=>W?.import_status?.needs_full_import);return e.jsxs("div",{className:"p-6",children:[e.jsxs(A,{onClick:t,variant:"ghost",className:"mb-4",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs(Ce,{children:[e.jsx(Je,{children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(Xe,{children:"Manage Your Podcasts"}),e.jsx(Zt,{children:"Here you can create, import, edit, or delete your podcasts."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:K,children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"})," New Podcast"]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>{try{window.dispatchEvent(new CustomEvent("ppp:navigate-view",{detail:"rssImporter"}))}catch{}},children:[e.jsx(oi,{className:"w-4 h-4 mr-2"})," Import"]})]})]})}),e.jsxs(Ae,{className:"space-y-6",children:[ie.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-muted/40 p-4 text-sm space-y-1",children:[e.jsx("p",{className:"font-medium text-foreground",children:"Finish importing your back catalogue"}),e.jsx("p",{className:"text-muted-foreground",children:ie.length===1?`We only imported a preview of ${ie[0].name}. Link the show to Spreaker and use “Import remaining episodes” to pull the rest.`:`We only imported previews for ${ie.length} shows. Link them to Spreaker and use “Import remaining episodes” to complete the migration.`})]}),r.length>0?e.jsx("div",{className:"space-y-6",children:r.map(W=>{const Pe=ee(W),Ue=!!W.spreaker_show_id,$e=W.import_status||null,Fe=!!$e?.needs_full_import,Ge=$e?.imported_count??0,ct=$e?.feed_total??0,et=Fe&&ct?`${Math.min(Ge,ct)} of ${ct} episodes imported in preview`:null;return e.jsx(Ce,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex gap-4 lg:w-1/2",children:[W.cover_path?e.jsx("img",{src:W.cover_path.startsWith("http")?W.cover_path:`/static/media/${W.cover_path.replace(/^\/+/,"").split("/").pop()}`,alt:`${W.name} cover`,className:"w-24 h-24 rounded-md object-cover",onError:dt=>{dt.currentTarget.style.display="none";const jt=dt.currentTarget.nextSibling;jt&&(jt.style.display="flex")}}):e.jsx("div",{className:"w-24 h-24 rounded-md bg-gray-100 flex items-center justify-center",children:e.jsx(Lr,{className:"w-10 h-10 text-gray-400"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-lg",children:W.name}),Ue&&e.jsx(pt,{variant:"secondary",children:"Linked to Spreaker"}),Fe&&e.jsx(pt,{variant:"outline",className:"border-amber-500 text-amber-700 bg-amber-50",children:"Preview only"})]}),et&&e.jsxs("p",{className:"text-sm text-amber-700 flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4"})," ",et]}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed max-w-xl",children:W.description||"No description."})]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[e.jsx(xe,{icon:aa,onClick:()=>ge(W),children:"Edit show details"}),(Pe.length===0||Ue)&&e.jsx(xe,{icon:ci,onClick:()=>te(W),children:"Distribution checklist"}),!Ue&&e.jsx(xe,{icon:$l,onClick:()=>De(W),disabled:z===W.id,children:z===W.id?"Linking…":"Link existing Spreaker show"}),!U&&Pe.length===0&&e.jsx(xe,{icon:di,onClick:()=>he(W),children:"Connect to Spreaker to publish"}),!Ue&&U&&e.jsx(xe,{icon:Ls,onClick:()=>B(W),disabled:E===W.id,children:E===W.id?"Creating…":"Create new Spreaker show"}),Fe&&e.jsx(xe,{icon:Ol,onClick:()=>Be(W),disabled:_===W.id||!W.spreaker_show_id,children:_===W.id?"Importing remaining episodes…":"Import remaining episodes"}),!Fe&&Ue&&e.jsx(xe,{icon:wa,onClick:()=>Be(W),disabled:_===W.id,children:_===W.id?"Scanning Spreaker…":"Recover missing episodes"}),(()=>{const jt=(re[String(W.id)]||{unpublished_or_unscheduled:0}).unpublished_or_unscheduled||0;return U&&Ue&&jt>=2?e.jsx(xe,{icon:ui,onClick:()=>ke(W),disabled:h===W.id,children:h===W.id?"Publishing…":`Publish ${jt} episodes to Spreaker`}):null})(),e.jsx(xe,{icon:$s,variant:"destructive",onClick:()=>_e(W),children:"Delete podcast"})]}),!Ue&&Pe.length===0&&!U&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ready to publish? Connect your Spreaker account first so we can push episodes over automatically."})]})]})},W.id)})}):e.jsxs("div",{className:"text-center py-10",children:[e.jsx("p",{className:"mb-4",children:"You haven't created any podcasts yet."}),e.jsxs(A,{onClick:K,children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"})," ",H?"Get started":"Create Your First Show"]})]})]})]}),e.jsx(na,{open:!!o,onOpenChange:T,children:e.jsxs(Hs,{children:[e.jsxs(Gs,{children:[e.jsx(Ks,{children:"Are you absolutely sure?"}),e.jsxs(Ns,{children:["This action cannot be undone. This will permanently delete the podcast",e.jsxs("strong",{className:"text-red-600",children:[' "',o?.name,'" ']}),"and all of its associated episodes."]})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs(ve,{htmlFor:"delete-confirm",children:["Please type ",e.jsx("strong",{className:"text-red-600",children:"delete"})," to confirm."]}),e.jsx(Ye,{id:"delete-confirm",value:d,onChange:W=>N(W.target.value),className:"mt-2"})]}),e.jsxs(ia,{children:[e.jsx(A,{type:"button",variant:"outline",onClick:T,children:"Cancel"}),e.jsx(A,{variant:"destructive",disabled:d!=="delete"||i,onClick:me,children:i?e.jsx(St,{className:"w-4 h-4 animate-spin"}):"Delete Podcast"})]})]})}),j&&m&&e.jsx(tc,{isOpen:j,onClose:V,podcast:m,onSave:je,token:a,userEmail:Z?.email||m?.user?.email||void 0,userFirstName:Z?.first_name,userLastName:Z?.last_name}),!H&&e.jsx(ac,{open:x,onOpenChange:v,token:a,onPodcastCreated:le}),e.jsx(oc,{open:p,onOpenChange:Ne,podcast:M,token:a})]})}function cc({onBack:t,token:a}){const[r,n]=s.useState(""),[o,l]=s.useState(!1),[d,N]=s.useState(!1),[i,u]=s.useState("public"),{toast:j}=Lt(),c=r.trim(),m=s.useMemo(()=>{if(!c)return!1;try{return/spreaker\.com/i.test(new URL(c).hostname||"")}catch{return/spreaker\.com/i.test(c)}},[c]),I=async()=>{if(!c){j({title:"Error",description:"Please enter an RSS feed URL.",variant:"destructive"});return}l(!0);try{const x={rss_url:c,attempt_link_spreaker:m,auto_publish_to_spreaker:d,publish_state:d?i:null},v=await G(a).post("/api/import/rss",x);if(v&&v.status&&v.status>=400)throw new Error(v.detail||"Failed to import from RSS feed.");const _=[`Imported "${v.podcast_name}" with ${v.episodes_imported} episodes.`,typeof v.mirrored_count=="number"?`${v.mirrored_count} mirrored`:null,typeof v.spreaker_linked=="number"&&v.spreaker_attempted?`${v.spreaker_linked} linked to Spreaker`:null,typeof v.auto_publish_started=="number"&&d?`${v.auto_publish_started} publish jobs started`:null].filter(Boolean),k=[];v?.import_status?.needs_full_import&&k.push('Additional episodes detected — use "Import remaining episodes" on the Manage Podcasts page once you are ready.'),j({title:"Import Successful!",description:[_.join(" • "),...k].filter(Boolean).join(` 
`)}),t()}catch(x){j({title:"Import Failed",description:x.message,variant:"destructive"})}finally{l(!1)}};return e.jsxs("div",{className:"p-6",children:[e.jsxs(A,{onClick:t,variant:"ghost",className:"mb-4",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs(Ce,{className:"max-w-xl mx-auto",children:[e.jsxs(Je,{children:[e.jsxs(Xe,{className:"flex items-center gap-2",children:[e.jsx(oi,{})," Import from RSS Feed"]}),e.jsx(Zt,{children:"Paste your public feed URL. We’ll pull the newest five episodes as a preview so you can verify everything looks right before recovering the rest."})]}),e.jsxs(Ae,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{htmlFor:"rss-url",children:"RSS Feed URL"}),e.jsx(Ye,{id:"rss-url",placeholder:"https://example.com/podcast.xml",value:r,onChange:x=>n(x.target.value)})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-muted/40 p-4 space-y-1 text-sm",children:[e.jsx("p",{className:"font-medium text-foreground",children:m?"Spreaker feed detected":"External feed detected"}),e.jsx("p",{className:"text-muted-foreground",children:m?"We will link directly to your existing Spreaker show and skip mirroring audio.":"We will mirror audio locally for seven days so you can review and publish to Spreaker, then automatically clean it up."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:x=>N(x.target.checked)}),"Auto-publish preview episodes to Spreaker"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{children:"Visibility"}),e.jsxs("select",{className:"h-9 px-2 border rounded",disabled:!d,value:i,onChange:x=>u(x.target.value),children:[e.jsx("option",{value:"public",children:"Public"}),e.jsx("option",{value:"unpublished",children:"Private (unpublished)"}),e.jsx("option",{value:"limited",children:"Limited"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"You can recover every episode from the Manage Podcasts screen once you have confirmed the preview looks right."})]}),e.jsx(A,{onClick:I,disabled:o,className:"w-full",children:o?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"mr-2 h-4 w-4 animate-spin"}),"Importing..."]}):"Import Podcast"})]})]})]})}function dc({token:t}){const[a,r]=s.useState(!1),{toast:n}=Lt(),o=async()=>{if(window.confirm("ARE YOU SURE? This will permanently delete all data, including users, shows, and templates.")){r(!0);try{const l=await G(t).post("/api/dev/reset-database");if(l&&l.status&&l.status>=400)throw new Error(l.detail||"Failed to reset database.");n({title:"Database Reset!",description:"The database has been wiped and recreated. Please log out and sign up again."})}catch(l){n({title:"Reset Failed",description:l.message,variant:"destructive"})}finally{r(!1)}}};return e.jsx("div",{className:"p-6",children:e.jsxs(Ce,{className:"max-w-xl mx-auto border-red-500",children:[e.jsxs(Je,{children:[e.jsxs(Xe,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(ws,{})," Developer Tools"]}),e.jsx(Zt,{children:"Use these tools to manage the development state of your application."})]}),e.jsxs(Ae,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"Reset Database"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This will completely wipe all data and recreate the database tables from the current code models. This is useful after making changes to `podcast.py` or other models."}),e.jsx(A,{variant:"destructive",onClick:o,disabled:a,children:a?e.jsx(St,{className:"mr-2 h-4 w-4 animate-spin"}):"Force Reset Database"})]})]})})}function uc({user:t,token:a,onBack:r,onTemplateCreated:n}){const[o,l]=s.useState([{role:"assistant",content:`AI Template Wizard is coming soon.

Soon you'll be able to:
• Describe your show in plain language.
• Get a draft template with segments and timing.
• Edit details before saving.

Tip: You can change templates later. Your work is safe.

For now, please use the manual Template Builder.`}]),[d,N]=s.useState(""),i=s.useRef(null),u=s.useRef(null),j=()=>{i.current?.scrollIntoView({behavior:"smooth"})};return s.useEffect(()=>{j()},[o]),s.useEffect(()=>{u.current?.focus()},[]),s.useEffect(()=>{const c=m=>{m.key==="Escape"&&(m.preventDefault(),r?.())};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[r]),e.jsx("div",{className:"fixed inset-0 bg-black/50 flex justify-center items-center p-4 z-50",role:"dialog","aria-modal":"true","aria-labelledby":"template-wizard-heading",children:e.jsxs(Ce,{className:"w-full max-w-2xl h-full max-h-[90vh] flex flex-col",children:[e.jsxs(Je,{className:"flex flex-row items-center justify-between",children:[e.jsxs(Xe,{id:"template-wizard-heading",tabIndex:-1,ref:u,className:"flex items-center gap-2 outline-none",children:[e.jsx(mr,{"aria-hidden":!0,className:"w-5 h-5"}),"Template Wizard (preview)"]}),e.jsxs(A,{variant:"ghost",onClick:r,className:"h-11 min-h-[44px] px-3",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2","aria-hidden":!0}),"Back"]})]}),e.jsxs(Ae,{className:"flex-grow overflow-y-auto p-4 space-y-4",children:[e.jsx("div",{role:"status","aria-live":"polite",className:"text-sm text-muted-foreground",children:"AI Template Wizard is coming soon."}),e.jsx("div",{className:"rounded-md border bg-muted/50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ra,{"aria-hidden":!0,className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"What you'll be able to do"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Describe your show in plain language."}),e.jsx("li",{children:"Get a draft template with segments and timing."}),e.jsx("li",{children:"Edit details before saving."})]}),e.jsx("p",{className:"mt-3 text-sm text-muted-foreground",children:"Tip: You can change templates later. Your work is safe."})]})]})}),o.map((c,m)=>e.jsxs("div",{className:`flex items-start gap-3 ${c.role==="user"?"justify-end":""}`,children:[c.role==="assistant"&&e.jsx(mr,{className:"w-6 h-6 text-blue-500","aria-hidden":!0}),e.jsx("div",{className:`rounded-lg p-3 max-w-[80%] ${c.role==="user"?"bg-blue-500 text-white":"bg-gray-100"}`,children:e.jsx("p",{className:"whitespace-pre-line text-sm",children:c.content})}),c.role==="user"&&e.jsx(qr,{className:"w-6 h-6 text-gray-500","aria-hidden":!0})]},m)),e.jsx("div",{ref:i})]}),e.jsx(Gr,{className:"p-4 border-t",children:e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsx(Ye,{disabled:!0,placeholder:"AI Wizard is disabled (coming soon)",value:d,readOnly:!0}),e.jsxs(A,{disabled:!0,variant:"outline",className:"h-11 min-h-[44px] px-5",children:[e.jsx(ui,{className:"w-4 h-4 mr-2","aria-hidden":!0}),"Send"]})]})})]})})}const fn="ppp.largeText",gn="ppp.highContrast";function mc(){const[t,a]=s.useState(()=>{try{return localStorage.getItem(fn)==="true"}catch{return!1}}),[r,n]=s.useState(()=>{try{return localStorage.getItem(gn)==="true"}catch{return!1}});s.useEffect(()=>{try{localStorage.setItem(fn,String(t))}catch{}},[t]),s.useEffect(()=>{try{localStorage.setItem(gn,String(r))}catch{}},[r]);const o=s.useCallback(d=>a(d),[]),l=s.useCallback(d=>n(d),[]);return{largeText:t,setLargeText:o,highContrast:r,setHighContrast:l}}const Ti=s.createContext(null);function hc({children:t}){const a=mc(),{largeText:r,setLargeText:n,highContrast:o,setHighContrast:l}=a;s.useEffect(()=>{if(typeof document>"u")return;const N=document.documentElement,i=document.body;if(!(!N||!i))return N.classList.toggle("pref-large-text",r),i.classList.toggle("pref-large-text",r),N.classList.toggle("pref-high-contrast",o),i.classList.toggle("pref-high-contrast",o),()=>{N.classList.remove("pref-large-text"),i.classList.remove("pref-large-text"),N.classList.remove("pref-high-contrast"),i.classList.remove("pref-high-contrast")}},[r,o]);const d=s.useMemo(()=>({largeText:r,setLargeText:n,highContrast:o,setHighContrast:l}),[r,n,o,l]);return e.jsx(Ti.Provider,{value:d,children:t})}function Xr(){const t=s.useContext(Ti);if(!t)throw new Error("useComfort must be used within a ComfortProvider");return t}function pc({inline:t=!1,className:a=""}){const{largeText:r,setLargeText:n,highContrast:o,setHighContrast:l}=Xr(),[d,N]=s.useState(!1),i=s.useId(),u=s.useId(),j=s.useId();s.useEffect(()=>{if(t||!d)return;const m=I=>{I.key==="Escape"&&N(!1)};return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[d,t]);const c=e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(ve,{htmlFor:u,className:"flex items-center gap-1 text-xs font-medium text-muted-foreground",children:[e.jsx(zl,{className:"h-3.5 w-3.5","aria-hidden":"true"})," Larger text"]}),e.jsx("p",{id:`${u}-hint`,className:"text-[11px] text-muted-foreground",children:"Boosts base font size for easier reading."})]}),e.jsx(Kt,{id:u,checked:r,onCheckedChange:n,"aria-describedby":`${u}-hint`})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(ve,{htmlFor:j,className:"flex items-center gap-1 text-xs font-medium text-muted-foreground",children:[e.jsx(Bl,{className:"h-3.5 w-3.5","aria-hidden":"true"})," High contrast"]}),e.jsx("p",{id:`${j}-hint`,className:"text-[11px] text-muted-foreground",children:"Enhances color contrast and underlines links."})]}),e.jsx(Kt,{id:j,checked:o,onCheckedChange:l,"aria-describedby":`${j}-hint`})]})]});if(t){const m=["rounded-md border bg-white p-4 shadow-sm"];return a&&m.push(a),e.jsxs("div",{className:m.join(" "),children:[e.jsx("div",{className:"flex items-center justify-between pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Sr,{className:"h-4 w-4 text-primary","aria-hidden":"true"}),e.jsx("p",{className:"text-sm font-semibold",children:"Display options"})]})}),c]})}return e.jsxs("div",{className:`fixed top-4 right-4 z-50 flex flex-col items-end gap-2 text-sm${a?` ${a}`:""}`,children:[e.jsxs("div",{id:i,className:`w-64 rounded-md border bg-white p-4 shadow-lg transition-all ${d?"opacity-100 visible translate-y-0":"pointer-events-none invisible -translate-y-2 opacity-0"}`,"aria-hidden":!d,children:[e.jsxs("div",{className:"flex items-center justify-between pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Sr,{className:"h-4 w-4 text-primary","aria-hidden":"true"}),e.jsx("p",{className:"text-sm font-semibold",children:"Display options"})]}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>N(!1),"aria-label":"Close display options",children:e.jsx(_a,{className:"h-4 w-4"})})]}),c]}),e.jsxs(A,{variant:d?"secondary":"outline",size:"sm",className:"shadow-sm",onClick:()=>N(m=>!m),"aria-expanded":d,"aria-controls":i,children:[e.jsx(Sr,{className:"mr-2 h-4 w-4","aria-hidden":"true"})," Display"]})]})}function Pa({icon:t,number:a,title:r,subtitle:n,defaultOpen:o=!0,children:l}){const[d,N]=s.useState(o),i=s.useId(),u=()=>t?e.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-slate-900/90 text-white",children:t}):typeof a<"u"?e.jsx("span",{className:"flex h-9 w-9 items-center justify-center rounded-2xl bg-slate-900 text-sm font-semibold text-white",children:a}):null;return e.jsxs("section",{className:"rounded-3xl border border-slate-200 bg-white/80 shadow-sm",children:[e.jsxs("button",{type:"button",onClick:()=>N(j=>!j),className:"flex w-full items-center justify-between gap-4 px-5 py-4 text-left","aria-expanded":d,"aria-controls":i,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:r}),n&&e.jsx("p",{className:"text-sm text-muted-foreground",children:n})]})]}),e.jsx(Br,{className:at("h-5 w-5 text-slate-500 transition-transform duration-200",d?"rotate-180":""),"aria-hidden":"true"})]}),d&&e.jsx("div",{id:i,className:"space-y-4 border-t border-slate-100 px-5 pb-5 pt-4",children:l})]})}function Vs({icon:t,title:a,description:r,action:n,children:o}){return e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex h-8 w-8 items-center justify-center rounded-xl bg-slate-900/90 text-white",children:t}),e.jsx("h4",{className:"text-base font-semibold text-slate-900",children:a})]}),r&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:r})]}),n&&e.jsx("div",{className:"sm:pt-1",children:n})]}),o&&e.jsx("div",{className:"mt-4 space-y-3 text-sm text-slate-700",children:o})]})}const Ir={removeFillers:!0,fillerWords:["um","uh","like"],fillerLeadTrimMs:100,removePauses:!0,maxPauseSeconds:1.8,targetPauseSeconds:.6,censorEnabled:!1,censorWords:[],censorFuzzy:!0,censorMatchThreshold:.8,commands:{flubber:{action:"rollback_restart",trigger_keyword:"flubber"},intern:{action:"ai_command",trigger_keyword:"intern",end_markers:["stop","stop intern"],remove_end_marker:!0,keep_command_token_in_transcript:!0}}},ar=250,rr=1e3,nr=0;function xc(t){return t?t.split(/[|,]/).map(a=>a.trim()).filter(Boolean).filter((a,r,n)=>n.indexOf(a)===r):[]}function fc({className:t}){const{token:a}=Ht(),[r,n]=s.useState(null),[o,l]=s.useState(!1),[d,N]=s.useState(null),[i,u]=s.useState(!1),[j,c]=s.useState([]),m=s.useCallback(async()=>{N(null);try{const y=(await G(a).get("/api/users/me/audio-cleanup-settings"))?.settings||{},p=y&&Object.keys(y).length?y:Ir,C={...p,commands:{...Ir.commands,...p.commands||{}}};n(C),u(!1)}catch(h){N(h?.message||String(h)),r||n(Ir)}finally{}},[a]);s.useEffect(()=>{m()},[m]),s.useEffect(()=>{(async()=>{try{const y=Fa(await G(a).get("/api/media/"));if(!y.length)return;const C=y.filter(M=>M.category==="sfx").map(M=>({id:M.id,label:M.friendly_name||M.filename?.split("_").slice(1).join("_")||M.filename,value:`media_uploads/${M.filename}`}));c(C)}catch{}})()},[a]),s.useEffect(()=>{if(!r?.censorEnabled)return;(r.censorBeepMs!==ar||r.censorBeepFreq!==rr||r.censorBeepGainDb!==nr)&&(n(y=>y&&{...y,censorBeepMs:ar,censorBeepFreq:rr,censorBeepGainDb:nr}),u(!0))},[r?.censorEnabled]);const I=h=>{n(y=>({...y||{},...h})),u(!0)},x=(h,y)=>{n(p=>({...p||{},commands:{...p?.commands||{},[h]:{...p?.commands?.[h]||{},...y}}})),u(!0)},v=async()=>{if(r){l(!0),N(null);try{const h={settings:r},y=await G(a).put("/api/users/me/audio-cleanup-settings",h);if(y&&y.status&&y.status>=400)throw new Error("Save failed");u(!1)}catch(h){N(h?.message||String(h))}finally{l(!1)}}};if(!r)return e.jsxs("div",{className:at("space-y-6",t),children:[e.jsx(Pa,{icon:e.jsx(an,{className:"h-5 w-5 text-white"}),title:"Audio Improvements",subtitle:"Loading your presets...",defaultOpen:!0,children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(wa,{className:"h-4 w-4 animate-spin"}),"Loading audio tools..."]})}),e.jsx(Pa,{icon:e.jsx(ta,{className:"h-5 w-5 text-white"}),title:"Magic Words",subtitle:"Loading your commands...",defaultOpen:!0,children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(wa,{className:"h-4 w-4 animate-spin"}),"Loading magic words..."]})})]});const k=Object.entries(r.commands||{}).filter(([h])=>!["flubber","intern"].includes(h));return e.jsxs("div",{className:at("space-y-6",t),children:[d&&e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:d}),e.jsxs(Pa,{icon:e.jsx(an,{className:"h-5 w-5 text-white"}),title:"Audio Improvements",subtitle:"Keep every episode tight, even if you are recording live.",defaultOpen:!0,children:[e.jsxs(Vs,{icon:e.jsx(Fr,{className:"h-4 w-4 text-white"}),title:"Trim pauses",description:"Shorten long silences automatically so conversations flow.",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-slate-200 bg-white px-4 py-3",children:[e.jsx("div",{className:"text-sm text-slate-700",children:"Shorten long pauses"}),e.jsx(Kt,{checked:!!r.removePauses,onCheckedChange:h=>I({removePauses:h})})]}),r.removePauses&&e.jsxs("div",{className:"grid gap-4 pt-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"text-xs text-slate-500",children:"Cut anything longer than (seconds)"}),e.jsx(Ye,{type:"number",step:"0.1",min:"0.4",value:r.maxPauseSeconds??1.8,onChange:h=>I({maxPauseSeconds:parseFloat(h.target.value||"0")})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"text-xs text-slate-500",children:"Target pause length after cleanup (seconds)"}),e.jsx(Ye,{type:"number",step:"0.1",min:"0.2",value:r.targetPauseSeconds??.6,onChange:h=>I({targetPauseSeconds:parseFloat(h.target.value||"0")})})]})]})]}),e.jsxs(Vs,{icon:e.jsx(Wl,{className:"h-4 w-4 text-white"}),title:"Eliminate filler words",description:'Let Flubber tidy the little "ums" and "uhs" without touching your tone.',children:[e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-slate-200 bg-white px-4 py-3",children:[e.jsx("div",{className:"text-sm text-slate-700",children:"Remove filler words"}),e.jsx(Kt,{checked:!!r.removeFillers,onCheckedChange:h=>I({removeFillers:h})})]}),r.removeFillers&&e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"text-xs text-slate-500",children:"Words or phrases to clip"}),e.jsx(yn,{values:r.fillerWords||[],onChange:h=>I({fillerWords:h}),placeholder:"Type a word and press Enter"})]}),e.jsxs("div",{className:"max-w-sm space-y-1",children:[e.jsx(ve,{className:"text-xs text-slate-500",children:"Trim a little extra before each cut (ms)"}),e.jsx(Ye,{type:"number",min:"0",value:r.fillerLeadTrimMs??100,onChange:h=>I({fillerLeadTrimMs:parseInt(h.target.value||"0",10)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Helpful if you tend to start over mid-syllable."})]})]})]}),e.jsxs(Vs,{icon:e.jsx(Vr,{className:"h-4 w-4 text-white"}),title:"Censor unwanted words",description:"Bleep specific words or phrases before you publish.",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-slate-200 bg-white px-4 py-3",children:[e.jsx("div",{className:"text-sm text-slate-700",children:"Turn censoring on"}),e.jsx(Kt,{checked:!!r.censorEnabled,onCheckedChange:h=>I({censorEnabled:h})})]}),r.censorEnabled&&e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"text-xs text-slate-500",children:"Words or phrases to bleep"}),e.jsx(yn,{values:r.censorWords||[],onChange:h=>I({censorWords:h}),placeholder:"Type a word and press Enter"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Kt,{checked:!!r.censorFuzzy,onCheckedChange:h=>I({censorFuzzy:h})}),e.jsx("span",{className:"text-sm text-slate-700",children:"Catch close matches too"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"text-xs text-slate-500",children:"Match strictness (0-1)"}),e.jsx(Ye,{type:"number",min:"0",max:"1",step:"0.05",className:"w-24",value:r.censorMatchThreshold??.8,onChange:h=>I({censorMatchThreshold:parseFloat(h.target.value||"0.8")})})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:(()=>{const h=Number(r.censorMatchThreshold??.8);return h<=.6?"Looser: bleeps more, may catch near matches.":h>=.9?"Stricter: bleeps less, may miss slang or endings.":"Balanced for most shows."})()})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"text-xs text-slate-500",children:"Beep sound"}),e.jsxs(Jt,{value:r.censorBeepFile&&r.censorBeepFile.trim()?r.censorBeepFile:"__builtin__",onValueChange:h=>{I(h==="__builtin__"?{censorBeepFile:"",censorBeepMs:ar,censorBeepFreq:rr,censorBeepGainDb:nr}:{censorBeepFile:h,censorBeepMs:ar,censorBeepFreq:rr,censorBeepGainDb:nr})},children:[e.jsx(Wt,{children:e.jsx(Qt,{placeholder:"Built-in short beep (250ms)"})}),e.jsxs(qt,{children:[e.jsx(yt,{value:"__builtin__",children:"Built-in short beep (250ms)"}),j.map(h=>e.jsx(yt,{value:h.value,children:h.label||h.value},h.id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload a single-hit SFX if you want something custom."})]})]})]})]}),e.jsxs(Pa,{icon:e.jsx(ta,{className:"h-5 w-5 text-white"}),title:"Magic Words",subtitle:"Steer edits with quick phrases while you record.",defaultOpen:!0,children:[e.jsxs(Vs,{icon:e.jsx(Fr,{className:"h-4 w-4 text-white"}),title:"Flubber",description:"Redo the last sentence without breaking your flow.",children:[e.jsx("p",{className:"text-sm text-slate-600",children:'Say your wake word ("flubber" by default) right after a flub. We rewind to the previous natural pause, cut the mistake, and let you pick up cleanly.'}),e.jsx("div",{className:"grid gap-3 pt-4 sm:grid-cols-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"text-xs text-slate-500",children:"What you say"}),e.jsx(Ye,{value:r.commands?.flubber?.trigger_keyword??"flubber",onChange:h=>x("flubber",{trigger_keyword:h.target.value}),placeholder:"flubber, do-over, rewind"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pick anything short you will remember under pressure."})]})})]}),e.jsx(Vs,{icon:e.jsx(mr,{className:"h-4 w-4 text-white"}),title:"Intern",description:"Ask your helper to draft edits, research, or add notes in the moment.",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Say the trigger word, give your request, then finish with a stop phrase. We tuck the response into the next pause and update your transcript."}),e.jsx("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-xs text-slate-600",children:'Example: "Oh, Jennifer, would you tell us about this cool thing we do not know, if you do not mind." Rename the trigger to "Jennifer" and set the stop phrase to "if you do not mind" for a natural handoff.'}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"text-xs text-slate-500",children:"Trigger word"}),e.jsx(Ye,{value:r.commands?.intern?.trigger_keyword??"intern",onChange:h=>x("intern",{trigger_keyword:h.target.value}),placeholder:"intern, jennifer, helper"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use a name that feels natural in your show."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"text-xs text-slate-500",children:"Stop phrase(s)"}),e.jsx(Ye,{value:(r.commands?.intern?.end_markers||["stop","stop intern"]).join(", "),onChange:h=>x("intern",{end_markers:xc(h.target.value)}),placeholder:"stop, thank you, if you do not mind"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Separate phrases with commas. We stop listening when we hear any of them."})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 rounded-2xl border border-slate-200 bg-white px-4 py-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"text-xs text-slate-600 sm:max-w-sm",children:"Remove spoken stop phrase from the transcript. It is on by default so the exchange sounds tight, but turn it off if you want listeners to hear the phrase."}),e.jsx(Kt,{checked:!!(r.commands?.intern?.remove_end_marker??!0),onCheckedChange:h=>x("intern",{remove_end_marker:h})})]})]})}),k.length>0&&e.jsxs("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-700",children:["Custom magic words"," ",k.map(([h])=>h).join(", ")," ","will keep working just like before. Reach out if you need us to expose advanced editing again."]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:i?"You have unsaved changes.":"All changes saved."}),e.jsx(A,{type:"button",size:"sm",disabled:!i||o,onClick:v,className:"inline-flex items-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx(wa,{className:"h-4 w-4 animate-spin"})," Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ra,{className:"h-4 w-4"})," Save changes"]})})]})]})]})}function yn({values:t,onChange:a,placeholder:r}){const[n,o]=s.useState(""),l=N=>{const i=N.trim();!i||t.includes(i)||(a([...t,i]),o(""))},d=N=>{a(t.filter(i=>i!==N))};return e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"flex flex-wrap gap-2 pb-2",children:t.map(N=>e.jsx(pt,{variant:"secondary",className:"cursor-pointer bg-slate-200 text-slate-700 hover:bg-slate-300",onClick:()=>d(N),children:N},N))}),e.jsx(Ye,{value:n,onChange:N=>o(N.target.value),onKeyDown:N=>{N.key==="Enter"&&(N.preventDefault(),l(n)),N.key==="Backspace"&&!n&&t.length&&d(t[t.length-1])},placeholder:r})]})}function Pi({token:t,initial:a=null,onSaved:r}){const{toast:n}=Lt(),[o,l]=$t.useState(a),[d,N]=$t.useState(!1),[i,u]=$t.useState(null);$t.useEffect(()=>{if(a!=null){l(a);return}if(!t)return;let x=!1;return(async()=>{try{const _=await G(t).get("/api/admin/settings");x||l(_||{test_mode:!1,default_user_active:!0})}catch{x||l({test_mode:!1,default_user_active:!0})}})(),()=>{x=!0}},[t,a]);const j=async(x,v)=>{if(t){N(!0),u(null);try{const k=await G(t).put("/api/admin/settings",x);l(k),r&&r(k)}catch(_){u(_?.message||"Failed");try{n({title:"Error",description:"Failed to update admin settings",variant:"destructive"})}catch{}v&&l(v)}finally{N(!1)}}},c=x=>{const v={...o||{}},_={...v,test_mode:!!x};l(_),j(_,v)},m=x=>{const v={...o||{}},_={...v,default_user_active:!!x};l(_),j(_,v)},I=x=>{const v={...o||{}};let _=parseInt(x,10);(!isFinite(_)||isNaN(_))&&(_=v.max_upload_mb||500),_<10&&(_=10),_>2048&&(_=2048);const k={...v,max_upload_mb:_};l(k),clearTimeout(I._t),I._t=setTimeout(()=>j(k,v),400)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ve,{className:"text-base font-medium text-gray-700",children:"Test Mode (Admin)"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"When enabled, new episodes default to draft and season/episode numbers are overridden to day-of-month and HHMM."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[d&&e.jsx("span",{className:"text-xs text-gray-400",children:"Saving…"}),i&&e.jsx("span",{className:"text-xs text-red-500",title:i,children:"Err"}),e.jsx(Kt,{checked:!!(o&&o.test_mode),disabled:d,onCheckedChange:c})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ve,{className:"text-base font-medium text-gray-700",children:"New Users Are Active By Default"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"When disabled, newly created accounts start as inactive and will see the Closed-Alpha gate until approved."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[d&&e.jsx("span",{className:"text-xs text-gray-400",children:"Saving…"}),i&&e.jsx("span",{className:"text-xs text-red-500",title:i,children:"Err"}),e.jsx(Kt,{checked:!!(o&&o.default_user_active),disabled:d,onCheckedChange:m})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ve,{className:"text-base font-medium text-gray-700",children:"Maximum Upload Size (MB)"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Applies to main audio uploads. Clients use this for hints; server enforces it."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[d&&e.jsx("span",{className:"text-xs text-gray-400",children:"Saving…"}),i&&e.jsx("span",{className:"text-xs text-red-500",title:i,children:"Err"}),e.jsx("input",{type:"number",min:10,max:2048,value:(o&&o.max_upload_mb)??500,onChange:x=>I(x.target.value),className:"w-28 border rounded px-2 py-1 text-sm"})]})]})]})}function gc(){const{user:t,token:a}=Ht(),{toast:r}=Lt(),[n,o]=s.useState(!1),[l,d]=s.useState(!1),[N,i]=s.useState(!1);return s.useEffect(()=>{(async()=>{try{if(!(t&&(t.is_admin||t.role==="admin"))){i(!1);return}const u=await G(a).get("/api/admin/settings");u?(i(!0),d(!!u.test_mode)):i(!1)}catch{}})()},[a,t]),N?e.jsxs(Ce,{className:"mt-4",children:[e.jsx(Je,{children:e.jsx(Xe,{children:"Admin Settings"})}),e.jsx(Ae,{children:e.jsx(Pi,{token:a,initial:{test_mode:l},onSaved:u=>d(!!u?.test_mode)})})]}):null}function Mi({token:t}){const{toast:a}=Lt(),{user:r,refreshUser:n}=Ht(),[o,l]=s.useState(""),[d,N]=s.useState(""),[i,u]=s.useState(!1),[j,c]=s.useState(!1),m=s.useRef(null);s.useEffect(()=>{l(r?.first_name||""),N(r?.last_name||""),c(!!r?.spreaker_access_token)},[r]);const I=s.useCallback(()=>{c(p=>(p||a({title:"Spreaker connected",description:"Your account is ready for one-click publishing."}),!0))},[a]),x=s.useCallback(async()=>{if(!t)return!1;try{if((await G(t).get("/api/auth/users/me"))?.spreaker_access_token)return I(),n?.({force:!0}),!0}catch{}return!1},[I,n,t]);s.useEffect(()=>{new URLSearchParams(window.location.search).get("spreaker_connected")==="true"&&(I(),x().catch(()=>{}),window.history.replaceState({},document.title,window.location.pathname))},[I,x]),s.useEffect(()=>{const p=C=>{const M=new Set([window.location.origin]);try{const g=Vt("");g&&M.add(new URL(g).origin)}catch{}if(!M.has(C.origin))return;const b=C.data;(b==="spreaker_connected"||b&&b.type==="spreaker_connected")&&(m.current&&(clearInterval(m.current),m.current=null),I(),x().catch(()=>{}))};return window.addEventListener("message",p),()=>window.removeEventListener("message",p)},[I,x]),s.useEffect(()=>()=>{m.current&&(clearInterval(m.current),m.current=null)},[]);const v=async()=>{u(!0);try{await G(t).patch("/api/auth/users/me/prefs",{first_name:o.trim(),last_name:d.trim()}),a({title:"Profile saved"}),n({force:!0})}catch(p){a({title:"Could not save profile",description:p?.message||"Please try again.",variant:"destructive"})}finally{u(!1)}},_=async()=>{try{let p=null;if(t){const M=new URLSearchParams({access_token:t}).toString();p=Vt(`/api/auth/spreaker/start?${M}`)}if(!p)throw new Error("Could not start the Spreaker sign-in.");const C=window.open(p,"spreakerAuth","width=600,height=700");if(!C)throw new Error("Popup blocked. Please allow popups and try again.");m.current&&(clearInterval(m.current),m.current=null),m.current=setInterval(async()=>{(!C||C.closed)&&(m.current&&(clearInterval(m.current),m.current=null),await x())},1e3)}catch(p){a({title:"Connection error",description:p?.message||"An unexpected error occurred.",variant:"destructive"})}},k=async()=>{if(window.confirm("Disconnect Spreaker? We will stop publishing automatically until you reconnect."))try{await G(t).post("/api/spreaker/disconnect",{}),a({title:"Spreaker disconnected",description:"We will keep everything ready if you decide to reconnect later."}),n({force:!0}),c(!1)}catch(p){a({title:"Error",description:p?.message||"An unexpected error occurred.",variant:"destructive"})}},h=()=>{window.location.href="/"},y=o.trim()!==(r?.first_name||"")||d.trim()!==(r?.last_name||"");return e.jsxs("div",{className:"mx-auto max-w-5xl space-y-8 bg-slate-50/80 p-6",children:[e.jsxs("button",{onClick:h,className:"flex items-center text-sm text-slate-600 transition hover:text-slate-900","aria-label":"Back to dashboard",type:"button",children:[e.jsx(Yt,{className:"mr-1 h-4 w-4"}),"Back to dashboard"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-semibold text-slate-900",children:"Settings"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-2xl",children:"Tune the workspace so it feels welcoming and make sure your automations know who they are helping."})]}),e.jsxs(Pa,{icon:e.jsx(Vl,{className:"h-5 w-5 text-white"}),title:"Site & Display Preferences",subtitle:"Personal details stay private to your team.",defaultOpen:!0,children:[e.jsxs(Vs,{icon:e.jsx(qr,{className:"h-4 w-4 text-white"}),title:"Name",description:"We use this to greet you and label any automations we run on your behalf.",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"settings-first-name",className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"First name"}),e.jsx(Ye,{id:"settings-first-name",value:o,onChange:p=>l(p.target.value),placeholder:"Jane",autoComplete:"given-name"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"settings-last-name",className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Last name"}),e.jsx(Ye,{id:"settings-last-name",value:d,onChange:p=>N(p.target.value),placeholder:"Doe",autoComplete:"family-name"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 pt-2",children:[e.jsx(A,{onClick:v,disabled:!y||i,children:i?"Saving...":"Save name"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:y?"You have unsaved changes":"Last updated from your profile"})]})]}),e.jsxs(Vs,{icon:e.jsx(ql,{className:"h-4 w-4 text-white"}),title:"Display options",description:"Adjust size and contrast for the dashboard, editor, and transcripts.",children:[e.jsx(pc,{inline:!0,className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Changes apply instantly; no save button needed."})]}),e.jsx(Vs,{icon:e.jsx(di,{className:"h-4 w-4 text-white"}),title:"Spreaker Connect",description:"Link your Spreaker account so finished episodes can publish automatically.",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm font-medium "+(j?"border-emerald-200 bg-emerald-50 text-emerald-600":"border-slate-200 bg-white text-slate-600"),children:[e.jsx("span",{className:"h-2 w-2 rounded-full",style:{backgroundColor:j?"#047857":"#94a3b8"}}),j?"Connected":"Not connected"]}),j?e.jsxs("div",{className:"flex flex-col gap-2 text-sm sm:flex-row sm:items-center sm:gap-3",children:[e.jsx(A,{variant:"secondary",onClick:k,children:"Disconnect"}),e.jsx("span",{className:"text-xs text-muted-foreground max-w-xs",children:"We will pause auto-publishing until you reconnect."})]}):e.jsxs("div",{className:"flex flex-col gap-2 text-sm sm:flex-row sm:items-center sm:gap-3",children:[e.jsx(A,{onClick:_,children:"Connect Spreaker"}),e.jsx("span",{className:"text-xs text-muted-foreground max-w-xs",children:"A popup will open. If you do not see it, allow popups for this site and try again."})]})]})})]}),e.jsx(fc,{}),e.jsx(gc,{})]})}function Ri({onBack:t,token:a,setCurrentView:r}){const[n,o]=s.useState([]),[l,d]=s.useState(!0),[N,i]=s.useState(null),[u,j]=s.useState(null),c=async()=>{d(!0),j(null);try{const _=await G(a).get("/api/templates/");o(_)}catch(v){i(v.message)}finally{d(!1)}};s.useEffect(()=>{c()},[a]);const m=()=>{j("new")},I=async v=>{if(window.confirm("Are you sure you want to delete this template?"))try{await G(a).del(`/api/templates/${v}`),c()}catch(_){const k=_&&_.message||"";k.toLowerCase().includes("at least one template")?(i(null),alert("You need to create another template before deleting your last one.")):i(k||"Delete failed")}},x=async v=>{try{const _=G(a),k={...v,is_active:v?.is_active===!1};await _.put(`/api/templates/${v.id}`,k),c()}catch(_){i(_.message)}};return u?e.jsx(Ci,{templateId:u,onBack:()=>j(null),token:a,onTemplateSaved:c}):e.jsxs("div",{className:"p-6",children:[e.jsxs(A,{onClick:t,variant:"ghost",className:"mb-4",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Template Manager"}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"italic text-xs text-muted-foreground mb-1",children:"Coming soon"}),e.jsxs(A,{type:"button",variant:"outline",disabled:!0,className:"opacity-60 cursor-not-allowed",title:"AI Template Wizard is coming soon",children:[e.jsx(mr,{className:"w-4 h-4 mr-2"}),"Create with AI Wizard"]})]}),e.jsxs(A,{onClick:m,children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Create New Template"]})]})]}),l&&e.jsx("div",{className:"flex justify-center",children:e.jsx(St,{className:"w-8 h-8 animate-spin"})}),N&&e.jsx("p",{className:"text-red-500",children:N}),!l&&!N&&e.jsxs(Ce,{children:[e.jsxs(Je,{children:[e.jsx(Xe,{children:"Your Templates"}),e.jsx(Zt,{children:"Select a template to edit or create a new one."})]}),e.jsx(Ae,{children:n.length>0?e.jsx("div",{className:"space-y-2",children:n.map(v=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold",children:v.name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${v?.is_active!==!1?"bg-green-50 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-300"}`,children:v?.is_active!==!1?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>x(v),children:v?.is_active!==!1?"Disable":"Enable"}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>j(v.id),children:[e.jsx(ni,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(A,{variant:"destructive",size:"sm",onClick:()=>I(v.id),children:[e.jsx($s,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]},v.id))}):e.jsx("p",{children:"No templates found. Get started by creating one!"})})]})]})}function Di({token:t,onBack:a}){const{refreshUser:r}=Ht(),[n,o]=s.useState(null),[l,d]=s.useState(null),[N,i]=s.useState(!0),[u,j]=s.useState(null),[c,m]=s.useState(!1),[I,x]=s.useState(!1),[v,_]=s.useState(null),[k,h]=s.useState(!1),[y,p]=s.useState(!1),[C,M]=s.useState(!1),{toast:b}=(()=>{try{return Lt()}catch{return{toast:()=>{}}}})(),g=s.useRef(null);if(!g.current)try{g.current=sessionStorage.getItem("ppp_tab_id")||Math.random().toString(36).slice(2)}catch{g.current=Math.random().toString(36).slice(2)}const U=s.useRef(null);s.useEffect(()=>{try{U.current=new BroadcastChannel("ppp_checkout_owner"),U.current.onmessage=D=>{D?.data?.type==="owner_claimed"&&D.data.owner!==g.current&&new URLSearchParams(window.location.search).get("checkout")==="success"&&(window.close(),setTimeout(()=>{try{document.hidden||window.location.replace("/")}catch{}},200))}}catch{}return()=>{try{U.current&&U.current.close()}catch{}}},[]);const se=async()=>{try{const D=G(t),[H,ge]=await Promise.all([D.get("/api/billing/subscription"),D.get("/api/billing/usage")]);o(H),d(ge)}catch(D){const H=is(D)?D.detail||D.error||D.message:String(D);j(H)}finally{i(!1)}};s.useEffect(()=>{se()},[t]),s.useEffect(()=>{const D=new URLSearchParams(window.location.search),H=D.get("checkout")==="success",ge=D.get("session_id"),V=typeof window<"u"&&window.opener&&window.name==="ppp_stripe_checkout";H&&(async()=>{try{const _e=localStorage.getItem("ppp_checkout_owner");if(_e&&_e!==g.current){window.close(),setTimeout(()=>{try{document.hidden||window.location.replace("/")}catch{}},150);return}else if(!_e){localStorage.setItem("ppp_checkout_owner",g.current);try{U.current?.postMessage({type:"owner_claimed",owner:g.current})}catch{}}}catch{}try{b({title:"Processing Purchase",description:"Finalizing your subscription...",duration:4e3})}catch{}if(ge)for(let _e=0;_e<5;_e++){try{const K=await G(t).get(`/api/billing/checkout_result?session_id=${ge}`);_(K),h(!0);try{const le=new BroadcastChannel("ppp_billing");le.postMessage({type:"checkout_success",payload:K}),le.close()}catch{}try{localStorage.setItem("ppp_last_checkout",JSON.stringify({ts:Date.now(),data:K}))}catch{}break}catch{}await new Promise(T=>setTimeout(T,300*(_e+1)))}let je=!1;if(ge)for(let _e=0;_e<6&&!je;_e++){try{const K=await G(t).post("/api/billing/force_sync_session",{session_id:ge});if(K?.plan_key&&K.plan_key!=="free"){o(le=>({...le||{},plan_key:K.plan_key,current_period_end:K.current_period_end})),je=!0,r({force:!0}),setTimeout(()=>r({force:!0}),1200),b({title:"Subscription Upgraded",description:`You are now on the ${K.plan_key} plan.`,duration:5e3});try{const le=new BroadcastChannel("ppp_billing");le.postMessage({type:"subscription_updated",payload:K}),le.close()}catch{}}}catch{}je||await new Promise(T=>setTimeout(T,800))}if(!je&&!V){p(!0);let _e=0;const T=async()=>{_e+=1;try{const le=await G(t).get("/api/billing/subscription");if(o(le),le.plan_key!=="free"){r({force:!0}),setTimeout(()=>r({force:!0}),1200),b({title:"Subscription Upgraded",description:`You are now on the ${le.plan_key} plan.`,duration:5e3});try{const me=new BroadcastChannel("ppp_billing");me.postMessage({type:"subscription_updated",payload:le}),me.close()}catch{}p(!1);return}}catch{}if(_e<15)setTimeout(T,1e3);else{p(!1);try{b({title:"Upgrade Pending",description:"Payment complete. Your plan will reflect the upgrade shortly.",duration:6e3})}catch{}}};T()}if(!V){se();try{window.history.replaceState(null,"",window.location.pathname)}catch{}}setTimeout(()=>{try{localStorage.getItem("ppp_checkout_owner")===g.current&&localStorage.removeItem("ppp_checkout_owner")}catch{}},5e3),V&&setTimeout(()=>{try{window.close()}catch{}},600)})()},[t,b]);const Z=async(D,H="monthly")=>{try{m(!0);const V=await G(t).post("/api/billing/checkout",{plan_key:D,billing_cycle:H}),je=window.open(V.url,"ppp_stripe_checkout","width=720,height=850,noopener");if(!je)window.location.href=V.url;else try{je.focus()}catch{}}catch(ge){const V=is(ge)?ge.detail||ge.error||ge.message:String(ge);j(V)}finally{m(!1)}},F=async()=>{try{x(!0);const H=await G(t).post("/api/billing/portal",{});window.location.href=H.url}catch(D){const H=is(D)?D.detail||D.error||D.message:String(D);j(H)}finally{x(!1)}},re=D=>{try{const H=new Date(D),ge=String(H.getMonth()+1).padStart(2,"0"),V=String(H.getDate()).padStart(2,"0"),je=H.getFullYear();return`${ge}-${V}-${je}`}catch{return D}},O=s.useMemo(()=>[{key:"starter",name:"Starter",monthly:19,annual:null,processing:"120 (2 hrs)",extraRate:"$6/hr",queue:"2 hrs, held 7 days",features:{uploadRecord:!0,basicCleanup:!0,manualPublish:!0,autopublishSpreaker:!1,flubber:!1,intern:!1,advancedIntern:!1,sfxTemplates:!1,analytics:!1,multiUser:!1,priorityQueue:!1,premiumSupport:!1}},{key:"creator",name:"Creator",monthly:39,annual:31,processing:"600 (10 hrs)",extraRate:"$5/hr",queue:"10 hrs, held 14 days",features:{uploadRecord:!0,basicCleanup:!0,manualPublish:!0,autopublishSpreaker:!0,flubber:!0,intern:!0,advancedIntern:!1,sfxTemplates:!1,analytics:!1,multiUser:!1,priorityQueue:!1,premiumSupport:!1},popular:!0,badge:"Most Popular"},{key:"pro",name:"Pro",monthly:79,annual:63,processing:"1500 (25 hrs)",extraRate:"$4/hr",queue:"25 hrs, held 30 days",features:{uploadRecord:!0,basicCleanup:!0,manualPublish:!0,autopublishSpreaker:!0,flubber:!0,intern:!0,advancedIntern:!0,sfxTemplates:!0,analytics:!0,multiUser:!1,priorityQueue:!1,premiumSupport:!1}},{key:"enterprise",name:"Enterprise",monthly:null,annual:null,processing:"3600 (60 hrs)",extraRate:"$3/hr",queue:"60 hrs, held 60 days",features:{uploadRecord:!0,basicCleanup:!0,manualPublish:!0,autopublishSpreaker:!0,flubber:!0,intern:!0,advancedIntern:!0,sfxTemplates:!0,analytics:!0,multiUser:!0,priorityQueue:!0,premiumSupport:!0},contact:!0}],[]),z=s.useMemo(()=>[{key:"price",label:"Price"},{key:"processing",label:"Processing minutes / mo"},{key:"extraRate",label:"Extra minutes (rollover)"},{key:"queue",label:"Queue storage (unprocessed audio)"},{key:"uploadRecord",label:"Upload & record"},{key:"basicCleanup",label:"Basic cleanup (noise, trim)"},{key:"manualPublish",label:"Manual publish"},{key:"autopublishSpreaker",label:"Auto-publish to Spreaker (+ linked platforms)"},{key:"flubber",label:"Flubber (filler removal)"},{key:"intern",label:"Intern (spoken edits)"},{key:"advancedIntern",label:"Advanced Intern (multi-step edits)"},{key:"sfxTemplates",label:"SFX & templates"},{key:"analytics",label:"Analytics (via Spreaker API)"},{key:"multiUser",label:"Multi-user accounts"},{key:"priorityQueue",label:"Priority processing queue"},{key:"premiumSupport",label:"Premium support"}],[]),P=D=>{if(D.contact)return"Contact Us";const H=C?D.annual:D.monthly;return H==null?C?"—":`$${D.monthly}/mo`:`$${H}/mo`+(C?" (billed annually)":"")};function E({on:D}){return e.jsx("span",{"aria-label":D?"Included":"Not included",className:D?"text-green-600":"text-slate-400",children:D?"✅":"–"})}const ne=n?.plan_key||"free",ee=n?.current_period_end,he=!!n?.cancel_at_period_end||!!n?.will_cancel_at;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsx(A,{variant:"ghost",onClick:a,children:"Back"}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Subscriptions"})]}),e.jsx("p",{className:"text-sm text-muted-foreground sm:text-right",children:"Toggle monthly or annual billing inside the plans table."})]}),u&&e.jsx("div",{className:"text-red-600 text-sm",children:u}),e.jsx(Ce,{children:e.jsxs(Ae,{className:"pt-6",children:[!l&&e.jsx("div",{className:"text-sm text-gray-500",children:"Loading usage..."}),l&&(()=>{const D=typeof l.processing_minutes_used_this_month=="number"?l.processing_minutes_used_this_month:typeof l.minutes_used=="number"?l.minutes_used:null,H=typeof l.max_processing_minutes_month=="number"?l.max_processing_minutes_month:l.max_processing_minutes_month==null?null:void 0,ge=H==null?"∞":D==null?null:Math.max(0,H-D),V=H&&typeof D=="number"?Math.min(100,D/Math.max(1,H)*100):null;return e.jsxs("div",{className:"space-y-2 text-sm relative",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Processing minutes"}),e.jsxs("span",{children:[D??"—"," / ",H??"∞"]})]}),typeof V=="number"&&e.jsx(Jr,{value:V}),e.jsxs("div",{className:"flex items-center justify-between",children:[ge!==null&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Minutes left: ",ge]}),ne!=="free"&&ee&&e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[he?"Your subscription ends on ":"Your subscription renews on ",e.jsx("span",{className:"font-medium",children:re(ee)})]})]})]})})()]})}),e.jsxs(Ce,{children:[e.jsxs(Je,{className:"flex flex-col gap-3 border-b border-slate-100 pb-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(Xe,{children:"Subscription Plans"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Compare plans and switch billing with the slider."})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 sm:items-start",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Billing"}),e.jsxs("div",{className:"relative inline-flex h-9 w-44 items-center rounded-full bg-slate-200/80 p-1 shadow-inner",children:[e.jsx("span",{"aria-hidden":"true",className:"pointer-events-none absolute inset-y-1 left-1 rounded-full bg-white shadow transition-transform duration-200 ease-in-out",style:{width:"calc(50% - 0.25rem)",transform:C?"translateX(calc(100% + 0.5rem))":"translateX(0)"}}),e.jsx("button",{type:"button",onClick:()=>M(!1),"aria-pressed":!C,className:`relative z-10 flex-1 rounded-full px-2 text-center text-sm font-medium transition-colors focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 ${C?"text-slate-500":"text-slate-900"}`,children:"Monthly"}),e.jsx("button",{type:"button",onClick:()=>M(!0),"aria-pressed":C,className:`relative z-10 flex-1 rounded-full px-2 text-center text-sm font-medium transition-colors focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 ${C?"text-slate-900":"text-slate-500"}`,children:"Annual"})]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Annual saves about 20%."})]})]}),e.jsxs(Ae,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse align-top min-w-[860px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 align-bottom text-sm",children:" "}),O.map(D=>e.jsx("th",{className:"p-2 text-left align-top min-w-[200px]",children:e.jsxs("div",{className:`rounded-lg border p-3 ${D.popular?"border-blue-500":"border-slate-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-base font-semibold",children:D.name}),D.popular&&e.jsx(pt,{variant:"secondary",children:D.badge||"Most Popular"}),ne===D.key&&e.jsx(pt,{variant:"secondary",className:"bg-green-100 text-green-700",children:"Current Plan"})]}),e.jsx("div",{className:"mt-1 text-xl font-bold",children:P(D)})]})},D.key))]})}),e.jsxs("tbody",{children:[z.map(D=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2 text-[13px] font-medium",children:D.key==="price"?"":D.label}),O.map(H=>e.jsxs("td",{className:"p-2 text-[13px] align-top",children:[D.key==="price"&&e.jsx("div",{className:"flex items-center justify-center gap-3",children:e.jsx("div",{className:"flex items-center gap-2",children:H.contact?e.jsx(A,{asChild:!0,variant:"secondary",children:e.jsx("a",{href:"/contact",children:"Contact Sales"})}):ne===H.key?e.jsx(A,{disabled:!0,variant:"secondary",children:"Current"}):e.jsx(A,{disabled:c,onClick:()=>Z(H.key,C?"annual":"monthly"),children:C?`Choose ${H.name} (Annual)`:`Choose ${H.name}`})})}),D.key==="processing"&&H.processing,D.key==="extraRate"&&H.extraRate,D.key==="queue"&&H.queue,D.key!=="price"&&D.key!=="processing"&&D.key!=="extraRate"&&D.key!=="queue"&&e.jsx(E,{on:!!H.features[D.key]})]},H.key))]},D.key)),ne!=="free"&&e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2 text-[13px] font-medium",children:"Manage"}),O.map(D=>e.jsx("td",{className:"p-2 text-[13px]",children:ne===D.key?e.jsx(A,{disabled:I,onClick:F,children:"Manage Subscription"}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})},D.key))]})]})]})}),y&&e.jsx("div",{className:"text-xs text-amber-600 mt-3",children:"Finalizing upgrade..."})]})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6 space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Subscription Updated"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:["Plan: ",e.jsx("span",{className:"font-medium capitalize",children:v?.plan_key}),v?.billing_cycle&&e.jsxs("span",{className:"ml-1 text-gray-500",children:["(",v.billing_cycle,")"]})]}),v?.plan_key!=="free"&&v?.renewal_date&&e.jsxs("div",{children:["Renewal: ",re(v.renewal_date)]}),v?.applied_credit&&e.jsxs("div",{children:["Prorated credit from previous plan: $",v.applied_credit.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(A,{variant:"outline",onClick:()=>h(!1),children:"Close"}),e.jsx(A,{onClick:()=>{h(!1),a&&a()},children:"Go to Dashboard"})]})]})})]})}function Fi({onBack:t,token:a,onFinish:r,onSaved:n,source:o="A"}){const[l,d]=s.useState(!1),[N,i]=s.useState(!1),[u,j]=s.useState(!1),[c,m]=s.useState(0),[I,x]=s.useState(""),[v,_]=s.useState([]),[k,h]=s.useState(""),[y,p]=s.useState(""),[C,M]=s.useState(!1),[b,g]=s.useState(0),U=s.useRef(null),[se,Z]=s.useState(0),[F,re]=s.useState(""),[O,z]=s.useState(""),[P,E]=s.useState(null),[ne,ee]=s.useState(!1),[he,D]=s.useState(""),[H,ge]=s.useState(""),[V,je]=s.useState(!1),[_e,T]=s.useState(!1),[K,le]=s.useState(""),[me,te]=s.useState(!1),[Ne,Be]=s.useState(0),ke=s.useRef(null),De=s.useRef(null),B=s.useRef([]),xe=s.useRef(!1),ie=s.useRef(null),W=s.useRef(null),Pe=s.useRef(null),Ue=s.useRef(null),$e=s.useRef(null),Fe=s.useRef(!1),Ge=s.useRef(!1),{toast:ct}=Lt(),et=s.useRef(null),dt=s.useRef(null),jt=s.useRef(0),xt=s.useRef(null),R=s.useRef(null),ye=s.useRef(null),[ae,f]=s.useState(500),Y=s.useMemo(()=>ae*1024*1024,[ae]),Q=s.useMemo(()=>{try{return/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent||"")}catch{return!1}},[]);s.useEffect(()=>{let we=!1;return(async()=>{try{const Me=await(await fetch("/api/public/config")).json().catch(()=>({})),Ze=parseInt(String(Me?.max_upload_mb||"500"),10);if(!we&&isFinite(Ze)&&!isNaN(Ze)){const tt=Math.min(Math.max(Ze,10),2048);f(tt)}}catch{}})(),()=>{we=!0}},[]);const ue=we=>{const Ee=Math.floor(we/60).toString().padStart(2,"0"),Me=Math.floor(we%60).toString().padStart(2,"0");return`${Ee}:${Me}`},Ie=()=>{if(window.MediaRecorder){if(MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm;codecs=opus"))return"audio/webm;codecs=opus";if(MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/mp4;codecs=aac"))return"audio/mp4;codecs=aac"}return""},Re=async we=>{const Ee=await we.arrayBuffer(),Me=window.AudioContext||window.webkitAudioContext;if(!Me)throw new Error("No AudioContext available");const Ze=new Me;try{const tt=await Ze.decodeAudioData(Ee),ot=Math.min(2,Math.max(1,tt.numberOfChannels||1)),ft=tt.sampleRate,Rt=tt.length,Tt=[];for(let bt=0;bt<ot;bt++)Tt[bt]=tt.getChannelData(bt);const hs=ot*2,ps=ft*hs,os=Rt*hs,_s=new ArrayBuffer(44+os),At=new DataView(_s);let vt=0;At.setUint32(vt,1380533830,!1),vt+=4,At.setUint32(vt,36+os,!0),vt+=4,At.setUint32(vt,1463899717,!1),vt+=4,At.setUint32(vt,1718449184,!1),vt+=4,At.setUint32(vt,16,!0),vt+=4,At.setUint16(vt,1,!0),vt+=2,At.setUint16(vt,ot,!0),vt+=2,At.setUint32(vt,ft,!0),vt+=4,At.setUint32(vt,ps,!0),vt+=4,At.setUint16(vt,hs,!0),vt+=2,At.setUint16(vt,16,!0),vt+=2,At.setUint32(vt,1684108385,!1),vt+=4,At.setUint32(vt,os,!0),vt+=4;const Ss=bt=>{const zt=Math.max(-1,Math.min(1,bt));At.setInt16(vt,zt<0?zt*32768:zt*32767,!0),vt+=2};if(ot===1){const bt=Tt[0];for(let zt=0;zt<Rt;zt++)Ss(bt[zt])}else for(let bt=0;bt<Rt;bt++)for(let zt=0;zt<ot;zt++)Ss(Tt[zt][bt]);const us=new Blob([_s],{type:"audio/wav"});try{Ze.close()}catch{}return us}finally{try{Ze.close()}catch{}}},Le=we=>{if(!we)return"";const Ee=we.lastIndexOf(".");return Ee>0?we.slice(0,Ee):we},nt=()=>{try{De.current&&De.current.getTracks().forEach(we=>we.stop())}catch{}De.current=null},He=()=>{try{W.current&&cancelAnimationFrame(W.current),W.current=null,Pe.current&&Pe.current.close()}catch{}Pe.current=null,Ue.current=null,$e.current=null},it=we=>{try{const Ee=new(window.AudioContext||window.webkitAudioContext),Me=Ee.createMediaStreamSource(we),Ze=Ee.createAnalyser();Ze.fftSize=2048,Me.connect(Ze),Pe.current=Ee,Ue.current=Ze,$e.current=Me;const tt=new Uint8Array(Ze.fftSize),ot=()=>{Ze.getByteTimeDomainData(tt);let ft=0;for(let Rt=0;Rt<tt.length;Rt++){const Tt=Math.abs(tt[Rt]-128)/128;Tt>ft&&(ft=Tt)}Z(Math.min(1,ft)),W.current=requestAnimationFrame(ot)};W.current=requestAnimationFrame(ot)}catch{}},w=async()=>{try{const we={audio:!0},Ee=await navigator.mediaDevices.getUserMedia(we);try{const Ze=(await navigator.mediaDevices.enumerateDevices()).filter(tt=>tt.kind==="audioinput"&&tt.deviceId).map(tt=>{const ot=(tt.label||"").replace(/\s*\([0-9a-f]{4}:[0-9a-f]{4}\)$/i,"").trim();return{...tt,label:ot||tt.label}});_(Ze),!k&&Ze[0]?.deviceId&&h(Ze[0].deviceId)}finally{try{Ee.getTracks().forEach(Me=>Me.stop())}catch{}}}catch(we){const Ee=we?.name||"";throw x(Ee==="NotAllowedError"||Ee==="SecurityError"||Ee==="PermissionDeniedError"?"Microphone access was blocked. Please allow microphone permission in your browser, then try again. Tip: Click the mic/camera icon in the address bar to grant access.":Ee==="NotFoundError"?"No microphone was found. Plug in or enable a microphone and try again.":"Could not access microphone."),we}},q=async we=>{const Ee=[],Me=we?{exact:we}:void 0;Ee.push({audio:{deviceId:Me,channelCount:1,noiseSuppression:{ideal:!0},echoCancellation:{ideal:!0}}}),Ee.push({audio:{deviceId:Me,channelCount:1}}),Ee.push({audio:{deviceId:Me}}),Ee.push({audio:!0});let Ze;for(const tt of Ee)try{const ot=await navigator.mediaDevices.getUserMedia(tt);return De.current=ot,it(ot),ot}catch(ot){Ze=ot}throw Ze||new Error("getUserMedia failed")},S=async()=>{x(""),z(Ee=>(Ee&&URL.revokeObjectURL(Ee),"")),E(null),j(!1),m(0),B.current=[];try{ye.current&&(ye.current.pause(),ye.current.currentTime=0)}catch{}i(!1),Ge.current=!1;const we=Ie();if(!we){x("Recording not supported in this browser.");return}p(we);try{if(!navigator.mediaDevices?.getUserMedia){x("Recording not supported in this browser.");return}const Ee=await q(k),Me=new MediaRecorder(Ee,{mimeType:we});B.current=[];let Ze=0;if(Me.ondataavailable=tt=>{const ot=Date.now();!tt?.data||tt.data.size===0||ot-Ze<50||(Ze=ot,B.current.push(tt.data))},Me.onpause=()=>{i(!0),Ge.current=!0},Me.onresume=()=>{i(!1),Ge.current=!1},Me.onstop=()=>{Promise.resolve().then(async()=>{try{if(xe.current){B.current=[],xe.current=!1,j(!1),E(null),z(Tt=>(Tt&&URL.revokeObjectURL(Tt),"")),re(""),m(0),ct({title:"Discarded",description:"Short take discarded (<30s)."});return}const tt=B.current||[],ot=new Blob(tt,{type:we});let ft=ot;try{ft=await Re(ot),p("audio/wav")}catch{ft=ot}E(ft);const Rt=URL.createObjectURL(ft);z(Rt),j(!0)}catch{}})},ke.current=Me,Me.start(),d(!0),Fe.current=!0,ie.current)try{clearInterval(ie.current)}catch{}ie.current=setInterval(()=>{Fe.current&&!Ge.current&&m(tt=>tt+1)},1e3);try{navigator.wakeLock?.request&&(R.current=await navigator.wakeLock.request("screen"))}catch{}}catch(Ee){console.error(Ee);const Me=Ee?.name||"";x(Me==="NotAllowedError"||Me==="SecurityError"||Me==="PermissionDeniedError"?"Microphone permission denied. Allow access in your browser and try again.":Me==="NotFoundError"?"No microphone detected.":"Could not access microphone."),nt(),He()}},$=()=>{try{ke.current&&ke.current.state!=="inactive"&&ke.current.stop()}catch{}d(!1),Fe.current=!1,i(!1),Ge.current=!1,ie.current&&clearInterval(ie.current),ie.current=null;try{ye.current&&ye.current.pause()}catch{}He(),nt();try{R.current?.release&&R.current.release()}catch{}R.current=null},J=()=>{if(!(l||me)){if(Be(3),te(!0),xt.current)try{clearInterval(xt.current)}catch{}xt.current=setInterval(()=>{Be(we=>{if(we<=1){try{clearInterval(xt.current)}catch{}return xt.current=null,te(!1),S(),0}return we-1})},1e3)}},Se=()=>{if(!(!N||me)){if(Be(3),te(!0),xt.current)try{clearInterval(xt.current)}catch{}xt.current=setInterval(()=>{Be(we=>{if(we<=1){try{clearInterval(xt.current)}catch{}xt.current=null,te(!1);try{ke.current?.resume?.()}catch{}return 0}return we-1})},1e3)}},We=()=>{try{xt.current&&clearInterval(xt.current)}catch{}xt.current=null,te(!1),Be(0)},Ve=()=>{if(!l){if(me){We();return}J();return}if(!N){try{ke.current?.pause?.()}catch{}return}Se()},lt=()=>{if(N){if(c<30){if(!window.confirm("You have recorded less than 30 seconds. Stopping now will discard this take. Do you want to stop and discard?"))return;xe.current=!0}$()}},Ct=async()=>{if(!(l||C)){M(!0);try{if(!v||v.length===0)try{await w()}catch{}const we=await q(k);let Ee=5;g(Ee),await new Promise(Me=>{U.current=setInterval(()=>{if(Ee-=1,g(Ee),Ee<=0){try{clearInterval(U.current)}catch{}U.current=null,Me()}},1e3)});try{const Me=Pe.current?.createMediaStreamDestination?.();if(Me&&$e.current){$e.current.connect(Me);const Ze=new MediaRecorder(Me.stream),tt=[];await new Promise(Tt=>{Ze.ondataavailable=Gt=>{Gt.data?.size&&tt.push(Gt.data)},Ze.onstop=()=>Tt(),Ze.start(),setTimeout(()=>{try{Ze.stop()}catch{}},800)});const ot=new Blob(tt,{type:"audio/webm"}),ft=URL.createObjectURL(ot),Rt=new Audio(ft);Rt.play().catch(()=>{}),Rt.onended=()=>{try{URL.revokeObjectURL(ft)}catch{}}}}catch{}He(),we.getTracks().forEach(Me=>Me.stop())}catch(we){const Ee=we?.name||"";x(Ee==="NotAllowedError"||Ee==="SecurityError"||Ee==="PermissionDeniedError"?"Microphone permission is blocked. Allow access in your browser and try again.":Ee==="NotFoundError"||Ee==="OverconstrainedError"?"Could not start mic check for the selected device. Try another microphone or unplug/replug it.":"Could not start mic check.")}finally{M(!1),g(0)}}},Et=(we,Ee)=>we?we.toLowerCase().endsWith(Ee)?we:`${we}${Ee}`:`untitled${Ee}`,ut=async()=>{if(!(!P||ne)){if(P.size>Y){ct({variant:"destructive",title:"Too large",description:"Recording too long to upload (over 500 MB)."});return}if(!he)try{ee(!0);const we=F&&F.trim()?F.trim():formatDateName();let Ee=".webm";y.includes("wav")?Ee=".wav":y.includes("webm")?Ee=".webm":(y.includes("mp4")||y.includes("aac"))&&(Ee=".m4a");const Me=Et(we,Ee);le(Me);const Ze=new File([P],Me,{type:y||P.type||"audio/webm"}),tt=new FormData;tt.append("files",Ze),tt.append("friendly_names",JSON.stringify([we]));const ft=await G(a).raw("/api/media/upload/main_content",{method:"POST",body:tt}),Rt=Array.isArray(ft)?ft:ft&&ft.data?ft.data:null,Tt=Array.isArray(Rt)?Rt[0]:null,Gt=Tt&&(Tt.filename||Tt.name||Tt.stored_name);if(!Gt)throw new Error("Upload response missing filename");D(Gt),ge(Le(Gt)),ct({title:"Saved",description:"Saved. Transcription has started."});try{window.dispatchEvent(new CustomEvent("ppp:media-uploaded",{detail:Tt}))}catch{}try{typeof n=="function"&&n(Tt)}catch{}}catch(we){const Ee=we&&(we.detail||we.message)||"Upload failed";ct({variant:"destructive",title:"Upload error",description:Ee})}finally{ee(!1)}}};s.useEffect(()=>((async()=>{try{if(navigator.permissions?.query)try{(await navigator.permissions.query({name:"microphone"}))?.state==="denied"&&x("Microphone access is blocked. Enable it in your browser site settings, then press Record.")}catch{}const Ee=(await navigator.mediaDevices.enumerateDevices()).filter(Me=>Me.kind==="audioinput"&&Me.deviceId).map(Me=>{const Ze=(Me.label||"").replace(/\s*\([0-9a-f]{4}:[0-9a-f]{4}\)$/i,"").trim();return{...Me,label:Ze||Me.label}});if(Ee.length){_(Ee);let Me="";try{Me=localStorage.getItem("ppp_mic_device_id")||""}catch{}Me&&Ee.find(Ze=>Ze.deviceId===Me)?h(Me):k||h(Ee[0].deviceId)}}catch{}})(),()=>{try{ie.current&&clearInterval(ie.current)}catch{}try{xt.current&&clearInterval(xt.current)}catch{}He(),nt(),O&&URL.revokeObjectURL(O);try{et.current&&clearInterval(et.current)}catch{}try{dt.current&&dt.current.abort()}catch{}try{R.current?.release&&R.current.release()}catch{}}),[]),s.useEffect(()=>{if(je(!1),T(!1),!H){try{et.current&&clearInterval(et.current)}catch{}try{dt.current&&dt.current.abort()}catch{}et.current=null,dt.current=null;return}const we=G(a),Ee=600*1e3;jt.current=Date.now();const Me=async()=>{try{dt.current&&dt.current.abort()}catch{}const Ze=new AbortController;dt.current=Ze;try{const ot=await we.get(`/api/ai/transcript-ready?hint=${encodeURIComponent(H)}`,{signal:Ze.signal});if(ot&&(ot.ready===!0||ot.status==="ready"||ot===!0)){je(!0);try{et.current&&clearInterval(et.current)}catch{}et.current=null}}catch{}Date.now()-jt.current>=Ee&&T(!0)};return Me(),et.current=setInterval(Me,5e3),()=>{try{et.current&&clearInterval(et.current)}catch{}et.current=null;try{dt.current&&dt.current.abort()}catch{}dt.current=null}},[H,a]),s.useEffect(()=>{const we=Me=>{if(!Me)return!1;const Ze=Me.tagName?.toLowerCase();return Me.isContentEditable||Ze==="input"||Ze==="textarea"||Ze==="select"},Ee=Me=>{if(Me.ctrlKey||Me.metaKey||Me.altKey)return;const Ze=Me.key||Me.code;if(Ze==="r"||Ze==="R"){if(we(Me.target))return;Me.preventDefault(),Ve()}else if((Ze===" "||Ze==="Spacebar"||Ze==="Space")&&u&&ye.current&&!we(Me.target)){Me.preventDefault();const tt=ye.current;tt.paused?tt.play().catch(()=>{}):tt.pause()}};return window.addEventListener("keydown",Ee),()=>window.removeEventListener("keydown",Ee)},[u,Ve]);const mt=async we=>{h(we);try{localStorage.setItem("ppp_mic_device_id",we||"")}catch{}if(l)$(),J();else try{He(),nt();const Ee=await q(we);setTimeout(()=>{He();try{Ee.getTracks().forEach(Me=>Me.stop())}catch{}},500)}catch{}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(A,{variant:"ghost",onClick:t,className:"px-2 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary","aria-label":"Go back to dashboard",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"})," Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Record an Episode"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o==="A"?"Capture audio directly in your browser and edit it afterwards":"Capture audio directly in your browser and save it to your library."})]})]}),e.jsxs(Ce,{className:"shadow-sm",children:[e.jsxs(Je,{className:"pb-2",children:[e.jsx(Xe,{className:"text-lg",children:"Recorder"}),e.jsx(Zt,{children:"Large controls and clear status for easy use."})]}),e.jsxs(Ae,{className:"space-y-6",children:[I&&e.jsx("div",{className:"text-sm bg-red-50 border border-red-200 text-red-700 rounded p-3",children:I}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{onClick:Ve,"aria-label":l?N?"Resume recording":"Pause recording":me?"Cancel countdown":"Start recording",className:`rounded-full w-28 h-28 text-lg font-semibold shadow ${l?N?"bg-green-600 hover:bg-green-500":"bg-amber-600 hover:bg-amber-500":me?"bg-amber-600 hover:bg-amber-500":"bg-green-600 hover:bg-green-500"} text-white focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary`,children:l?e.jsx("span",{className:"flex flex-col items-center leading-tight",children:N?e.jsxs(e.Fragment,{children:[e.jsx(Ys,{className:"w-5 h-5 mb-1"}),e.jsx("span",{children:me?`Resuming in ${Ne}…`:"Resume"})]}):e.jsx("span",{children:"Pause"})}):e.jsxs("span",{className:"flex flex-col items-center leading-tight",children:[e.jsx(Ys,{className:"w-5 h-5 mb-1"}),e.jsx("span",{children:me?`Starting in ${Ne}…`:"Record"})]})}),e.jsxs(A,{variant:"outline",disabled:!N||me,onClick:lt,"aria-label":"Stop recording (available when paused)",className:"h-10",children:[e.jsx(ri,{className:"w-4 h-4 mr-2"})," Stop"]})]}),e.jsx("div",{className:"text-5xl font-mono tracking-wider","aria-live":"polite",children:ue(c)}),l&&Q&&e.jsx("div",{className:"text-xs text-amber-800 bg-amber-50 border border-amber-200 rounded px-3 py-2",role:"status",children:"Keep your screen on while recording. We’ll try to prevent sleep."}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Input level"}),e.jsx("div",{className:"h-3 rounded-full bg-muted relative overflow-hidden",children:e.jsx("div",{className:"absolute left-0 top-0 h-3 bg-emerald-500 transition-[width] duration-75",style:{width:`${Math.round(se*100)}%`}})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end max-w-3xl mx-auto w-full",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(ve,{htmlFor:"micSelect",children:"Microphone"}),v.filter(we=>we.deviceId).length===0&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Select your microphone and click Allow in your browser when prompted. The list stays disabled until access is granted."}),e.jsxs(Jt,{value:k,onValueChange:mt,onOpenChange:we=>{we&&v.filter(Ee=>Ee.deviceId).length===0&&w().catch(()=>{})},"aria-label":"Select microphone",children:[e.jsx(Wt,{id:"micSelect",className:"mt-1 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:e.jsx(Qt,{placeholder:v.filter(we=>we.deviceId).length?"Select microphone":"Select microphone (allow access first)"})}),e.jsx(qt,{children:v.filter(we=>we.deviceId).length===0?e.jsx(yt,{value:"no-devices",disabled:!0,children:"No microphones found"}):v.filter(we=>we.deviceId).map(we=>e.jsx(yt,{value:we.deviceId,children:we.label||"Microphone"},we.deviceId))})]})]}),e.jsx("div",{className:"flex md:justify-end",children:e.jsx(A,{variant:"outline",className:"w-full md:w-auto focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary","aria-label":"Run mic check",disabled:l||C,onClick:async()=>{if(v.length===0)try{await w()}catch{}Ct()},children:"Mic check (5s)"})})]}),C&&b>0&&e.jsxs("div",{className:"text-center text-xs text-muted-foreground","aria-live":"polite",children:["Mic check… ",b,"s"]}),u&&e.jsxs("div",{className:"mt-2 space-y-4 max-w-3xl mx-auto w-full",children:[e.jsx("div",{className:"p-4 border rounded-lg bg-card",children:e.jsx("audio",{controls:!0,className:"w-full focus-visible:outline focus-visible:outline-2 focus-visible:outline-primary",src:O||void 0,ref:ye,"aria-label":"Recording preview"})}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(ve,{htmlFor:"recName",children:"Name this recording"}),e.jsx(Ye,{id:"recName",className:"mt-1 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",placeholder:"e.g., Interview with Jamie (raw)",value:F,onChange:we=>re(we.target.value)})]}),e.jsxs("div",{className:"flex gap-2 md:justify-end",children:[e.jsx(A,{className:"flex-1 md:flex-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary","aria-label":"Save and continue",disabled:!P||ne||P&&P.size>Y||!!he,onClick:ut,children:ne?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(St,{className:"h-4 w-4 animate-spin"})," Saving…"]}):he?"Saved":"Save and continue"}),e.jsx(A,{variant:"outline",className:"flex-1 md:flex-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary","aria-label":"Discard recording",disabled:ne,onClick:()=>{j(!1),E(null),z(we=>(we&&URL.revokeObjectURL(we),"")),re("")},children:"Discard"})]})]}),P&&P.size>Y&&e.jsx("div",{className:"text-sm bg-red-50 border border-red-200 text-red-700 rounded p-3",children:"Recording too long to upload (over 500 MB). Please record a shorter segment."}),he&&e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Queued for processing"}),e.jsx("div",{className:"text-sm font-medium mt-1",children:K||he}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-0.5",children:["Size: ",P?(P.size/(1024*1024)).toFixed(2):"0.00"," MB"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[V?e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800 border border-emerald-200",children:[e.jsx(as,{className:"h-4 w-4 mr-1","aria-hidden":!0})," Ready"]}):e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800 border border-amber-200",children:[e.jsx(St,{className:"h-4 w-4 mr-1 animate-spin","aria-hidden":!0})," Processing…"]}),V&&e.jsx(A,{className:"bg-primary text-primary-foreground hover:bg-primary/90 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary","aria-label":"Finish episode",onClick:()=>{if(typeof r=="function"){r({filename:he,hint:H,transcriptReady:!0,startStep:5});return}try{he&&localStorage.setItem("ppp_uploaded_filename",he),H&&localStorage.setItem("ppp_uploaded_hint",H),localStorage.setItem("ppp_start_step","5"),localStorage.setItem("ppp_transcript_ready","1")}catch{}try{window.dispatchEvent(new CustomEvent("ppp:navigate-view",{detail:"createEpisode"}))}catch{}},children:"Finish Episode"})]})]}),_e&&!V&&e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:"Still processing; you can leave this page — we’ll keep working."})]})]})]})]})]})}const bn=t=>!!(t&&(t.is_admin||t.role==="admin")),jn="ppp_dashboard_tour_completed";function yc(t){if(!t)return"—";try{const a=new Date(t),r=Date.now()-a.getTime(),n=Math.floor(r/1e3);if(n<60)return"just now";const o=Math.floor(n/60);if(o<60)return`${o}m ago`;const l=Math.floor(o/60);if(l<24)return`${l}h ago`;const d=Math.floor(l/24);if(d<30)return`${d}d ago`;const N=Math.floor(d/30);return N<12?`${N}mo ago`:`${Math.floor(N/12)}y ago`}catch{return"—"}}function bc(t){if(!t)return"—";switch(t){case"success":return"Success";case"error":return"Error";case"pending":return"In Progress";default:return t.charAt(0).toUpperCase()+t.slice(1)}}function jc(t){if(!t)return"";try{const a=new Date(t),r=new Date,n=l=>String(l).padStart(2,"0");return a.toDateString()===r.toDateString()?`${n(a.getHours())}:${n(a.getMinutes())}`:`${a.getMonth()+1}/${a.getDate()} ${n(a.getHours())}:${n(a.getMinutes())}`}catch{return""}}function vn(){const{token:t,logout:a,user:r}=Ht(),{toast:n}=Lt(),[o,l]=s.useState(null),[d,N]=s.useState([]),[i,u]=s.useState([]),[j,c]=s.useState(null),[m,I]=s.useState(null),[x,v]=s.useState([]),[_,k]=s.useState(!1),[h,y]=s.useState(()=>{try{if(localStorage.getItem("ppp_post_checkout")==="1")return"billing"}catch{}return"dashboard"}),[p,C]=s.useState(null),[M,b]=s.useState(null),[g,U]=s.useState(!1),[se,Z]=s.useState(!1),[F,re]=s.useState("standard"),[O,z]=s.useState([]),[P,E]=s.useState(!1),[ne,ee]=s.useState(null),he=s.useMemo(()=>[{target:'[data-tour-id="dashboard-new-episode"]',title:"New Episode Button",content:"This is where the magic happens. Hit this button to start making your episode either from a show you've already recorded, or one you want to record now.",disableBeacon:!0},{target:'[data-tour-id="dashboard-quicktool-podcasts"]',title:"Podcasts",content:"If you want to change anything about the structure of your show, like the name, cover, or description, that's here."},{target:'[data-tour-id="dashboard-quicktool-templates"]',title:"Templates",content:"This is the blueprint for your show - the stuff that happens every episode. We made one for you already, but you can edit it or make others."},{target:'[data-tour-id="dashboard-quicktool-media"]',title:"Media",content:"Any sound files that you use for your show are uploaded and stored here."},{target:'[data-tour-id="dashboard-quicktool-episodes"]',title:"Episodes",content:"All the details about your individual episodes here so you can edit them as you need to."},{target:'[data-tour-id="dashboard-quicktool-subscription"]',title:"Subscription",content:"This is where you can choose and edit your plan here so you get the perfect one for you."},{target:'[data-tour-id="dashboard-quicktool-settings"]',title:"Settings",content:"If it doesn't fit in one of the categories above, look for it here."}],[]),D=s.useCallback(async()=>{if(!t)return[];E(!0);try{const K=await G(t).get("/api/media/main-content");return Array.isArray(K)?z(K):z([]),ee(null),K}catch(T){const K=T?.status;let le="Failed to load your uploaded main-content audio.";if(K===401)le="Your session expired. Please sign in again to load your uploads.";else if(K===403)le="You are not allowed to view uploads for this account.";else if(K===404)le="No uploads found yet.";else if(typeof T?.message=="string"){const me=T.message.toLowerCase();(me.includes("failed to fetch")||me.includes("network")||me.includes("cors"))&&(le="Network issue loading your uploads. Check your connection or try again.")}return ee(le),z([]),[]}finally{E(!1)}},[t]),H=T=>{const{status:K}=T;if([cr.FINISHED,cr.SKIPPED].includes(K)){try{localStorage.setItem(jn,"1")}catch{}Z(!1)}},ge=async()=>{if(t)try{I(null);const T=G(t),K=await Promise.allSettled([T.get("/api/templates/"),T.get("/api/podcasts/"),T.get("/api/dashboard/stats")]),[le,me,te]=K;if(le.status==="fulfilled"){const Ne=Fa(le.value);N(Ne)}else{const Ne=le.reason||{};if(Ne.status===401){console.warn("Templates fetch unauthorized, logging out",Ne),a();return}console.warn("Failed to load templates (non-fatal):",Ne),N([])}if(me.status==="fulfilled"){const Ne=Fa(me.value);u(Ne)}else{const Ne=me.reason||{};if(Ne.status===401){console.warn("Podcasts fetch unauthorized, logging out",Ne),a();return}console.warn("Failed to load podcasts (non-fatal):",Ne),u([])}if(te.status==="fulfilled")c(te.value);else{const Ne=te.reason||{};Ne.status===401?(console.warn("Stats fetch unauthorized; continuing without stats",Ne),I("You are not authorized to view stats."),c(null)):(console.warn("Failed to load stats (non-fatal):",Ne),I("Failed to load stats."),c(null))}}catch(T){console.error("Unexpected error fetching dashboard data:",T),T&&T.status===401?a():I("Failed to load dashboard data.")}};s.useEffect(()=>{t&&ge()},[t,a]),s.useEffect(()=>{t&&(h==="episodeStart"||h==="preuploadUpload")&&D()},[t,h,D]),s.useEffect(()=>{t&&h==="createEpisode"&&F==="preuploaded"&&!P&&O.length===0&&D()},[t,h,F,P,O.length,D]),s.useEffect(()=>{t&&h==="dashboard"&&ge()},[t,h]),s.useEffect(()=>{if(!t)return;let T=!1;(async()=>{try{const me=await G(t).get("/api/notifications/");!T&&Array.isArray(me)&&v(te=>{const Ne=new Map((te||[]).map(ke=>[ke.id,ke])),Be=me.map(ke=>{const De=Ne.get(ke.id);return De&&De.read_at?{...ke,read_at:De.read_at}:ke});for(const ke of te||[])Be.find(De=>De.id===ke.id)||Be.push(ke);return Be.sort((ke,De)=>new Date(De.created_at||0)-new Date(ke.created_at||0))})}catch{}})()},[t]),s.useEffect(()=>{let T;try{T=new BroadcastChannel("ppp_billing"),T.onmessage=le=>{le?.data?.type==="checkout_success"?(async()=>{try{const te=await G(t).get("/api/notifications/");v(Ne=>{const Be=new Map((Ne||[]).map(De=>[De.id,De])),ke=(Array.isArray(te)?te:[]).map(De=>{const B=Be.get(De.id);return B&&B.read_at?{...De,read_at:B.read_at}:De});for(const De of Ne||[])ke.find(B=>B.id===De.id)||ke.push(De);return ke.sort((De,B)=>new Date(B.created_at||0)-new Date(De.created_at||0))})}catch{}})():le?.data?.type==="subscription_updated"&&h!=="billing"&&n({title:"Subscription Updated",description:`Plan changed to ${le.data.payload?.plan_key}`,duration:5e3})}}catch{}const K=le=>{le.key==="ppp_last_checkout"&&(async()=>{try{const te=await G(t).get("/api/notifications/");v(Ne=>{const Be=new Map((Ne||[]).map(De=>[De.id,De])),ke=(Array.isArray(te)?te:[]).map(De=>{const B=Be.get(De.id);return B&&B.read_at?{...De,read_at:B.read_at}:De});for(const De of Ne||[])ke.find(B=>B.id===De.id)||ke.push(De);return ke.sort((De,B)=>new Date(B.created_at||0)-new Date(De.created_at||0))})}catch{}})()};return window.addEventListener("storage",K),()=>{try{T&&T.close()}catch{}window.removeEventListener("storage",K)}},[t,h,n]),s.useEffect(()=>{l(r)},[r]),s.useEffect(()=>{if(h==="billing")try{localStorage.removeItem("ppp_post_checkout")}catch{}},[h]);const V=()=>{C(null),re("standard"),y("dashboard");try{ge()}catch{}},je=()=>{C(null),y("templateManager")},_e=()=>{switch(h){case"recorder":return e.jsx(Fi,{onBack:V,token:t,onFinish:({filename:T,hint:K,transcriptReady:le})=>{try{b(T||K||null),U(!!le)}catch{}re("standard"),y("createEpisode")}});case"episodeStart":{const T=O.some(K=>K?.transcript_ready);return e.jsx(Vo,{loading:P,hasReadyAudio:T,errorMessage:ne||"",onRetry:()=>{try{D()}catch{}},onBack:V,onChooseUpload:()=>{re("standard"),y("preuploadUpload")},onChooseLibrary:async()=>{if(re("preuploaded"),b(null),U(!1),!P&&O.length===0)try{await D()}catch{}y("createEpisode")},onChooseRecord:()=>{re("standard"),y("recorder")}})}case"preuploadUpload":return e.jsx(Yo,{token:t,onBack:()=>y("episodeStart"),onDone:V,defaultEmail:o?.email||"",onUploaded:D});case"templateManager":return e.jsx(Ri,{onBack:V,token:t,setCurrentView:y});case"editTemplate":return e.jsx(Ci,{templateId:p,onBack:je,token:t,onTemplateSaved:ge});case"createEpisode":return e.jsx(ki,{onBack:V,token:t,templates:d,podcasts:i,preselectedMainFilename:M,preselectedTranscriptReady:g,creatorMode:F,preuploadedItems:O,preuploadedLoading:P,onRefreshPreuploaded:D,preselectedStartStep:F==="preuploaded"?1:void 0});case"mediaLibrary":return e.jsx(Ei,{onBack:V,token:t});case"episodeHistory":return e.jsx(Ai,{onBack:V,token:t});case"podcastManager":return e.jsx(Ii,{onBack:V,token:t,podcasts:i,setPodcasts:u});case"rssImporter":return e.jsx(cc,{onBack:V,token:t});case"devTools":return bn(r)?e.jsx(dc,{token:t}):e.jsx("div",{className:"p-6 text-sm text-red-600",children:"Not authorized."});case"settings":return e.jsx(Mi,{token:t});case"templateWizard":return e.jsx(uc,{user:o,token:t,onBack:()=>y("templateManager"),onTemplateCreated:()=>{ge(),y("templateManager")}});case"billing":return e.jsx(Di,{token:t,onBack:()=>y("dashboard")});case"dashboard":default:{const T=(o?.tier||"").toLowerCase(),le=new Set(["pro","enterprise","business","team","agency"]).has(T),me=i.length>0&&d.length>0;return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"flex flex-col gap-4 md:flex-row md:items-end md:justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight",style:{color:"#2C3E50"},children:["Welcome back",o?`, ${o.first_name||(o.email?o.email.split("@")[0]:"friend")}`:"","!"]}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Quick launch your next episode or jump into a tool."})]})}),m&&e.jsx("div",{className:"bg-red-100 border border-red-300 text-red-700 rounded p-3 mb-4 text-sm",children:m}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(Ce,{className:"shadow-sm border border-gray-200",children:[e.jsxs(Je,{className:"pb-3",children:[e.jsx(Xe,{className:"text-lg",children:"Create Episode"}),e.jsx(Zt,{children:"Assemble a new episode from your shows & templates."})]}),e.jsxs(Ae,{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[11px] tracking-wide text-gray-500",children:"Shows"}),e.jsx("div",{className:"font-semibold text-gray-800 mt-0.5",children:i.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[11px] tracking-wide text-gray-500",children:"Episodes"}),e.jsx("div",{className:"font-semibold text-gray-800 mt-0.5",children:j?.total_episodes??"–"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[11px] tracking-wide text-gray-500",children:"Ready?"}),e.jsx("div",{className:`font-semibold mt-0.5 ${me?"text-green-600":"text-amber-600"}`,children:me?"Yes":"Setup needed"})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:me?e.jsxs(A,{className:"flex-1 md:flex-none",title:"Start a new episode","data-tour-id":"dashboard-new-episode",onClick:()=>{re("standard"),b(null),U(!1),y("episodeStart"),D()},children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Start New Episode"]}):e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[d.length===0&&e.jsx(A,{variant:"outline",size:"sm",onClick:()=>y("templateManager"),className:"border-red-500 text-red-700",children:"Create Template"}),j?.spreaker_connected===!1&&e.jsx(A,{variant:"outline",size:"sm",onClick:()=>y("settings"),className:"border-red-500 text-red-700",children:"Connect Spreaker"})]})})]})]}),e.jsxs(Ce,{className:"shadow-sm border border-gray-200",children:[e.jsxs(Je,{className:"pb-3",children:[e.jsx(Xe,{className:"text-lg",children:"Recent Activity"}),e.jsx(Zt,{children:"Production pace and listening at a glance."})]}),e.jsxs(Ae,{className:"text-sm text-gray-700 space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded border bg-white flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] tracking-wide text-gray-500",children:"Episodes published in last 30 days"}),e.jsx("span",{className:"text-lg font-semibold",children:j?.episodes_last_30d??"–"})]}),e.jsxs("div",{className:"p-3 rounded border bg-white flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] tracking-wide text-gray-500",children:"Episodes scheduled"}),e.jsx("span",{className:"text-lg font-semibold",children:typeof j?.upcoming_scheduled=="number"?j.upcoming_scheduled:"–"})]}),e.jsxs("div",{className:"p-3 rounded border bg-white flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] tracking-wide text-gray-500",children:"Last episode published"}),e.jsx("span",{className:"text-sm font-medium",children:yc(j?.last_published_at)})]}),e.jsxs("div",{className:"p-3 rounded border bg-white flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] tracking-wide text-gray-500",children:"Last assembly result"}),e.jsx("span",{className:`text-sm font-medium ${j?.last_assembly_status==="error"?"text-red-600":j?.last_assembly_status==="success"?"text-green-600":j?.last_assembly_status==="pending"?"text-amber-600":"text-gray-600"}`,children:bc(j?.last_assembly_status)})]})]}),(typeof j?.plays_last_30d=="number"||typeof j?.show_total_plays=="number"||Array.isArray(j?.recent_episode_plays)&&j.recent_episode_plays.length>0)&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Listening"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[typeof j?.plays_last_30d=="number"&&e.jsxs("div",{className:"p-3 rounded border bg-white flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] tracking-wide text-gray-500",children:"Plays Last 30 Days"}),e.jsx("span",{className:"text-lg font-semibold",children:j.plays_last_30d})]}),Array.isArray(j?.recent_episode_plays)&&j.recent_episode_plays.slice(0,4).map(te=>e.jsxs("div",{className:"p-3 rounded border bg-white flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] tracking-wide text-gray-500 truncate",title:te.title,children:te.title}),e.jsx("span",{className:"text-lg font-semibold",children:te.plays_total??"—"})]},te.episode_id))]})]}),e.jsx("p",{className:"text-[11px] text-gray-400",children:"Plays update periodically; detailed windows (24h / 7d / 30d) coming soon."})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(Ce,{className:"shadow-sm border border-gray-200",children:[e.jsxs(Je,{className:"pb-3",children:[e.jsx(Xe,{className:"text-lg",children:"Quick Tools"}),e.jsx(Zt,{className:"text-xs",children:"Jump directly into a management area."})]}),e.jsx(Ae,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(A,{onClick:()=>y("podcastManager"),variant:"outline",className:"justify-start text-sm h-10","data-tour-id":"dashboard-quicktool-podcasts",children:[e.jsx(Yl,{className:"w-4 h-4 mr-2"}),"Podcasts"]}),e.jsxs(A,{onClick:()=>y("templateManager"),variant:"outline",className:"justify-start text-sm h-10","data-tour-id":"dashboard-quicktool-templates",children:[e.jsx(sa,{className:"w-4 h-4 mr-2"}),"Templates"]}),e.jsxs(A,{onClick:()=>y("mediaLibrary"),variant:"outline",className:"justify-start text-sm h-10","data-tour-id":"dashboard-quicktool-media",children:[e.jsx(ur,{className:"w-4 h-4 mr-2"}),"Media"]}),e.jsxs(A,{onClick:()=>y("episodeHistory"),variant:"outline",className:"justify-start text-sm h-10","data-tour-id":"dashboard-quicktool-episodes",children:[e.jsx(pi,{className:"w-4 h-4 mr-2"}),"Episodes"]}),e.jsxs(A,{onClick:()=>y("billing"),variant:"outline",className:"justify-start text-sm h-10","data-tour-id":"dashboard-quicktool-subscription",children:[e.jsx(Hl,{className:"w-4 h-4 mr-2"}),"Subscription"]}),le&&e.jsx(A,{asChild:!0,variant:"outline",className:"justify-start text-sm h-10",children:e.jsxs("a",{href:"/docs/podcast-website-builder",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Gl,{className:"w-4 h-4 mr-2"}),"Website Builder Guide"]})}),e.jsxs(A,{onClick:()=>y("settings"),variant:"outline",className:"justify-start text-sm h-10","data-tour-id":"dashboard-quicktool-settings",children:[e.jsx(aa,{className:"w-4 h-4 mr-2"}),"Settings"]}),bn(r)&&e.jsxs(A,{onClick:()=>y("devTools"),variant:"destructive",className:"justify-start text-sm h-10",children:[e.jsx(ws,{className:"w-4 h-4 mr-2"}),"Dev"]})]})})]})})]})]})}}};return s.useEffect(()=>{const T=()=>y("billing");window.addEventListener("ppp:navigate-billing",T);const K=le=>{try{const me=le?.detail;typeof me=="string"&&y(me)}catch{}};return window.addEventListener("ppp:navigate-view",K),()=>{window.removeEventListener("ppp:navigate-billing",T),window.removeEventListener("ppp:navigate-view",K)}},[]),s.useEffect(()=>{if(se)return;if(h!=="dashboard"){Z(!1);return}let T=!1;const K=setTimeout(()=>{if(T)return;try{if(localStorage.getItem(jn)==="1")return}catch{return}document.querySelector('[data-tour-id="dashboard-new-episode"]')&&Z(!0)},600);return()=>{T=!0,clearTimeout(K)}},[h,i,d,se]),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(In,{steps:he,run:se,continuous:!0,showSkipButton:!0,callback:H,disableOverlayClose:!0,scrollToFirstStep:!0,styles:{options:{zIndex:1e4}},spotlightClicks:!0}),e.jsx("nav",{className:"border-b border-gray-200 px-4 py-4 bg-white shadow-sm",children:e.jsxs("div",{className:"container mx-auto max-w-7xl flex justify-between items-center",children:[e.jsx(gr,{size:28,lockup:!0}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(A,{variant:"ghost",size:"sm",className:"relative",onClick:()=>k(T=>!T),children:[e.jsx(mi,{className:"w-5 h-5"}),x.filter(T=>!T.read_at).length>0&&e.jsx(pt,{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center bg-red-500 text-white text-xs",children:x.filter(T=>!T.read_at).length})]}),_&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white border border-gray-200 rounded shadow-lg z-50 max-h-96 overflow-auto",children:[e.jsxs("div",{className:"p-3 font-semibold border-b flex items-center justify-between",children:[e.jsx("span",{children:"Notifications"}),x.some(T=>!T.read_at)&&e.jsx("button",{className:"text-xs text-blue-600 hover:underline",onClick:async()=>{try{await G(t).post("/api/notifications/read-all"),v(K=>K.map(le=>le.read_at?le:{...le,read_at:new Date().toISOString()}))}catch{}},children:"Mark all read"})]}),x.length===0&&e.jsx("div",{className:"p-3 text-sm text-gray-500",children:"No notifications"}),x.map(T=>e.jsxs("div",{className:"p-3 text-sm border-b last:border-b-0 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium mr-2 truncate",children:T.title}),e.jsx("div",{className:"text-[11px] text-gray-500 whitespace-nowrap",children:jc(T.created_at)})]}),T.body&&e.jsx("div",{className:"text-gray-600 text-xs",children:T.body}),!T.read_at&&e.jsx("button",{className:"text-xs text-blue-600 self-start",onClick:async()=>{try{await G(t).post(`/api/notifications/${T.id}/read`),v(le=>le.map(me=>me.id===T.id?{...me,read_at:new Date().toISOString()}:me))}catch{}},children:"Mark read"})]},T.id))]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[o?.picture?e.jsxs(La,{className:"h-8 w-8",children:[e.jsx(xr,{src:o.picture}),e.jsx(Ua,{children:o?.email?o.email.substring(0,2).toUpperCase():"…"})]}):null,e.jsx("span",{className:"hidden md:block text-sm font-medium",style:{color:"#2C3E50"},children:o?o.email:"Loading..."})]}),e.jsxs(A,{onClick:a,variant:"ghost",size:"sm",className:"text-gray-600 hover:text-gray-800",children:[e.jsx(hi,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"hidden md:inline",children:"Logout"})]})]})]})}),e.jsx("main",{className:"container mx-auto max-w-7xl px-4 py-6",children:_e()})]})}function vc({largeText:t,setLargeText:a,highContrast:r,setHighContrast:n}){return e.jsxs("div",{className:"flex items-center gap-6 p-3 rounded-[var(--radius)] border bg-card",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(Kt,{checked:t,onCheckedChange:a}),e.jsx("span",{className:"text-sm",children:"Larger text"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(Kt,{checked:r,onCheckedChange:n}),e.jsx("span",{className:"text-sm",children:"High contrast"})]})]})}function wc({children:t,keyProp:a}){const[r,n]=s.useState(!0);return s.useMemo(()=>{n(!1);const o=setTimeout(()=>n(!0),0);return()=>clearTimeout(o)},[a]),e.jsx("div",{className:"transition-all duration-200 ease-out will-change-transform "+(r?"opacity-100 translate-y-0":"opacity-0 translate-y-2"),children:t},a)}function Li({steps:t,index:a,setIndex:r,onComplete:n,prefs:o,greetingName:l,nextDisabled:d=!1,hideNext:N=!1,hideBack:i=!1,showExitDiscard:u=!1,onExitDiscard:j}){const c=t[a],m=t.length,I=a===m-1,x=s.useRef(null),v=s.useRef(null),_=15e3,k=2e3,[h,y]=s.useState(!1),[p,C]=s.useState(""),M=s.useRef(null),b=s.useRef(null),g=o.largeText?"text-[18px] md:text-[18px]":"text-[15px] md:text-[16px]",U=o.highContrast?"bg-white text-black [&_.btn]:!bg-black [&_.btn]:!text-white [&_.btn-outline]:!border-black [&_.btn-outline]:!text-black [&_a]:underline":"";async function se(){if(c?.validate)try{if(!await c.validate())return}catch{return}I?n?.():r(a+1)}function Z(){a>0&&r(a-1)}const F=s.useMemo(()=>{const P={welcome:Xl,showDetails:sa,format:sa,coverArt:Lr,introOutro:ta,music:ta,spreaker:Mr,elevenlabs:ta,publishDay:va,finish:va,rss:Mr,analyze:sa,assets:Lr,yourName:qr,choosePath:Ql,publishCadence:Jl,publishSchedule:Kl,ttsReview:ta};return c?.id&&P[c.id]?P[c.id]:null},[c?.id]),re=s.useMemo(()=>({welcome:{headline:"What to expect",summary:"You'll answer a few quick questions so we can pre-fill your show settings and connect the tools you already use.",steps:["Have your show name, a short description, and any cover art handy.","If you're importing, keep the RSS URL nearby.","Prefer a walkthrough? Use the Guides button below to open the full getting started article."]},yourName:{headline:"Why we ask",summary:"We personalize reminders and drafts using your first name only.",steps:["Use the name you'd like to appear in emails and episode copy."]},showDetails:{headline:"Describe your show",summary:"A clear name and description help us draft intros, titles, and marketing copy that sound like you.",steps:["Aim for a 4+ character name that's easy to search.","Mention your audience and value proposition in the description.","You can tweak these later inside Show Settings."]},format:{headline:"Pick a starting format",summary:"Formats determine which segments we auto-generate (intro, interview cues, outro, etc.).",steps:["Choose the option that best matches your recurring structure—it's easy to adjust per episode.","Need something custom? Select the closest match and refine the template in the next step."]},introOutro:{headline:"Plan your openings",summary:"Decide whether you want AI narration, an uploaded intro, or both.",steps:["Upload any must-use clips so we can stitch them into every episode.","Prefer AI voiceovers? You'll preview voices in the ElevenLabs step."]},music:{headline:"Choose music rules",summary:"Music rules control when theme tracks fade in or out across segments.",steps:["Pick a library track now—we'll let you fine-tune timing inside the Template Editor.","Unsure? Select “Let Plus Plus decide” and we'll recommend something calm to start."]},elevenlabs:{headline:"Preview voices",summary:"Test a few AI voices and lock in the tone you want for narration or ad reads.",steps:["Click preview to hear an example line.","Use the notes field to tell us about pronunciation or pacing preferences."]},publishCadence:{headline:"Set your cadence",summary:"We use this to schedule reminders and auto-build episode timelines.",steps:["Weekly cadence works best for most shows; bi-weekly expects every other week.","Not sure yet? Pick your best guess—you can change it any time."]},publishSchedule:{headline:"Pick preferred days",summary:"Scheduling helps us plan drafts, reminders, and auto-publishing windows.",steps:["Select the days you usually publish.","If you mark “I’m not sure,” we’ll pause scheduling nudges for now."]},rss:{headline:"Importing via RSS",summary:"Drop your RSS feed URL and we'll pull recent episodes to learn your style.",steps:["You can find the RSS link in Spotify for Podcasters, Apple Podcasts Connect, or your current host dashboard.","We'll never publish to that feed—this is read-only for setup."]},spreaker:{headline:"Connect Spreaker",summary:"Connecting lets us publish directly for you without manual uploads.",steps:["Have your Spreaker login ready; we only request episode-management scopes.","Prefer to skip? You can connect later in Integrations."]},confirm:{headline:"Review & finish",summary:"Double-check the summary and continue—we'll start generating your workspace immediately.",steps:["You can revisit any step later from Settings."]}}),[]),O=c?.id?re[c.id]:null,z=O?.icon||F;return s.useEffect(()=>{const P=E=>{const ne=E.target,ee=(ne?.tagName||"").toLowerCase(),he=ne?.isContentEditable||ee==="input"||ee==="textarea"||ee==="select";if(E.key==="Backspace"){he||(E.preventDefault(),E.stopPropagation());return}if(E.key==="Escape"){E.preventDefault(),E.stopPropagation();return}E.key==="Enter"&&!E.shiftKey&&!E.ctrlKey&&!E.metaKey&&!E.altKey&&ee!=="textarea"&&(E.preventDefault(),E.stopPropagation(),se())};return window.addEventListener("keydown",P,{capture:!0}),()=>window.removeEventListener("keydown",P,{capture:!0})},[se]),s.useEffect(()=>{const P=v.current;if(P){const E=setTimeout(()=>{try{P.focus()}catch{}},0);return()=>clearTimeout(E)}},[c?.id]),s.useEffect(()=>{const P=x.current;if(!P)return;const E=()=>{M.current&&clearTimeout(M.current),b.current&&clearTimeout(b.current),y(!1),M.current=setTimeout(()=>{y(!0),C("Saved"),b.current=setTimeout(()=>{y(!1),C("")},k)},_)};return P.addEventListener("input",E,!0),()=>{P.removeEventListener("input",E,!0),M.current&&clearTimeout(M.current),b.current&&clearTimeout(b.current)}},[c?.id]),e.jsxs("div",{className:`min-h-screen bg-background ${g} ${U}`,children:[e.jsx("header",{className:"border-b bg-card/40 backdrop-blur-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold",children:"New Podcast Setup"}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx(vc,{largeText:o.largeText,setLargeText:o.setLargeText??(()=>{}),highContrast:o.highContrast,setHighContrast:o.setHighContrast??(()=>{})})})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-8 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[l&&a===1&&e.jsx("div",{className:"text-lg md:text-xl font-semibold","aria-live":"polite",children:`Hi ${l}.  It's great to meet you.`}),e.jsx("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:`Step ${a+1}: ${c?.title||""}${p?` - ${p}`:""}`}),e.jsx("nav",{className:"sr-only","aria-label":"Step Progress",children:e.jsx("ol",{children:t.map((P,E)=>e.jsx("li",{"aria-current":E===a?"step":void 0,children:`Step ${E+1}: ${P.title}`},P.id))})}),e.jsxs("div",{className:"flex items-center gap-2",children:[F?e.jsx(F,{className:"h-5 w-5 text-muted-foreground","aria-hidden":"true"}):e.jsx("span",{className:"inline-block h-5 w-5","aria-hidden":"true"}),e.jsxs("h2",{ref:v,tabIndex:-1,className:"text-lg md:text-xl font-medium flex items-center gap-2",children:[`Step ${a+1}: ${c?.title||""}`,h&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground","aria-hidden":"true",children:[e.jsx(va,{className:"h-3.5 w-3.5"})," Saved"]})]})]}),c?.description&&e.jsx("p",{className:"text-muted-foreground",children:c.description})]}),e.jsx(wc,{keyProp:c?.id,children:e.jsx("div",{ref:x,className:"rounded-[var(--radius)] border bg-card p-4 md:p-6",children:c?.render()})}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[!i&&e.jsxs(A,{variant:"outline",onClick:Z,disabled:a===0,className:"rounded-[var(--radius)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring h-11 min-h-[44px] px-5 btn-outline text-foreground",children:[e.jsx(Yr,{className:"mr-2 h-4 w-4"})," Back"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[I&&!N&&e.jsxs("span",{className:"text-xs text-muted-foreground hidden md:inline-flex items-center gap-1",children:[e.jsx(va,{className:"h-4 w-4"})," You're all set after this"]}),!N&&e.jsx(A,{onClick:se,disabled:!!d,className:"rounded-[var(--radius)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring h-11 min-h-[44px] px-5 btn text-white disabled:opacity-60",children:I?e.jsxs(e.Fragment,{children:["Finish ",e.jsx(hr,{className:"ml-2 h-4 w-4"})]}):e.jsxs(e.Fragment,{children:["Continue ",e.jsx(hr,{className:"ml-2 h-4 w-4"})]})})]})]}),u&&e.jsx("div",{className:"flex justify-end mt-3",children:e.jsx("button",{type:"button",onClick:()=>j?.(),className:"inline-flex items-center rounded-full border border-red-600 text-red-600 px-3 py-1 text-xs bg-white hover:bg-red-50",children:"Exit and Discard"})})]}),e.jsxs("aside",{className:"space-y-4",children:[O&&e.jsxs(Ce,{"data-tour-id":"onboarding-dynamic-guide",children:[e.jsxs(Je,{className:"flex flex-row items-center gap-2 pb-2",children:[(z||ra)&&e.jsx("div",{className:"rounded-full bg-primary/10 p-2 text-primary",children:z?e.jsx(z,{className:"h-5 w-5","aria-hidden":"true"}):e.jsx(ra,{className:"h-5 w-5","aria-hidden":"true"})}),e.jsx(Xe,{className:"text-base",children:O.headline})]}),e.jsxs(Ae,{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:O.summary}),Array.isArray(O.steps)&&O.steps.length>0&&e.jsx("ul",{className:"space-y-2 rounded-md border border-dashed border-muted-foreground/40 bg-muted/40 p-3 text-sm",children:O.steps.map((P,E)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Zl,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-primary","aria-hidden":"true"}),e.jsx("span",{children:P})]},E))})]})]}),e.jsxs(Ce,{children:[e.jsxs(Je,{className:"flex flex-row items-center gap-2 pb-2",children:[e.jsx(eo,{className:"h-5 w-5 text-primary"}),e.jsx(Xe,{className:"text-base",children:"Helpful tip"})]}),e.jsx(Ae,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:c?.tip||O?.summary||"Short and sweet: you can change this later in Settings."})})]}),e.jsxs(Ce,{children:[e.jsxs(Je,{className:"flex flex-row items-center gap-2 pb-2",children:[e.jsx(Ds,{className:"h-5 w-5 text-primary"}),e.jsx(Xe,{className:"text-base",children:"Need a hand?"})]}),e.jsxs(Ae,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"We're here to help. Browse quick guides or reach out."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",className:"rounded-[var(--radius)] h-11 min-h-[44px] px-5",asChild:!0,children:e.jsx("a",{href:"/help",target:"_blank",rel:"noreferrer",children:"Guides"})}),e.jsx(A,{className:"rounded-[var(--radius)] h-11 min-h-[44px] px-5 text-white",asChild:!0,children:e.jsx("a",{href:"mailto:support@example.com",children:"Contact"})}),e.jsx(A,{variant:"secondary",className:"rounded-[var(--radius)] h-11 min-h-[44px] px-5",onClick:()=>{if(window.confirm("You can skip this for now, but you will either have to complete this later or enter in everything manually to create podcast episodes.")){try{localStorage.setItem("ppp.onboarding.completed","1")}catch{}try{localStorage.removeItem("ppp.onboarding.step")}catch{}try{window.location.assign("/dashboard?onboarding=0")}catch{}}},children:"Skip for now"})]})]})]})]})]})]})}const Nc=[{key:"solo",label:"Solo Monologue",desc:"You sharing insights, tips, or stories."},{key:"interview",label:"Interview",desc:"You interviewing a different guest each episode."},{key:"cohost",label:"Co-Hosts",desc:"Conversational show with a consistent co-host."},{key:"panel",label:"Panel / Roundtable",desc:"Group discussion with multiple recurring voices."},{key:"narrative",label:"Narrative / Story",desc:"Scripted or documentary style storytelling."}],Tr={id:"none",display_name:"No Music",mood_tags:[]};function Ui(){const{token:t,user:a,refreshUser:r}=Ht(),{toast:n}=Lt(),o="ppp.onboarding.step",[l]=s.useState(()=>{try{return new URLSearchParams(window.location.search).get("from")==="manager"}catch{return!1}}),[d,N]=s.useState(()=>{try{const X=localStorage.getItem(o),ze=X!=null?parseInt(X,10):0;return Number.isFinite(ze)&&ze>=0?ze:0}catch{return 0}}),i=s.useRef(null),u=s.useRef(null),{largeText:j,setLargeText:c,highContrast:m,setHighContrast:I}=Xr(),[x,v]=s.useState("new"),[_,k]=s.useState({podcastName:"",podcastDescription:"",coverArt:null,elevenlabsApiKey:""}),[h,y]=s.useState(!!a?.spreaker_access_token),[p,C]=s.useState(!1),[M,b]=s.useState(!1),[g,U]=s.useState("solo"),[se,Z]=s.useState("Monday"),[F,re]=s.useState(""),[O,z]=s.useState(null),[P,E]=s.useState(!1),[ne,ee]=s.useState(!1),[he,D]=s.useState(!1),[H,ge]=s.useState(!1),[V,je]=s.useState([Tr]),[_e,T]=s.useState(!1),[K,le]=s.useState("none"),[me,te]=s.useState(null),Ne=s.useRef(null),Be=s.useRef(null),[ke,De]=s.useState(!1),[B,xe]=s.useState(!1),[ie,W]=s.useState(""),[Pe,Ue]=s.useState(1),[$e,Fe]=s.useState(""),[Ge,ct]=s.useState([]),[et,dt]=s.useState([]),[jt,xt]=s.useState(!1),[R,ye]=s.useState(()=>a?.first_name||""),[ae,f]=s.useState(()=>a?.last_name||""),[Y,Q]=s.useState(""),[ue,Ie]=s.useState(!1),Re=s.useRef(null),Le=s.useRef(null),[nt,He]=s.useState(null),[it,w]=s.useState("crop"),[q,S]=s.useState("tts"),[$,J]=s.useState("tts"),[Se,We]=s.useState("Welcome to my podcast!"),[Ve,lt]=s.useState("Thank you for listening and see you next time!"),[Ct,Et]=s.useState(null),[ut,mt]=s.useState(null),[we,Ee]=s.useState(null),[Me,Ze]=s.useState(null),[tt,ot]=s.useState([]),[ft,Rt]=s.useState([]),[Tt,Gt]=s.useState(""),[hs,ps]=s.useState(""),[os,_s]=s.useState([]),[At,vt]=s.useState(!1),[Ss,us]=s.useState(""),[bt,zt]=s.useState("default"),js=s.useRef(null),[es,xs]=s.useState(!1),[Is,Os]=s.useState(!1),[ls,fs]=s.useState(null),[ms,Wa]=s.useState(null),[gs,Js]=s.useState(""),[Ts,Sa]=s.useState(""),[la,qa]=s.useState(!1),rs=(X,ze=!0)=>{try{let de=String(X||"");if(typeof X=="object"&&X&&(de=X.display_name||X.original_name||X.filename||X.name||X.id||""),de=de.split(/[\\/]/).pop(),de=de.replace(/\.[a-z0-9]{2,4}$/i,""),de=de.replace(/^(?:[a-f0-9]{8,}|[a-f0-9-]{8,})[_-]+/i,""),de=de.replace(/[._-]+/g," "),de=de.trim().replace(/\s+/g," "),de=de.toLowerCase(),de.length&&(de=de[0].toUpperCase()+de.slice(1)),!ze)return de;let Qe=0,Te=de.length;for(let Nt=0;Nt<de.length;Nt++)if(/[a-z0-9]/i.test(de[Nt])&&Qe++,Qe>=25){let Ut=Nt+1;for(;Ut<de.length&&/[a-z0-9]/i.test(de[Ut]);)Ut++;Te=Ut;break}const rt=de.slice(0,Te);return Te<de.length?`${rt}…`:rt}catch{return String(X||"")}},oa=X=>{if(!X||X==="default")return null;const ze=de=>de?.voice_id||de?.id||de?.name;return os.find(de=>ze(de)===X)||null},jr=()=>{try{if(es&&js.current){js.current.pause(),xs(!1);return}const X=oa(bt),ze=X?.preview_url||X?.sample_url;if(!ze)return;if(js.current)try{js.current.pause()}catch{}const de=new Audio(ze);js.current=de,xs(!0),de.onended=()=>{xs(!1)},de.play().catch(()=>xs(!1))}catch{xs(!1)}},Va=s.useMemo(()=>[{id:"rss",title:"Import from RSS",description:"Paste your feed URL."},{id:"confirm",title:"Confirm import",description:"We'll mirror your setup and assets."},{id:"importing",title:"Importing...",description:"Fetching episodes and metadata."},{id:"analyze",title:"Analyzing",description:"We'll bring over what we can, and you can tidy later."},{id:"assets",title:"Assets",description:"We'll bring over what we can, and you can tidy later."},{id:"importSuccess",title:"Imported",description:"Your show is now in Podcast Plus Plus."}],[]),Qs=s.useMemo(()=>{const de=[{id:"yourName",title:"What can we call you?",description:"First name required; last name optional. You can update this later in Settings.",validate:async()=>{const rt=(R||"").trim(),Nt=(ae||"").trim();if(!rt)return Q("First name is required"),!1;Q("");try{await G(t).patch("/api/auth/users/me/prefs",{first_name:rt,last_name:Nt||void 0});try{r?.({force:!0})}catch{}}catch{}return!0},render:()=>e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(ve,{htmlFor:"firstName",className:"text-right",children:["First name",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(Ye,{id:"firstName",value:R,onChange:rt=>ye(rt.target.value),className:"col-span-3",placeholder:"e.g., Alex"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ve,{htmlFor:"lastName",className:"text-right",children:"Last name"}),e.jsx(Ye,{id:"lastName",value:ae,onChange:rt=>f(rt.target.value),className:"col-span-3",placeholder:"(Optional)"})]}),Y&&e.jsx("p",{className:"text-sm text-red-600",children:Y})]})},{id:"choosePath",title:"Do you have an existing podcast?",description:"Start fresh, or import an existing show if you already have one."},{id:"showDetails",title:"About your show",description:"Tell us the name and what it's about. You can change this later."},{id:"format",title:"Format",description:"How will most episodes feel?"},{id:"coverArt",title:"Podcast Cover Art (optional)",description:"Upload your podcast cover art. A square picture at least 1400 pixels wide works best. If you don't have one yet, you can skip this for now."},...he?[{id:"skipNotice",title:"Skipping ahead",description:"We imported your show. We'll jump to Step 6 so you can finish setup."}]:[],{id:"introOutro",title:"Intro & Outro",description:"Create simple intro/outro audio now, or upload files if you have them."},...Is?[{id:"ttsReview",title:"Review your intro & outro",description:"Please review these and make sure they are okay."}]:[],{id:"music",title:"Music (optional)",description:"Pick intro/outro music (optional)."},{id:"spreaker",title:"Connect to Podcast Host",description:"We partner with Spreaker to host your podcast."},{id:"publishCadence",title:"How often will you publish?",description:"We ask to help keep you on track for publishing consistently"},{id:"publishSchedule",title:"Publishing days",description:"Pick your publishing days/dates. You can change this later."},{id:"finish",title:"Finish",description:"Nice work. You can publish now or explore your dashboard."}];let Qe=l?de.filter(rt=>rt.id!=="yourName"):de;return l&&h&&(Qe=Qe.filter(rt=>rt.id!=="spreaker")),ie!=="day"&&ie!=="year"?Qe:Qe.filter(rt=>rt.id!=="publishSchedule")},[R,ae,Y,ie,x,t,r,l,h,he,Is]),ts=s.useMemo(()=>x==="import"?Va:Qs,[x,Va,Qs]),zs=s.useMemo(()=>{const X=Qs.findIndex(ze=>ze.id==="introOutro");return X>=0?X:0},[Qs]),Ft=ts[d]?.id,[Ya,Ha]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const X=await G(t).get("/api/podcasts/"),ze=Array.isArray(X)?X:X?.items||[];Ha(ze.length>0)}catch{Ha(!1)}})()},[t]);const Ga=s.useRef(!1);s.useEffect(()=>{if(!Ga.current){Ga.current=!0;try{const X=new URL(window.location.href),ze=X.searchParams.get("from")==="manager";if(X.searchParams.get("reset")==="1"||X.searchParams.get("reset")==="true")try{localStorage.removeItem(o)}catch{}const Qe=X.searchParams.get("step"),Te=Qe!=null?parseInt(Qe,10):NaN;if(Number.isFinite(Te)&&Te>=1){const rt=Math.min(Math.max(1,Te),ts.length)-1;N(rt)}else if(ze){const rt=ts.findIndex(Nt=>Nt.id==="choosePath");N(rt>=0?rt:0)}}catch{}}},[ts.length]),s.useEffect(()=>{const X=Math.max(0,ts.length-1);d>X&&N(X)},[ts.length]),s.useEffect(()=>(i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{try{localStorage.setItem(o,String(d))}catch{}},350),()=>{i.current&&clearTimeout(i.current)}),[d]),s.useEffect(()=>{if(Ft==="music"&&V.length<=1&&!_e&&(T(!0),(async()=>{try{const ze=await G(t).get("/api/music/assets"),de=Array.isArray(ze?.assets)?ze.assets:[];je([Tr,...de])}catch{je([Tr])}finally{T(!1)}})()),Ft!=="music"&&Ne.current){try{Ne.current.pause()}catch{}Ne.current=null,te(null)}},[Ft,V.length,_e]),s.useEffect(()=>{if(Ft==="introOutro"&&!At&&os.length===0&&(vt(!0),us(""),(async()=>{try{const X=await G(t).get("/api/elevenlabs/voices?size=12"),ze=X&&(X.items||X.voices)||[];if(_s(ze),ze.length>0&&(!bt||bt==="default")){const de=ze[0];zt(de.voice_id||de.id||de.name||"default")}}catch{us("Voice list unavailable; using a default voice.")}finally{vt(!1)}})()),Ft==="introOutro"&&tt.length===0&&ft.length===0&&(async()=>{try{const X=await G(t).get("/api/media/"),ze=Array.isArray(X)?X:X?.items||[],de=ze.filter(Te=>(Te?.category||"").toLowerCase()==="intro"),Qe=ze.filter(Te=>(Te?.category||"").toLowerCase()==="outro");if(ot(de),Rt(Qe),de.length>0){const Te=de[0];Gt(String(Te.id||Te.filename)),Ee(Te),S(rt=>rt==="tts"||rt==="upload"?"existing":rt)}if(Qe.length>0){const Te=Qe[0];ps(String(Te.id||Te.filename)),Ze(Te),J(rt=>rt==="tts"||rt==="upload"?"existing":rt)}}catch{}})(),Ft!=="introOutro"&&js.current){try{js.current.pause()}catch{}xs(!1)}if(Ft!=="introOutro"&&Be.current){try{Be.current.pause()}catch{}De(!1),xe(!1)}},[Ft,At,os.length,bt,t,tt.length,ft.length]),s.useEffect(()=>{Ft==="introOutro"&&(async()=>{try{const X=await G(t).get("/api/podcasts/"),ze=Array.isArray(X)?X:X?.items||[],de=await G(t).get("/api/media/"),Qe=Array.isArray(de)?de:de?.items||[],Te=Qe.some(Nt=>(Nt?.category||"").toLowerCase()==="intro"),rt=Qe.some(Nt=>(Nt?.category||"").toLowerCase()==="outro");qa(ze.length===0&&!Te&&!rt)}catch{qa(!1)}})()},[Ft,t]);const ca=X=>{try{let ze=null;if(Is?ze=X==="intro"?ls||we:ms||Me:ze=X==="intro"?tt.find(Te=>String(Te.id||Te.filename)===Tt)||we||null:ft.find(Te=>String(Te.id||Te.filename)===hs)||Me||null,!ze)return;const de=async()=>{if(ze.id)try{const rt=await G(t).get(`/api/media/preview?id=${encodeURIComponent(ze.id)}&resolve=true`);return rt?.path||rt?.url||ze.preview_url||ze.url||ze.filename||null}catch{}return ze.preview_url||ze.url||ze.filename||null};(async()=>{let Te=await de();if(!Te){n?.({title:"No audio",description:"Could not determine preview URL",variant:"destructive"});return}if(/^https?:\/\//i.test(Te)||(Te=Vt(Te.startsWith("/")?Te:`/${Te}`)),(X==="intro"?ke:B)&&Be.current){try{Be.current.pause()}catch{}Be.current=null,De(!1),xe(!1);return}if(Be.current)try{Be.current.pause()}catch{}const Nt=new Audio(Te);try{const Ut=Vt("/").replace(/\/+$|^https?:\/\/|\/$/g,"").replace(/^[^/]*\/\//,""),Ps=Ut.includes("//")?new URL(Ut).host:Ut,ss=new URL(Te,window.location.origin).host;Ps&&ss&&Ps===ss&&(Nt.crossOrigin="anonymous")}catch{}Be.current=Nt,De(X==="intro"),xe(X==="outro"),Nt.onended=()=>{De(!1),xe(!1)},Nt.onerror=()=>{De(!1),xe(!1),n?.({title:"Playback failed",description:"Could not play audio preview",variant:"destructive"})},Nt.play().catch(Ut=>{De(!1),xe(!1),n?.({title:"Playback blocked",description:Ut?.message||"User gesture or CORS issue",variant:"destructive"})})})()}catch{De(!1),xe(!1)}},vr=X=>{if(!X||X.id==="none")return;const ze=X.preview_url||X.url||X.filename;if(ze){if(me===X.id){try{Ne.current?.pause()}catch{}Ne.current=null,te(null);return}try{if(Ne.current)try{Ne.current.pause()}catch{}const de=new Audio(ze);Ne.current=de,te(X.id);const Qe=20,Te=()=>{!de||isNaN(de.currentTime)||de.currentTime>=Qe&&(de.pause(),te(null),de.removeEventListener("timeupdate",Te))};de.addEventListener("timeupdate",Te),de.onended=()=>{te(null);try{de.removeEventListener("timeupdate",Te)}catch{}},de.play().catch(()=>{te(null)})}catch{te(null)}}},Ca=X=>{const{id:ze,value:de,files:Qe}=X.target;k(Te=>({...Te,[ze]:Qe?Qe[0]:de}))};async function wr(){try{if(!t)throw new Error("Not signed in");const X=new URLSearchParams({access_token:t}).toString(),ze=Vt(`/api/auth/spreaker/start?${X}`),de=window.open(ze,"spreakerAuth","width=600,height=700");b(!0);const Qe=setInterval(()=>{(!de||de.closed)&&(clearInterval(Qe),G(t).get("/api/auth/users/me").then(Te=>{Te?.spreaker_access_token&&y(!0)}).catch(()=>{}))},1e3)}catch(X){try{n({title:"Connection Error",description:X.message,variant:"destructive"})}catch{}}}const Ka=()=>{if(!Ya)return;const X=Qs.findIndex(de=>de.id==="introOutro");if(!(X>=0&&d>=X&&!window.confirm("Exit and discard your onboarding changes?"))){try{localStorage.removeItem("ppp.onboarding.step")}catch{}try{window.location.replace("/?onboarding=0")}catch{}}};async function da(X,ze,de,Qe){try{if(ze==="upload"){if(!Qe)return null;const Te=new FormData;Te.append("files",Qe);const rt=await G(t).raw(`/api/media/upload/${X}`,{method:"POST",body:Te});return Array.isArray(rt)&&rt.length>0?rt[0]:null}else{const Te={text:(de||"").trim()||(X==="intro"?"Welcome to my podcast!":"Thank you for listening and see you next time!"),category:X};return bt&&bt!=="default"&&(Te.voice_id=bt),la&&(Te.free_override=!0),await G(t).post("/api/media/tts",Te)||null}}catch(Te){try{n({title:`Could not prepare ${X}`,description:Te?.message||String(Te),variant:"destructive"})}catch{}return null}}async function Bs(){try{C(!0);let X=null,ze=[];try{const de=await G(t).get("/api/podcasts/");ze=Array.isArray(de)?de:de?.items||[]}catch{ze=[]}if(_.elevenlabsApiKey)try{await G(t).put("/api/users/me/elevenlabs-key",{api_key:_.elevenlabsApiKey})}catch{}if(x==="new"&&ze.length===0){const de=new FormData;if(de.append("name",_.podcastName),de.append("description",_.podcastDescription),_.coverArt)try{const Te=await Le.current?.getProcessedBlob?.();if(Te){const rt=new File([Te],"cover.jpg",{type:"image/jpeg"});de.append("cover_image",rt)}else de.append("cover_image",_.coverArt)}catch{de.append("cover_image",_.coverArt)}const Qe=await G(t).raw("/api/podcasts/",{method:"POST",body:de});if(!Qe||!Qe.id){let Te="";try{Te=Qe&&Qe.detail?Qe.detail:JSON.stringify(Qe||{})}catch{}throw new Error(Te||"Failed to create the podcast show.")}X=Qe;try{n({title:"Success!",description:"Your new podcast show has been created."})}catch{}try{const Te=[];we?.filename&&Te.push({segment_type:"intro",source:{source_type:"static",filename:we.filename}}),Te.push({segment_type:"content",source:{source_type:"tts",script:"",voice_id:bt&&bt!=="default"?bt:"default"}}),Me?.filename&&Te.push({segment_type:"outro",source:{source_type:"static",filename:Me.filename}});const rt=[],Nt=(V||[]).find(ss=>ss.id===K&&ss.id!=="none");Nt&&Nt.filename&&(rt.push({music_filename:Nt.filename,apply_to_segments:["intro"],start_offset_s:0,end_offset_s:1,fade_in_s:1.5,fade_out_s:2,volume_db:-4}),rt.push({music_filename:Nt.filename,apply_to_segments:["outro"],start_offset_s:-10,end_offset_s:0,fade_in_s:3,fade_out_s:1,volume_db:-4}));const Ps={name:"My First Template",podcast_id:(X||(ze.length>0?ze[ze.length-1]:null))?.id,segments:Te,background_music_rules:rt,timing:{content_start_offset_s:0,outro_start_offset_s:0},is_active:!0,default_elevenlabs_voice_id:bt&&bt!=="default"?bt:null};try{await G(t).post("/api/templates/",Ps)}catch(ss){try{n({title:"Template not saved",description:ss?.message||"We could not save your default template.",variant:"destructive"})}catch{}}}catch{}}else{const de=ze.length>0?ze[ze.length-1]:null;if(de)try{const Qe=[];we?.filename&&Qe.push({segment_type:"intro",source:{source_type:"static",filename:we.filename}}),Qe.push({segment_type:"content",source:{source_type:"tts",script:"",voice_id:bt&&bt!=="default"?bt:"default"}}),Me?.filename&&Qe.push({segment_type:"outro",source:{source_type:"static",filename:Me.filename}});const Te={name:"My First Template",podcast_id:de.id,segments:Qe,background_music_rules:[],timing:{content_start_offset_s:0,outro_start_offset_s:0},is_active:!0,default_elevenlabs_voice_id:bt&&bt!=="default"?bt:null};await G(t).post("/api/templates/",Te)}catch(Qe){try{n({title:"Template not saved",description:Qe?.message||"We could not save your default template.",variant:"destructive"})}catch{}}try{n({title:"Imported",description:"Your show has been imported."})}catch{}}try{localStorage.removeItem("ppp.onboarding.step"),localStorage.setItem("ppp.onboarding.completed","1")}catch{}try{window.location.replace("/?onboarding=0")}catch{}}catch(X){try{n({title:"An Error Occurred",description:X.message,variant:"destructive"})}catch{}}finally{C(!1)}}const Ja=ts.map((X,ze)=>({id:X.id,title:X.title,description:X.description,tip:X.id==="yourName"?"We'll use this to personalize your dashboard.":X.id==="choosePath"?"If you have an existing podcast, import it here.":X.id==="showDetails"?"Short and clear works best.":X.id==="format"?"This is for your reference.":X.id==="coverArt"?"No artwork yet? You can skip this for now.":X.id==="introOutro"?"Start with our default scripts or upload your own audio.":X.id==="music"?"This is background music for your intro and outro. It can be changed or removed at any time.":X.id==="spreaker"?"Click connect to open a popup; you can come back to this later.":X.id==="publishCadence"?"We ask to help keep you on track for publishing consistently":X.id==="publishSchedule"?"Consistency is more important than volume for a successful podcast":X.id==="rss"?"Paste your feed URL.":X.id==="analyze"||X.id==="assets"?"We'll bring over what we can, and you can tidy later.":X.id==="finish"?"There's a short tour next if you'd like it.":"",render:()=>{switch(X.id){case"yourName":return new URLSearchParams(window.location.search).get("from")==="manager"?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Skipping…"}):e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(ve,{htmlFor:"firstName",className:"text-right",children:["First name",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(Ye,{id:"firstName",value:R,onChange:pe=>ye(pe.target.value),className:"col-span-3",placeholder:"e.g., Alex"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ve,{htmlFor:"lastName",className:"text-right",children:"Last name"}),e.jsx(Ye,{id:"lastName",value:ae,onChange:pe=>f(pe.target.value),className:"col-span-3",placeholder:"(Optional)"})]}),Y&&e.jsx("p",{className:"text-sm text-red-600",children:Y})]});case"choosePath":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx(A,{variant:x==="new"?"default":"outline",onClick:()=>{v("new"),N(ze+1)},children:"Start new"}),e.jsx(A,{variant:x==="import"?"default":"outline",onClick:()=>{v("import"),N(0)},children:"Import existing"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"You can't break anything. We save as you go."})]});case"showDetails":return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(ve,{htmlFor:"podcastName",className:"text-right",children:["Name",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(Ye,{id:"podcastName",value:_.podcastName,onChange:Ca,placeholder:"e.g., 'The Morning Cup'"}),(_.podcastName||"").trim().length>0&&(_.podcastName||"").trim().length<4&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Name must be at least 4 characters"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(ve,{htmlFor:"podcastDescription",className:"text-right",children:["Description",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(bs,{id:"podcastDescription",value:_.podcastDescription,onChange:Ca,className:"col-span-3",placeholder:"e.g., 'A daily podcast about the latest tech news.'"})]})]});case"format":return e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"grid gap-3",children:Nc.map(pe=>e.jsxs("label",{className:`border rounded p-3 cursor-pointer flex gap-3 ${g===pe.key?"border-blue-600 ring-1 ring-blue-400":"hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"format",className:"mt-1",value:pe.key,checked:g===pe.key,onChange:()=>U(pe.key)}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:pe.label}),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-muted-foreground",children:pe.desc})]})]},pe.key))})});case"coverArt":return e.jsxs("div",{className:"space-y-4",children:[!_.coverArt&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{htmlFor:"coverArt",className:"",children:"Image"}),e.jsxs("div",{children:[e.jsx(Ye,{ref:Re,id:"coverArt",type:"file",onChange:Ca,accept:"image/png, image/jpeg,image/jpg"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"You can crop your image if it's not the right size."})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{id:"skipCoverNow",type:"checkbox",checked:ue,onChange:pe=>Ie(pe.target.checked)}),e.jsx(ve,{htmlFor:"skipCoverNow",children:"Skip this for now"})]})]}),_.coverArt&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(ve,{className:"text-right",children:"Adjust"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(br,{ref:Le,sourceFile:_.coverArt,existingUrl:null,value:nt,onChange:pe=>He(pe),onModeChange:pe=>w(pe)}),e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsx(A,{type:"button",variant:"outline",onClick:()=>{k(pe=>({...pe,coverArt:null})),He(null)},children:"Remove"})})]})]})})]});case"introOutro":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"Intro"}),e.jsxs("div",{className:"flex gap-3 items-center",children:[tt.length>0&&e.jsxs("label",{className:`border rounded p-2 cursor-pointer ${q==="existing"?"border-blue-600":"hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"introMode",value:"existing",checked:q==="existing",onChange:()=>S("existing")}),e.jsx("span",{className:"ml-2",children:e.jsx("span",{children:"Use current"})})]}),e.jsxs("label",{className:`border rounded p-2 cursor-pointer ${q==="tts"?"border-blue-600":"hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"introMode",value:"tts",checked:q==="tts",onChange:()=>S("tts")}),e.jsxs("span",{className:"ml-2 inline-flex flex-col items-center text-center",children:[e.jsx("span",{children:"Generate with AI voice"}),e.jsx("span",{className:"text-xs italic text-muted-foreground",children:"(We read your script aloud)"})]})]}),e.jsxs("label",{className:`border rounded p-2 cursor-pointer ${q==="upload"?"border-blue-600":"hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"introMode",value:"upload",checked:q==="upload",onChange:()=>S("upload")}),e.jsx("span",{className:"ml-2",children:"Upload a file"})]})]}),q==="existing"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button","aria-label":ke?"Pause preview":"Play preview",onClick:()=>ca("intro"),className:`inline-flex items-center justify-center h-8 w-8 rounded border ${ke?"bg-blue-600 text-white border-blue-600":"bg-white text-foreground border-muted-foreground/30"}`,title:"Preview",children:ke?e.jsx(vs,{className:"h-4 w-4"}):e.jsx(Xt,{className:"h-4 w-4"})}),e.jsx("select",{className:"border rounded p-2 min-w-[220px]",value:Tt,onChange:pe=>{const ht=pe.target.value;Gt(ht);const gt=tt.find(Pt=>String(Pt.id||Pt.filename)===ht)||null;Ee(gt)},children:tt.map(pe=>{const ht=String(pe.id||pe.filename),gt=pe.display_name||pe.original_name||pe.filename||ht;return e.jsx("option",{value:ht,children:rs(gt,!0)},ht)})})]}),q==="tts"?e.jsx(bs,{value:Se,onChange:pe=>We(pe.target.value),placeholder:"Welcome to my podcast!"}):q==="upload"?e.jsx(Ye,{type:"file",accept:"audio/*",onChange:pe=>Et(pe.target.files?.[0]||null)}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"Outro"}),e.jsxs("div",{className:"flex gap-3 items-center",children:[ft.length>0&&e.jsxs("label",{className:`border rounded p-2 cursor-pointer ${$==="existing"?"border-blue-600":"hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"outroMode",value:"existing",checked:$==="existing",onChange:()=>J("existing")}),e.jsx("span",{className:"ml-2",children:e.jsx("span",{children:"Use current"})})]}),e.jsxs("label",{className:`border rounded p-2 cursor-pointer ${$==="tts"?"border-blue-600":"hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"outroMode",value:"tts",checked:$==="tts",onChange:()=>J("tts")}),e.jsxs("span",{className:"ml-2 inline-flex flex-col items-center text-center",children:[e.jsx("span",{children:"Generate with AI voice"}),e.jsx("span",{className:"text-xs italic text-muted-foreground",children:"(We read your script aloud)"})]})]}),e.jsxs("label",{className:`border rounded p-2 cursor-pointer ${$==="upload"?"border-blue-600":"hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"outroMode",value:"upload",checked:$==="upload",onChange:()=>J("upload")}),e.jsx("span",{className:"ml-2",children:"Upload a file"})]})]}),$==="existing"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button","aria-label":B?"Pause preview":"Play preview",onClick:()=>ca("outro"),className:`inline-flex items-center justify-center h-8 w-8 rounded border ${B?"bg-blue-600 text-white border-blue-600":"bg-white text-foreground border-muted-foreground/30"}`,title:"Preview",children:B?e.jsx(vs,{className:"h-4 w-4"}):e.jsx(Xt,{className:"h-4 w-4"})}),e.jsx("select",{className:"border rounded p-2 min-w-[220px]",value:hs,onChange:pe=>{const ht=pe.target.value;ps(ht);const gt=ft.find(Pt=>String(Pt.id||Pt.filename)===ht)||null;Ze(gt)},children:ft.map(pe=>{const ht=String(pe.id||pe.filename),gt=pe.display_name||pe.original_name||pe.filename||ht;return e.jsx("option",{value:ht,children:rs(gt,!0)},ht)})})]}),$==="tts"?e.jsx(bs,{value:Ve,onChange:pe=>lt(pe.target.value),placeholder:"Thank you for listening and see you next time!"}):$==="upload"?e.jsx(Ye,{type:"file",accept:"audio/*",onChange:pe=>mt(pe.target.files?.[0]||null)}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ve,{className:"",children:"Voice"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{className:"border rounded p-2 min-w-[220px]",value:bt,onChange:pe=>zt(pe.target.value),disabled:At||(os?.length||0)===0,children:[e.jsx("option",{value:"default",children:"Default"}),os.map(pe=>{const ht=pe.voice_id||pe.id||pe.name,gt=pe.name||pe.label||ht;return e.jsx("option",{value:ht,children:gt},ht)})]}),e.jsxs(A,{type:"button",variant:"outline",onClick:jr,disabled:At||!oa(bt)?.preview_url,children:[es?e.jsx(vs,{className:"w-4 h-4 mr-2"}):e.jsx(Xt,{className:"w-4 h-4 mr-2"}),"Preview"]})]})]}),At&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Loading voices…"}),Ss&&e.jsx("div",{className:"text-xs text-yellow-700",children:Ss})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We’ll create simple defaults if you leave the scripts unchanged."})]});case"ttsReview":{const pe=!!ls,ht=!!ms,gt=async(cs,Bt)=>{if(!cs||!Bt)return;const ds=cs.id||cs.media_id;if(ds)try{await G(t).patch(`/api/media/${ds}`,{display_name:Bt})}catch{}},Pt=async cs=>{if(cs){try{ls?.id&&await G(t).delete(`/api/media/${ls.id}`)}catch{}try{ms?.id&&await G(t).delete(`/api/media/${ms.id}`)}catch{}}if(pe){const Bt=await da("intro","tts",Se,null);Bt&&(Ee(Bt),fs(Bt),Js(rs(Bt,!1)))}if(ht){const Bt=await da("outro","tts",Ve,null);Bt&&(Ze(Bt),Wa(Bt),Sa(rs(Bt,!1)))}},qs=()=>N(cs=>Math.min(cs+1,ts.length-1)),Aa=async()=>{pe&&gs&&rs(ls,!1)!==gs&&await gt(ls,gs),ht&&Ts&&rs(ms,!1)!==Ts&&await gt(ms,Ts),Os(!1),qs()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please review these and make sure they are okay."}),e.jsxs("div",{className:"grid gap-4",children:[pe&&e.jsxs("div",{className:"p-3 border rounded",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Intro"}),e.jsx("button",{type:"button","aria-label":ke?"Pause preview":"Play preview",onClick:()=>ca("intro"),className:`inline-flex items-center justify-center h-8 w-8 rounded border ${ke?"bg-blue-600 text-white border-blue-600":"bg-white text-foreground border-muted-foreground/30"}`,children:ke?e.jsx(vs,{className:"h-4 w-4"}):e.jsx(Xt,{className:"h-4 w-4"})})]}),e.jsx(ve,{htmlFor:"renameIntro",className:"text-sm",children:"Name (optional)"}),e.jsx(Ye,{id:"renameIntro",value:gs,onChange:cs=>Js(cs.target.value),placeholder:rs(ls,!1)})]}),ht&&e.jsxs("div",{className:"p-3 border rounded",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Outro"}),e.jsx("button",{type:"button","aria-label":B?"Pause preview":"Play preview",onClick:()=>ca("outro"),className:`inline-flex items-center justify-center h-8 w-8 rounded border ${B?"bg-blue-600 text-white border-blue-600":"bg-white text-foreground border-muted-foreground/30"}`,children:B?e.jsx(vs,{className:"h-4 w-4"}):e.jsx(Xt,{className:"h-4 w-4"})})]}),e.jsx(ve,{htmlFor:"renameOutro",className:"text-sm",children:"Name (optional)"}),e.jsx(Ye,{id:"renameOutro",value:Ts,onChange:cs=>Sa(cs.target.value),placeholder:rs(ms,!1)})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(A,{onClick:Aa,className:"text-white",children:"Continue"}),e.jsx(A,{variant:"secondary",onClick:()=>Pt(!1),children:"Keep and Retry"}),e.jsx(A,{variant:"destructive",onClick:()=>Pt(!0),children:"Discard and Retry"})]})]})}case"music":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:_e?"Loading music...":'Pick a track or choose "No Music".'}),e.jsx("div",{className:"grid gap-2",children:V.map(pe=>{const ht=!!(pe&&pe.id!=="none"&&(pe.preview_url||pe.url||pe.filename)),gt=K===pe.id,Pt=me===pe.id;return e.jsxs("div",{className:`flex items-center gap-3 p-2 rounded border ${gt?"border-blue-600 bg-blue-50":"bg-card hover:border-muted-foreground/30"}`,children:[e.jsx("button",{type:"button","aria-label":Pt?"Pause preview":"Play preview",disabled:!ht,onClick:()=>ht&&vr(pe),className:`inline-flex items-center justify-center h-8 w-8 rounded border ${Pt?"bg-blue-600 text-white border-blue-600":"bg-white text-foreground border-muted-foreground/30"} disabled:opacity-50`,title:ht?"Preview 20s":"Preview not available",children:Pt?e.jsx(vs,{className:"h-4 w-4"}):e.jsx(Xt,{className:"h-4 w-4"})}),e.jsxs("label",{className:"flex items-center gap-3 flex-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"music",value:pe.id,checked:gt,onChange:()=>le(pe.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:pe.display_name}),pe.mood_tags&&pe.mood_tags.length>0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:pe.mood_tags.slice(0,3).join(", ")})]})]})]},pe.id)})})]});case"spreaker":return e.jsx("div",{className:"flex justify-center items-center p-6 bg-accent/30 rounded-[var(--radius)]",children:h?e.jsxs(A,{variant:"secondary",disabled:!0,className:"bg-green-600 text-white hover:bg-green-600",children:[e.jsx(as,{className:"w-5 h-5 mr-2"})," Connected"]}):e.jsx(A,{onClick:wr,className:"text-white",children:"Connect to Podcast Host"})});case"publishDay":return null;case"publishCadence":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"I want to publish"}),e.jsx(Ye,{type:"number",min:1,value:Pe,onChange:pe=>Ue(Math.max(1,parseInt(pe.target.value||"1",10)||1)),className:"w-20"}),e.jsx("span",{className:"text-sm",children:"time(s) every"}),e.jsxs("select",{className:"border rounded p-2",value:ie,onChange:pe=>W(pe.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"select..."}),e.jsx("option",{value:"day",children:"day"}),e.jsx("option",{value:"week",children:"week"}),e.jsx("option",{value:"bi-weekly",children:"bi-weekly"}),e.jsx("option",{value:"month",children:"month"}),e.jsx("option",{value:"year",children:"year"})]})]}),$e&&e.jsx("p",{className:"text-sm text-red-600",children:$e}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We'll tailor the next step based on this."})]});case"publishSchedule":if(ie==="week"){const pe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ht=gt=>ct(Pt=>Pt.includes(gt)?Pt.filter(qs=>qs!==gt):[...Pt,gt]);return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:pe.map(gt=>e.jsx("button",{type:"button",onClick:()=>ht(gt),className:`border rounded p-2 text-center ${Ge.includes(gt)?"border-blue-600 ring-1 ring-blue-400":"hover:border-gray-400"}`,children:gt},gt))}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{id:"notSureSchedule",type:"checkbox",checked:jt,onChange:gt=>xt(gt.target.checked)}),e.jsx(ve,{htmlFor:"notSureSchedule",children:"I'm not sure yet"})]})]})}const de=(()=>{const pe=new Date;return new Date(pe.getFullYear(),pe.getMonth(),pe.getDate())})(),Qe=new Date(de.getFullYear(),de.getMonth(),1),Te=new Date(de.getFullYear(),de.getMonth()+1,1),rt=new Date(de.getFullYear(),de.getMonth()+1,0),Nt=(()=>{const pe=new Date(Te),ht=pe.getDay(),gt=new Date(pe);return gt.setDate(pe.getDate()-ht),gt})(),Ut=new Date(Nt.getFullYear(),Nt.getMonth(),Nt.getDate()+6),Ps=(()=>{const pe=[];for(let ht=de.getDate();ht<=rt.getDate();ht++)pe.push(new Date(de.getFullYear(),de.getMonth(),ht));return pe})(),ss=Ps.length>0&&Ps.every(pe=>pe>=Nt&&pe<=Ut),ka=ss?[Te]:[Qe,Te],_r=(pe,ht)=>new Date(pe,ht+1,0).getDate(),ua=pe=>String(pe).padStart(2,"0"),Ea=pe=>`${pe.getFullYear()}-${ua(pe.getMonth()+1)}-${ua(pe.getDate())}`,Ws=pe=>dt(ht=>ht.includes(pe)?ht.filter(gt=>gt!==pe):[...ht,pe]),Ms=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs("div",{className:"space-y-4",children:[ka.map((pe,ht)=>{const gt=pe.getFullYear(),Pt=pe.getMonth(),qs=Pt===Te.getMonth()&&gt===Te.getFullYear(),Aa=_r(gt,Pt),Bt=new Date(gt,Pt,1).getDay(),ds=[];if(qs&&ss)for(let It=0;It<Bt;It++){const ys=new Date(gt,Pt,1-(Bt-It));if(ys>=de&&ys>=Nt&&ys<=Ut){const ma=Ea(ys);ds.push({key:ma,iso:ma,day:ys.getDate(),carry:!0})}else ds.push({key:`b-${It}`,blank:!0})}else for(let It=0;It<Bt;It++)ds.push({key:`b-${It}`,blank:!0});for(let It=1;It<=Aa;It++){const ys=new Date(gt,Pt,It);if(ys<de&&Pt===de.getMonth()&&gt===de.getFullYear()){ds.push({key:`p-${It}`,blank:!0});continue}const ma=Ea(ys);ds.push({key:ma,iso:ma,day:It})}for(;ds.length%7!==0;)ds.push({key:`t-${ds.length}`,blank:!0});return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium text-sm",children:pe.toLocaleString(void 0,{month:"long",year:"numeric"})}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-[11px] text-muted-foreground",children:Ms.map(It=>e.jsx("div",{className:"py-1 text-center",children:It},It))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:ds.map(It=>{if(It.blank)return e.jsx("div",{className:"p-2"},It.key);const ys=et.includes(It.iso);return e.jsx("button",{type:"button",onClick:()=>Ws(It.iso),className:`border rounded p-2 text-center text-xs ${ys?"border-blue-600 ring-1 ring-blue-400":"hover:border-gray-400"}`,children:It.day},It.key)})})]},ht)}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{id:"notSureSchedule2",type:"checkbox",checked:jt,onChange:pe=>xt(pe.target.checked)}),e.jsx(ve,{htmlFor:"notSureSchedule2",children:"I'm not sure yet"})]})]});case"finish":return e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Finish"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nice work. You can publish now or explore your dashboard."}),p&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Working..."})]});case"rss":return e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ve,{htmlFor:"rssUrl",className:"text-right",children:"RSS URL"}),e.jsx(Ye,{id:"rssUrl",value:F,onChange:pe=>re(pe.target.value),className:"col-span-3",placeholder:"https://example.com/feed.xml"})]})});case"confirm":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm",children:"We'll import episodes and assets from:"}),e.jsx("div",{className:"p-3 rounded border bg-accent/30 text-sm break-all",children:F||"-"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Click Continue to start the import."})]});case"importing":return e.jsx("div",{className:"text-sm",children:"Importing... This may take a moment."});case"analyze":return e.jsx("div",{className:"text-sm",children:"Analyzing your feed and extracting settings..."});case"assets":return e.jsx("div",{className:"text-sm",children:"Pulling cover art and audio assets..."});case"importSuccess":return e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Imported"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your show is in Podcast Plus Plus. We'll continue the setup from step 6 so you can fine-tune everything."})]});default:return null}},validate:X.validate?X.validate:X.id==="publishCadence"?async()=>ie?ie==="bi-weekly"&&Number(Pe)!==1?(Fe("For bi-weekly, X must be 1."),!1):(Fe(""),!0):(Fe("Please choose a frequency."),!1):X.id==="publishSchedule"?async()=>jt?!0:!(ie==="week"&&Ge.length===0||(ie==="bi-weekly"||ie==="month")&&et.length===0):X.id==="confirm"&&x==="import"?async()=>{const de=(F||"").trim();if(!de)return n({variant:"destructive",title:"RSS feed required",description:"Please enter your feed URL before continuing."}),!1;ee(!0);try{const Te=await G(t).post("/api/import/rss",{rss_url:de});z(Te),re(de);const rt=Te?.podcast_name||Te?.title||Te?.name||"",Nt=Te?.description||Te?.summary||"";return k(Ut=>({...Ut,podcastName:rt||Ut.podcastName||"",podcastDescription:Nt||Ut.podcastDescription||""})),Ie(!0),E(!0),!0}catch(Qe){const Te=Qe?.detail||Qe?.message||"Failed to import RSS feed.";return n({variant:"destructive",title:"Import failed",description:Te}),z(null),E(!1),!1}finally{ee(!1)}}:X.id==="showDetails"?async()=>{const Qe=(_.podcastName||"").trim().length>=4,Te=(_.podcastDescription||"").trim().length>0;return Qe&&Te}:X.id==="coverArt"?async()=>!!(_.coverArt||ue):X.id==="introOutro"?async()=>{let de=null,Qe=null;if(q==="upload"&&!Ct||$==="upload"&&!ut)return!1;if(!we){const Te=await da("intro",q,Se,Ct);Te&&(Ee(Te),de=Te)}if(!Me){const Te=await da("outro",$,Ve,ut);Te&&(Ze(Te),Qe=Te)}return(de||Qe)&&(fs(de||ls),Wa(Qe||ms),Js(de?rs(de,!1):gs),Sa(Qe?rs(Qe,!1):Ts),Os(!0)),!0}:X.id==="spreaker"?async()=>!!M||!!h:void 0}));s.useEffect(()=>{let X;return x==="import"&&(Ft==="importing"?X=setTimeout(()=>N(ze=>Math.min(ze+1,ts.length-1)),1e3):Ft==="analyze"?X=setTimeout(()=>N(ze=>Math.min(ze+1,ts.length-1)),800):Ft==="assets"&&(X=setTimeout(()=>N(ze=>Math.min(ze+1,ts.length-1)),800))),()=>{X&&clearTimeout(X)}},[x,Ft,ts.length]),s.useEffect(()=>{const X=P&&x==="import"&&Ft==="importSuccess";if(X&&!u.current){const ze=zs>=0?zs:0;u.current=window.setTimeout(()=>{u.current=null,E(!1),v("new"),D(!0),ge(!0),N(ze);const de=O?.podcast_name||O?.title||O?.name||_.podcastName||"your show";n({title:"Import complete",description:`We pulled in ${de}. Continue with the rest of the setup.`})},600)}else!X&&u.current&&(clearTimeout(u.current),u.current=null);return()=>{u.current&&(clearTimeout(u.current),u.current=null)}},[P,x,Ft,zs,O,_.podcastName,n,N,v,E]);const{nextDisabled:Qa,hideNext:Nr}=s.useMemo(()=>{let X=!1,ze=!1;switch(Ft){case"skipNotice":{X=!1;break}case"choosePath":ze=!0;break;case"ttsReview":{ze=!0;break}case"confirm":{x==="import"&&(X=ne);break}case"yourName":{X=!(R||"").trim();break}case"showDetails":{const de=(_.podcastName||"").trim().length>=4,Qe=(_.podcastDescription||"").trim().length>0;X=!(de&&Qe);break}case"coverArt":{X=!(_.coverArt||ue);break}case"spreaker":{X=!(M||h);break}case"publishCadence":{X=!ie||ie==="bi-weekly"&&Number(Pe)!==1;break}case"publishSchedule":{jt||(ie==="week"?X=Ge.length===0:(ie==="bi-weekly"||ie==="month")&&(X=et.length===0));break}}return{nextDisabled:!!X,hideNext:!!ze}},[Ft,x,ne,R,_.podcastName,_.podcastDescription,_.coverArt,ue,M,h,ie,Pe,jt,Ge.length,et.length]);return s.useEffect(()=>{if(Ft!=="skipNotice")return;const X=setTimeout(()=>{N(ze=>Math.min(ze+1,ts.length-1))},900);return()=>clearTimeout(X)},[Ft,ts.length,N]),e.jsx(Li,{steps:Ja,index:d,setIndex:N,onComplete:Bs,prefs:{largeText:j,setLargeText:c,highContrast:m,setHighContrast:I},greetingName:R?.trim()||"",nextDisabled:Qa,hideNext:Nr,hideBack:H&&Ft==="introOutro",showExitDiscard:Ya,onExitDiscard:Ka})}const Oa=s.forwardRef(({className:t,...a},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:at("w-full caption-bottom text-sm",t),...a})}));Oa.displayName="Table";const za=s.forwardRef(({className:t,...a},r)=>e.jsx("thead",{ref:r,className:at("[&_tr]:border-b",t),...a}));za.displayName="TableHeader";const Ba=s.forwardRef(({className:t,...a},r)=>e.jsx("tbody",{ref:r,className:at("[&_tr:last-child]:border-0",t),...a}));Ba.displayName="TableBody";const _c=s.forwardRef(({className:t,...a},r)=>e.jsx("tfoot",{ref:r,className:at("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...a}));_c.displayName="TableFooter";const As=s.forwardRef(({className:t,...a},r)=>e.jsx("tr",{ref:r,className:at("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...a}));As.displayName="TableRow";const Ot=s.forwardRef(({className:t,...a},r)=>e.jsx("th",{ref:r,className:at("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a}));Ot.displayName="TableHead";const Dt=s.forwardRef(({className:t,...a},r)=>e.jsx("td",{ref:r,className:at("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a}));Dt.displayName="TableCell";const Sc=s.forwardRef(({className:t,...a},r)=>e.jsx("caption",{ref:r,className:at("mt-4 text-sm text-muted-foreground",t),...a}));Sc.displayName="TableCaption";function Cc(){const{token:t}=Ht(),a=t?G(t):null,{toast:r}=Lt(),[n,o]=s.useState([]),[l,d]=s.useState(null),[N,i]=s.useState([]),[u,j]=s.useState([]),[c,m]=s.useState(50),[I,x]=s.useState(0),[v,_]=s.useState(0),[k,h]=s.useState(!1),[y,p]=s.useState(null),[C,M]=s.useState(null),[b,g]=s.useState({}),[U,se]=s.useState(!1),[Z,F]=s.useState(null);s.useEffect(()=>{a&&a.get("/api/admin/db/tables").then(D=>o(D.tables||[])).catch(()=>{})},[t]);const re=(D,H=0)=>{D&&(h(!0),p(null),a&&a.get(`/api/admin/db/table/${D}?limit=${c}&offset=${H}`).then(ge=>{d(D),i(ge.rows||[]),j(ge.columns||[]),x(ge.offset),_(ge.total)}).catch(ge=>{const V=ge&&(ge.detail||ge.message)||"Load failed";if(ge&&ge.status===403){p("Admin only"),d(null),i([]),j([]);try{r({title:"Admin only",description:"Access denied to DB Explorer."})}catch{}}else p(V)}).finally(()=>h(!1)))},O=D=>{M(D),g(D)},z=()=>{M(null),g({})},P=()=>{if(!l||!C)return;se(!0),p(null);const D={};if(Object.keys(b).forEach(H=>{H!=="id"&&b[H]!==C[H]&&(D[H]=b[H])}),Object.keys(D).length===0){se(!1),z();return}a.patch(`/api/admin/db/table/${l}/${C.id}`,{updates:D}).then(H=>{i(ge=>ge.map(V=>V.id===H.row.id?H.row:V)),z();try{r({title:"Row saved"})}catch{}}).catch(H=>{if(H&&H.status===403){p("Admin only"),d(null);try{r({title:"Admin only",description:"Access denied to DB Explorer."})}catch{}}else p(H&&(H.detail||H.message)||"Save failed")}).finally(()=>se(!1))},E=D=>{!l||!D||a.del(`/api/admin/db/table/${l}/${D.id}`).then(()=>{i(H=>H.filter(ge=>ge.id!==D.id)),F(null)}).catch(H=>{if(H&&H.status===403){p("Admin only"),d(null);try{r({title:"Admin only",description:"Access denied to DB Explorer."})}catch{}}else p(H&&(H.detail||H.message)||"Delete failed")})},ne=Math.ceil(v/c)||1,ee=I>0,he=I+c<v;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:n.map(D=>e.jsx("button",{onClick:()=>re(D,0),className:`px-3 py-1 rounded text-sm border ${D===l?"bg-blue-600 text-white":"bg-white hover:bg-blue-50"}`,children:D},D))}),y&&e.jsx("div",{className:"text-sm text-red-600",children:y}),k&&e.jsx("div",{className:"text-sm",children:"Loading..."}),l&&!k&&e.jsx("div",{className:"border rounded bg-white shadow-sm overflow-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[u.map(D=>e.jsx("th",{className:"text-left px-2 py-1 font-medium",children:D},D)),e.jsx("th",{className:"px-2 py-1"})]})}),e.jsxs("tbody",{children:[N.map(D=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[u.map(H=>e.jsx("td",{className:"px-2 py-1 whitespace-nowrap max-w-[240px] truncate",title:D[H],children:D[H]===null?"NULL":String(D[H])},H)),e.jsxs("td",{className:"px-2 py-1 flex gap-1",children:[e.jsx("button",{onClick:()=>O(D),className:"hover:underline text-blue-600",children:"edit"}),e.jsx("button",{onClick:()=>F(D),className:"hover:underline text-red-600",children:"del"})]})]},D.id||JSON.stringify(D))),N.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:u.length+1,className:"px-2 py-4 text-center text-gray-500",children:"No rows"})})]})]})}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("button",{disabled:!ee,onClick:()=>re(l,Math.max(0,I-c)),className:`px-2 py-1 border rounded ${ee?"bg-white hover:bg-gray-50":"opacity-40 cursor-not-allowed"}`,children:"Prev"}),e.jsxs("div",{children:["Page ",Math.floor(I/c)+1," / ",ne]}),e.jsx("button",{disabled:!he,onClick:()=>re(l,I+c),className:`px-2 py-1 border rounded ${he?"bg-white hover:bg-gray-50":"opacity-40 cursor-not-allowed"}`,children:"Next"}),e.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[e.jsx("label",{children:"Limit:"}),e.jsx("input",{type:"number",value:c,onChange:D=>m(Number(D.target.value)||50),className:"w-20 border px-1 py-0.5 rounded"}),e.jsx("button",{onClick:()=>re(l,0),className:"px-2 py-1 border rounded bg-white hover:bg-gray-50",children:"Apply"})]})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded shadow-lg w-full max-w-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[e.jsxs("div",{className:"font-semibold text-sm",children:["Edit Row ",C.id]}),e.jsx("button",{onClick:z,className:"text-xs text-gray-600",children:"close"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-2",children:u.map(D=>e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("label",{className:"w-40 font-medium pt-1",children:D}),D==="id"||D.endsWith("_at")||D==="spreaker_episode_id"?e.jsx("div",{className:"pt-1 text-gray-500 break-all",children:String(b[D])}):e.jsx("textarea",{className:"flex-1 border rounded p-1 font-mono text-[11px]",rows:Math.min(8,String(b[D]||"").split(`
`).length),value:b[D]===null?"":String(b[D]),onChange:H=>g(ge=>({...ge,[D]:H.target.value}))})]},D))}),e.jsxs("div",{className:"px-4 py-2 border-t flex gap-2 justify-end",children:[e.jsx("button",{onClick:z,className:"px-3 py-1 text-xs border rounded bg-white",children:"Cancel"}),e.jsx("button",{disabled:U,onClick:P,className:"px-3 py-1 text-xs border rounded bg-blue-600 text-white disabled:opacity-50",children:U?"Saving...":"Save"})]})]})}),Z&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded shadow p-4 w-full max-w-sm text-xs space-y-3",children:[e.jsx("div",{className:"font-semibold",children:"Delete Row"}),e.jsxs("div",{children:["Are you sure you want to delete id ",Z.id,"? This cannot be undone."]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>F(null),className:"px-3 py-1 border rounded bg-white",children:"Cancel"}),e.jsx("button",{onClick:()=>E(Z),className:"px-3 py-1 border rounded bg-red-600 text-white",children:"Delete"})]})]})})]})}const Es="ppp_layout_choice",Rs="ppp_layout_mode",Or={regular:{key:"regular",label:"Regular workspace"},ab:{key:"ab",label:"Plus Plus workspace"}},ea={key:"regular",mode:"manual"};function wn(){try{const t=localStorage.getItem(Es);if(t==="regular"||t==="ab")return t;const a=Math.random()<.5?"regular":"ab";return localStorage.setItem(Es,a),a}catch{return"regular"}}function kc(){if(typeof window>"u")return ea;try{const a=new URLSearchParams(window.location.search).get("layout");if(a==="regular"||a==="ab")return localStorage.setItem(Es,a),localStorage.setItem(Rs,"manual"),{key:a,mode:"manual"};if(a==="auto"){const o=wn();return localStorage.setItem(Rs,"auto"),{key:o,mode:"auto"}}const r=localStorage.getItem(Rs),n=localStorage.getItem(Es);return r==="manual"?n==="regular"||n==="ab"?{key:n,mode:"manual"}:(localStorage.setItem(Es,ea.key),localStorage.setItem(Rs,"manual"),ea):r==="auto"?{key:wn(),mode:"auto"}:n==="regular"||n==="ab"?(localStorage.setItem(Rs,"manual"),{key:n,mode:"manual"}):(localStorage.setItem(Es,ea.key),localStorage.setItem(Rs,ea.mode),ea)}catch{return ea}}const $i=s.createContext({layout:Or.regular,layoutKey:"regular",layoutMode:"manual",setLayout:()=>{}});function Ec({children:t}){const[a,r]=s.useState(()=>kc());s.useEffect(()=>{if(typeof document>"u")return;const d=document.documentElement;d.setAttribute("data-layout",a.key),d.setAttribute("data-layout-mode",a.mode)},[a]);const n=s.useMemo(()=>Or[a.key]||Or.regular,[a.key]),o=s.useCallback((d,N="manual")=>{r({key:d,mode:N});try{localStorage.setItem(Es,d),localStorage.setItem(Rs,N)}catch{}},[]),l=s.useMemo(()=>({layout:n,layoutKey:a.key,layoutMode:a.mode,setLayout:o}),[n,a.key,a.mode,o]);return e.jsx($i.Provider,{value:l,children:t})}function Oi(){return s.useContext($i)}function Ac(){try{const t=localStorage.getItem(Es);if(t==="regular"||t==="ab")return t;const a=Math.random()<.5?"regular":"ab";return localStorage.setItem(Es,a),a}catch{return"regular"}}function Ic(){const{layoutKey:t,layoutMode:a}=Oi(),[r,n]=$t.useState(a==="auto"?"auto":t);$t.useEffect(()=>{n(a==="auto"?"auto":t)},[t,a]);const o=N=>{try{N==="auto"?(Ac(),localStorage.setItem(Rs,"auto")):(localStorage.setItem(Es,N),localStorage.setItem(Rs,"manual"))}catch{}window.location.reload()},l=t==="ab"?"Plus Plus workspace":"Regular workspace",d=a==="auto"?"Auto (50/50)":"Manual";return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ve,{className:"text-base font-medium text-gray-700",children:"Workspace layout experiment"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Choose between the classic dashboard and the newer Plus Plus workspace, or let visitors split 50/50."}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Current mode: ",d,". Active bucket: ",l,"."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Jt,{value:r,onValueChange:n,children:[e.jsx(Wt,{className:"w-[220px]",children:e.jsx(Qt,{placeholder:"Select layout…"})}),e.jsxs(qt,{children:[e.jsx(yt,{value:"regular",children:"Regular workspace"}),e.jsx(yt,{value:"ab",children:"Plus Plus workspace"}),e.jsx(yt,{value:"auto",children:"Auto 50/50"})]})]}),e.jsx(A,{variant:"default",onClick:()=>o(r),children:"Apply"})]})]})}function Tc(){const{token:t}=Ht(),{toast:a}=Lt(),[r,n]=s.useState(!0),[o,l]=s.useState(!1),[d,N]=s.useState(null),[i,u]=s.useState(null),[j,c]=s.useState(!1);s.useEffect(()=>{let _=!1;return(async()=>{n(!0),N(null);try{const h=await G(t).get("/api/admin/tiers");_||u(h)}catch{if(!_){N("Failed to load tiers");try{a({title:"Error",description:"Failed to load Tier configuration",variant:"destructive"})}catch{}}}finally{_||n(!1)}})(),()=>{_=!0}},[t]);const m=s.useMemo(()=>i?.tiers||[],[i]),I=s.useMemo(()=>i?.features||[],[i]),x=(_,k,h)=>{u(y=>y&&{...y,features:y.features.map((C,M)=>M===_?{...C,values:{...C.values,[k]:h}}:C)}),c(!0)},v=async()=>{if(i){l(!0);try{const k=await G(t).put("/api/admin/tiers",i);u(k),c(!1);try{a({title:"Saved",description:"Tier configuration updated."})}catch{}}catch(_){try{a({title:"Save failed",description:_?.message||"Network error",variant:"destructive"})}catch{}}finally{l(!1)}}};return e.jsx("div",{className:"space-y-4",children:e.jsxs(Ce,{children:[e.jsxs(Je,{children:[e.jsx(Xe,{children:"Tier Editor"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Columns are tiers. Rows are features. Unlimited tier is implicit and not listed."})]}),e.jsxs(Ae,{children:[r&&e.jsx("div",{className:"text-sm text-gray-600",children:"Loading..."}),d&&e.jsx("div",{className:"text-sm text-red-600",children:d}),!r&&!d&&i&&e.jsx("div",{className:"overflow-auto border rounded",children:e.jsxs(Oa,{children:[e.jsx(za,{children:e.jsxs(As,{children:[e.jsx(Ot,{className:"min-w-[260px]",children:"Feature"}),m.map(_=>e.jsx(Ot,{className:"text-center",children:_},_))]})}),e.jsx(Ba,{children:I.map((_,k)=>e.jsxs(As,{children:[e.jsxs(Dt,{children:[e.jsx("div",{className:"font-medium",children:_.label||_.key}),e.jsx("div",{className:"text-xs text-gray-500",children:_.type==="boolean"?"On/Off":"Number"})]}),m.map(h=>e.jsx(Dt,{className:"text-center",children:_.type==="boolean"?e.jsx("div",{className:"flex justify-center",children:e.jsx(Kt,{checked:!!_.values?.[h],onCheckedChange:y=>x(k,h,!!y)})}):e.jsx("div",{className:"flex justify-center",children:e.jsx(Ye,{type:"number",className:"w-28",value:String(_.values?.[h]??""),onChange:y=>{const p=y.target.value,C=p===""?"":Number(p);x(k,h,C===""||isNaN(C)?0:C)}})})},h))]},_.key))})]})}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx(A,{onClick:v,disabled:!j||o,children:o?"Saving...":"Save"}),e.jsx(A,{variant:"outline",disabled:o,onClick:()=>{u(null),c(!1),N(null),n(!0),setTimeout(()=>{n(!1)},0)},children:"Reset"})]})]})]})})}function Pc(){const{token:t}=Ht(),{toast:a}=Lt(),[r,n]=s.useState([]),[o,l]=s.useState(!1),[d,N]=s.useState(!1),[i,u]=s.useState(null),[j,c]=s.useState({}),m=s.useRef(null),I=async()=>{l(!0);try{const g=await G(t).get("/api/music/assets");n(Array.isArray(g?.assets)?g.assets:[])}catch{n([])}finally{l(!1)}};s.useEffect(()=>{I()},[]);const x=g=>{const U=g.preview_url||g.url||g.filename;if(U){if(i===g.id){try{m.current?.pause()}catch{}m.current=null,u(null);return}try{if(m.current)try{m.current.pause()}catch{}const se=new Audio(U);m.current=se,u(g.id);const Z=20,F=()=>{se.currentTime>=Z&&(se.pause(),u(null),se.removeEventListener("timeupdate",F))};se.addEventListener("timeupdate",F),se.onended=()=>{u(null);try{se.removeEventListener("timeupdate",F)}catch{}},se.play().catch(()=>u(null))}catch{u(null)}}},v=()=>{n(g=>[{id:`new-${Date.now()}`,display_name:"",mood_tags:[],url:"",filename:"",isNew:!0},...g])},_=async g=>{if(String(g.id).startsWith("new-")){n(U=>U.filter(se=>se.id!==g.id));return}if(confirm("Delete this music asset?"))try{await G(t).del(`/api/admin/music/assets/${g.id}`),await I();try{a({title:"Deleted",description:`${g.display_name||"Asset"} removed.`})}catch{}}catch{try{a({title:"Delete failed",description:"Could not remove asset",variant:"destructive"})}catch{}}},k=(g,U,se)=>{n(Z=>Z.map(F=>F.id===g?{...F,[U]:se}:F))},h=(g,U)=>{n(se=>se.map(Z=>Z.id===g?{...Z,_file:U}:Z))},y=(g,U)=>{c(se=>({...se,[g]:U}))},p=(g,U=800)=>{setTimeout(()=>{c(se=>{const Z={...se};return delete Z[g],Z})},U)},C=async g=>{if(!g._file){try{a({title:"No file selected",variant:"destructive"})}catch{}return}N(!0);try{const U=new FormData;U.append("file",g._file),g.display_name&&U.append("display_name",g.display_name),Array.isArray(g.mood_tags)&&g.mood_tags.length&&U.append("mood_tags",JSON.stringify(g.mood_tags)),y(g.id,{state:"uploading",percent:0}),await new Promise((se,Z)=>{try{const F=new XMLHttpRequest;F.open("POST",Vt("/api/admin/music/assets/upload")),t&&F.setRequestHeader("Authorization",`Bearer ${t}`),F.upload.onprogress=re=>{if(!re.lengthComputable)return;const O=Math.min(100,Math.round(re.loaded/re.total*100));y(g.id,{state:"uploading",percent:O})},F.onload=()=>{if(F.status>=200&&F.status<300)y(g.id,{state:"complete",percent:100}),se();else{let re="Upload failed";try{const O=JSON.parse(F.responseText);re=O?.detail||O?.message||re}catch{}y(g.id,{state:"error",percent:0,message:re}),Z(new Error(re))}},F.onerror=()=>{const re="Network error while uploading";y(g.id,{state:"error",percent:0,message:re}),Z(new Error(re))},F.onabort=()=>{const re="Upload cancelled";y(g.id,{state:"error",percent:0,message:re}),Z(new Error(re))},F.send(U)}catch(F){Z(F instanceof Error?F:new Error("Upload failed"))}});try{a({title:"Uploaded",description:`${g.display_name||g._file.name} uploaded.`})}catch{}await I(),p(g.id)}catch(U){y(g.id,{state:"error",percent:0,message:U?.message||"Upload failed"});try{a({title:"Upload failed",description:U.message||"Could not upload file",variant:"destructive"})}catch{}}finally{N(!1)}},M=async g=>{if(!g.url||!/^https?:\/\//i.test(g.url)){try{a({title:"Enter a valid URL first",variant:"destructive"})}catch{}return}N(!0);try{await G(t).post("/api/admin/music/assets/import-url",{display_name:g.display_name||"Track",source_url:g.url,mood_tags:g.mood_tags||[]});try{a({title:"Imported",description:"Track downloaded and added."})}catch{}await I()}catch(U){try{a({title:"Import failed",description:U.message||"Could not import from URL",variant:"destructive"})}catch{}}finally{N(!1)}},b=async g=>{if(String(g.id).startsWith("new-")){g._file?await C(g):g.url&&/^https?:\/\//i.test(g.url)?await M(g):a({title:"Action Required",description:"Please select a file to upload or provide a full URL to import.",variant:"destructive"});return}N(!0);try{const U={display_name:g.display_name,mood_tags:g.mood_tags||[]};await G(t).put(`/api/admin/music/assets/${g.id}`,U),a({title:"Saved",description:"Music asset updated."}),await I()}catch(U){a({title:"Save failed",description:U.message||"Could not save asset",variant:"destructive"})}finally{N(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Music Library"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{onClick:v,children:[e.jsx(Ls,{className:"h-4 w-4 mr-1"})," Add New"]}),e.jsx(A,{variant:"outline",onClick:I,disabled:o,children:"Refresh"})]})]}),e.jsxs(Ce,{children:[e.jsx(Je,{children:e.jsxs(Xe,{className:"text-base",children:["Assets ",o&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(Loading…)"})]})}),e.jsx(Ae,{children:e.jsxs(Oa,{children:[e.jsx(za,{children:e.jsxs(As,{children:[e.jsx(Ot,{className:"w-[48px]"}),e.jsx(Ot,{children:"Name"}),e.jsx(Ot,{children:"Source URL"}),e.jsx(Ot,{children:"Or Upload File"}),e.jsx(Ot,{children:"Mood Tags (comma-separated)"}),e.jsx(Ot,{className:"w-[140px]"})]})}),e.jsx(Ba,{children:r.map(g=>{const U=!!(g.preview_url||g.url||g.filename),se=Array.isArray(g.mood_tags)?g.mood_tags.join(", "):g.mood_tags||"",Z=j[g.id];return e.jsxs(As,{children:[e.jsx(Dt,{children:e.jsx(A,{size:"icon",variant:"outline",disabled:!U,onClick:()=>U&&x(g),children:i===g.id?e.jsx(vs,{className:"h-4 w-4"}):e.jsx(Xt,{className:"h-4 w-4"})})}),e.jsx(Dt,{children:e.jsx(Ye,{value:g.display_name||"",onChange:F=>k(g.id,"display_name",F.target.value),placeholder:"Display name"})}),g.isNew?e.jsxs(e.Fragment,{children:[e.jsxs(Dt,{children:[e.jsx(Ye,{value:g.url||"",onChange:F=>k(g.id,"url",F.target.value),placeholder:"https://.../track.mp3"}),Z&&Z.state==="error"&&!g._file&&e.jsx("div",{className:"text-xs text-red-500 mt-1",children:Z.message||"Upload failed"})]}),e.jsxs(Dt,{children:[e.jsx("input",{type:"file",accept:"audio/*",onChange:F=>h(g.id,F.target.files?.[0]||null)}),Z&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("div",{className:"h-2 bg-muted rounded overflow-hidden",children:e.jsx("div",{className:`h-2 ${Z.state==="error"?"bg-red-500":"bg-blue-500"}`,style:{width:`${Z.percent}%`}})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Z.state==="error"?Z.message||"Upload failed":Z.percent===100?"Processing…":`${Z.percent}%`})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Dt,{children:e.jsx("span",{className:"text-xs text-muted-foreground truncate",title:g.url,children:g.url||"N/A"})}),e.jsx(Dt,{children:e.jsx("span",{className:"text-xs text-muted-foreground",children:"Existing file"})})]}),e.jsx(Dt,{children:e.jsx(Ye,{value:se,onChange:F=>k(g.id,"mood_tags",F.target.value.split(",").map(re=>re.trim()).filter(Boolean)),placeholder:"calm, upbeat, cinematic"})}),e.jsxs(Dt,{className:"flex items-center gap-2",children:[g.isNew?e.jsxs(A,{size:"sm",onClick:()=>b(g),disabled:d||!(g._file||g.url),children:[e.jsx(Ls,{className:"h-4 w-4 mr-1"})," Create"]}):e.jsxs(A,{size:"sm",onClick:()=>b(g),disabled:d,children:[e.jsx(Ra,{className:"h-4 w-4 mr-1"})," Save"]}),e.jsxs(A,{size:"sm",variant:"destructive",onClick:()=>_(g),children:[e.jsx($s,{className:"h-4 w-4 mr-1"})," Delete"]})]})]},g.id)})})]})})]})]})}function Mc(){const{token:t,logout:a}=Ht(),{toast:r}=Lt(),[n,o]=s.useState("users"),[l,d]=s.useState(""),[N,i]=s.useState("all"),[u,j]=s.useState("all"),[c,m]=s.useState(1),[I]=s.useState(10),[x,v]=s.useState([]),[_,k]=s.useState(!1),[h,y]=s.useState(null),[p,C]=s.useState(null),[M,b]=s.useState(!1),[g,U]=s.useState(null),[se,Z]=s.useState(null),[F,re]=s.useState(!1),[O,z]=s.useState(null),[P,E]=s.useState(""),ne=(f,Y="Request failed")=>{const Q=f&&(f.detail||f.message)||Y;try{r({title:"Error",description:Q,variant:"destructive"})}catch{}},ee=(f,Y="Access denied; returning to dashboard.")=>{if(f&&f.status===403){try{r({title:"Admin access denied",description:Y})}catch{}try{window.location.href="/dashboard"}catch{}return!0}return!1};s.useEffect(()=>{if(!t)return;const f=G(t);k(!0),b(!0),f.get("/api/admin/users/full").then(v).catch(Y=>{ee(Y)||ne(Y,"Failed to load users")}).finally(()=>k(!1)),f.get("/api/admin/summary").then(Y=>y(Y)).catch(Y=>{ee(Y)||ne(Y,"Failed to load summary")}),f.get("/api/admin/metrics").then(Y=>C(Y)).catch(Y=>{C(null),ee(Y)}).finally(()=>b(!1)),f.get("/api/admin/settings").then(Z).catch(Y=>{ee(Y)||Z(null)})},[t]),s.useEffect(()=>{E(se?.maintenance_message??"")},[se?.maintenance_message]);const he=async f=>{if(!se)return;const Y={...se,...f};Z(Y),re(!0),z(null);try{const ue=await G(t).put("/api/admin/settings",Y);Z(ue)}catch{z("Failed to save settings")}finally{re(!1)}},D=P!==(se?.maintenance_message??""),H=f=>{he({maintenance_mode:!!f})},ge=()=>{if(!D)return;const f=P.trim();he({maintenance_message:f||null})},V=()=>{E(se?.maintenance_message??"")},je=()=>{const f=G(t);f.post("/api/admin/seed").then(Y=>{U(Y),f.get("/api/admin/summary").then(y)}).catch(()=>{})},_e={totalUsers:Number(h?.users)||0,totalEpisodes:Number(h?.episodes)||0,publishedEpisodes:Number(h?.published_episodes)||0,podcasts:Number(h?.podcasts)||0,templates:Number(h?.templates)||0,activeUsers:p?.daily_active_users_30d?.length&&p.daily_active_users_30d[p.daily_active_users_30d.length-1]?.count||0,newSignups:p?.daily_signups_30d?.reduce((f,Y)=>f+(Number(Y?.count)||0),0)||0,revenue:p?.mrr_cents!=null?Math.round(p.mrr_cents/100):null,arr:p?.arr_cents!=null?Math.round(p.arr_cents/100):null,revenue30d:p?.revenue_30d_cents!=null?Math.round(p.revenue_30d_cents/100):null},T=f=>typeof f=="number"&&isFinite(f)?f:0,[K,le]=s.useState({aiShowNotes:!0,guestAccess:!1,maxFileSize:"500",autoBackup:!0,emailNotifications:!0}),me=[{id:"dashboard",label:"Dashboard Overview",icon:pi},{id:"users",label:"Users",icon:Ia},{id:"podcasts",label:"Podcasts",icon:Xt},{id:"analytics",label:"Analytics",icon:Cs},{id:"tiers",label:"Tier Editor",icon:aa},{id:"music",label:"Music Library",icon:Ur},{id:"db",label:"DB Explorer",icon:to},{id:"settings",label:"Settings",icon:aa},{id:"billing",label:"Billing",icon:xi},{id:"help",label:"Help & Docs",icon:Ds}],te=x.filter(f=>{const Y=l.trim().toLowerCase(),Q=(f.email||"").toLowerCase(),ue=(f.tier||"").toLowerCase(),Ie=!Y||Q.includes(Y)||ue.includes(Y),Re=N==="all"||ue===N,Le=u==="all"||u==="active"&&!!f.is_active||(u==="inactive"||u==="suspended")&&!f.is_active;return Ie&&Re&&Le}),[Ne,Be]=s.useState(new Set),[ke,De]=s.useState({}),[B,xe]=s.useState({}),ie=async(f,Y)=>{Be(Q=>new Set([...Q,f])),De(Q=>({...Q,[f]:null}));try{const ue=await G(t).patch(`/api/admin/users/${f}`,Y);v(Ie=>Ie.map(Re=>Re.id===f?ue:Re))}catch(Q){De(ue=>({...ue,[f]:Q.message||"Network error"}))}finally{Be(Q=>{const ue=new Set(Q);return ue.delete(f),ue})}},W=f=>/^(\d{4})-(\d{2})-(\d{2})$/.test(f),Pe=f=>{if(!f||!W(f.slice(0,10)))return"";const Y=f.slice(0,4),Q=f.slice(5,7),ue=f.slice(8,10);return`${Q}/${ue}/${Y}`},Ue=f=>{const Y=f.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(!Y)return null;let[Q,ue,Ie,Re]=Y;ue.length===1&&(ue="0"+ue),Ie.length===1&&(Ie="0"+Ie);const Le=`${Re}-${ue}-${Ie}`;return W(Le)?Le:null},$e=f=>new Date(f+"T00:00:00Z"),Fe=f=>f.toISOString().slice(0,10),Ge=(f,Y)=>{const Q=new Date(f.getTime()),ue=Q.getUTCDate();Q.setUTCDate(1),Q.setUTCMonth(Q.getUTCMonth()+Y);const Ie=new Date(Date.UTC(Q.getUTCFullYear(),Q.getUTCMonth()+1,0)).getUTCDate();return Q.setUTCDate(Math.min(ue,Ie)),Q},ct=(f,Y)=>{const Q=new Date(f.getTime());return Q.setUTCFullYear(Q.getUTCFullYear()+Y),Q},et=f=>{const Y=B[f.id];if(Y){const Q=Ue(Y);if(Q)return Q}return f.subscription_expires_at||new Date().toISOString().slice(0,10)},dt=c*I,jt=dt-I,xt=te.slice(jt,dt),R=Math.ceil(te.length/I),ye=f=>{switch(f){case"Active":return e.jsx(pt,{className:"bg-green-100 text-green-800",children:"Active"});case"Suspended":return e.jsx(pt,{className:"bg-red-100 text-red-800",children:"Suspended"});case"Inactive":return e.jsx(pt,{className:"bg-gray-100 text-gray-800",children:"Inactive"});default:return e.jsx(pt,{variant:"secondary",children:f})}},ae=f=>{const Y=f.toLowerCase();return Y==="pro"?e.jsx(pt,{className:"bg-purple-100 text-purple-800",children:"Pro"}):Y==="creator"?e.jsx(pt,{className:"bg-blue-100 text-blue-800",children:"Creator"}):Y==="free"?e.jsx(pt,{className:"bg-gray-100 text-gray-800",children:"Free"}):Y==="unlimited"?e.jsx(pt,{className:"bg-yellow-100 text-yellow-800",children:"Unlimited"}):e.jsx(pt,{variant:"secondary",children:f})};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("div",{className:"w-64 bg-white border-r border-gray-200 flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ur,{className:"w-8 h-8",style:{color:"#2C3E50"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",style:{color:"#2C3E50"},children:"Podcast Plus Plus"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Admin Panel"})]})]})}),e.jsx("nav",{className:"flex-1 p-4",role:"navigation","aria-label":"Admin side navigation",children:e.jsx("ul",{className:"space-y-2",children:me.map(f=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>o(f.id),className:`w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-all ${n===f.id?"text-white shadow-md":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"}`,style:{backgroundColor:n===f.id?"#2C3E50":"transparent"},children:[e.jsx(f.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:f.label})]})},f.id))})}),e.jsxs("div",{className:"p-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(La,{className:"h-8 w-8",children:e.jsx(Ua,{children:e.jsx(Vr,{className:"w-4 h-4"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:"Admin User"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Platform Administrator"})]})]}),e.jsxs(A,{onClick:a,variant:"ghost",size:"sm",className:"w-full justify-start text-gray-600",children:[e.jsx(hi,{className:"w-4 h-4 mr-2"}),"Logout"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",role:"main","aria-label":"Admin main content",tabIndex:-1,children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",style:{color:"#2C3E50"},children:me.find(f=>f.id===n)?.label}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[n==="users"&&"Manage platform users and their accounts",n==="analytics"&&"Monitor platform performance and user engagement",n==="tiers"&&"Define features per tier (placeholder, not enforced yet)",n==="db"&&"Browse & edit core tables (safe fields only)",n==="music"&&"Curate previewable background tracks for onboarding/templates",n==="settings"&&"Configure platform settings and features",n==="dashboard"&&"Overview of platform metrics and activity",n==="billing"&&"View and manage billing details and subscriptions"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-secondary text-secondary-foreground",children:["Brand: ",document.documentElement.getAttribute("data-brand")||"ppp"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleTimeString()]})]})]})}),e.jsxs("main",{className:"flex-1 p-6",children:[e.jsxs("div",{className:"mb-6",children:[n==="dashboard"&&_e&&e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Users"}),e.jsx("div",{className:"text-2xl font-bold",children:_e.totalUsers})]})}),e.jsx(Ce,{children:e.jsxs(Ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Episodes"}),e.jsx("div",{className:"text-2xl font-bold",children:_e.totalEpisodes})]})}),e.jsx(Ce,{children:e.jsxs(Ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Published"}),e.jsx("div",{className:"text-2xl font-bold",children:_e.publishedEpisodes})]})})]}),n==="dashboard"&&e.jsx(A,{size:"sm",variant:"outline",onClick:je,children:"Seed Demo Data"}),g&&n==="dashboard"&&e.jsxs("div",{className:"text-xs text-green-700 mt-2",children:["Seeded podcast ",g.podcast_id.slice(0,8)," / template ",g.template_id.slice(0,8)]}),se?.maintenance_mode&&e.jsx(Ce,{className:"border-l-4 border-orange-500 bg-orange-50",children:e.jsx(Ae,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ws,{className:"w-5 h-5 text-orange-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-orange-800",children:"Maintenance Mode Active"}),e.jsx("p",{className:"text-sm text-orange-700",children:se?.maintenance_message||"Platform is currently in maintenance mode. Users cannot access the service right now."})]}),e.jsx(A,{variant:"outline",size:"sm",className:"ml-auto bg-transparent",disabled:F,onClick:()=>he({maintenance_mode:!1}),children:"Disable"})]})})}),!1]}),n==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{className:"border-0 shadow-sm bg-white",children:e.jsx(Ae,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-4 lg:space-y-0 lg:flex lg:items-center lg:space-x-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ii,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Ye,{placeholder:"Search users by name, email, or tier...",className:"pl-10",value:l,onChange:f=>d(f.target.value)})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(Jt,{value:N,onValueChange:i,children:[e.jsx(Wt,{className:"w-32","aria-label":"Filter by tier",children:e.jsx(Qt,{})}),e.jsxs(qt,{children:[e.jsx(yt,{value:"all",children:"All Tiers"}),e.jsx(yt,{value:"pro",children:"Pro"}),e.jsx(yt,{value:"creator",children:"Creator"}),e.jsx(yt,{value:"free",children:"Free"}),e.jsx(yt,{value:"unlimited",children:"Unlimited"})]})]}),e.jsxs(Jt,{value:u,onValueChange:j,children:[e.jsx(Wt,{className:"w-32","aria-label":"Filter by status",children:e.jsx(Qt,{})}),e.jsxs(qt,{children:[e.jsx(yt,{value:"all",children:"All Status"}),e.jsx(yt,{value:"active",children:"Active"}),e.jsx(yt,{value:"inactive",children:"Inactive"})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(A,{"aria-label":"Export CSV",variant:"outline",size:"sm",children:[e.jsx(Za,{className:"w-4 h-4 mr-2"}),"Export CSV"]}),e.jsxs(A,{"aria-label":"Bulk Message",variant:"outline",size:"sm",children:[e.jsx(rn,{className:"w-4 h-4 mr-2"}),"Bulk Message"]}),e.jsxs(A,{size:"sm",className:"text-white",style:{backgroundColor:"#2C3E50"},children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Add User"]})]})]})})}),e.jsx(Ce,{className:"border-0 shadow-sm bg-white",children:e.jsxs(Ae,{className:"p-0",children:[_?e.jsx("div",{className:"p-4 space-y-2",children:Array.from({length:I}).map((f,Y)=>e.jsx("div",{className:"h-10 bg-gray-100 rounded animate-pulse"},Y))}):e.jsxs(Oa,{children:[e.jsx(za,{children:e.jsxs(As,{className:"border-b border-gray-200",children:[e.jsx(Ot,{className:"font-semibold text-gray-700",children:"User"}),e.jsx(Ot,{className:"font-semibold text-gray-700",children:"Email"}),e.jsx(Ot,{className:"font-semibold text-gray-700",children:"Tier"}),e.jsx(Ot,{className:"font-semibold text-gray-700",children:"Status"}),e.jsx(Ot,{className:"font-semibold text-gray-700",children:"Episodes"}),e.jsx(Ot,{className:"font-semibold text-gray-700",children:"Last Login"}),e.jsx(Ot,{className:"font-semibold text-gray-700",children:"Actions"})]})}),e.jsx(Ba,{children:xt.map(f=>{const Y=f?.email||f?.first_name||f?.last_name||"User",Q=String(Y),Ie=((Q.includes("@")?Q.split("@")[0]:Q)||"U").slice(0,2).toUpperCase(),Re=Q;return e.jsxs(As,{className:"hover:bg-gray-50",children:[e.jsx(Dt,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(La,{className:"h-10 w-10",children:[e.jsx(xr,{src:f.avatar||"/placeholder.svg"}),e.jsx(Ua,{children:Ie})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:Re}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Created ",(f.created_at||"").toString().slice(0,10)]})]})]})}),e.jsx(Dt,{className:"text-gray-600",children:f.email}),e.jsx(Dt,{children:ae(f.tier||"free")}),e.jsx(Dt,{children:ye(f.is_active?"Active":"Inactive")}),e.jsx(Dt,{className:"text-gray-600",children:f.episode_count}),e.jsx(Dt,{className:"text-gray-600",children:f.last_activity?f.last_activity.slice(0,10):"—"}),e.jsx(Dt,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(Jt,{defaultValue:f.tier||"free",onValueChange:Le=>ie(f.id,{tier:Le}),disabled:Ne.has(f.id),children:[e.jsx(Wt,{className:"w-24 h-8 text-xs","aria-label":`Tier for ${Re}`,children:e.jsx(Qt,{})}),e.jsxs(qt,{children:[e.jsx(yt,{value:"free",children:"Free"}),e.jsx(yt,{value:"creator",children:"Creator"}),e.jsx(yt,{value:"pro",children:"Pro"}),e.jsx(yt,{value:"unlimited",children:"Unlimited"})]})]}),e.jsx(Kt,{"aria-label":`Active status for ${Re}`,checked:!!f.is_active,disabled:Ne.has(f.id),onCheckedChange:Le=>ie(f.id,{is_active:Le})}),e.jsx("input",{"aria-label":"Subscription expiry date",type:"text",inputMode:"numeric",className:`border rounded px-2 py-1 text-xs w-28 ${B[f.id]&&B[f.id].length>0&&Ue(B[f.id])===null?"border-red-400":""}`,value:B[f.id]??Pe(f.subscription_expires_at),onChange:Le=>{const nt=Le.target.value.replace(/[^0-9/]/g,"");let He=nt;/^\d{3,}$/.test(nt)&&nt.indexOf("/")===-1&&(nt.length>=2&&(He=nt.slice(0,2)+"/"+nt.slice(2)),nt.length>=4&&(He=He.slice(0,5)+"/"+He.slice(5))),He=He.slice(0,10),xe(it=>({...it,[f.id]:He}))},onBlur:()=>{const Le=B[f.id];if(Le!==void 0){if(Le==="")ie(f.id,{subscription_expires_at:""});else{const nt=Ue(Le);nt&&ie(f.id,{subscription_expires_at:nt})}xe(nt=>{const He={...nt};return delete He[f.id],He})}},disabled:Ne.has(f.id),placeholder:"MM/DD/YYYY",title:"Subscription expiry (MM/DD/YYYY)"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{type:"button",className:"text-[10px] px-1 py-0.5 border rounded bg-gray-100 hover:bg-gray-200",disabled:Ne.has(f.id),onClick:()=>{const Le=et(f),nt=Ge($e(Le),1),He=Fe(nt);xe(it=>({...it,[f.id]:Pe(He)})),ie(f.id,{subscription_expires_at:He})},children:"+1M"}),e.jsx("button",{type:"button",className:"text-[10px] px-1 py-0.5 border rounded bg-gray-100 hover:bg-gray-200",disabled:Ne.has(f.id),onClick:()=>{const Le=et(f),nt=ct($e(Le),1),He=Fe(nt);xe(it=>({...it,[f.id]:Pe(He)})),ie(f.id,{subscription_expires_at:He})},children:"+1Y"}),e.jsx("button",{type:"button",className:"text-[10px] px-1 py-0.5 border rounded bg-gray-100 hover:bg-gray-200",disabled:Ne.has(f.id),onClick:()=>{const Le=new Date().toISOString().slice(0,10);xe(nt=>({...nt,[f.id]:Pe(Le)})),ie(f.id,{subscription_expires_at:Le})},children:"Today"}),e.jsx("button",{type:"button",className:"text-[10px] px-1 py-0.5 border rounded bg-gray-100 hover:bg-gray-200",disabled:Ne.has(f.id),onClick:()=>{xe(Le=>({...Le,[f.id]:""})),ie(f.id,{subscription_expires_at:""})},children:"Clear"})]}),Ne.has(f.id)&&e.jsx("span",{className:"text-[10px] text-gray-400",children:"Saving…"}),ke[f.id]&&e.jsx("span",{className:"text-[10px] text-red-500",title:ke[f.id],children:"Err"})]})})]},f.id)})})]}),n==="tiers"&&e.jsx(Tc,{}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",jt+1," to ",Math.min(dt,te.length)," of"," ",te.length," users"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{"aria-label":"Previous page",variant:"outline",size:"sm",onClick:()=>m(Math.max(1,c-1)),disabled:c===1,children:e.jsx(Yr,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",c," of ",R]}),e.jsx(A,{"aria-label":"Next page",variant:"outline",size:"sm",onClick:()=>m(Math.min(R,c+1)),disabled:c===R,children:e.jsx(hr,{className:"w-4 h-4"})})]})]})]})})]}),n==="music"&&e.jsx("div",{className:"space-y-4",children:e.jsx(Pc,{})}),n==="db"&&e.jsx("div",{className:"space-y-4",children:e.jsx(Cc,{})}),n==="podcasts"&&e.jsx(Rc,{}),n==="billing"&&e.jsx(Dc,{}),n==="help"&&e.jsx(Fc,{}),n==="analytics"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"#2C3E50"},children:"Platform Analytics"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive insights into platform performance"})]}),e.jsxs(Jt,{defaultValue:"30d",children:[e.jsx(Wt,{className:"w-40",children:e.jsx(Qt,{})}),e.jsxs(qt,{children:[e.jsx(yt,{value:"7d",children:"Last 7 days"}),e.jsx(yt,{value:"30d",children:"Last 30 days"}),e.jsx(yt,{value:"90d",children:"Last 90 days"}),e.jsx(yt,{value:"1y",children:"Last year"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:M?e.jsx(e.Fragment,{children:Array.from({length:4}).map((f,Y)=>e.jsx(Ce,{className:"border-0 shadow-sm",children:e.jsx(Ae,{className:"p-6",children:e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"})})},Y))}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"border-0 shadow-sm hover:shadow-md transition-all",style:{backgroundColor:"#ECF0F1"},children:e.jsxs(Ae,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Active Users"}),e.jsx("p",{className:"text-3xl font-bold",style:{color:"#2C3E50"},children:T(_e.activeUsers).toLocaleString()}),e.jsxs("div",{className:"flex items-center mt-2 text-sm",children:[e.jsx(Cs,{className:"w-4 h-4 text-green-600 mr-1"}),e.jsx("span",{className:"text-green-600",children:"+12% from last month"})]})]}),e.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:e.jsx(Ia,{className:"w-8 h-8 text-blue-600"})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsx("div",{className:"text-xs text-gray-600",children:"Latest daily active users (DAU) over last 30 days"})})]})}),e.jsx(Ce,{className:"border-0 shadow-sm hover:shadow-md transition-all",style:{backgroundColor:"#ECF0F1"},children:e.jsxs(Ae,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"New Sign-ups (30 Days)"}),e.jsx("p",{className:"text-3xl font-bold",style:{color:"#2C3E50"},children:T(_e.newSignups).toLocaleString()}),e.jsxs("div",{className:"flex items-center mt-2 text-sm",children:[e.jsx(Cs,{className:"w-4 h-4 text-green-600 mr-1"}),e.jsx("span",{className:"text-green-600",children:"+8% from last month"})]})]}),e.jsx("div",{className:"p-3 rounded-full bg-green-100",children:e.jsx(so,{className:"w-8 h-8 text-green-600"})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"text-xs text-gray-600",children:["Daily average: ",Math.round(_e.newSignups/30)," users"]})})]})}),e.jsx(Ce,{className:"border-0 shadow-sm hover:shadow-md transition-all",style:{backgroundColor:"#ECF0F1"},children:e.jsxs(Ae,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Episodes Published"}),e.jsx("p",{className:"text-3xl font-bold",style:{color:"#2C3E50"},children:_e.totalEpisodes.toLocaleString()}),e.jsxs("div",{className:"flex items-center mt-2 text-sm",children:[e.jsx(Cs,{className:"w-4 h-4 text-green-600 mr-1"}),e.jsx("span",{className:"text-green-600",children:"+23% from last month"})]})]}),e.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:e.jsx(Xt,{className:"w-8 h-8 text-purple-600"})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsx("div",{className:"text-xs text-gray-600",children:"This month: 1,247 episodes"})})]})}),e.jsx(Ce,{className:"border-0 shadow-sm hover:shadow-md transition-all",style:{backgroundColor:"#ECF0F1"},children:e.jsxs(Ae,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Revenue (MRR)"}),e.jsx("p",{className:"text-3xl font-bold",style:{color:"#2C3E50"},children:_e.revenue!=null?e.jsxs(e.Fragment,{children:["$",Number(_e.revenue).toLocaleString()]}):e.jsx(pt,{variant:"secondary",children:"—"})}),e.jsxs("div",{className:"flex items-center mt-2 text-sm",children:[e.jsx(Cs,{className:"w-4 h-4 text-green-600 mr-1"}),e.jsx("span",{className:"text-green-600",children:"+15% from last month"})]})]}),e.jsx("div",{className:"p-3 rounded-full bg-green-100",children:e.jsx(Cs,{className:"w-8 h-8 text-green-600"})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"text-xs text-gray-600",children:["ARPU: ",_e.revenue!=null&&_e.totalUsers>0?e.jsxs(e.Fragment,{children:["$",(Number(_e.revenue)/Number(_e.totalUsers)).toFixed(2)]}):e.jsx(pt,{variant:"secondary",children:"—"})]})})]})})]})}),e.jsx("div",{className:"grid lg:grid-cols-2 gap-6",children:M?e.jsx(e.Fragment,{children:Array.from({length:2}).map((f,Y)=>e.jsx(Ce,{className:"border-0 shadow-sm bg-white",children:e.jsx(Ae,{className:"p-6",children:e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"})})},Y))}):e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{className:"border-0 shadow-sm bg-white",children:[e.jsx(Je,{children:e.jsxs(Xe,{className:"flex items-center justify-between",style:{color:"#2C3E50"},children:["Daily Signups (30 days)",e.jsxs(A,{variant:"ghost",size:"sm",className:"text-blue-600",children:[e.jsx(Za,{className:"w-4 h-4 mr-1"}),"Export"]})]})}),e.jsxs(Ae,{children:[e.jsx("div",{className:"h-64 flex items-end justify-between space-x-1 p-4 bg-gray-50 rounded-lg",children:(p?.daily_signups_30d||[]).map((f,Y,Q)=>{const ue=Math.max(1,...Q.map(Re=>Number(Re.count)||0)),Ie=Math.round((Number(f.count)||0)/ue*200);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-3 bg-blue-500 rounded-t",style:{height:`${Ie}px`}}),e.jsx("span",{className:"text-[10px] text-gray-500 mt-1",children:String(f.date).slice(5)})]},Y)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Total signups: ",T(_e.newSignups).toLocaleString()]}),e.jsx("span",{className:"text-green-600",children:"30 days"})]})]})]}),e.jsxs(Ce,{className:"border-0 shadow-sm bg-white",children:[e.jsx(Je,{children:e.jsxs(Xe,{className:"flex items-center justify-between",style:{color:"#2C3E50"},children:["Daily Active Users (30 days)",e.jsxs(A,{variant:"ghost",size:"sm",className:"text-blue-600",children:[e.jsx(Za,{className:"w-4 h-4 mr-1"}),"Export"]})]})}),e.jsxs(Ae,{children:[e.jsx("div",{className:"h-64 flex items-end justify-between space-x-1 p-4 bg-gray-50 rounded-lg",children:(p?.daily_active_users_30d||[]).map((f,Y,Q)=>{const ue=Math.max(1,...Q.map(Re=>Number(Re.count)||0)),Ie=Math.round((Number(f.count)||0)/ue*200);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-3 bg-purple-500 rounded-t",style:{height:`${Ie}px`}}),e.jsx("span",{className:"text-[10px] text-gray-500 mt-1",children:String(f.date).slice(5)})]},Y)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Latest DAU: ",T(_e.activeUsers).toLocaleString()]}),e.jsx("span",{className:"text-green-600",children:"30 days"})]})]})]})]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs(Ce,{className:"border-0 shadow-sm bg-white",children:[e.jsx(Je,{children:e.jsx(Xe,{style:{color:"#2C3E50"},children:"Top Performing Content"})}),e.jsx(Ae,{className:"space-y-4",children:[{title:"Tech Talk Weekly",downloads:"12.4K",growth:"+23%"},{title:"Mindful Moments",downloads:"8.7K",growth:"+18%"},{title:"Business Insights",downloads:"6.2K",growth:"+15%"}].map((f,Y)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:f.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:[f.downloads," downloads"]})]}),e.jsx(pt,{className:"bg-green-100 text-green-800",children:f.growth})]},Y))})]}),e.jsxs(Ce,{className:"border-0 shadow-sm bg-white",children:[e.jsx(Je,{children:e.jsx(Xe,{style:{color:"#2C3E50"},children:"User Engagement"})}),e.jsx(Ae,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Daily Active Users"}),e.jsx("span",{className:"font-medium",children:"78%"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:"78%"}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Weekly Retention"}),e.jsx("span",{className:"font-medium",children:"65%"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:"65%"}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Monthly Retention"}),e.jsx("span",{className:"font-medium",children:"42%"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-orange-500 h-2 rounded-full",style:{width:"42%"}})})]})]})})]}),e.jsxs(Ce,{className:"border-0 shadow-sm bg-white",children:[e.jsx(Je,{children:e.jsx(Xe,{style:{color:"#2C3E50"},children:"Platform Health"})}),e.jsxs(Ae,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:"98.7%"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Uptime (30 days)"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Avg Response Time"}),e.jsx("span",{className:"font-medium",children:"245ms"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Error Rate"}),e.jsx("span",{className:"font-medium text-green-600",children:"0.03%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Active Connections"}),e.jsx("span",{className:"font-medium",children:"1,247"})]})]})]})]})]})]}),n==="dashboard"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Ce,{className:"border-0 shadow-sm bg-white hover:shadow-md transition-all",children:e.jsx(Ae,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#2C3E50"},children:T(_e.activeUsers).toLocaleString()}),e.jsxs("div",{className:"flex items-center mt-1 text-sm text-green-600",children:[e.jsx(Cs,{className:"w-3 h-3 mr-1"}),"+12% vs last month"]})]}),e.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:e.jsx(Ia,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(Ce,{className:"border-0 shadow-sm bg-white hover:shadow-md transition-all",children:e.jsx(Ae,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Monthly Revenue"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#2C3E50"},children:_e.revenue!=null?e.jsxs(e.Fragment,{children:["$",T(_e.revenue).toLocaleString()]}):e.jsx(pt,{variant:"secondary",children:"—"})}),e.jsxs("div",{className:"flex items-center mt-1 text-sm text-green-600",children:[e.jsx(Cs,{className:"w-3 h-3 mr-1"}),"+18% vs last month"]})]}),e.jsx("div",{className:"p-3 rounded-full bg-green-100",children:e.jsx(Cs,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(Ce,{className:"border-0 shadow-sm bg-white hover:shadow-md transition-all",children:e.jsx(Ae,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Episodes Today"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#2C3E50"},children:"47"}),e.jsxs("div",{className:"flex items-center mt-1 text-sm text-blue-600",children:[e.jsx(Xt,{className:"w-3 h-3 mr-1"}),"23 published, 24 drafts"]})]}),e.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:e.jsx(Xt,{className:"w-6 h-6 text-purple-600"})})]})})}),e.jsx(Ce,{className:"border-0 shadow-sm bg-white hover:shadow-md transition-all",children:e.jsx(Ae,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"System Health"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:"98.7%"}),e.jsxs("div",{className:"flex items-center mt-1 text-sm text-green-600",children:[e.jsx(as,{className:"w-3 h-3 mr-1"}),"All systems operational"]})]}),e.jsx("div",{className:"p-3 rounded-full bg-green-100",children:e.jsx(as,{className:"w-6 h-6 text-green-600"})})]})})})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(Ce,{className:"border-0 shadow-sm bg-white",children:[e.jsx(Je,{children:e.jsxs(Xe,{className:"flex items-center justify-between",style:{color:"#2C3E50"},children:["Recent Platform Activity",e.jsx(A,{variant:"ghost",size:"sm",className:"text-blue-600",children:"View All"})]})}),e.jsx(Ae,{className:"space-y-4",children:[{icon:Ia,color:"text-blue-600",bg:"bg-blue-100",title:"New user registration spike",description:"23 new users signed up in the last hour",time:"5 minutes ago"},{icon:ws,color:"text-orange-600",bg:"bg-orange-100",title:"High server load detected",description:"CPU usage at 78% - monitoring closely",time:"12 minutes ago"},{icon:Xt,color:"text-purple-600",bg:"bg-purple-100",title:"Episode milestone reached",description:"Platform just hit 15,000 total episodes published",time:"1 hour ago"},{icon:Cs,color:"text-green-600",bg:"bg-green-100",title:"Revenue target exceeded",description:"Monthly revenue goal reached 5 days early",time:"2 hours ago"}].map((f,Y)=>e.jsxs("div",{className:"flex items-start space-x-4 p-4 rounded-lg hover:bg-gray-50 transition-all",children:[e.jsx("div",{className:`p-2 rounded-full ${f.bg}`,children:e.jsx(f.icon,{className:`w-4 h-4 ${f.color}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-800",children:f.title}),e.jsx("p",{className:"text-sm text-gray-600",children:f.description}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:f.time})]})]},Y))})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ce,{className:"border-0 shadow-sm bg-white",children:[e.jsx(Je,{children:e.jsx(Xe,{style:{color:"#2C3E50"},children:"Quick Actions"})}),e.jsxs(Ae,{className:"space-y-3",children:[e.jsxs(A,{variant:"outline",className:"w-full justify-start bg-transparent",children:[e.jsx(rn,{className:"w-4 h-4 mr-3"}),"Send Platform Announcement"]}),e.jsxs(A,{variant:"outline",className:"w-full justify-start bg-transparent",children:[e.jsx(Za,{className:"w-4 h-4 mr-3"}),"Generate Monthly Report"]}),e.jsxs(A,{variant:"outline",className:"w-full justify-start bg-transparent",children:[e.jsx(aa,{className:"w-4 h-4 mr-3"}),"System Maintenance"]}),e.jsxs(A,{variant:"outline",className:"w-full justify-start bg-transparent",children:[e.jsx(Ia,{className:"w-4 h-4 mr-3"}),"User Support Queue"]})]})]}),e.jsxs(Ce,{className:"border-0 shadow-sm",style:{backgroundColor:"#ECF0F1"},children:[e.jsx(Je,{children:e.jsx(Xe,{style:{color:"#2C3E50"},children:"System Status"})}),e.jsx(Ae,{className:"space-y-4",children:[{service:"API Gateway",status:"operational",color:"text-green-600",icon:as},{service:"Database",status:"operational",color:"text-green-600",icon:as},{service:"AI Services",status:"operational",color:"text-green-600",icon:as},{service:"File Storage",status:"degraded",color:"text-orange-600",icon:ws},{service:"Email Service",status:"down",color:"text-red-600",icon:Rr}].map((f,Y)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(f.icon,{className:`w-4 h-4 ${f.color}`}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:f.service})]}),e.jsx(pt,{className:`text-xs ${f.status==="operational"?"bg-green-100 text-green-800":f.status==="degraded"?"bg-orange-100 text-orange-800":"bg-red-100 text-red-800"}`,children:f.status})]},Y))})]})]})]})]}),n==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ce,{className:"border-0 shadow-sm bg-white",children:[e.jsxs(Je,{children:[e.jsx(Xe,{style:{color:"#2C3E50"},children:"Platform Features"}),e.jsx("p",{className:"text-gray-600",children:"Enable or disable platform-wide features"})]}),e.jsxs(Ae,{className:"space-y-6",children:[se?e.jsx(Pi,{token:t,initial:se,onSaved:f=>Z(f)}):e.jsx("p",{className:"text-sm text-gray-500",children:"Loading admin settings…"}),e.jsx(Ic,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ve,{className:"text-base font-medium text-gray-700",children:"Enable AI Show Notes (Beta)"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Allow users to generate show notes automatically using AI"})]}),e.jsx(Kt,{"aria-label":"Enable AI Show Notes",checked:K.aiShowNotes,onCheckedChange:f=>le({...K,aiShowNotes:f})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ve,{className:"text-base font-medium text-gray-700",children:"Allow Guest Access to Podcasts"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Enable non-registered users to listen to public podcasts"})]}),e.jsx(Kt,{"aria-label":"Allow guest access",checked:K.guestAccess,onCheckedChange:f=>le({...K,guestAccess:f})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ve,{className:"text-base font-medium text-gray-700",children:"Maintenance Mode"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Temporarily disable platform access for maintenance"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[se?.maintenance_mode&&e.jsx(ws,{className:"w-5 h-5 text-orange-500"}),e.jsx(Kt,{"aria-label":"Maintenance mode",checked:!!(se&&se.maintenance_mode),disabled:F||!se,onCheckedChange:H})]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx(ve,{className:"text-sm font-medium text-gray-700",children:"Maintenance Message"}),e.jsx(bs,{value:P,onChange:f=>E(f.target.value),placeholder:"Let your users know what's happening...",rows:3,disabled:F||!se}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[O&&e.jsx("span",{className:"text-red-500",children:O}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:V,disabled:!D||F,children:"Reset"}),e.jsx(A,{size:"sm",onClick:ge,disabled:!D||F,children:"Save Message"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ve,{className:"text-base font-medium text-gray-700",children:"Auto Backup"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Automatically backup user data daily"})]}),e.jsx(Kt,{"aria-label":"Enable auto backup",checked:K.autoBackup,onCheckedChange:f=>le({...K,autoBackup:f})})]})]})]}),e.jsxs(Ce,{className:"border-0 shadow-sm",style:{backgroundColor:"#ECF0F1"},children:[e.jsx(Je,{children:e.jsx(Xe,{style:{color:"#2C3E50"},children:"System Status"})}),e.jsx(Ae,{children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(as,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:"Database"}),e.jsx("p",{className:"text-sm text-green-600",children:"Operational"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(as,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:"AI Services"}),e.jsx("p",{className:"text-sm text-green-600",children:"Operational"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Rr,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:"Email Service"}),e.jsx("p",{className:"text-sm text-red-600",children:"Degraded"})]})]})]})})]})]}),!["users","analytics","settings","dashboard","music"].includes(n)&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:[me.find(f=>f.id===n)?.label," Coming Soon"]}),e.jsx("p",{className:"text-gray-500",children:"This section is under development and will be available soon."})]})]})]})]})}function Rc(){const{token:t}=Ht(),{toast:a}=Lt(),[r,n]=$t.useState([]),[o,l]=$t.useState(0),[d,N]=$t.useState(25),[i,u]=$t.useState(0),[j,c]=$t.useState(!1),[m,I]=$t.useState(""),x=async(p=0)=>{if(t){c(!0);try{const C=G(t),M=new URLSearchParams({limit:String(d),offset:String(p),...m?{owner_email:m}:{}}),b=await C.get(`/api/admin/podcasts?${M.toString()}`);n(b.items||[]),l(Number(b.total)||0),u(Number(b.offset)||0)}catch(C){try{a({title:"Failed to load podcasts",description:C?.message||"Error"})}catch{}}finally{c(!1)}}};$t.useEffect(()=>{x(0)},[t]);const v=()=>x(0),_=Math.max(1,Math.ceil(o/d)),k=Math.floor(i/d)+1,h=p=>{try{const C=`/dashboard?podcast=${encodeURIComponent(p)}`;window.location.href=C}catch{}},y=async p=>{try{await navigator.clipboard.writeText(p),a({title:"Copied podcast id"})}catch{}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ce,{className:"border-0 shadow-sm bg-white",children:e.jsxs(Ae,{className:"p-4 flex items-center gap-3",children:[e.jsx(Ye,{placeholder:"Filter by owner email",value:m,onChange:p=>I(p.target.value),className:"max-w-sm"}),e.jsx(A,{onClick:v,disabled:j,children:"Search"}),e.jsxs("div",{className:"ml-auto text-sm text-gray-500",children:["Total: ",o]})]})}),e.jsx(Ce,{className:"border-0 shadow-sm bg-white",children:e.jsx(Ae,{className:"p-0",children:e.jsxs(Oa,{children:[e.jsx(za,{children:e.jsxs(As,{children:[e.jsx(Ot,{children:"Podcast"}),e.jsx(Ot,{children:"Owner"}),e.jsx(Ot,{children:"Episodes"}),e.jsx(Ot,{children:"Created"}),e.jsx(Ot,{children:"Last Activity"}),e.jsx(Ot,{className:"text-right",children:"Actions"})]})}),e.jsxs(Ba,{children:[r.map(p=>e.jsxs(As,{children:[e.jsx(Dt,{className:"font-medium",children:p.name||"—"}),e.jsx(Dt,{children:p.owner_email||"—"}),e.jsx(Dt,{children:p.episode_count??0}),e.jsx(Dt,{children:p.created_at?new Date(p.created_at).toLocaleString():"—"}),e.jsx(Dt,{children:p.last_episode_at?new Date(p.last_episode_at).toLocaleString():"—"}),e.jsxs(Dt,{className:"text-right space-x-2",children:[e.jsx(A,{size:"sm",variant:"outline",onClick:()=>h(p.id),children:"Open in Podcast Manager"}),e.jsx(A,{size:"sm",variant:"secondary",onClick:()=>y(p.id),children:"Copy ID"})]})]},p.id)),r.length===0&&e.jsx(As,{children:e.jsx(Dt,{colSpan:6,className:"text-center text-sm text-gray-500 py-8",children:j?"Loading…":"No results"})})]})]})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",k," of ",_]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(A,{"aria-label":"Previous page",size:"sm",variant:"outline",disabled:i<=0||j,onClick:()=>x(Math.max(0,i-d)),children:e.jsx(Yr,{className:"w-4 h-4"})}),e.jsx(A,{"aria-label":"Next page",size:"sm",variant:"outline",disabled:i+d>=o||j,onClick:()=>x(i+d),children:e.jsx(hr,{className:"w-4 h-4"})})]})]})]})}function Dc(){const{token:t}=Ht(),{toast:a}=Lt(),[r,n]=$t.useState(null),[o,l]=$t.useState(!1);$t.useEffect(()=>{if(!t)return;let j=!1;return l(!0),(async()=>{try{const m=await G(t).get("/api/admin/billing/overview");j||n(m)}catch(c){try{a({title:"Failed to load billing overview",description:c?.message||"Error"})}catch{}j||n(null)}finally{j||l(!1)}})(),()=>{j=!0}},[t]);const d=j=>typeof j=="number"&&isFinite(j)?j:0,i=(j=>j==null?null:Math.round(j)/100)(r?.gross_mrr_cents),u=()=>{const j=r?.dashboard_url;if(j)try{window.open(j,"_blank","noopener,noreferrer")}catch{}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"#2C3E50"},children:"Billing Overview"}),e.jsx("p",{className:"text-gray-600",children:"Stripe-derived subscription metrics"})]}),e.jsxs(A,{onClick:u,disabled:!r?.dashboard_url,className:"text-white",style:{backgroundColor:"#2C3E50"},children:[e.jsx(xi,{className:"w-4 h-4 mr-2"}),"Open Stripe Dashboard"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsx(Ce,{className:"border-0 shadow-sm bg-white",children:e.jsxs(Ae,{className:"p-6",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Active Subscriptions"}),e.jsx("div",{className:"text-3xl font-bold",style:{color:"#2C3E50"},children:d(r?.active_subscriptions)})]})}),e.jsx(Ce,{className:"border-0 shadow-sm bg-white",children:e.jsxs(Ae,{className:"p-6",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Trialing"}),e.jsx("div",{className:"text-3xl font-bold",style:{color:"#2C3E50"},children:d(r?.trialing)})]})}),e.jsx(Ce,{className:"border-0 shadow-sm bg-white",children:e.jsxs(Ae,{className:"p-6",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Canceled (30d)"}),e.jsx("div",{className:"text-3xl font-bold",style:{color:"#2C3E50"},children:d(r?.canceled_last_30d)})]})}),e.jsx(Ce,{className:"border-0 shadow-sm bg-white",children:e.jsxs(Ae,{className:"p-6",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Trials expiring (7d)"}),e.jsx("div",{className:"text-3xl font-bold",style:{color:"#2C3E50"},children:d(r?.trial_expiring_7d)})]})}),e.jsx(Ce,{className:"border-0 shadow-sm bg-white",children:e.jsxs(Ae,{className:"p-6",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Gross MRR"}),e.jsx("div",{className:"text-3xl font-bold",style:{color:"#2C3E50"},children:i!=null?e.jsxs(e.Fragment,{children:["$",d(i).toLocaleString()]}):e.jsx(pt,{variant:"secondary",children:"—"})})]})})]}),o&&e.jsx("div",{className:"text-sm text-gray-500",children:"Loading…"})]})}function Fc(){const[t,a]=$t.useState({ok:null,detail:null});$t.useEffect(()=>{let o=!1;return(async()=>{try{const l=await fetch(Vt("/api/health")),d=l.ok;let N=null;try{N=await l.json()}catch{}o||a({ok:d,detail:N})}catch{o||a({ok:!1,detail:null})}})(),()=>{o=!0}},[]);const r=o=>o===!0?e.jsx(pt,{className:"bg-green-100 text-green-800",children:"OK"}):o===!1?e.jsx(pt,{className:"bg-red-100 text-red-800",children:"DOWN"}):e.jsx(pt,{variant:"secondary",children:"Unknown"}),n=[{label:"System Health",href:"/api/health",desc:"Raw health endpoint"},{label:"Job Queue",href:"#/admin/jobs",desc:"Queue status and workers"},{label:"Database Explorer Guide",href:"#/docs/db-explorer",desc:"How to safely use DB Explorer"},{label:"Support Inbox",href:"#/support",desc:"Contact support"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{className:"border-0 shadow-sm bg-white",children:e.jsxs(Ae,{className:"p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"API Health"}),e.jsx("div",{className:"text-xl font-semibold",style:{color:"#2C3E50"},children:"Platform Status"})]}),r(t.ok)]})}),e.jsxs(Ce,{className:"border-0 shadow-sm bg-white",children:[e.jsx(Je,{children:e.jsx(Xe,{style:{color:"#2C3E50"},children:"Quick Links"})}),e.jsx(Ae,{className:"divide-y",children:n.map((o,l)=>e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:o.label}),e.jsx("div",{className:"text-sm text-gray-500",children:o.desc})]}),e.jsx("a",{href:o.href,target:o.href.startsWith("http")||o.href.startsWith("/api/")?"_blank":void 0,rel:"noopener noreferrer",className:"text-blue-600 hover:underline text-sm",children:"Open"})]},l))})]})]})}function Lc({href:t,className:a,...r}){return e.jsx("a",{href:t,className:at("block",a),...r,children:e.jsxs("div",{className:at("w-full inline-flex items-center justify-center gap-2","rounded border bg-white","hover:bg-[#f7f8f8]","px-4 h-12","transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#1a73e8]/40"),role:"button","aria-label":"Sign in with Google",style:{borderColor:"#dadce0"},children:[e.jsx("img",{src:"/google-g-logo.svg",alt:"","aria-hidden":"true",className:"h-[18px] w-[18px]",width:18,height:18}),e.jsx("span",{className:"text-sm font-medium",style:{color:"#3c4043"},children:"Sign in with Google"})]})})}const Uc={},ya=t=>Vt(t),$c=()=>{let t=Vt("/api/auth/login/google");if(t||(t="/api/auth/login/google"),/^https?:\/\//i.test(t)||t.startsWith("/")||(t=`/${t}`),typeof window<"u"){const a=window.location&&window.location.origin?window.location.origin.replace(/\/+$/,""):"";if(a){const r=t.includes("?")?"&":"?";t=`${t}${r}return_to=${encodeURIComponent(a)}`}}return t},Oc=({onClose:t})=>{const{login:a}=Ht(),r=s.useMemo($c,[]),[n,o]=s.useState(""),[l,d]=s.useState(""),[N,i]=s.useState(""),[u,j]=s.useState("error"),[c,m]=s.useState("login"),[I,x]=s.useState(""),[v,_]=s.useState(""),[k,h]=s.useState(null),[y,p]=s.useState(!1),[C,M]=s.useState(!1),[b,g]=s.useState(""),[U,se]=s.useState(!1),Z=s.useRef(null),F=s.useRef(null),re=Uc?.VITE_TERMS_VERSION||"2025-09-19",[O,z]=s.useState(!0),[P,E]=s.useState({version:re,url:"/terms"}),[ne,ee]=s.useState(!1),[he,D]=s.useState(!1),H=(te,Ne)=>{if(te==null||te==="")return Ne;if(typeof te=="string")return te;if(Array.isArray(te))return te.map(ke=>{if(!ke)return"";if(typeof ke=="string")return ke;if(ke?.msg){const De=Array.isArray(ke.loc)?ke.loc.join("."):ke.loc;return De?`${ke.msg} (${De})`:ke.msg}try{return JSON.stringify(ke)}catch{return String(ke)}}).filter(Boolean).join(" ")||Ne;if(typeof te=="object"){if(te.detail&&te.detail!==te)return H(te.detail,Ne);if(te.message&&te.message!==te)return H(te.message,Ne);try{const Be=JSON.stringify(te);if(Be&&Be!=="{}")return Be}catch{return Ne}}return String(te)||Ne},ge=(te,Ne="error")=>{i(te),j(Ne)},V=()=>{i(""),j("error")};s.useEffect(()=>{let te=!1;return(async()=>{ee(!0);try{const Be=await fetch(ya("/api/auth/terms/info"));if(!Be.ok)throw new Error("terms_fetch_failed");const ke=await Be.json().catch(()=>({}));te||E({version:ke&&ke.version||re,url:ke&&ke.url||"/terms"})}catch{te||E(ke=>({version:ke&&ke.version||re,url:ke&&ke.url||"/terms"}))}finally{te||ee(!1)}})(),()=>{te=!0}},[re]);const je=async(te,Ne)=>{const Be=new URLSearchParams({username:(te??n).trim(),password:Ne??l});try{const ke=await fetch(ya("/api/auth/token"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Be.toString(),credentials:"include"}),De=await ke.json().catch(()=>({}));if(ke.ok&&De&&De.access_token){a(De.access_token),t();return}if(ke.status===401){const B=H(De?.detail||De?.message,"Invalid email or password.");/confirm your email/i.test(B)?ge(B,"info"):ge(B,"error")}else ge(H(De?.detail||De?.message,"An unexpected error occurred. Please try again."));throw new Error("login_failed")}catch(ke){throw ke.message!=="login_failed"&&ge("An unexpected error occurred. Please try again."),ke}},_e=()=>{const te=n.trim();return te?l?te:(ge("Password is required."),F.current?.focus(),null):(ge("Email is required."),Z.current?.focus(),null)},T=async te=>{te.preventDefault(),V();const Ne=_e();if(Ne){o(Ne);try{await je(Ne,l)}catch{}}},K=async te=>{te.preventDefault(),V();const Ne=_e();if(!Ne)return;o(Ne);const Be=P?.version||re;D(!0);let ke=!1;try{const De=await fetch(ya("/api/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:Ne,password:l,accept_terms:!0,terms_version:Be}),credentials:"include"});if(!De.ok){const ie=await De.json().catch(()=>({}));ke=!0,De.status===400?ge(H(ie?.detail||ie?.message,"A user with this email already exists.")):De.status===422?ge("Invalid email or password format."):ge(H(ie?.detail||ie?.message,"Registration error. Please try again."));return}const B=await De.json().catch(()=>null);if(B&&typeof B=="object"&&(B.is_active===!1||B.isActive===!1)){_(Ne),h(Date.now()+900*1e3),m("verify"),x(""),M(!1),g("");return}await je(Ne,l)}catch{ke||ge("Registration error. Please try again.")}finally{D(!1)}},le=c==="login"?!n.trim()||!l:c==="register"?he||!n.trim()||!l:!1,me=c==="login"?"Sign In":he?"Creating…":"Create Account";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(Ce,{className:"w-full max-w-md mx-4",children:[e.jsxs(Je,{className:"flex flex-row items-center justify-between",children:[e.jsx(Xe,{children:c==="login"?"Sign In":"Create Account"}),e.jsx(A,{variant:"ghost",size:"sm",onClick:t,children:e.jsx(_a,{className:"w-4 h-4"})})]}),e.jsxs(Ae,{children:[c!=="verify"&&e.jsxs("form",{onSubmit:c==="login"?T:K,className:"space-y-4",children:[N&&e.jsx("div",{className:`rounded-md border px-3 py-2 text-sm ${u==="info"?"border-blue-200 bg-blue-50 text-blue-700":u==="success"?"border-emerald-200 bg-emerald-50 text-emerald-700":"border-red-200 bg-red-50 text-red-700"}`,role:"alert","aria-live":"assertive",children:N}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{htmlFor:"email",children:"Email"}),e.jsx(Ye,{ref:Z,id:"email",type:"email",autoComplete:"email",placeholder:"you@example.com",value:n,onChange:te=>o(te.target.value),inputMode:"email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{ref:F,id:"password",type:U?"text":"password",autoComplete:c==="login"?"current-password":"new-password",value:l,onChange:te=>d(te.target.value),className:"pr-20"}),e.jsx(A,{type:"button",variant:"ghost",size:"sm",className:"absolute inset-y-1 right-1 h-7 px-2 text-xs",onClick:()=>se(te=>!te),"aria-pressed":U,"aria-label":U?"Hide password":"Show password",children:U?"Hide":"Show"})]})]}),e.jsx(A,{type:"submit",className:"w-full",disabled:le,children:me}),e.jsx("button",{type:"button",onClick:()=>{m(te=>te==="login"?"register":"login"),V(),D(!1)},className:"w-full text-xs text-blue-600 hover:underline",children:c==="login"?"Need an account? Sign up":"Have an account? Sign in"})]}),c==="verify"&&e.jsxs("div",{className:"space-y-4","data-state":"verify-flow",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["We sent a 6‑digit code to ",e.jsx("strong",{children:v}),". Enter it below or click the link in the email. This code expires in ",k?Math.max(0,Math.floor((k-Date.now())/6e4)):15,"m."]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{htmlFor:"verifyCode",children:"Verification Code"}),e.jsx(Ye,{id:"verifyCode",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,value:I,autoFocus:!0,onChange:te=>x(te.target.value.replace(/[^0-9]/g,"")),placeholder:"123456",className:"tracking-widest text-center text-lg"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{disabled:I.length!==6,onClick:async()=>{V();try{const te=await fetch(ya("/api/auth/confirm-email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:v,code:I}),credentials:"include"}),Ne=await te.json().catch(()=>({}));if(!te.ok){ge(H(Ne?.detail||Ne?.message,"Invalid or expired code."));return}try{await je(v,l)}catch{}}catch{ge("Verification failed.")}},children:"Confirm"}),e.jsx(A,{variant:"outline",onClick:async()=>{if(V(),!y){p(!0);try{await fetch(ya("/api/auth/resend-verification"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:v})}),h(Date.now()+900*1e3),ge("New code sent (check spam folder if not visible).","info")}catch{}p(!1)}},children:"Resend"}),e.jsx(A,{variant:"ghost",onClick:()=>{m("login"),V()},children:"Cancel"})]}),e.jsxs("div",{className:"space-y-2",children:[!C&&e.jsx("button",{className:"text-xs text-blue-600 hover:underline",type:"button",onClick:()=>{M(!0),g(v)},children:"Wrong email? Change it"}),C&&e.jsxs("div",{className:"space-y-2 border rounded p-3",children:[e.jsx(ve,{htmlFor:"newEmail",children:"New Email"}),e.jsx(Ye,{id:"newEmail",type:"email",value:b,onChange:te=>g(te.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{size:"sm",disabled:!b.trim()||b===v,onClick:async()=>{V();try{const te=await fetch(ya("/api/auth/update-pending-email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({old_email:v,new_email:b.trim()})});if(!te.ok){const Ne=await te.json().catch(()=>({}));ge(H(Ne?.detail||Ne?.message,"Unable to update email."));return}_(b.trim()),h(Date.now()+900*1e3),x(""),M(!1),ge("Email updated. New code sent.","info")}catch{ge("Update failed")}},children:"Save"}),e.jsx(A,{size:"sm",variant:"ghost",onClick:()=>{M(!1)},children:"Cancel"})]})]})]})]}),c!=="verify"&&e.jsxs("div",{className:"relative my-4",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-muted-foreground",children:"Or continue with"})})]}),c!=="verify"&&e.jsx(Lc,{href:r})]})]})})};function Nn(){const[t,a]=s.useState(!1),[r,n]=s.useState(!1),[o,l]=s.useState([]),{brand:d}=fr();s.useEffect(()=>{try{new URLSearchParams(window.location.search).get("login")==="1"&&n(!0)}catch{}},[]),s.useEffect(()=>{(async()=>{try{const i=await G().get("/api/public/episodes");l(Array.isArray(i.items)?i.items:[])}catch{}})()},[]);const N=()=>{a(!t)};return e.jsxs("div",{className:"min-h-screen bg-white",children:[r&&e.jsx(Oc,{onClose:()=>n(!1)}),e.jsx("nav",{className:"px-4 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"container mx-auto max-w-6xl flex justify-between items-center",children:[e.jsx(gr,{size:28,lockup:!0}),e.jsxs("div",{className:"hidden md:flex items-center space-x-8",children:[e.jsx("a",{href:"#how-it-works",className:"text-gray-600 hover:text-gray-800 transition-colors",children:"How It Works"}),e.jsx("a",{href:"#testimonials",className:"text-gray-600 hover:text-gray-800 transition-colors",children:"Reviews"}),e.jsx("a",{href:"#faq",className:"text-gray-600 hover:text-gray-800 transition-colors",children:"FAQ"}),e.jsx("a",{href:"/subscriptions",className:"text-gray-600 hover:text-gray-800 transition-colors",children:"Subscriptions"}),e.jsx(A,{onClick:()=>n(!0),variant:"outline",className:"border-2 bg-transparent",style:{borderColor:"#2C3E50",color:"#2C3E50"},children:"Sign In"})]})]})}),e.jsxs("section",{className:"px-4 py-16 md:py-24 lg:py-32 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50 to-purple-50 opacity-30"}),e.jsxs("div",{className:"container mx-auto max-w-5xl text-center relative z-10",children:[e.jsx(pt,{className:"mb-6 px-4 py-2 text-sm font-medium",style:{backgroundColor:"#ECF0F1",color:"#2C3E50"},children:"🎉 Over 10,000 podcasters trust Podcast Plus Plus"}),e.jsx("h1",{className:"text-4xl md:text-6xl lg:text-7xl font-bold mb-6 leading-tight",style:{color:"#2C3E50"},children:d.heroH1}),e.jsx("p",{className:"text-xl md:text-2xl lg:text-3xl mb-8 text-gray-600 max-w-4xl mx-auto leading-relaxed",children:d.heroSub}),e.jsxs("p",{className:"text-lg md:text-xl mb-12 text-gray-500 max-w-3xl mx-auto",children:["Join thousands of creators who've discovered the joy of effortless podcasting.",e.jsx("strong",{className:"text-gray-700",children:" Average setup time: Under 5 minutes."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center mb-12",children:[e.jsxs(A,{size:"lg",onClick:()=>n(!0),className:"text-lg px-8 py-6 font-semibold rounded-[var(--radius)] hover:opacity-90 transition-all transform hover:scale-105 shadow-lg",children:["Make my first episode",e.jsx(nn,{className:"ml-2 w-5 h-5"})]}),e.jsxs(A,{variant:"outline",size:"lg",className:"text-lg px-8 py-6 font-semibold rounded-[var(--radius)] border bg-secondary text-secondary-foreground hover:opacity-90 transition-all",onClick:N,children:[e.jsx(Xt,{className:"mr-2 w-5 h-5"}),"See how it works"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-6 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(as,{className:"w-4 h-4 mr-2 text-green-500"}),"Free 14-day trial"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(as,{className:"w-4 h-4 mr-2 text-green-500"}),"No credit card required"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(as,{className:"w-4 h-4 mr-2 text-green-500"}),"Cancel anytime"]})]})]})]}),e.jsx("section",{className:"px-4 py-12",style:{backgroundColor:"#ECF0F1"},children:e.jsx("div",{className:"container mx-auto max-w-4xl",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-8 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-2",style:{color:"#2C3E50"},children:"10K+"}),e.jsx("div",{className:"text-gray-600",children:"Active Podcasters"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-2",style:{color:"#2C3E50"},children:"50K+"}),e.jsx("div",{className:"text-gray-600",children:"Episodes Published"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-2",style:{color:"#2C3E50"},children:"95%"}),e.jsx("div",{className:"text-gray-600",children:"Customer Satisfaction"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-2",style:{color:"#2C3E50"},children:"5 Min"}),e.jsx("div",{className:"text-gray-600",children:"Average Setup Time"})]})]})})}),e.jsx("section",{id:"how-it-works",className:"px-4 py-16 md:py-24",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-6",style:{color:"#2C3E50"},children:"How It Works: Podcasting, Simplified."}),e.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Three simple steps to go from idea to published podcast. No technical expertise required."})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-8 lg:gap-12",children:[e.jsxs("div",{className:"text-center group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center shadow-lg group-hover:shadow-xl transition-all transform group-hover:scale-105",children:e.jsx(Ys,{className:"w-12 h-12",style:{color:"#2C3E50"}})}),e.jsx(pt,{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1",children:"Step 1"})]}),e.jsx("h3",{className:"text-xl md:text-2xl font-semibold mb-4",style:{color:"#2C3E50"},children:"Record or Generate Audio"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed mb-4",children:"Simply speak into your device, upload existing audio, or let our AI generate content from your notes."}),e.jsx("div",{className:"text-sm text-gray-500",children:"✓ Works with any device • ✓ AI content generation • ✓ Multiple formats supported"})]}),e.jsxs("div",{className:"text-center group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-green-100 to-blue-100 flex items-center justify-center shadow-lg group-hover:shadow-xl transition-all transform group-hover:scale-105",children:e.jsx(aa,{className:"w-12 h-12",style:{color:"#2C3E50"}})}),e.jsx(pt,{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1",children:"Step 2"})]}),e.jsx("h3",{className:"text-xl md:text-2xl font-semibold mb-4",style:{color:"#2C3E50"},children:"Automate Production & Polishing"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed mb-4",children:"Our AI handles editing, noise reduction, music, and professional formatting automatically."}),e.jsx("div",{className:"text-sm text-gray-500",children:"✓ Auto noise removal • ✓ Music & intros • ✓ Professional editing"})]}),e.jsxs("div",{className:"text-center group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-purple-100 to-pink-100 flex items-center justify-center shadow-lg group-hover:shadow-xl transition-all transform group-hover:scale-105",children:e.jsx(ci,{className:"w-12 h-12",style:{color:"#2C3E50"}})}),e.jsx(pt,{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1",children:"Step 3"})]}),e.jsx("h3",{className:"text-xl md:text-2xl font-semibold mb-4",style:{color:"#2C3E50"},children:"Publish & Share Instantly"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed mb-4",children:"Your podcast goes live on Spotify, Apple Podcasts, and 20+ platforms with just one click."}),e.jsx("div",{className:"text-sm text-gray-500",children:"✓ 20+ platforms • ✓ Automatic distribution • ✓ Analytics included"})]})]}),e.jsx("div",{className:"text-center mt-12",children:e.jsx(A,{size:"lg",className:"text-lg px-8 py-4 rounded-lg font-semibold text-white hover:opacity-90 transition-all",style:{backgroundColor:"#2C3E50"},children:"Try It Free for 14 Days"})})]})}),e.jsx("section",{className:"px-4 py-16 md:py-24",style:{backgroundColor:"#ECF0F1"},children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-8",style:{color:"#2C3E50"},children:"Why 10,000+ Creators Choose Podcast Plus Plus"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[e.jsx(Ce,{className:"border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105 bg-white",children:e.jsxs(Ae,{className:"p-8 text-center",children:[e.jsx(li,{className:"w-16 h-16 mx-auto mb-6",style:{color:"#2C3E50"}}),e.jsx("h3",{className:"text-2xl font-semibold mb-4",style:{color:"#2C3E50"},children:"Save 10+ Hours Per Episode"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed",children:"What used to take days now takes minutes. Spend your time creating content, not fighting technology."})]})}),e.jsx(Ce,{className:"border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105 bg-white",children:e.jsxs(Ae,{className:"p-8 text-center",children:[e.jsx(Vr,{className:"w-16 h-16 mx-auto mb-6",style:{color:"#2C3E50"}}),e.jsx("h3",{className:"text-2xl font-semibold mb-4",style:{color:"#2C3E50"},children:"Zero Technical Knowledge Required"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed",children:"If you can send an email, you can create a professional podcast. We handle all the complex stuff."})]})}),e.jsx(Ce,{className:"border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105 bg-white",children:e.jsxs(Ae,{className:"p-8 text-center",children:[e.jsx(ta,{className:"w-16 h-16 mx-auto mb-6",style:{color:"#2C3E50"}}),e.jsx("h3",{className:"text-2xl font-semibold mb-4",style:{color:"#2C3E50"},children:"Studio-Quality Results"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed",children:"Professional sound quality that rivals expensive studios, without the expensive equipment."})]})})]})]})})}),e.jsx("section",{id:"testimonials",className:"px-4 py-16 md:py-24",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[o.length>0&&e.jsxs("div",{className:"mb-16",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",style:{color:"#2C3E50"},children:"Recently Published with Plus Plus"}),e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:o.map(i=>e.jsxs(Ce,{className:"overflow-hidden",children:[e.jsx("div",{className:"h-40 bg-gray-100",children:i.cover_url?e.jsx("img",{src:i.cover_url,alt:i.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-400",children:"No Cover"})}),e.jsx(Je,{children:e.jsx(Xe,{className:"text-lg line-clamp-1",children:i.title})}),e.jsxs(Ae,{children:[e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3 mb-2",children:i.description}),i.final_audio_url&&e.jsx("audio",{controls:!0,src:i.final_audio_url,className:"w-full"})]})]},i.id))})]}),e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-6",style:{color:"#2C3E50"},children:"Real Stories from Real Podcasters"}),e.jsxs("div",{className:"flex justify-center items-center mb-8",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((i,u)=>e.jsx(er,{className:"w-6 h-6 fill-yellow-400 text-yellow-400"},u))}),e.jsx("span",{className:"ml-2 text-lg text-gray-600",children:"4.9/5 from 2,847 reviews"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[e.jsx(Ce,{className:"border-0 shadow-lg hover:shadow-xl transition-all bg-white",children:e.jsxs(Ae,{className:"p-8",children:[e.jsx("div",{className:"flex mb-4",children:[...Array(5)].map((i,u)=>e.jsx(er,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},u))}),e.jsx("p",{className:"text-gray-700 leading-relaxed mb-6 text-lg",children:'"I was terrified of the technical side of podcasting. Podcast Plus Plus made it so simple that I launched my first episode in under 30 minutes! Now I have 50+ episodes and growing."'}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:"https://placehold.co/60x60/E2E8F0/A0AEC0?text=Avatar",alt:"Sarah Johnson",width:60,height:60,className:"rounded-full mr-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",style:{color:"#2C3E50"},children:"Sarah Johnson"}),e.jsx("p",{className:"text-gray-600",children:"Small Business Owner • 6 months on Plus Plus"})]})]})]})}),e.jsx(Ce,{className:"border-0 shadow-lg hover:shadow-xl transition-all bg-white",children:e.jsxs(Ae,{className:"p-8",children:[e.jsx("div",{className:"flex mb-4",children:[...Array(5)].map((i,u)=>e.jsx(er,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},u))}),e.jsx("p",{className:"text-gray-700 leading-relaxed mb-6 text-lg",children:`"I've saved 15+ hours every week since switching to Podcast Plus Plus. The AI editing is incredible - it sounds better than when I did it manually!"`}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:"https://placehold.co/60x60/E2E8F0/A0AEC0?text=Avatar",alt:"Robert Chen",width:60,height:60,className:"rounded-full mr-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",style:{color:"#2C3E50"},children:"Robert Chen"}),e.jsx("p",{className:"text-gray-600",children:"Retired Teacher • 1 year on Plus Plus"})]})]})]})}),e.jsx(Ce,{className:"border-0 shadow-lg hover:shadow-xl transition-all bg-white",children:e.jsxs(Ae,{className:"p-8",children:[e.jsx("div",{className:"flex mb-4",children:[...Array(5)].map((i,u)=>e.jsx(er,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},u))}),e.jsx("p",{className:"text-gray-700 leading-relaxed mb-6 text-lg",children:'"My podcast now reaches 10,000+ listeners monthly. The automatic distribution to all platforms was a game-changer for my reach!"'}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:"https://placehold.co/60x60/E2E8F0/A0AEC0?text=Avatar",alt:"Maria Rodriguez",width:60,height:60,className:"rounded-full mr-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",style:{color:"#2C3E50"},children:"Maria Rodriguez"}),e.jsx("p",{className:"text-gray-600",children:"Community Leader • 8 months on Plus Plus"})]})]})]})})]})]})}),e.jsx("section",{id:"faq",className:"px-4 py-16 md:py-24",style:{backgroundColor:"#ECF0F1"},children:e.jsxs("div",{className:"container mx-auto max-w-4xl",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-6",style:{color:"#2C3E50"},children:"Frequently Asked Questions"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Everything you need to know about getting started with Podcast Plus Plus"})]}),e.jsx("div",{className:"space-y-6",children:[{q:"Do I need any technical experience to use Podcast Plus Plus?",a:"Absolutely not! Plus Plus is designed for complete beginners. If you can use email, you can create professional podcasts with our platform."},{q:"How long does it take to publish my first episode?",a:"Most users publish their first episode within 30 minutes of signing up. Our average setup time is under 5 minutes, and episode creation takes just a few more minutes."},{q:"What platforms will my podcast be available on?",a:"Your podcast will automatically be distributed to 20+ major platforms including Spotify, Apple Podcasts, Google Podcasts, and many more with just one click."},{q:"Is there really a free trial with no credit card required?",a:"Yes! You get full access to all features for 14 days completely free. No credit card required, no hidden fees, and you can cancel anytime."},{q:"What if I'm not satisfied with the service?",a:"We offer a 30-day money-back guarantee. If you're not completely satisfied, we'll refund your payment, no questions asked."}].map((i,u)=>e.jsx(Ce,{className:"border-0 shadow-md bg-white",children:e.jsxs(Ae,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",style:{color:"#2C3E50"},children:i.q}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:i.a})]})},u))})]})}),e.jsx("section",{className:"px-4 py-16 md:py-24",children:e.jsxs("div",{className:"container mx-auto max-w-5xl text-center",children:[e.jsx("h2",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-6",style:{color:"#2C3E50"},children:"Ready to Start Your Podcast Journey?"}),e.jsx("p",{className:"text-xl md:text-2xl mb-8 text-gray-600 leading-relaxed max-w-3xl mx-auto",children:"Join over 10,000 creators who've discovered the joy of effortless podcasting. Start your free trial today - no credit card required."}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center mb-8",children:e.jsxs(A,{size:"lg",onClick:()=>n(!0),className:"text-xl px-10 py-6 rounded-lg font-semibold text-white hover:opacity-90 transition-all transform hover:scale-105 shadow-lg",style:{backgroundColor:"#2C3E50"},children:["Start Your Free 14-Day Trial",e.jsx(nn,{className:"ml-2 w-6 h-6"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-6 text-sm text-gray-500 mb-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(as,{className:"w-4 h-4 mr-2 text-green-500"}),"14-day free trial"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(as,{className:"w-4 h-4 mr-2 text-green-500"}),"No credit card required"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(as,{className:"w-4 h-4 mr-2 text-green-500"}),"30-day money-back guarantee"]})]}),e.jsx("div",{className:"text-center",children:e.jsx(pt,{className:"px-4 py-2 text-sm font-medium",style:{backgroundColor:"#ECF0F1",color:"#2C3E50"},children:"🔒 Trusted by 10,000+ podcasters worldwide"})})]})}),e.jsx("footer",{className:"px-4 py-12 border-t border-gray-200",style:{backgroundColor:"#ECF0F1"},children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 mb-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Ur,{className:"w-6 h-6",style:{color:"#2C3E50"}}),e.jsx("span",{className:"text-xl font-bold",style:{color:"#2C3E50"},children:"Podcast Plus Plus"})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Making podcasting accessible to everyone, regardless of technical expertise."}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded"}),e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded"}),e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",style:{color:"#2C3E50"},children:"Product"}),e.jsxs("ul",{className:"space-y-2 text-gray-600",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Features"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Pricing"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Templates"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Integrations"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",style:{color:"#2C3E50"},children:"Support"}),e.jsxs("ul",{className:"space-y-2 text-gray-600",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Help Center"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Contact Us"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Tutorials"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Community"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",style:{color:"#2C3E50"},children:"Company"}),e.jsxs("ul",{className:"space-y-2 text-gray-600",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"About Us"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Blog"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Careers"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Press"})})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-8 flex flex-col md:flex-row justify-between items-center",children:[e.jsx("p",{className:"text-gray-600 mb-4 md:mb-0",children:"Podcast Plus Plus © 2025. All rights reserved."}),e.jsxs("div",{className:"flex space-x-6",children:[e.jsx("a",{href:"/privacy",className:"text-gray-600 hover:text-gray-800 transition-colors",children:"Privacy Policy"}),e.jsx("a",{href:"/terms",className:"hover:text-gray-800 transition-colors",children:"Terms of Use"}),e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Cookie Policy"})]})]})]})})]})}function _n(){const{user:t,token:a,logout:r}=Ht(),{toast:n}=Lt(),[o,l]=s.useState(t?.email||""),[d,N]=s.useState(""),[i,u]=s.useState(!1),j=async c=>{if(c?.preventDefault?.(),!!o){u(!0);try{const m=await fetch(Vt("/api/public/waitlist"),{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify({email:o,note:d||void 0})});if(m.ok)n({title:"Request received",description:"We'll notify you as soon as a spot opens."}),N("");else{let I="Please try again later.";try{const x=await m.json();I=x?.error?.message||x?.detail||I}catch{}n({title:"Couldn't save your request",description:I,variant:"destructive"})}}catch{n({title:"Network error",description:"Check your connection and try again.",variant:"destructive"})}finally{u(!1)}}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-white p-4",children:e.jsxs(Ce,{className:"w-full max-w-xl shadow-sm border-slate-200",children:[e.jsx(Je,{children:e.jsx(Xe,{className:"text-2xl",children:"Private preview access"})}),e.jsxs(Ae,{className:"space-y-5 text-slate-700",children:[e.jsx("p",{children:"This application is currently in a closed alpha. If you've recently signed up and we recognize your email, your account will be approved shortly. If you'd like to join the pre-launch test group, leave your email below and we'll reach out as soon as new slots open."}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{htmlFor:"email",children:"Email"}),e.jsx(Ye,{id:"email",type:"email",required:!0,value:o,onChange:c=>l(c.target.value),placeholder:"you@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{htmlFor:"note",children:"Optional note"}),e.jsx(Ye,{id:"note",type:"text",value:d,onChange:c=>N(c.target.value),placeholder:"Tell us a bit about your use case"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx(A,{type:"submit",disabled:i,children:i?"Sending...":"Request early access"}),e.jsx(A,{type:"button",variant:"outline",onClick:r,children:"Sign out"})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"We'll only use your email to notify you about access and important updates. No spam."})]})]})]})})}const zc=_l,zi=s.forwardRef(({className:t,...a},r)=>e.jsx(Kn,{asChild:!0,...a,children:e.jsx("div",{ref:r,role:"region","aria-label":"Notifications",className:at("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t)})}));zi.displayName=Kn.displayName;const Bc=pr("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Bi=s.forwardRef(({className:t,variant:a,...r},n)=>e.jsx(Jn,{ref:n,className:at(Bc({variant:a}),t),...r}));Bi.displayName=Jn.displayName;const Wc=s.forwardRef(({className:t,...a},r)=>e.jsx(Qn,{ref:r,className:at("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...a}));Wc.displayName=Qn.displayName;const Wi=s.forwardRef(({className:t,...a},r)=>e.jsx(Xn,{ref:r,className:at("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...a,children:e.jsx(_a,{className:"h-4 w-4"})}));Wi.displayName=Xn.displayName;const qi=s.forwardRef(({className:t,...a},r)=>e.jsx(Zn,{ref:r,className:at("text-sm font-semibold [&+div]:text-xs",t),...a}));qi.displayName=Zn.displayName;const Vi=s.forwardRef(({className:t,...a},r)=>e.jsx(ei,{ref:r,className:at("text-sm opacity-90",t),...a}));Vi.displayName=ei.displayName;function qc(){const{toasts:t}=Lt();return e.jsxs(zc,{children:[t.map(function({id:a,title:r,description:n,action:o,...l}){return e.jsxs(Bi,{...l,children:[e.jsxs("div",{className:"grid gap-1",children:[r&&e.jsx(qi,{children:r}),n&&e.jsx(Vi,{children:n})]}),o,e.jsx(Wi,{"aria-label":"Close notification"})]},a)}),e.jsx(zi,{"aria-label":"Notifications"})]})}function Yi({title:t,description:a}){return s.useEffect(()=>{t&&(document.title=t)},[t]),null}const Hi=`<h1>Terms of Use</h1>
<p><em>Last updated: September 16, 2025</em></p>
<p>These Terms of Use (the <strong>&quot;Terms&quot;</strong>) form a binding agreement between <strong>Chainsaw Enterprises</strong>, doing business as <strong>Podcast Plus Plus</strong> (&quot;<strong>we</strong>,&quot; &quot;<strong>us</strong>,&quot; or &quot;<strong>our</strong>&quot;), and you (&quot;<strong>you</strong>&quot; or &quot;<strong>user</strong>&quot;). By accessing or using <strong>podcastplusplus.com (and related apps/subdomains)</strong> and any related apps, products, and services (collectively, the &quot;<strong>Service</strong>&quot;), you agree to these Terms and to our <strong><a href="https://podcastplusplus.com/privacy">https://podcastplusplus.com/privacy</a></strong>. If you do not agree, do not use the Service.</p>
<blockquote>
<p><strong>Important notes</strong></p>
<ul>
<li>If you are accepting on behalf of an organization, you represent that you have authority to bind that organization to these Terms.</li>
<li>The Service is intended for users <strong>13 years of age or older</strong>. If you are under 18 (or the age of majority in your jurisdiction), you may use the Service only with consent and supervision of a parent or guardian.</li>
</ul>
</blockquote>
<hr>
<h2>1) Your Account &amp; Security</h2>
<ul>
<li>You must provide accurate account information and keep it updated.</li>
<li>You are responsible for maintaining the confidentiality of your login credentials and for all activities that occur under your account.</li>
<li>Notify us immediately of any unauthorized use of your account.</li>
</ul>
<h2>2) Subscriptions, Billing &amp; Processing Minutes</h2>
<p>Some features are offered via paid subscriptions or usage-based plans (&quot;<strong>Plans</strong>&quot;). Plan details, prices, and inclusions are shown at checkout or in your account.</p>
<p><strong>2.1 Billing.</strong> You authorize us (and our payment processors) to charge your payment method for all fees, taxes, and recurring amounts per your Plan. Unless stated otherwise, fees are <strong>non-refundable</strong> and prepaid for the applicable term.</p>
<p><strong>2.2 Processing Minutes.</strong> Certain features (e.g., transcription, AI processing, audio effects) consume <strong>processing minutes</strong> or similar units. <strong>Processing minutes are deducted once a job begins and are not returned if you later delete the job or its outputs.</strong> If we determine that a job failed <strong>due to a Service error</strong>, we may, at our discretion, restore the affected minutes or re-run the job at no additional cost. We do not restore minutes for user errors, incompatible source files, content policy violations, or third-party failures outside our reasonable control. **In rare, case-by-case circumstances, we may offer credits or refunds at our sole discretion; our decision is final.**g., transcription, AI processing, audio effects) consume <strong>processing minutes</strong> or similar units. <strong>Processing minutes are deducted once a job begins and are not returned if you later delete the job or its outputs.</strong> If we determine that a job failed <strong>due to a Service error</strong>, we may, at our discretion, restore the affected minutes or re-run the job at no additional cost. We do not restore minutes for user errors, incompatible source files, content policy violations, or third-party failures outside our reasonable control.</p>
<p><strong>2.3 Changes to Plans and Pricing.</strong> We may modify Plans, features, or pricing with prior notice as required by law. Changes will apply after your current term unless otherwise stated.</p>
<p><strong>2.4 Cancellation.</strong> You may cancel at any time in your account settings. Your access remains through the end of your current billing period. <strong>No refunds</strong> for partial periods unless required by law.</p>
<h2>3) Acceptable Use</h2>
<p>You agree <strong>not</strong> to:</p>
<ul>
<li>Violate any law or infringe any third-party rights (e.g., copyright, trademark, privacy, publicity, contractual, or confidentiality rights).</li>
<li>Upload or process content that is unlawful, harassing, defamatory, obscene, exploitative, or otherwise objectionable.</li>
<li>Record or upload audio without <strong>all legally required consents</strong> (e.g., in two-party consent states).</li>
<li>Attempt to reverse engineer, decompile, or otherwise access the Service&#39;s source code except where permitted by law.</li>
<li>Interfere with or disrupt the Service, circumvent security or usage limits, or attempt unauthorized access to systems or data.</li>
<li>Use any scraping, data mining, or automated means not expressly permitted by us.</li>
</ul>
<p>We may investigate and take appropriate action, including removing content, suspending or terminating accounts, and reporting unlawful activity to authorities.</p>
<h2>4) Your Content &amp; License to Us</h2>
<p><strong>You own your content.</strong> Between you and us, you retain rights to audio, transcripts, text, images, and other content you submit (&quot;<strong>User Content</strong>&quot;). You grant us a <strong>worldwide, non-exclusive, royalty-free license</strong> to host, store, process, transcode, analyze, modify (solely as necessary to provide the Service), and display User Content to you and those you authorize, for the purpose of operating, improving, and supporting the Service. This license also allows us to generate and store derivative technical data (e.g., transcripts, embeddings, logs) needed to provide features to you.</p>
<p>You represent and warrant that you have all licenses, rights, and consents necessary to submit and process User Content with the Service.</p>
<p>You may delete User Content from within the product where supported. Backups and logs may persist for a limited time consistent with our retention practices.</p>
<h2>5) AI &amp; Third-Party Services</h2>
<p>The Service may leverage AI models and third-party providers (e.g., hosting, transcription, text-to-speech, analytics, podcast distribution). <strong>Third-party services are subject to their own terms and privacy policies</strong> and we are not responsible for their actions, uptime, or outputs.</p>
<p><strong>AI limitations.</strong> AI outputs can be inaccurate, incomplete, or inappropriate. You are responsible for reviewing outputs before publishing and for complying with applicable laws (including disclosures for AI-generated content where required).</p>
<h2>6) Intellectual Property</h2>
<p>The Service (including software, designs, interfaces, and documentation) and all related IP are owned by us and our licensors. Except for the limited rights expressly granted, we reserve all rights.</p>
<p>You may provide feedback or suggestions; you grant us a perpetual, irrevocable, worldwide, royalty-free license to use them without restriction.</p>
<h2>7) Copyright &amp; DMCA</h2>
<p>If you believe content on the Service infringes your copyright, you may submit a notice under the Digital Millennium Copyright Act (DMCA) to our agent:</p>
<ul>
<li><strong>DMCA Agent:</strong> Scott Gerhardt</li>
<li><strong>Address:</strong> 121 W Lexington Dr Suite 236, Glendale, CA 91203</li>
<li><strong>Email:</strong> <a href="mailto:Scott@thebsgcompany.com">Scott@thebsgcompany.com</a></li>
</ul>
<p>Your notice must include the information required by 17 U.S.C. Section 512(c)(3). We may notify the user who posted the material and provide a process for counter-notification where applicable.</p>
<h2>8) Privacy</h2>
<p>Your use of the Service is subject to our <strong>[Privacy Policy URL]</strong>, which explains how we collect, use, and share information. Where required by law (e.g., California, EU/UK), you may have certain rights over your personal data. Please review the Privacy Policy for details.</p>
<h2>9) Disclaimers</h2>
<p>THE SERVICE AND ALL OUTPUTS ARE PROVIDED <strong>&quot;AS IS&quot;</strong> AND <strong>&quot;AS AVAILABLE.&quot;</strong> TO THE MAXIMUM EXTENT PERMITTED BY LAW, WE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT. WE DO NOT WARRANT THAT THE SERVICE WILL BE ERROR-FREE, UNINTERRUPTED, OR FREE OF HARMFUL COMPONENTS.</p>
<h2>10) Limitation of Liability</h2>
<p>TO THE MAXIMUM EXTENT PERMITTED BY LAW, <strong>OUR TOTAL LIABILITY</strong> FOR ALL CLAIMS ARISING OUT OF OR RELATED TO THE SERVICE <strong>WILL NOT EXCEED THE AMOUNTS YOU PAID TO US IN THE 12 MONTHS BEFORE THE EVENT GIVING RISE TO LIABILITY</strong> OR <strong>$100</strong> IF YOU HAVE NOT PAID ANY AMOUNTS. WE ARE NOT LIABLE FOR INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, EXEMPLARY, OR PUNITIVE DAMAGES, OR FOR LOST PROFITS, REVENUE, DATA, OR GOODWILL.</p>
<p>Some jurisdictions do not allow certain limitations; in those cases, these limitations apply only to the extent permitted by law.</p>
<h2>11) Indemnification</h2>
<p>You will indemnify and hold us harmless from and against any claims, liabilities, damages, losses, and expenses (including reasonable attorneys&#39; fees) arising out of or related to: (a) your User Content; (b) your use of the Service; (c) your violation of these Terms; or (d) your violation of any law or third-party rights.</p>
<h2>12) Termination</h2>
<p>You may stop using the Service at any time. We may suspend or terminate your access immediately if you violate these Terms, create risk or possible legal exposure, fail to pay fees when due, or if we stop offering the Service. Upon termination, your right to use the Service ends, but certain sections (including IP, disclaimers, limitations, indemnities, and dispute provisions) will survive.</p>
<h2>13) Changes to the Service or Terms</h2>
<p>We may update the Service and these Terms from time to time. If we make material changes, we will provide notice (e.g., by email or in-product). Changes take effect upon posting or as otherwise stated. Your continued use after changes become effective means you accept the updated Terms.</p>
<h2>14) Governing Law; Dispute Resolution</h2>
<p>These Terms are governed by the laws of the <strong>State of California</strong>, without regard to its conflict of laws rules.</p>
<p><strong>Arbitration &amp; Class Action Waiver.</strong> Any dispute, claim, or controversy arising out of or relating to these Terms or the Service will be resolved by <strong>binding arbitration</strong> administered by the <strong>American Arbitration Association (AAA)</strong> under its <strong>Consumer Arbitration Rules</strong>, as modified by these Terms. Arbitration will be conducted by a single arbitrator in <strong>Los Angeles County, California</strong>, or remotely by video conference if the arbitrator permits. <strong>You and we both waive any right to a jury trial and to participate in a class action, class arbitration, or representative proceeding.</strong></p>
<p>Either party may bring an individual action in <strong>small claims court</strong> in Los Angeles County, California, instead of arbitration. This Section does not prevent either party from seeking <strong>injunctive or equitable relief</strong> in a court of competent jurisdiction to protect intellectual property or prevent unauthorized use of the Service.</p>
<p>If any part of this Section is found unenforceable, the remainder will still apply, and the unenforceable part will be severed to the minimum extent necessary.</p>
<h2>15) Export &amp; Sanctions</h2>
<p>You may not use or export the Service except as authorized by U.S. law and the laws of the jurisdiction(s) where the Service is provided. You represent you are not located in, under the control of, or a national/resident of any embargoed country or prohibited party list.</p>
<h2>16) Communications</h2>
<p>You consent to receive service-related communications electronically (e.g., emails, in-app messages). You may opt out of non-essential marketing emails.</p>
<h2>17) Miscellaneous</h2>
<p>If any provision is unenforceable, the remainder remains in effect. You may not assign these Terms without our prior written consent; we may assign them as part of a merger, acquisition, or sale of assets. These Terms (plus any referenced policies) are the entire agreement between you and us regarding the Service and supersede prior agreements.</p>
<h2>18) Contact</h2>
<p><strong>Chainsaw Enterprises</strong><br><strong>121 W Lexington Dr Suite 236, Glendale, CA 91203</strong><br><strong><a href="mailto:Scott@thebsgcompany.com">Scott@thebsgcompany.com</a></strong></p>
<hr>
<h3>Annex A - Feature-Specific Notices (Optional)</h3>
<p><strong>Recording Consent.</strong> You are solely responsible for obtaining all legally required consents before recording or uploading conversations. Laws vary by jurisdiction (e.g., one-party vs two-party consent states in the U.S.).</p>
<p><strong>Podcast Distribution Integrations.</strong> Some features rely on third-party services (e.g., hosting, analytics, ad networks). Availability and accuracy of analytics (e.g., downloads vs plays) are governed by those providers&#39; systems.</p>
<p><strong>Beta Features.</strong> Certain features may be labeled &quot;beta,&quot; &quot;preview,&quot; or &quot;experimental&quot; and may be subject to additional limitations, interruptions, or change.</p>
<p><strong>Service-Level Expectations.</strong> Unless you have a separate written agreement with us, we do not guarantee specific turnaround times, uptime, or support response times.</p>
<p><strong>Content Moderation.</strong> We may remove or disable content that violates these Terms or our policies, or if we receive a credible complaint or court order.</p>
<hr>
<h3>Short Summary (non-binding)</h3>
<ul>
<li>You must have rights to the content you upload and get consent from anyone you record.</li>
<li>Processing minutes are consumed when a job starts and are <strong>not</strong> refunded if you later delete outputs; we may restore minutes only for confirmed Service errors.</li>
<li>We use third-party services and AI; outputs can be wrong--review them before publishing.</li>
<li>We disclaim broad warranties and limit our liability to what you paid in the last 12 months (or $100).</li>
<li>Disputes: choose <strong>either</strong> arbitration or courts in your state.</li>
</ul>
`;function Vc(){const{user:t,acceptTerms:a,logout:r}=Ht(),[n,o]=s.useState(!1),[l,d]=s.useState(""),N=t?.terms_version_required||t?.terms_version_accepted||"",i=async()=>{if(N){o(!0),d("");try{await a(N)}catch(u){const j=u?.detail||u?.message||"Unable to record acceptance. Please try again.";d(j)}finally{o(!1)}}};return e.jsx("div",{className:"min-h-screen bg-slate-100 py-10",children:e.jsx("div",{className:"mx-auto w-full max-w-4xl px-4",children:e.jsxs(Ce,{className:"shadow-xl",children:[e.jsxs(Je,{children:[e.jsx(Xe,{className:"text-2xl font-semibold text-slate-900",children:"Updated Terms of Use"}),e.jsx("p",{className:"text-sm text-slate-600",children:"To continue using Podcast Plus Plus we need you to review and accept the most recent terms. The full agreement is below for your records."})]}),e.jsxs(Ae,{children:[e.jsxs("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3 text-sm text-slate-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-800",children:"Required version:"})," ",N||"Unspecified"]}),e.jsxs("div",{children:["Need a larger view?"," ",e.jsx("a",{href:"/terms",target:"_blank",rel:"noreferrer",className:"font-medium text-blue-600 hover:text-blue-700",children:"Open the Terms in a new tab"})]})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto rounded-lg border border-slate-200 bg-white p-6",children:e.jsx("article",{className:"prose prose-slate max-w-none",dangerouslySetInnerHTML:{__html:Hi}})}),l&&e.jsx("div",{className:"mt-4 rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",role:"alert",children:l})]}),e.jsxs(Gr,{className:"flex flex-col items-stretch gap-3 md:flex-row md:justify-end",children:[e.jsx(A,{variant:"outline",onClick:r,disabled:n,children:"Sign out"}),e.jsx(A,{onClick:i,disabled:n,children:n?"Recording acceptance…":"I Agree"})]})]})})})}function Yc(t){if(!t)return"";try{const a=new Date(t),r=new Date,n=l=>String(l).padStart(2,"0");return a.toDateString()===r.toDateString()?`${n(a.getHours())}:${n(a.getMinutes())}`:`${a.getMonth()+1}/${a.getDate()} ${n(a.getHours())}:${n(a.getMinutes())}`}catch{return""}}function Hc({onSwitch:t,active:a}){const{token:r,user:n}=Ht()||{},{brand:o}=fr(),l=[{id:"dashboard",label:"Dashboard"},{id:"creator-upload",label:"New Episode"},{id:"settings",label:"Settings"}],[d,N]=s.useState([]),[i,u]=s.useState(!1),j=s.useMemo(()=>n&&[n.picture,n.avatar,n.photo_url,n.image_url,n.picture_url,n.profile&&n.profile.picture,Array.isArray(n.photos)&&n.photos[0]&&n.photos[0].value,Array.isArray(n.identities)&&n.identities[0]&&n.identities[0].picture,Array.isArray(n.providerData)&&n.providerData[0]&&n.providerData[0].photoURL,n.user_metadata&&n.user_metadata.avatar_url,n.oauth_picture].filter(Boolean).find(k=>typeof k=="string"&&k.trim().length>0)||null,[n]),c=s.useMemo(()=>{if(!n)return"";const v=[n.first_name,n.last_name].filter(Boolean).join(" ")||n.name||"";return v.trim()?v.trim().split(/\s+/).slice(0,2).map(k=>k[0]).join("").toUpperCase():n.email?n.email.slice(0,2).toUpperCase():""},[n]);s.useEffect(()=>{let v=!1;if(!r){N([]);return}return(async()=>{try{const k=await G(r).get("/api/notifications/");!v&&Array.isArray(k)&&N(k.sort((h,y)=>new Date(y.created_at||0)-new Date(h.created_at||0)))}catch{}})(),()=>{v=!0}},[r]);const m=d.filter(v=>!v.read_at).length,I=async()=>{if(r)try{await G(r).post("/api/notifications/read-all"),N(_=>_.map(k=>k.read_at?k:{...k,read_at:new Date().toISOString()}))}catch{}},x=async v=>{if(r)try{await G(r).post(`/api/notifications/${v}/read`),N(k=>k.map(h=>h.id===v?{...h,read_at:new Date().toISOString()}:h))}catch{}};return e.jsx("header",{className:"sticky top-0 z-40 w-full border-b bg-background/80 backdrop-blur",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-8 rounded-xl bg-primary/15 text-primary font-semibold flex items-center justify-center",children:"++"}),e.jsx("span",{className:"font-semibold tracking-tight",children:o.shortName})]}),e.jsx("nav",{className:"hidden md:flex items-center gap-1",children:l.map(v=>e.jsx("button",{onClick:()=>t(v.id),className:"px-3 py-2 rounded-lg text-sm font-medium focus:outline-none focus-visible:ring "+(a===v.id?"bg-indigo-600 text-white":"hover:bg-muted"),children:v.label},v.id))}),e.jsxs("div",{className:"flex items-center gap-3 relative",children:[e.jsxs("button",{className:"relative rounded-lg hover:bg-muted p-2 focus:outline-none focus-visible:ring","aria-label":"Notifications",onClick:()=>u(v=>!v),disabled:!r,children:[e.jsx(mi,{className:"w-5 h-5"}),m>0&&e.jsx(pt,{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center bg-red-500 text-white text-xs",children:m})]}),i&&e.jsxs("div",{className:"absolute right-12 top-10 w-80 bg-white border border-gray-200 rounded shadow-lg z-50 max-h-96 overflow-auto",children:[e.jsxs("div",{className:"p-3 font-semibold border-b flex items-center justify-between",children:[e.jsx("span",{children:"Notifications"}),m>0&&e.jsx("button",{className:"text-xs text-blue-600 hover:underline",onClick:I,children:"Mark all read"})]}),d.length===0&&e.jsx("div",{className:"p-3 text-sm text-gray-500",children:"No notifications"}),d.map(v=>e.jsxs("div",{className:"p-3 text-sm border-b last:border-b-0 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium mr-2 truncate",children:v.title}),e.jsx("div",{className:"text-[11px] text-gray-500 whitespace-nowrap",children:Yc(v.created_at)})]}),v.body&&e.jsx("div",{className:"text-gray-600 text-xs",children:v.body}),!v.read_at&&e.jsx("button",{className:"text-xs text-blue-600 self-start",onClick:()=>x(v.id),children:"Mark read"})]},v.id))]}),e.jsxs(La,{className:"h-8 w-8",children:[j&&e.jsx(xr,{src:j,alt:"avatar",onError:v=>{try{v.currentTarget.style.display="none"}catch{}}}),e.jsx(Ua,{children:c||""})]})]})]})})}const Gc=()=>e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M4 6h16M4 12h16M4 18h10",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})}),Kc=()=>e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 16V4m0 0l4 4m-4-4l-4 4M4 20h16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),Sn=()=>e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"9",y:"3",width:"6",height:"10",rx:"3",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M5 11a7 7 0 0 0 14 0M12 18v3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),Jc=()=>e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 3l9 5-9 5-9-5 9-5z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M21 12l-9 5-9-5",stroke:"currentColor",strokeWidth:"1.5"})]}),Qc=()=>e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"3",y:"5",width:"18",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M3 10h18",stroke:"currentColor",strokeWidth:"1.5"})]});function Xc({collapsed:t,setCollapsed:a,onNavigate:r,active:n}){const o=[{label:"Episodes",icon:e.jsx(Gc,{}),route:"episode-history"},{label:"Record",icon:e.jsx(Sn,{}),route:"recorder"},{label:"Media Uploads",icon:e.jsx(Kc,{}),route:"media-library"},{label:"My Podcasts",icon:e.jsx(Sn,{}),route:"podcast-manager"},{label:"Templates",icon:e.jsx(Jc,{}),route:"my-templates"},{label:"Subscription",icon:e.jsx(Qc,{}),route:"billing"}];return e.jsxs("aside",{className:(t?"w-16 ":"w-64 ")+"shrink-0 border-r bg-card",children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-3 border-b",children:[e.jsx("span",{className:"text-sm font-medium truncate "+(t?"sr-only":""),children:"Workspace"}),e.jsx("button",{className:"size-8 grid place-items-center rounded-lg hover:bg-muted focus:outline-none focus-visible:ring",title:t?"Expand":"Collapse",onClick:()=>a(l=>!l),children:e.jsx("span",{"aria-hidden":"true",children:"≡"})})]}),e.jsx("nav",{className:"p-2 space-y-1",children:o.map((l,d)=>e.jsxs("button",{className:"w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm "+(n===l.route?"bg-muted font-medium":"hover:bg-muted"),onClick:()=>{r&&r(l.route),window.scrollTo({top:0,behavior:"smooth"})},children:[e.jsx("span",{className:"size-5 grid place-items-center rounded",children:l.icon}),e.jsx("span",{className:t?"sr-only":"truncate",children:l.label})]},d))})]})}function ba({label:t,value:a,sub:r}){return e.jsxs("div",{className:"rounded-2xl border bg-card p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:t}),e.jsx("div",{className:"mt-1 text-2xl font-semibold tracking-tight",children:a}),r&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:r})]})}function Zc({token:t,shows:a,drafts:r,onOpenDraft:n,setActive:o}){const[l,d]=s.useState("All"),[N,i]=s.useState({episodes:null,minutesLeft:null,scheduled:null,episodesThisWeek:null,playsLast30d:null,recentPlays:[]}),[u,j]=s.useState(null);s.useEffect(()=>{let m=!1;return(async()=>{if(!t){i({episodes:null,minutesLeft:null,scheduled:null,episodesThisWeek:null,playsLast30d:null,recentPlays:[]}),j(null);return}try{j(null);const I=G(t);let x=null,v=null,_=new Map,k=new Map;try{const C=await I.get("/api/episodes/?limit=200");if(x=Array.isArray(C?.items)?C.items.length:Array.isArray(C)?C.length:null,typeof C?.total=="number"&&(x=C.total),Array.isArray(C?.items)){const M=new Date().toISOString();v=C.items.filter(b=>b.status==="scheduled"||b.publish_at&&b.publish_at>M).length;for(const b of C.items)!b||!b.id||(_.set(String(b.id),b.title||"Untitled"),k.set(String(b.id),{publish_at:b.publish_at||b.processed_at||b.created_at||null}))}}catch{j("Failed to load episode stats.")}let h=null;try{const C=await I.get("/api/billing/usage");if(C)if(typeof C.minutes_left=="number")h=C.minutes_left;else{const M=C.processing_minutes_used_this_month,b=C.max_processing_minutes_month;typeof b=="number"&&typeof M=="number"?h=Math.max(0,b-M):b==null&&(h="∞")}}catch{j("Failed to load usage stats.")}let y=null,p=[];try{const C=await I.get("/api/users/me/stats");if(typeof C?.plays_last_30d=="number"&&(y=C.plays_last_30d),y==null){const b=await I.get("/api/spreaker/analytics/plays/shows?window=last30d");if(b&&b.totals){let g=0;for(const U of Object.keys(b.totals)){const se=b.totals[U]?.plays_total;typeof se=="number"&&(g+=se)}y=isNaN(g)?null:g}}const M=await I.get("/api/spreaker/analytics/plays/episodes?window=last30d");if(Array.isArray(M?.items)){const b=M.items.map(g=>({...g,title:_.get(String(g.episode_id))||g.title||"Untitled",_pub:k.get(String(g.episode_id))?.publish_at||null}));b.sort((g,U)=>{const se=g?._pub?new Date(g._pub).getTime():0;return(U?._pub?new Date(U._pub).getTime():0)-se}),p=b.slice(0,3)}}catch{j("Failed to load play stats.")}try{const C=await I.get("/api/users/me/stats");p.length===0&&Array.isArray(C?.recent_episode_plays)&&(p=C.recent_episode_plays.slice(0,3).map(M=>({episode_id:M.episode_id,plays_total:M.plays_total,title:M.title||_.get(String(M.episode_id))||"Untitled"})))}catch{j("Failed to load recent episode stats.")}i(C=>m?C:{...C,episodes:x,minutesLeft:h,scheduled:v,playsLast30d:y,recentPlays:p})}catch{m||(i({episodes:null,minutesLeft:null,scheduled:null,episodesThisWeek:null,playsLast30d:null,recentPlays:[]}),j("Failed to load dashboard stats."))}})(),()=>{m=!0}},[t]);const c=s.useMemo(()=>r.map(m=>{const I=m.transcript==="ready"?"Transcript ready":"Transcribing";return{id:m.id,title:m.title,status:I}}),[r]);return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight",children:"Welcome back"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ship a new episode in minutes."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Podcast"}),e.jsxs("select",{className:"rounded-lg border px-2 py-1 text-sm",value:l,onChange:m=>d(m.target.value),children:[e.jsx("option",{children:"All"}),a.map(m=>e.jsx("option",{children:m.name},m.id))]})]}),e.jsx("button",{className:"rounded-xl bg-indigo-600 px-4 py-2 text-white shadow hover:bg-indigo-500 focus:outline-none focus-visible:ring",onClick:()=>o("creator-upload"),children:"New Episode"})]})]}),u&&e.jsx("div",{className:"bg-red-100 border border-red-300 text-red-700 rounded p-3 mb-4 text-sm",children:u}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ba,{label:"Episodes",value:(N.episodes??"—").toString(),sub:N.episodesThisWeek?`+${N.episodesThisWeek} this week`:void 0}),e.jsx(ba,{label:"Scheduled",value:(N.scheduled??"—").toString()}),e.jsx(ba,{label:"Drafts",value:c.length.toString()}),e.jsx(ba,{label:"Minutes Left",value:(N.minutesLeft??"—").toString()})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ba,{label:"Plays Last 30 Days",value:(N.playsLast30d??"—").toString()}),(N.recentPlays||[]).slice(0,3).map((m,I)=>e.jsx(ba,{label:m?.title||"Recent Episode",value:(m?.plays_total??"—").toString()},I))]}),e.jsxs("section",{className:"rounded-2xl border bg-card",children:[e.jsx("header",{className:"flex items-center justify-between px-4 py-3 border-b",children:e.jsx("h2",{className:"text-base font-semibold",children:"Draft uploads"})}),e.jsx("ul",{className:"divide-y",children:c.map(m=>e.jsxs("li",{className:"px-4 py-3 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:m.title}),e.jsx("div",{className:"text-xs text-muted-foreground",children:m.status})]}),e.jsx("button",{className:"px-3 py-1.5 text-sm rounded-lg border hover:bg-muted",onClick:()=>n(m.id),children:"Resume"})]},m.id))})]})]})}const Gi="ab_drafts";function ed(){try{return JSON.parse(localStorage.getItem(Gi)||"{}")}catch{return{}}}function Cn(t){try{localStorage.setItem(Gi,JSON.stringify(t))}catch{}}function td(){return crypto?.randomUUID?.()||Math.random().toString(36).slice(2)}function Ki(){const t=ed(),a=Object.entries(t).map(([l,d])=>({id:l,...d}));function r(l){return t[l]||null}function n(l){const d=l?.id||td();return t[d]={...l,id:d},Cn(t),d}function o(l){l in t&&(delete t[l],Cn(t))}return{drafts:a,get:r,upsert:n,remove:o}}function Mt(){const t=G();return{get:t.get,post:t.post,put:t.put,delete:t.delete,uploadAudio(a){return t.post("/ab/upload",a)},createDraft(a){return t.post("/ab/drafts",a)},getStatus(a){return t.get(`/ab/drafts/${a}/status`)}}}function sd({token:t,shows:a,uploads:r,setUploads:n,drafts:o,setDrafts:l,markUploadUsed:d,goFinalize:N,goCustomizeSegments:i}){const[u,j]=s.useState(a[0]?.id??""),[c,m]=s.useState(r[0]?.id??null),[I,x]=s.useState([{key:"title",label:"Title",done:!1},{key:"description",label:"Description",done:!1},{key:"tags",label:"Tags",done:!1},{key:"template",label:"Choose template",done:!1},{key:"introoutro",label:"Finish intro/outro",done:!1}]),v=s.useRef(null),{setDraftMeta:_,getDraftMeta:k,clearDraft:h}=Ki(),[y,p]=s.useState([]),[C,M]=s.useState(!1),[b,g]=s.useState(null),[U,se]=s.useState(!1),[Z,F]=s.useState(!1),[re,O]=s.useState(null),[z,P]=s.useState({}),[E,ne]=s.useState([]),[ee,he]=s.useState(!1),[D,H]=s.useState(null),[ge,V]=s.useState(!1),[je,_e]=s.useState({}),[T,K]=s.useState(!1),[le,me]=s.useState(!1),[te,Ne]=s.useState(!1),Be=s.useMemo(()=>I.every(R=>R.done),[I]),ke=s.useMemo(()=>!u||!c?null:k(u,c),[u,c,k]);s.useEffect(()=>{let R=!1;return(async()=>{try{if(!t||!u){Ne(!1);return}try{const ye=await G(t).get("/api/episodes"),f=(Array.isArray(ye)?ye:[]).filter(Y=>String(Y?.podcast_id)===String(u)&&(Y?.status==="processed"||Y?.status==="published")).length;R||Ne(f>=5);return}catch{R||Ne(!1);return}}catch{R||Ne(!1)}})(),()=>{R=!0}},[t,u]);const De=s.useMemo(()=>{const R=re;if(!R)return[];const ye=(R.segments||[]).filter(f=>f.segment_type==="intro"||f.segment_type==="outro"),ae=[];for(const f of ye){const Y=z?.[f.id]?.source||{},Q=f?.source||{},ue=Q?.source_type||"static";if(ue==="tts")(Y.script??Q.script??"").trim()||ae.push(`${f.segment_type}: AI voice script is required`);else if(ue==="ai_generated")(Y.prompt??Q.prompt??"").trim()||ae.push(`${f.segment_type}: AI prompt is required`);else{const Ie=(Y.filename??Q.filename??"").trim();Ie?E.some(Le=>(f.segment_type==="intro"?Le.category==="intro":Le.category==="outro")&&Le.filename===Ie)||ae.push(`${f.segment_type}: selected file not found in library`):ae.push(`${f.segment_type}: choose a static file`)}}return ae},[re,z,E]),B=R=>new Promise(ye=>{try{const ae=new Audio;let f=null;const Y=()=>{try{f&&URL.revokeObjectURL(f)}catch{}},Q=()=>{const Ie=ae&&isFinite(ae.duration)?ae.duration:null;Y(),ye(Ie&&Ie>0?Ie:null)},ue=()=>{Y(),ye(null)};ae.addEventListener("loadedmetadata",Q),ae.addEventListener("error",ue),f=URL.createObjectURL(R),ae.src=f,ae.load()}catch{ye(null)}}),xe=(R,ye=60)=>{if(!R)return"";if(R.length<=ye)return R;const ae=Math.ceil((ye-3)*.6),f=ye-3-ae;return R.slice(0,ae)+"..."+R.slice(-f)};s.useEffect(()=>{if(!u||!c)return;const R=k(u,c);x(ye=>ye.map(ae=>ae.key in R&&R[ae.key]?{...ae,done:!0}:ae))},[u,c,k]),s.useEffect(()=>{let R=!1;return(async()=>{try{const ye=await Mt(t).listTemplates();R||p(Array.isArray(ye)?ye:[])}catch{R||p([])}})(),()=>{R=!0}},[t]),s.useEffect(()=>{if(!u||!c)return;const R=(y||[]).filter(ae=>ae?.is_active!==!1);if(R.length!==1)return;const ye=k(u,c);(!ye||!ye.template)&&jt(R[0])},[y,u,c]),s.useEffect(()=>{let R=!1;return(async()=>{if(U)try{const ye=await Mt(t).listMedia();R||ne(Array.isArray(ye)?ye:[])}catch{R||ne([])}})(),()=>{R=!0}},[U,t]),s.useEffect(()=>{let R=!1;return(async()=>{if(!(!U||!re))try{const ye=new Set;if((re?.segments||[]).forEach(Q=>{if(Q?.source?.source_type==="tts"){const ue=z?.[Q.id]?.source?.voice_id,Ie=Q?.source?.voice_id;ue&&String(ue).toLowerCase()!=="default"&&ye.add(String(ue)),Ie&&String(Ie).toLowerCase()!=="default"&&ye.add(String(Ie))}}),!ye.size)return;let ae=!0;for(const Q of ye)if(!je[Q]){ae=!1;break}if(ae)return;K(!0);let f={};try{if(t){const ue=await G(t).get("/api/elevenlabs/voices?size=200"),Ie=Array.isArray(ue?.items)?ue.items:Array.isArray(ue)?ue:[];for(const Re of Ie||[]){const Le=Re.common_name||Re.name||"";Le&&(f[Re.voice_id]=Le)}}else{const Q=await yr("",1,200);for(const ue of Q?.items||[]){const Ie=ue.common_name||ue.name||"";Ie&&(f[ue.voice_id]=Ie)}}}catch{}!R&&Object.keys(f).length&&_e(Q=>({...Q,...f}));const Y=Array.from(ye).filter(Q=>Q&&Q.toLowerCase()!=="default"&&!f[Q]);if(Y.length&&t){const Q=G(t);for(const ue of Y)try{const Ie=await Q.get(`/api/elevenlabs/voice/${encodeURIComponent(ue)}/resolve`),Re=Ie?.common_name||Ie?.name||"";Re&&!R&&_e(Le=>({...Le,[ue]:Re}))}catch{}}}finally{R||K(!1)}})(),()=>{R=!0}},[U,re,z,t]);const ie=s.useMemo(()=>{const R=r.find(ae=>ae.id===c);if(!R)return"≈ —";if(R&&typeof R.durationSec=="number"&&isFinite(R.durationSec)&&R.durationSec>0){const ae=R.durationSec/60,f=Math.max(1,Math.floor(ae*.75)),Y=Math.max(Math.ceil(ae*1.25),Math.ceil(ae+2));return`≈ ${f}–${Y} min`}const ye=(R.fileName||"").toLowerCase();return ye.endsWith(".wav")||ye.endsWith(".aif")||ye.endsWith(".aiff")?"≈ 8–14 min":"≈ 5–10 min"},[r,c]),W=async R=>{n(ye=>ye.filter(ae=>ae.id!==R)),l(ye=>ye.filter(ae=>ae.fileId!==R)),h(u,R),c===R&&m(null);try{await Mt(t).deleteMedia(R)}catch{}},Pe=async()=>{if(t){me(!0);try{const ae=(await Mt(t).listMedia()||[]).filter(f=>{const Y=(f?.category||"").toLowerCase();return Y==="main_content"||Y==="content"||Y===""||Y==="audio"}).map(f=>{const Y=typeof f?.filesize=="number"?f.filesize:f?.size,Q=Y?`${Math.max(1,Math.round(Y/1024/1024))} MB`:"",ue=f?.friendly_name||f?.client_name||f?.filename||"audio";return{id:f.id,fileName:ue,serverFilename:f.filename,size:Q,status:"done",progress:100,nickname:"",showId:void 0,ttlDays:14}});n(f=>{const Y=new Map(f.map(Q=>[Q.id,Q]));return ae.forEach(Q=>{const ue=Y.get(Q.id);ue?Y.set(Q.id,{...ue,...Q}):Y.set(Q.id,Q)}),Array.from(Y.values())}),l(f=>{const Y=new Set(f.map(ue=>ue.fileId)),Q=ae.filter(ue=>!Y.has(ue.id)).map(ue=>({id:`d_${ue.id}`,title:(ue.fileName||"").replace(/\.[a-z0-9]+$/i,""),fileId:ue.id,transcript:"processing",hint:(ue.serverFilename||ue.fileName||"").replace(/\.[a-z0-9]+$/i,"")}));return Q.length?f.concat(Q):f})}catch{}finally{me(!1)}}};s.useEffect(()=>{t&&Pe()},[t]),s.useEffect(()=>{let R=!1;return(async()=>{if(!t||!ke||ke.transcript==="ready")return;const ye=r.find(Y=>Y.id===c),ae=(ke.hint||ye?.serverFilename||ye?.fileName||"").replace(/\.[a-z0-9]+$/i,"");if(!ae)return;const f=async()=>{try{const Y=await Mt(t).transcriptReady({hint:ae});if(R)return;if(Y&&Y.ready){_(u,c,{transcript:"ready"});return}}catch{}R||setTimeout(f,5e3)};setTimeout(f,2e3)})(),()=>{R=!0}},[t,ke?.transcript,ke?.hint,c,u,r,_]);const Ue=()=>v.current?.click(),$e=async R=>{const ye=Array.from(R.target.files||[]);if(!ye.length)return;const ae=(Q,ue)=>new Promise(Ie=>{const Re=`tmp_${Date.now()}_${ue}`,Le=Q.size?`${Math.max(1,Math.round(Q.size/1024/1024))} MB`:"";let nt=null,He=null;n(S=>[...S,{id:Re,fileName:Q.name,serverFilename:void 0,size:Le,status:"uploading",progress:1,nickname:"",showId:u,ttlDays:14,durationSec:null}]),B(Q).then(S=>{He=S,n($=>$.map(J=>J.id===Re||nt&&J.id===nt?{...J,durationSec:S}:J))});const it=Hr("/api/media/upload/main_content"),w=new XMLHttpRequest;w.open("POST",it),t&&w.setRequestHeader("Authorization",`Bearer ${t}`),w.upload.onprogress=S=>{if(!S.lengthComputable)return;const $=Math.max(1,Math.min(99,Math.round(S.loaded/S.total*100)));n(J=>J.map(Se=>Se.id===Re?{...Se,progress:$}:Se))},w.onreadystatechange=()=>{if(w.readyState===4){try{if(w.status>=200&&w.status<300){const S=JSON.parse(w.responseText||"[]"),$=Array.isArray(S)?S[0]:S;if($&&$.id){nt=$.id,n(Se=>Se.map(We=>We.id===Re?{id:$.id,fileName:Q.name,serverFilename:$.filename,size:Le,status:"done",progress:100,nickname:"",showId:u,ttlDays:14,durationSec:He??We.durationSec??null}:We));const J={id:`d_${$.id}`,title:($.friendly_name||$.filename||Q.name).replace(/\.[a-z0-9]+$/i,""),fileId:$.id,transcript:"processing",hint:($.filename||Q.name).replace(/\.[a-z0-9]+$/i,"")};l(Se=>Se.concat([J])),Ie(J);return}}}catch{}n(S=>S.map($=>$.id===Re?{...$,status:"error",progress:0}:$)),Ie(null)}};const q=new FormData;q.append("files",Q);try{q.append("friendly_names",JSON.stringify([Q.name]))}catch{}w.send(q)}),f=[];for(let Q=0;Q<ye.length;Q++){const ue=await ae(ye[Q],Q);ue&&f.push(ue)}f[0]?.fileId&&m(f[0].fileId),R.target.value="";const Y=f[0];if(Y&&Y.hint){let Q=!1;const ue=async()=>{try{const Ie=await Mt(t).transcriptReady({hint:Y.hint});if(Ie&&Ie.ready){l(Re=>Re.map(Le=>Le.id===Y.id?{...Le,transcript:"ready"}:Le));return}}catch{}setTimeout(ue,5e3)};setTimeout(ue,5e3)}},[Fe,Ge]=s.useState(null),ct=R=>{if(!c)return;const ye=k(u,c);Ge({key:R,value:ye[R]||""})},et=()=>{if(!Fe)return;const R=(Fe.value||"").trim();_(u,c,{[Fe.key]:R}),x(ye=>ye.map(ae=>ae.key===Fe.key?{...ae,done:!!R}:ae)),Ge(null)},dt=async R=>{const ye=r.find(Y=>Y.id===c),ae=await Mt().aiMetadata({current_title:"",filename:ye?.fileName}),f=R==="title"?{title:ae.title}:R==="description"?{description:ae.description}:{tags:(ae.tags||[]).join(", ")};_(u,c,f),x(Y=>Y.map(Q=>Q.key===R?{...Q,done:!0}:Q))},jt=R=>{!u||!c||(_(u,c,{template:R?.id||R,template_name:R?.name||void 0}),x(ye=>ye.map(ae=>ae.key==="template"?{...ae,done:!0}:ae)),M(!1),g(null))},xt=()=>{const R=(y||[]).filter(ye=>ye?.is_active!==!1);if(!R.length){window.alert("No active templates. Create or enable one in Templates.");return}if(R.length===1){jt(R[0]);return}g(R[0]?.id||null),M(!0)};return e.jsxs("div",{className:"mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsx("input",{ref:v,type:"file",multiple:!0,accept:"audio/*",className:"hidden",onChange:$e}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight",children:"Upload your audio"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Drop files here. We’ll handle the rest in the background."})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Podcast"}),e.jsx("select",{className:"rounded-lg border px-2 py-1 text-sm",value:u,onChange:R=>j(R.target.value),children:a.map(R=>e.jsx("option",{value:R.id,children:R.name},R.id))})]})})]}),e.jsx("div",{className:"rounded-2xl border border-dashed bg-card p-6 text-center",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Drag & drop or ",e.jsx("button",{className:"underline",onClick:Ue,children:"browse"})]})}),e.jsxs("section",{className:"rounded-2xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Uploads"}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs disabled:opacity-50",disabled:le||!t,title:t?"Refresh uploads from server":"Sign in to refresh from server",onClick:Pe,children:le?"Refreshing…":"Refresh"})]}),e.jsx("ul",{className:"space-y-2",children:r.map(R=>e.jsxs("li",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"primaryFile",checked:c===R.id,onChange:()=>m(R.id),title:"Use this file for processing & estimates"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate",title:R.fileName,children:R.nickname?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:xe(R.nickname,50)})," ",e.jsxs("span",{className:"italic text-muted-foreground",children:["(",xe(R.fileName,50),")"]})]}):e.jsx("span",{className:"font-medium",children:xe(R.fileName,60)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:R.size})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${(o.find(f=>f.fileId===R.id)?.transcript||"processing")==="ready"?"bg-green-50 text-green-700 border-green-200":"bg-amber-50 text-amber-700 border-amber-200"}`,children:o.find(ae=>ae.fileId===R.id)?.transcript==="ready"?"Transcription Complete":"Transcription Pending"}),e.jsxs("div",{className:"text-sm",children:[R.status==="uploading"&&e.jsxs("span",{children:[R.progress,"%"]}),R.status==="queued"&&e.jsx("span",{children:"Queued"}),R.status==="done"&&e.jsx("span",{className:"text-green-700",children:"Uploaded"})]})]}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>{window.confirm("Delete this upload? This cannot be undone.")&&W(R.id)},children:"Delete"})]}),R.status==="uploading"&&e.jsx("div",{className:"mt-2 h-2 rounded bg-muted",children:e.jsx("div",{className:"h-2 rounded bg-indigo-600",style:{width:R.progress+"%"}})}),e.jsxs("div",{className:"mt-2 grid sm:grid-cols-2 gap-2",children:[e.jsxs("label",{className:"text-xs",children:["Common name (optional)",e.jsx("input",{className:"mt-1 w-full rounded border px-2 py-1 text-sm",value:R.nickname,onChange:ye=>n(ae=>ae.map(f=>f.id===R.id?{...f,nickname:ye.target.value}:f))})]}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-end justify-end",children:["Expires in ",R.ttlDays??14," days"]})]})]},R.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"rounded-2xl border bg-card p-4",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Transcript"}),e.jsxs("div",{className:"mt-2 text-sm",children:[ke?.transcript==="ready"?e.jsxs("div",{className:"rounded-lg border px-3 py-2 bg-green-50 text-green-800 flex items-center justify-between",children:[e.jsx("span",{children:"Transcription Complete"}),e.jsx("span",{className:"text-xs",children:"Ready"})]}):e.jsxs("div",{className:"rounded-lg border px-3 py-2 bg-amber-50 text-amber-800 flex items-center justify-between",children:[e.jsx("span",{children:"Processing"}),e.jsx("span",{className:"text-xs",children:ie})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"You can keep working while we transcribe."})]})]}),e.jsxs("section",{className:"lg:col-span-2 rounded-2xl border bg-card p-4",children:[e.jsx("h2",{className:"text-base font-semibold",children:"While we work, you can..."}),e.jsx("ul",{className:"mt-2 grid sm:grid-cols-2 gap-3 text-sm",children:I.map(R=>e.jsxs("li",{className:"rounded-lg border px-3 py-2 flex items-center justify-between gap-2 "+(R.done?"bg-green-50 border-green-200":""),children:[e.jsxs("span",{className:"truncate flex items-center gap-2",children:[R.done&&e.jsx("span",{className:"inline-block w-4 h-4 rounded-full bg-green-500 shrink-0"}),R.label]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[R.key!=="template"&&R.key!=="introoutro"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>ct(R.key),children:"Manual"}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>dt(R.key),children:"AI suggest"})]}),R.key==="template"&&e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:xt,children:"Choose"}),R.key==="introoutro"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-2 py-1 rounded border text-xs disabled:opacity-50",disabled:ge,onClick:async()=>{if(!u||!c){window.alert("Select an upload first.");return}const ye=k(u,c),ae=ye?.template;if(!ae){window.alert("Choose a template first.");return}F(!0),se(!0);try{const f=await fetch(Vt(`/api/templates/${ae}`),{headers:t?{Authorization:`Bearer ${t}`}:{}});if(f.ok){const Y=await f.json();O(Y);const Q=ye?.segment_overrides||{},ue={};(Y.segments||[]).forEach(Ie=>{if(Ie.segment_type==="intro"||Ie.segment_type==="outro"){const Re=Q[Ie.id]||{};Ie?.source?.source_type==="tts"?ue[Ie.id]={source:{script:Re?.source?.script??Ie?.source?.script??"",voice_id:Re?.source?.voice_id??Ie?.source?.voice_id??null,voice_name:Re?.source?.voice_name??Ie?.source?.voice_name??void 0}}:Ie?.source?.source_type==="ai_generated"?ue[Ie.id]={source:{prompt:Re?.source?.prompt??Ie?.source?.prompt??""}}:Ie?.source?.source_type==="static"&&(ue[Ie.id]={source:{filename:Re?.source?.filename??Ie?.source?.filename??""}})}}),P(ue)}else O(null)}catch{O(null)}finally{F(!1)}},children:"Manual"}),te&&e.jsx("button",{className:"px-2 py-1 rounded border text-xs disabled:opacity-50",disabled:ge,onClick:async()=>{if(!u||!c){window.alert("Select an upload first.");return}const ye=k(u,c),ae=ye?.template;if(!ae){window.alert("Choose a template first.");return}V(!0);try{const f=await fetch(Vt(`/api/templates/${ae}`),{headers:t?{Authorization:`Bearer ${t}`}:{}});if(!f.ok)throw new Error("Template not found");const Y=await f.json(),Q=r.find(He=>He.id===c),ue=(ye?.hint||Q?.serverFilename||Q?.fileName||"").replace(/\.[a-z0-9]+$/i,""),Re={...ye?.segment_overrides||{}},Le=(Y.segments||[]).filter(He=>He.segment_type==="intro"),nt=(Y.segments||[]).filter(He=>He.segment_type==="outro");for(const He of Y.segments||[])if((He.segment_type==="intro"||He.segment_type==="outro")&&He?.source?.source_type==="tts")try{const it=(He.segment_type==="intro"?Le.findIndex(J=>J.id===He.id):nt.findIndex(J=>J.id===He.id))+1,w=He.segment_type==="intro"?`Intro ${it}`:`Outro ${it}`,q={episode_id:ye?.episode_id||"00000000-0000-0000-0000-000000000000",podcast_id:u,tag:w,section_type:He.segment_type,hint:ue,history_count:10},$=((await Mt(t).suggestSection(q))?.script||"").trim();$&&(Re[He.id]={source:{...Re?.[He.id]?.source||{},script:$}})}catch(it){console.warn("intro/outro suggest failed",it)}_(u,c,{segment_overrides:Re,introoutro:!0}),x(He=>He.map(it=>it.key==="introoutro"?{...it,done:!0}:it))}catch(f){window.alert(f?.message||String(f))}finally{V(!1)}},children:"AI suggest"})]})]})]},R.key))}),e.jsx("div",{className:"mt-4 flex items-center justify-end",children:e.jsx("button",{className:`px-4 py-2 rounded-lg ${Be?"bg-indigo-600 text-white hover:bg-indigo-700 border border-indigo-600":"bg-gray-200 text-gray-500 border border-gray-300 cursor-not-allowed"}`,disabled:!Be,onClick:N,title:Be?"Proceed to Finalize":"Complete the items above to enable",children:"Go to Finalize"})})]})]}),C&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 bg-black/40 grid place-items-center p-4 z-50",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Choose a template"}),e.jsx("button",{className:"px-2 py-1 text-sm rounded border",onClick:()=>M(!1),children:"Close"})]}),e.jsx("div",{className:"max-h-[60vh] overflow-auto divide-y border rounded",children:(y||[]).filter(R=>R?.is_active!==!1).map(R=>e.jsxs("label",{className:"flex items-center gap-3 p-3 cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"tpl",checked:b===R.id,onChange:()=>g(R.id)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:R.name}),R.podcast_id&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Show-linked"})]}),e.jsx("span",{className:`ml-auto text-xs px-2 py-0.5 rounded-full border ${R?.is_active!==!1?"bg-green-50 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-300"}`,children:R?.is_active!==!1?"Active":"Inactive"})]},R.id))}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded border",onClick:()=>M(!1),children:"Cancel"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-indigo-600 text-white disabled:opacity-50",disabled:!b,onClick:()=>{const R=(y||[]).find(ye=>ye.id===b);R&&jt(R)},children:"Use template"})]})]})}),U&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 bg-black/40 grid place-items-center p-4 z-50",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-2xl bg-white p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Finish Intro/Outro"}),e.jsx("button",{className:"px-2 py-1 text-sm rounded border",onClick:()=>se(!1),children:"Close"})]}),Z&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}),!Z&&!re&&e.jsx("div",{className:"rounded border bg-amber-50 text-amber-800 p-3 text-sm",children:"Template not available. Choose a template first."}),!Z&&re&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Customize only intro/outro segments for this episode. These edits won't change the saved template. Required: AI voice needs a script; AI text needs a prompt; static needs a selected file."}),e.jsx("div",{className:"flex items-end justify-end gap-2",children:e.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:async()=>{const R=r.find(Q=>Q.id===c),ye=k(u,c),ae=re,f=(ae?.segments||[]).filter(Q=>Q.segment_type==="intro"),Y=(ae?.segments||[]).filter(Q=>Q.segment_type==="outro");for(const Q of ae?.segments||[])if((Q.segment_type==="intro"||Q.segment_type==="outro")&&(Q?.source?.source_type||"static")==="tts")try{const Ie=(Q.segment_type==="intro"?f.findIndex(it=>it.id===Q.id):Y.findIndex(it=>it.id===Q.id))+1,Re=Q.segment_type==="intro"?`Intro ${Ie}`:`Outro ${Ie}`,Le={episode_id:ye?.episode_id||"00000000-0000-0000-0000-000000000000",podcast_id:u,tag:Re,section_type:Q.segment_type,hint:(ye?.hint||R?.serverFilename||R?.fileName||"").replace(/\.[a-z0-9]+$/i,""),history_count:10},He=((await Mt(t).suggestSection(Le))?.script||"").trim();He&&P(it=>({...it,[Q.id]:{source:{...it?.[Q.id]?.source,script:He}}}))}catch(Ie){console.warn("section suggest failed",Ie)}},children:"AI suggest scripts"})}),e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-auto",children:(re.segments||[]).filter(R=>R.segment_type==="intro"||R.segment_type==="outro").map((R,ye)=>e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium",children:[R.segment_type==="intro"?"Intro":"Outro"," ",""]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border bg-gray-50 text-gray-700 border-gray-200",children:R?.source?.source_type||"static"})]}),R?.source?.source_type==="tts"&&e.jsxs("label",{className:"block text-sm mt-2",children:["AI voice script",e.jsx("textarea",{className:"mt-1 w-full rounded border p-2 min-h-28",value:z?.[R.id]?.source?.script||"",onChange:ae=>P(f=>({...f,[R.id]:{source:{...f?.[R.id]?.source,script:ae.target.value}}}))})]}),R?.source?.source_type==="tts"&&e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:(()=>{const ae=z?.[R.id]?.source?.voice_id||R?.source?.voice_id||null,f=z?.[R.id]?.source?.voice_name||R?.source?.voice_name||(ae?je[ae]:null),Y=f||ae||"Default";return e.jsxs(e.Fragment,{children:["Voice: ",Y,T&&ae&&!f&&!je[ae]?e.jsx("span",{className:"ml-2 text-[10px] text-gray-400",children:"(resolving…)"}):null]})})()}),e.jsx("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>{H(R.id),he(!0)},children:"Change voice"})]}),R?.source?.source_type==="ai_generated"&&e.jsxs("label",{className:"block text-sm mt-2",children:["AI Prompt",e.jsx("textarea",{className:"mt-1 w-full rounded border p-2 min-h-24",value:z?.[R.id]?.source?.prompt||"",onChange:ae=>P(f=>({...f,[R.id]:{source:{...f?.[R.id]?.source,prompt:ae.target.value}}}))})]}),!["tts","ai_generated"].includes(R?.source?.source_type)&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("div",{className:"text-muted-foreground",children:"Static segment file:"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:z?.[R.id]?.source?.filename||R?.source?.filename||"",onChange:ae=>P(f=>({...f,[R.id]:{source:{...f?.[R.id]?.source,filename:ae.target.value}}})),children:[e.jsx("option",{value:"",children:R.segment_type==="intro"?"Choose an intro file…":"Choose an outro file…"}),E.filter(ae=>R.segment_type==="intro"?ae.category==="intro":ae.category==="outro").map(ae=>e.jsx("option",{value:ae.filename,children:ae.friendly_name||ae.filename},ae.id))]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Current: ",R?.source?.filename||"—"]})]}),E.filter(ae=>R.segment_type==="intro"?ae.category==="intro":ae.category==="outro").length===0&&e.jsxs("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded px-2 py-1 mt-2",children:["No ",R.segment_type," files in your library. Add them in Templates."]})]})]},R.id))}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded border",onClick:()=>se(!1),children:"Cancel"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-indigo-600 text-white disabled:opacity-50",disabled:De.length>0,onClick:()=>{const ye=(re?.segments||[]).filter(ue=>ue.segment_type==="intro"||ue.segment_type==="outro"),ae=[];for(const ue of ye){const Ie=z?.[ue.id]?.source||{},Re=ue?.source||{},Le=Re?.source_type||"static";if(Le==="tts")(Ie.script??Re.script??"").trim()||ae.push(`${ue.segment_type}: AI voice script is required`);else if(Le==="ai_generated")(Ie.prompt??Re.prompt??"").trim()||ae.push(`${ue.segment_type}: AI prompt is required`);else{const nt=(Ie.filename??Re.filename??"").trim();nt?E.some(it=>(ue.segment_type==="intro"?it.category==="intro":it.category==="outro")&&it.filename===nt)||ae.push(`${ue.segment_type}: selected file not found in library`):ae.push(`${ue.segment_type}: choose a static file`)}}if(ae.length){window.alert(`Please fix before saving:
- ${ae.join(`
- `)}`);return}const f=k(u,c),Q={...{...f?.segment_overrides||{},...z}};for(const ue of re.segments||[])if(ue?.source?.source_type==="tts"){const Ie=Q?.[ue.id]?.source||{},Re=Ie.voice_id||ue?.source?.voice_id||null,Le=Ie.voice_name||ue?.source?.voice_name||(Re?je[Re]:void 0);Re&&Le&&!Ie.voice_name&&(Q[ue.id]={source:{...Ie,voice_name:Le}})}_(u,c,{segment_overrides:Q,introoutro:!0}),(async()=>{try{if(u){const ue=(re.segments||[]).filter(Re=>Re.segment_type==="intro"),Ie=(re.segments||[]).filter(Re=>Re.segment_type==="outro");for(const Re of re.segments||[]){const Le=Q?.[Re.id]?.source||{};if(Re?.source?.source_type==="tts"&&(Le.script||Re?.source?.script)){const nt=Le.voice_id||Re?.source?.voice_id||null,He=Le.voice_name||Re?.source?.voice_name||null,it=(Le.script||Re?.source?.script||"").trim(),w=(Re.segment_type==="intro"?ue.findIndex(S=>S.id===Re.id):Ie.findIndex(S=>S.id===Re.id))+1,q=Re.segment_type==="intro"?`Intro ${w}`:`Outro ${w}`;it&&await Mt(t).saveSection({podcast_id:u,episode_id:f?.episode_id||null,tag:q,section_type:Re.segment_type,content:it,voice_id:nt,voice_name:He})}}}}catch(ue){console.warn("saveSection failed",ue)}})(),x(ue=>ue.map(Ie=>Ie.key==="introoutro"?{...Ie,done:!0}:Ie)),se(!1)},children:"Save"})]})]})]})}),ee&&D&&e.jsx($a,{value:z?.[D]?.source?.voice_id||null,onChange:R=>{P(ye=>({...ye,[D]:{source:{...ye?.[D]?.source,voice_id:R}}}))},onSelect:R=>{if(!R)return;const ye=R.common_name||R.name||"Voice";P(ae=>({...ae,[D]:{source:{...ae?.[D]?.source,voice_id:R.voice_id,voice_name:ye}}}))},token:t,onClose:()=>{he(!1),H(null)}}),Fe&&e.jsx("div",{role:"dialog",className:"fixed inset-0 bg-black/40 grid place-items-center p-4 z-50",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white p-4 space-y-3",children:[e.jsxs("div",{className:"text-base font-semibold",children:["Enter ",Fe.key]}),Fe.key==="description"?e.jsx("textarea",{className:"w-full rounded border p-2 min-h-40",value:Fe.value,onChange:R=>Ge({...Fe,value:R.target.value})}):e.jsx("input",{className:"w-full rounded border p-2",value:Fe.value,onChange:R=>Ge({...Fe,value:R.target.value})}),Fe.key==="tags"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Comma-separated (e.g., tips, interview)"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded border",onClick:()=>Ge(null),children:"Cancel"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-indigo-600 text-white",onClick:et,children:"Save"})]})]})})]})}function ad({token:t,drafts:a,uploads:r,uploadById:n,goUpload:o}){const[l,d]=s.useState("draft"),i=(a[0]||null)?.fileId||null,u=r.find(B=>B.id===i)?.showId||null,{getDraftMeta:j,setDraftMeta:c}=Ki(),m=s.useMemo(()=>u&&i?j(u,i):{},[u,i,j]),[I,x]=s.useState(m.title||"How to pick a podcast niche in 2025"),[v,_]=s.useState(m.description||"In this episode we cover how to find a topic you can stick with..."),[k,h]=s.useState(m.tags||""),y=m?.transcript==="ready",[p,C]=s.useState([]),[M,b]=s.useState(m?.spreaker_show_id||null),[g,U]=s.useState(m?.schedule_at||"");s.useEffect(()=>{m&&(m.title&&x(m.title),m.description&&_(m.description),typeof m.tags=="string"?h(m.tags):Array.isArray(m.tags)&&h(m.tags.join(", ")),m.spreaker_show_id&&b(m.spreaker_show_id),m.schedule_at&&U(m.schedule_at))},[m]),s.useEffect(()=>{let B=!1;return(async()=>{if(!t||y||!i)return;const xe=n[i],ie=(m?.hint||xe?.serverFilename||xe?.fileName||"").replace(/\.[a-z0-9]+$/i,"");if(!ie)return;const W=async()=>{try{const Pe=await Mt(t).transcriptReady({hint:ie});if(B)return;if(Pe&&Pe.ready){u&&i&&c(u,i,{transcript:"ready"});return}}catch{}B||setTimeout(W,5e3)};setTimeout(W,2e3)})(),()=>{B=!0}},[t,y,i,u,m?.hint,n,c]),s.useEffect(()=>{let B=!1;return(async()=>{try{if(!t)return;const xe=await Mt(t).listSpreakerShows();if(B)return;const ie=Array.isArray(xe)?xe:Array.isArray(xe?.shows)?xe.shows:[];if(C(ie),!M&&ie?.length){const W=ie.find(Pe=>String(Pe.id)===String(m?.spreaker_show_id||""));b(String(W?W.id:ie[0].id))}}catch{B||C([])}})(),()=>{B=!0}},[t]);const se=()=>{if(!u||!i)return;const B=(k||"").trim();c(u,i,{title:I?.trim(),description:v?.trim(),tags:B,spreaker_show_id:M||null,schedule_at:g||null}),window.alert("Saved")},Z=async()=>{if(!i){window.alert("Select an upload first.");return}const B=n[i],xe=B?.serverFilename||B?.fileName;if(!xe){window.alert("File not available.");return}if(!M){window.alert("Choose a Spreaker show.");return}try{const ie={show_id:String(M),title:(I||xe).trim(),description:(v||"").trim(),filename:xe},W=(g||"").trim();if(W){const Ue=new Date(W);isNaN(Ue.getTime())||(ie.auto_published_at=Ue.toISOString())}const Pe=await Mt(t).publishToSpreaker(ie);u&&i&&c(u,i,{spreaker_show_id:String(M),schedule_at:g||null,last_publish_response:Pe||!0}),window.alert(W?"Scheduled for Spreaker.":"Published to Spreaker.")}catch(ie){window.alert(ie?.message||"Failed to publish.")}},F=async()=>{if(!i)return;const B=n[i];try{const xe=await Mt(t).aiMetadata({current_title:I,current_description:v,filename:B?.serverFilename||B?.fileName});xe?.title&&x(xe.title),u&&i&&xe?.title&&c(u,i,{title:xe.title})}catch{}},re=async()=>{if(!i)return;const B=n[i];try{const xe=await Mt(t).aiMetadata({current_title:I,current_description:v,filename:B?.serverFilename||B?.fileName,prompt:"expand"});xe?.description&&_(xe.description),u&&i&&xe?.description&&c(u,i,{description:xe.description})}catch{}},O=async()=>{if(!i)return;const B=n[i];try{const xe=await Mt(t).aiMetadata({current_title:I,current_description:v,filename:B?.serverFilename||B?.fileName,prompt:"shorten"});xe?.description&&_(xe.description),u&&i&&xe?.description&&c(u,i,{description:xe.description})}catch{}},z=async()=>{if(!i)return;const B=n[i];try{const xe=await Mt(t).aiMetadata({current_title:I,current_description:v,filename:B?.serverFilename||B?.fileName,prompt:"tags"}),ie=Array.isArray(xe?.tags)?xe.tags.join(", "):typeof xe?.tags=="string"?xe.tags:null;ie&&h(ie),u&&i&&ie&&c(u,i,{tags:ie})}catch{}},[P,E]=s.useState(!1),[ne,ee]=s.useState(!1),[he,D]=s.useState(null),[H,ge]=s.useState({}),[V,je]=s.useState([]),[_e,T]=s.useState(!1),[K,le]=s.useState(null),[me,te]=s.useState(!1),[Ne,Be]=s.useState({}),[ke,De]=s.useState(!1);return s.useEffect(()=>{let B=!1;return(async()=>{if(P)try{const xe=await Mt(t).listMedia();B||je(Array.isArray(xe)?xe:[])}catch{B||je([])}})(),()=>{B=!0}},[P,t,u]),s.useEffect(()=>{let B=!1;return(async()=>{if(!(!P||!he))try{const xe=new Set;if((he?.segments||[]).forEach(Ue=>{if(Ue?.source?.source_type==="tts"){const $e=H?.[Ue.id]?.source?.voice_id,Fe=Ue?.source?.voice_id;$e&&String($e).toLowerCase()!=="default"&&xe.add(String($e)),Fe&&String(Fe).toLowerCase()!=="default"&&xe.add(String(Fe))}}),!xe.size)return;let ie=!0;for(const Ue of xe)if(!Ne[Ue]){ie=!1;break}if(ie)return;De(!0);let W={};try{if(t){const $e=await G(t).get("/api/elevenlabs/voices?size=200"),Fe=Array.isArray($e?.items)?$e.items:Array.isArray($e)?$e:[];for(const Ge of Fe||[]){const ct=Ge.common_name||Ge.name||"";ct&&(W[Ge.voice_id]=ct)}}else{const Ue=await yr("",1,200);for(const $e of Ue?.items||[]){const Fe=$e.common_name||$e.name||"";Fe&&(W[$e.voice_id]=Fe)}}}catch{}!B&&Object.keys(W).length&&Be(Ue=>({...Ue,...W}));const Pe=Array.from(xe).filter(Ue=>Ue&&Ue.toLowerCase()!=="default"&&!W[Ue]);if(Pe.length&&t){const Ue=G(t);for(const $e of Pe)try{const Fe=await Ue.get(`/api/elevenlabs/voice/${encodeURIComponent($e)}/resolve`),Ge=Fe?.common_name||Fe?.name||"";Ge&&!B&&Be(ct=>({...ct,[$e]:Ge}))}catch{}}}finally{B||De(!1)}})(),()=>{B=!0}},[P,he,H,t]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight",children:"Finalize · Titles & Publish"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Review AI suggestions, set visibility, and schedule publishing."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded-xl border px-4 py-2 hover:bg-muted focus:outline-none",onClick:se,children:"Save"}),e.jsx("button",{className:"rounded-xl bg-indigo-600 px-4 py-2 text-white shadow hover:bg-indigo-500 focus:outline-none focus-visible:ring",onClick:Z,children:"Publish"})]})]}),e.jsxs("div",{className:`rounded-xl border px-4 py-3 text-sm ${y?"bg-green-50 text-green-800 border-green-200":"bg-amber-50 text-amber-800 border-amber-200"}`,children:[e.jsx("strong",{children:"Transcript status:"})," ",y?"ready":"processing..."," You can keep editing; AI fields ",y?"are available.":"will fill in automatically once ready.",e.jsx("button",{className:"ml-3 px-2 py-1 rounded border text-xs",onClick:o,children:"View uploads"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"lg:col-span-2 rounded-2xl border bg-card p-4 space-y-4",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Title & description"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"Title"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 rounded-lg border px-3 py-2 focus:outline-none focus-visible:ring",value:I,onChange:B=>x(B.target.value)}),e.jsx("button",{className:"px-3 py-2 rounded-lg border hover:bg-muted",onClick:F,children:"AI suggest"})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx("textarea",{className:"min-h-32 rounded-lg border px-3 py-2 focus:outline-none focus-visible:ring",value:v,onChange:B=>_(B.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-lg border hover:bg-muted",onClick:re,children:"AI expand"}),e.jsx("button",{className:"px-3 py-2 rounded-lg border hover:bg-muted",onClick:O,children:"AI shorten"})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 rounded-lg border px-3 py-2",value:k,onChange:B=>h(B.target.value),placeholder:"comma, separated, tags"}),e.jsx("button",{className:"px-3 py-2 rounded-lg border hover:bg-muted",onClick:z,children:"AI tags"})]})]})]}),e.jsxs("section",{className:"lg:col-span-2 rounded-2xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Intro/Outro"}),(()=>{const B=m?.introoutro_status||(m?.introoutro?"manual":null);return B?e.jsx("span",{className:"text-xs font-medium text-green-600",children:B==="ai"?"AI Text Applied":"Completed"}):null})()]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded border text-xs disabled:opacity-50",disabled:me,onClick:async()=>{if(!u||!i){window.alert("Select an upload first.");return}const B=m,xe=B?.template;if(!xe){window.alert("Choose a template first (on Upload page).");return}ee(!0),E(!0);try{const ie=await fetch(Vt(`/api/templates/${xe}`),{headers:t?{Authorization:`Bearer ${t}`}:{}});if(ie.ok){const W=await ie.json();D(W);const Pe=B?.segment_overrides||{},Ue={};(W.segments||[]).forEach($e=>{if($e.segment_type==="intro"||$e.segment_type==="outro"){const Fe=Pe[$e.id]||{};$e?.source?.source_type==="tts"?Ue[$e.id]={source:{script:Fe?.source?.script??"",voice_id:Fe?.source?.voice_id??null,voice_name:Fe?.source?.voice_name??void 0}}:$e?.source?.source_type==="ai_generated"?Ue[$e.id]={source:{prompt:Fe?.source?.prompt??""}}:$e?.source?.source_type==="static"&&(Ue[$e.id]={source:{filename:Fe?.source?.filename??""}})}}),ge(Ue)}else D(null)}catch{D(null)}finally{ee(!1)}},children:"Manual"}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs disabled:opacity-50",disabled:me,onClick:async()=>{if(!u||!i){window.alert("Select an upload first.");return}const B=m,xe=B?.template;if(!xe){window.alert("Choose a template first (on Upload page).");return}te(!0);try{const ie=await fetch(Vt(`/api/templates/${xe}`),{headers:t?{Authorization:`Bearer ${t}`}:{}});if(!ie.ok)throw new Error("Template not found");const W=await ie.json(),Pe=n[i],Ue=(B?.hint||Pe?.serverFilename||Pe?.fileName||"").replace(/\.[a-z0-9]+$/i,""),Fe={...B?.segment_overrides||{}},Ge=(W.segments||[]).filter(et=>et.segment_type==="intro"),ct=(W.segments||[]).filter(et=>et.segment_type==="outro");for(const et of W.segments||[])if((et.segment_type==="intro"||et.segment_type==="outro")&&et?.source?.source_type==="tts")try{const dt=(et.segment_type==="intro"?Ge.findIndex(ae=>ae.id===et.id):ct.findIndex(ae=>ae.id===et.id))+1,jt=et.segment_type==="intro"?`Intro ${dt}`:`Outro ${dt}`,xt={episode_id:B?.episode_id||"00000000-0000-0000-0000-000000000000",podcast_id:u,tag:jt,section_type:et.segment_type,hint:Ue,history_count:10},ye=((await Mt(t).suggestSection(xt))?.script||"").trim();ye&&(Fe[et.id]={source:{...Fe?.[et.id]?.source||{},script:ye}})}catch(dt){console.warn("intro/outro suggest failed",dt)}c(u,i,{segment_overrides:Fe,introoutro:!0,introoutro_status:"ai"}),window.alert("Intro/Outro suggestions applied")}catch(ie){window.alert(ie?.message||String(ie))}finally{te(!1)}},children:"AI suggest"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage your episode-specific intro/outro here."})]}),e.jsxs("section",{className:"lg:col-span-2 rounded-2xl border bg-card p-4 space-y-3",children:[e.jsx("div",{className:"font-medium",children:"Intern review queue"}),e.jsx("ul",{className:"mt-2 space-y-3 text-sm",children:[{t:"Insert intro music",detail:"at 00:00:13",text:"Insert intro music"},{t:"Add chapter",detail:"Sponsor segment at 00:14:22",text:"Add chapter: Sponsor"},{t:"Note",detail:"Redo question at 00:23:05",text:"Note: redo that question"}].map((B,xe)=>e.jsxs("li",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:B.t}),e.jsx("div",{className:"text-xs text-muted-foreground",children:B.detail})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded border text-xs",children:"Undo"}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs",children:"Approve"})]})]}),e.jsx("input",{defaultValue:B.text,className:"mt-2 w-full rounded border px-2 py-1 text-sm"})]},xe))})]}),e.jsxs("section",{className:"rounded-2xl border bg-card p-4 space-y-4",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Publish settings"}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Spreaker show"}),e.jsxs("select",{className:"mt-1 w-full rounded-lg border px-3 py-2",value:M||"",onChange:B=>b(B.target.value||null),children:[e.jsx("option",{value:"",children:"Select a show…"}),(p||[]).map(B=>e.jsx("option",{value:String(B.id),children:B.title||B.name||B.id},B.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Visibility"}),e.jsxs("div",{className:"mt-2 flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"visibility",value:"draft",checked:l==="draft",onChange:()=>d("draft")})," Draft"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"visibility",value:"publish",checked:l==="publish",onChange:()=>d("publish")})," Publish"]})]})]}),e.jsxs("div",{className:l==="draft"?"opacity-60 pointer-events-none":"",children:[e.jsx("label",{className:"text-sm font-medium",children:"Schedule"}),e.jsx("input",{type:"datetime-local",className:"mt-1 w-full rounded-lg border px-3 py-2",value:g,onChange:B=>U(B.target.value)})]})]}),e.jsx("button",{className:"w-full rounded-xl bg-indigo-600 px-4 py-2 text-white shadow hover:bg-indigo-500 focus:outline-none focus-visible:ring",onClick:l==="publish"?Z:se,children:l==="publish"?"Publish":"Save"})]})]})]}),P&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 bg-black/40 grid place-items-center p-4 z-50",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-2xl bg-white p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Finish Intro/Outro"}),e.jsx("button",{className:"px-2 py-1 text-sm rounded border",onClick:()=>E(!1),children:"Close"})]}),ne&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}),!ne&&!he&&e.jsx("div",{className:"rounded border bg-amber-50 text-amber-800 p-3 text-sm",children:"Template not available. Choose a template first."}),!ne&&he&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Customize only intro/outro segments for this episode. These edits won’t change the saved template."}),e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-auto",children:(he.segments||[]).filter(B=>B.segment_type==="intro"||B.segment_type==="outro").map((B,xe)=>e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium",children:[B.segment_type==="intro"?"Intro":"Outro"," ",""]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border bg-gray-50 text-gray-700 border-gray-200",children:B?.source?.source_type||"static"})]}),B?.source?.source_type==="tts"&&e.jsxs("label",{className:"block text-sm mt-2",children:["AI voice script",e.jsx("textarea",{className:"mt-1 w-full rounded border p-2 min-h-28",value:H?.[B.id]?.source?.script||"",onChange:ie=>ge(W=>({...W,[B.id]:{source:{...W?.[B.id]?.source,script:ie.target.value}}}))})]}),B?.source?.source_type==="tts"&&e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:(()=>{const ie=H?.[B.id]?.source?.voice_id||B?.source?.voice_id||null,W=H?.[B.id]?.source?.voice_name||B?.source?.voice_name||(ie?Ne[ie]:null),Pe=W||ie||"Default";return e.jsxs(e.Fragment,{children:["Voice: ",Pe,ke&&ie&&!W&&!Ne[ie]?e.jsx("span",{className:"ml-2 text-[10px] text-gray-400",children:"(resolving…)"}):null]})})()}),e.jsx("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>{le(B.id),T(!0)},children:"Change voice"})]}),B?.source?.source_type==="ai_generated"&&e.jsxs("label",{className:"block text-sm mt-2",children:["AI Prompt",e.jsx("textarea",{className:"mt-1 w-full rounded border p-2 min-h-24",value:H?.[B.id]?.source?.prompt||"",onChange:ie=>ge(W=>({...W,[B.id]:{source:{...W?.[B.id]?.source,prompt:ie.target.value}}}))})]}),!["tts","ai_generated"].includes(B?.source?.source_type)&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("div",{className:"text-muted-foreground",children:"Static segment file:"}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:H?.[B.id]?.source?.filename||B?.source?.filename||"",onChange:ie=>ge(W=>({...W,[B.id]:{source:{...W?.[B.id]?.source,filename:ie.target.value}}})),children:[e.jsx("option",{value:"",children:B.segment_type==="intro"?"Choose an intro file…":"Choose an outro file…"}),V.filter(ie=>B.segment_type==="intro"?ie.category==="intro":ie.category==="outro").map(ie=>e.jsx("option",{value:ie.filename,children:ie.friendly_name||ie.filename},ie.id))]})}),V.filter(ie=>B.segment_type==="intro"?ie.category==="intro":ie.category==="outro").length===0&&e.jsxs("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded px-2 py-1 mt-2",children:["No ",B.segment_type," files in your library. Add them in Templates."]})]})]},B.id))}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded border",onClick:()=>E(!1),children:"Cancel"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-indigo-600 text-white",onClick:()=>{const B={...m?.segment_overrides||{},...H};for(const xe of he.segments||[])if(xe?.source?.source_type==="tts"){const ie=B?.[xe.id]?.source||{},W=ie.voice_id||xe?.source?.voice_id||null,Pe=ie.voice_name||xe?.source?.voice_name||(W?Ne[W]:void 0);W&&Pe&&!ie.voice_name&&(B[xe.id]={source:{...ie,voice_name:Pe}})}c(u,i,{segment_overrides:B,introoutro:!0,introoutro_status:"manual"}),(async()=>{try{if(u){const xe=(he.segments||[]).filter(W=>W.segment_type==="intro"),ie=(he.segments||[]).filter(W=>W.segment_type==="outro");for(const W of he.segments||[]){const Pe=B?.[W.id]?.source||{};if(W?.source?.source_type==="tts"&&(Pe.script||W?.source?.script)){const Ue=(Pe.script||W?.source?.script||"").trim(),$e=(W.segment_type==="intro"?xe.findIndex(Ge=>Ge.id===W.id):ie.findIndex(Ge=>Ge.id===W.id))+1,Fe=W.segment_type==="intro"?`Intro ${$e}`:`Outro ${$e}`;Ue&&await Mt(t).saveSection({podcast_id:u,episode_id:m?.episode_id||null,tag:Fe,section_type:W.segment_type,content:Ue,voice_id:Pe.voice_id||W?.source?.voice_id||null,voice_name:Pe.voice_name||W?.source?.voice_name||null})}}}}catch(xe){console.warn("saveSection failed",xe)}})(),E(!1),window.alert("Intro/Outro saved to this draft")},children:"Save"})]})]})]})}),_e&&K&&e.jsx($a,{value:H?.[K]?.source?.voice_id||null,onChange:B=>{ge(xe=>({...xe,[K]:{source:{...xe?.[K]?.source,voice_id:B}}}))},onSelect:B=>{if(!B)return;const xe=B.common_name||B.name||"Voice";ge(ie=>({...ie,[K]:{source:{...ie?.[K]?.source,voice_id:B.voice_id,voice_name:xe}}}))},token:t,onClose:()=>{T(!1),le(null)}})]})}function rd({token:t}){const[a,r]=s.useState(!0),[n,o]=s.useState(["um","uh","like","you know"]),[l,d]=s.useState(!0),[N,i]=s.useState(!1),[u,j]=s.useState(!1),[c,m]=s.useState("low"),[I,x]=s.useState(""),[v,_]=s.useState([]);s.useEffect(()=>{let p=!0;return Mt().listSfx().then(C=>p&&_(C)),()=>{p=!1}},[t]);const k=s.useRef(null),h=p=>{k.current||(k.current=new(window.AudioContext||window.webkitAudioContext));const C=k.current,M=C.createOscillator(),b=C.createGain();M.type="sine",M.frequency.value=p==="low"?700:1200,b.gain.value=.1,M.connect(b),b.connect(C.destination),M.start(),setTimeout(()=>M.stop(),200)},y=async()=>{const p=document.createElement("input");p.type="file",p.accept="audio/*",p.onchange=async C=>{const M=C.target.files?.[0];if(!M)return;await Mt().uploadMedia([M],[M.name],"sfx");const b=await Mt().listSfx();_(b),x(b[b.length-1]?.id||"")},p.click()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-base font-semibold",children:"Audio cleanup"})}),e.jsx("button",{className:"rounded-lg border px-3 py-2 hover:bg-muted",onClick:()=>{r(!0),o(["um","uh","like","you know"]),d(!0),i(!1),j(!1),m("low"),x("")},children:"Restore defaults"})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Remove filler words"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Hide common fillers like “um/uh/like” when it’s safe"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:()=>r(p=>!p)})," Enable"]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[n.map((p,C)=>e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm",children:[p,e.jsx("button",{className:"text-muted-foreground",onClick:()=>o(n.filter((M,b)=>b!==C)),children:"×"})]},C)),e.jsx("button",{className:"rounded-full border px-3 py-1 text-sm",onClick:()=>o(p=>p.concat(["um"])),children:"+ Add word"})]})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("div",{className:"font-medium",children:"Shorten long pauses"}),e.jsxs("div",{className:"mt-2 flex items-center gap-6 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>d(p=>!p)})," Enable"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 "+(l?"":"opacity-60 pointer-events-none"),children:[e.jsx("input",{type:"checkbox",checked:N,onChange:()=>i(p=>!p)})," More aggressive detection"]})]})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("div",{className:"font-medium",children:"Censor beep"}),e.jsxs("div",{className:"mt-2 space-y-3 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:()=>j(p=>!p)})," Enable"]}),e.jsxs("div",{className:u?"":"opacity-60 pointer-events-none",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"beep",checked:c==="low",onChange:()=>m("low")})," Low beep"]}),e.jsx("button",{className:"w-6 h-6 border rounded grid place-items-center text-xs",title:"Play low beep",onClick:()=>h("low"),children:"▶"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"beep",checked:c==="high",onChange:()=>m("high")})," High beep"]}),e.jsx("button",{className:"w-6 h-6 border rounded grid place-items-center text-xs",title:"Play high beep",onClick:()=>h("high"),children:"▶"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"beep",checked:c==="custom",onChange:()=>m("custom")})," Use your own sound"]})})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("label",{className:"text-sm",children:"Sound"}),e.jsxs("select",{className:"rounded-lg border px-2 py-1 text-sm",disabled:c!=="custom",value:I,onChange:p=>x(p.target.value),children:[e.jsx("option",{value:"",children:"Select SFX..."}),v.map(p=>e.jsx("option",{value:p.id,children:p.friendly_name||p.filename},p.id)),e.jsx("option",{value:"__upload",children:"Upload new SFX…"})]}),I&&I!=="__upload"&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Selected: ",v.find(p=>p.id===I)?.friendly_name||I]}),I==="__upload"&&e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:y,children:"Choose file…"})]})]})]})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("div",{className:"font-medium",children:"Coming soon"}),e.jsxs("div",{className:"mt-2 grid sm:grid-cols-2 gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 opacity-60",children:[e.jsx("input",{type:"checkbox",disabled:!0})," Remove coughs"]}),e.jsxs("label",{className:"flex items-center gap-2 opacity-60",children:[e.jsx("input",{type:"checkbox",disabled:!0})," Duck background SFX"]})]})]})]})}function nd(){const[t,a]=s.useState("Flubber"),[r,n]=s.useState(!0),[o,l]=s.useState("Intern"),[d,N]=s.useState(!1),[i,u]=s.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold",children:"Magic words & Intern"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose the phrases you’ll say while recording."})]})}),e.jsxs("div",{className:"rounded-xl border p-4 space-y-3",children:[e.jsx("div",{className:"font-medium",children:"Flubber wake phrase"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Say this when you make a mistake. We’ll mark it for an easy fix later."}),e.jsx("input",{value:t,onChange:j=>a(j.target.value),className:"w-full rounded-lg border px-3 py-2"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm mt-2",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>n(j=>!j)})," Use Flubber if detected?"]})]}),e.jsxs("div",{className:"rounded-xl border p-4 space-y-3",children:[e.jsx("div",{className:"font-medium",children:"Intern wake phrase"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use this to ask for actions."}),e.jsx("input",{value:o,onChange:j=>l(j.target.value),className:"w-full rounded-lg border px-3 py-2"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm mt-2",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:()=>N(j=>!j)})," Use Intern actions if detected?"]})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"SFX on magic phrase"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Play a sound effect when your phrase is heard"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:()=>u(j=>!j)})," Use SFX if detected?"]})]}),e.jsx("div",{className:"mt-3 text-xs text-muted-foreground",children:"Tip: Choose unique phrases to avoid false triggers."})]})]})}function id({token:t}){return e.jsxs("div",{className:"mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-10 space-y-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight",children:"Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("section",{className:"md:col-span-2 rounded-2xl border bg-card p-4",children:e.jsx(rd,{token:t})}),e.jsx("section",{className:"md:col-span-2 rounded-2xl border bg-card p-4",children:e.jsx(nd,{})})]})]})}function zr({token:t}){const[a,r]=s.useState("dashboard"),[n,o]=s.useState(!1),[l,d]=s.useState([]),[N,i]=s.useState([]),[u,j]=s.useState([]),[c,m]=s.useState([]);s.useEffect(()=>{i([]),j([]),d([])},[t]),s.useEffect(()=>{try{const k=t?`ab_state_${t.slice(0,6)}`:"ab_state_demo",h=localStorage.getItem(k);if(h){const y=JSON.parse(h);Array.isArray(y.uploads)&&i(y.uploads),Array.isArray(y.drafts)&&j(y.drafts)}}catch{}},[t]),s.useEffect(()=>{try{const k=t?`ab_state_${t.slice(0,6)}`:"ab_state_demo",h={uploads:N,drafts:u};localStorage.setItem(k,JSON.stringify(h))}catch{}},[N,u,t]),s.useEffect(()=>{let k=!1;return(async()=>{try{const h=await G(t).get("/api/templates/");k||m(Array.isArray(h)?h:[])}catch{}})(),()=>{k=!0}},[t]),s.useEffect(()=>{let k=!1;return(async()=>{if(t)try{const h=await Mt(t).listPodcasts();if(k)return;const y=(Array.isArray(h)?h:[]).map(p=>({id:p.id||p.uuid||p._id||String(p.name||"show"),name:p.name||p.title||"Show"}));d(y)}catch{}})(),()=>{k=!0}},[t]),s.useEffect(()=>{let k=!1;return(async()=>{if(t)try{const h=await Mt(t).listMedia();if(k)return;const y=(h||[]).filter(p=>{const C=(p?.category||"").toLowerCase();return C==="main_content"||C==="content"||C===""||C==="audio"}).map(p=>{const C=p?.size?`${Math.max(1,Math.round(p.size/1024/1024))} MB`:"",M=p?.friendly_name||p?.client_name||p?.filename||"audio";return{id:p.id,fileName:M,serverFilename:p.filename,size:C,status:"done",progress:100,nickname:"",showId:void 0,ttlDays:14}});i(p=>{const C=new Map(p.map(M=>[M.id,M]));return y.forEach(M=>{const b=C.get(M.id);b?C.set(M.id,{...b,...M}):C.set(M.id,M)}),Array.from(C.values())}),j(p=>{const C=new Set(p.map(b=>b.fileId)),M=y.filter(b=>!C.has(b.id)).map(b=>({id:`d_${b.id}`,title:(b.fileName||"").replace(/\.[a-z0-9]+$/i,""),fileId:b.id,transcript:"processing",hint:(b.serverFilename||b.fileName||"").replace(/\.[a-z0-9]+$/i,"")}));return M.length?p.concat(M):p})}catch{}})(),()=>{k=!0}},[t]);const I=s.useMemo(()=>Object.fromEntries(N.map(k=>[k.id,k])),[N]),x=$t.useCallback(k=>{if(!k)return;const h={id:k.id,fileName:k.friendly_name||k.client_name||k.filename||"audio",serverFilename:k.filename,size:k.size?`${Math.max(1,Math.round(k.size/1024/1024))} MB`:"",status:"done",progress:100,nickname:"",showId:void 0,ttlDays:14};i(y=>{const p=new Map(y.map(M=>[M.id,M])),C=p.get(h.id);return p.set(h.id,C?{...C,...h}:h),Array.from(p.values())}),j(y=>{if(y.some(C=>C.fileId===k.id))return y;const p=(h.fileName||"").replace(/\.[a-z0-9]+$/i,"");return y.concat([{id:`d_${k.id}`,title:p,fileId:k.id,transcript:"processing",hint:(h.serverFilename||p).replace(/\.[a-z0-9]+$/i,"")}])})},[]);s.useEffect(()=>{const k=h=>x(h?.detail);return window.addEventListener("ppp:media-uploaded",k),()=>window.removeEventListener("ppp:media-uploaded",k)},[x]);const v=s.useCallback(k=>{const h=u.find(y=>y.id===k);h&&r(h.transcript==="ready"?"creator-finalize":"creator-upload")},[u]),_=s.useCallback(k=>{i(h=>h.filter(y=>y.id!==k))},[]);return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(Hc,{active:a,onSwitch:r}),e.jsxs("div",{className:"flex-1 flex",children:[e.jsx(Xc,{collapsed:n,setCollapsed:o,onNavigate:r,active:a}),e.jsxs("main",{className:"flex-1",children:[e.jsx("div",{className:"px-4 pt-3 text-xs text-muted-foreground",children:(()=>{const h={dashboard:"Dashboard","episode-history":"Episodes","podcast-manager":"My Podcasts","media-library":"Media Uploads","my-templates":"My Templates",billing:"Billing","creator-upload":"Upload","creator-finalize":"Finalize",settings:"Settings"}[a]||"—";return e.jsxs("span",{children:["Plus Plus workspace / ",e.jsx("span",{className:"text-foreground",children:h})]})})()}),a==="dashboard"&&e.jsx(Zc,{token:t,shows:l,drafts:u,onOpenDraft:v,setActive:r}),a==="episode-history"&&e.jsx(Ai,{token:t,onBack:()=>r("dashboard")}),a==="podcast-manager"&&e.jsx(Ii,{token:t,podcasts:l,setPodcasts:d,onBack:()=>r("dashboard")}),a==="media-library"&&e.jsx(Ei,{token:t,onBack:()=>r("dashboard")}),a==="my-templates"&&e.jsx(Ri,{token:t,onBack:()=>r("dashboard"),setCurrentView:()=>{}}),a==="billing"&&e.jsx(Di,{token:t,onBack:()=>r("dashboard")}),a==="creator-upload"&&e.jsx(sd,{token:t,shows:l,uploads:N,setUploads:i,drafts:u,setDrafts:j,markUploadUsed:_,goFinalize:()=>r("creator-finalize"),goCustomizeSegments:()=>r("creator-step3")}),a==="creator-finalize"&&e.jsx(ad,{token:t,drafts:u,uploads:N,uploadById:I,goUpload:()=>r("creator-upload")}),a==="creator-step3"&&e.jsx(ki,{onBack:()=>r("creator-upload"),token:t,templates:c,podcasts:l,initialStep:3}),a==="recorder"&&e.jsx(Fi,{onBack:()=>r("dashboard"),token:t,onSaved:x,onFinish:({filename:k,hint:h,transcriptReady:y})=>{(async()=>{try{const C=(await Mt(t).listMedia()||[]).filter(b=>{const g=(b?.category||"").toLowerCase();return g==="main_content"||g==="content"||g===""||g==="audio"});i(b=>{const g=new Map(b.map(U=>[U.id,U]));return C.forEach(U=>{const se=U?.size?`${Math.max(1,Math.round(U.size/1024/1024))} MB`:"",Z=U?.friendly_name||U?.client_name||U?.filename||"audio",F={id:U.id,fileName:Z,serverFilename:U.filename,size:se,status:"done",progress:100,nickname:"",showId:void 0,ttlDays:14},re=g.get(F.id);g.set(F.id,re?{...re,...F}:F)}),Array.from(g.values())});const M=C.find(b=>{const g=(b?.filename||"").toLowerCase(),U=(h||k||"").toLowerCase();return U?g===U||g.includes(U):!1});if(M){const b=(M.friendly_name||M.client_name||M.filename||"Recording").replace(/\.[a-z0-9]+$/i,"");j(g=>g.some(U=>U.fileId===M.id)?g:g.concat([{id:`d_${M.id}`,title:b,fileId:M.id,transcript:y?"ready":"processing",hint:h||k||b}]))}}catch{}r(y?"creator-finalize":"creator-upload")})()}}),a==="settings"&&e.jsx(id,{token:t})]})]})]})}const kn=t=>!!(t&&(t.is_admin||t.role==="admin"));function ld(){const{isAuthenticated:t,token:a,login:r,logout:n,user:o,refreshUser:l,hydrated:d,maintenanceInfo:N}=Ht(),[i,u]=s.useState(!0),[j,c]=s.useState(!1),[m,I]=s.useState(null),{toast:x}=Lt(),[v,_]=s.useState({checked:!1,allowed:!1}),[k,h]=$t.useState({loading:!0,count:0,fetched:!1}),{layoutKey:y}=Oi();s.useEffect(()=>{(async()=>{const M=window.location.hash;if(M){const U=new URLSearchParams(M.substring(1)).get("access_token");U&&(r(U),window.location.hash="")}if(new URLSearchParams(window.location.search).get("checkout")==="success"){c(!0),I(Date.now());try{localStorage.setItem("ppp_post_checkout","1")}catch{}}u(!1)})()},[a,r]),s.useEffect(()=>{if(!j||t)return;l({force:!0});let C=0;const M=setInterval(()=>{C+=1,l({force:!0}),C>8&&clearInterval(M)},750);return()=>clearInterval(M)},[j,t,l]),s.useEffect(()=>{if(!t||k.fetched||!d)return;let C=!1;return(async()=>{try{const b=await G(a).get("/api/podcasts/");if(!C){const g=Array.isArray(b)?b:b.items||[];h({loading:!1,count:g.length,fetched:!0})}}catch{C||h({loading:!1,count:0,fetched:!0})}})(),()=>{C=!0}},[t,a,k.fetched,d]),s.useEffect(()=>{let C=!1;return(async()=>{if(_(M=>({...M,checked:!1,allowed:!1})),!t||!d||!o||!kn(o)){_({checked:!0,allowed:!1});return}try{await G(a).get("/api/admin/summary"),C||_({checked:!0,allowed:!0})}catch{C||(_({checked:!0,allowed:!1}),x({title:"Admin access denied",description:"Falling back to dashboard."}))}})(),()=>{C=!0}},[t,a,o,d]);const p=window.location.pathname;if(!d)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."});if(N){const C=N.message||N.detail?.message||N.detail?.detail||"We are performing scheduled maintenance and will be back soon.";return e.jsxs("div",{className:"min-h-screen w-full flex flex-col items-center justify-center bg-slate-950 text-white px-6 text-center space-y-6",children:[e.jsx(ws,{className:"w-14 h-14 text-amber-400"}),e.jsx("div",{className:"text-3xl font-semibold",children:"We'll be right back"}),e.jsx("p",{className:"max-w-md text-sm text-slate-200",children:C}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-3",children:[e.jsx(A,{size:"sm",onClick:()=>l({force:!0}),children:"Try Again"}),e.jsx(A,{size:"sm",variant:"outline",className:"text-white border-white/40 hover:bg-white/10",onClick:n,children:"Sign Out"})]}),e.jsx("p",{className:"text-xs text-slate-400 max-w-sm",children:"Admins can still sign in to toggle maintenance mode off."})]})}if(o&&o.is_active===!1)return e.jsx(_n,{});if(p==="/dashboard/settings")return e.jsx(Mi,{token:a});if(j&&!t){if(a)return y==="ab"?e.jsx(zr,{token:a}):e.jsx(vn,{});const C=m?Date.now()-m:0;return e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen space-y-4",children:[e.jsx("div",{className:"text-xl font-semibold",children:"Finalizing your purchase..."}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This will update automatically."}),C>8e3&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-red-500",children:"Still working... you can manually sign back in if this persists."}),e.jsx("button",{onClick:()=>{try{window.location.href="/?login=1"}catch{}},className:"text-xs text-blue-600 underline",children:"Open sign-in modal"})]})]})}if(!t&&!a)return e.jsx(Nn,{});if(i)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."});if(!t)return e.jsx(Nn,{});if(o){if(o.is_active===!1)return e.jsx(_n,{});if(k.loading)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Preparing your workspace..."});const C=new URLSearchParams(window.location.search),M=C.get("onboarding"),b=M==="1",g=M==="0"||C.get("skip_onboarding")==="1";let U=!1;try{U=localStorage.getItem("ppp.onboarding.completed")==="1"}catch{}if(!g&&!U&&(k.count===0||b))return e.jsx(Ui,{});const se=o?.terms_version_required,Z=o?.terms_version_accepted;if(se&&se!==Z)return e.jsx(Vc,{});if(kn(o)){if(!v.checked)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Checking admin access..."});if(v.allowed)return e.jsx(Mc,{})}return y==="ab"?e.jsx(zr,{token:a}):e.jsx(vn,{})}return e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."})}function Ta(){return e.jsxs(e.Fragment,{children:[e.jsx(Yi,{}),e.jsx(ld,{}),e.jsx(qc,{})]})}function od(){return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center px-6 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"404 — Page not found"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"We couldn't find the page you're looking for."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(dr,{to:"/",className:"text-blue-600 underline",children:"Go Home"}),e.jsx(dr,{to:"/",className:"text-blue-600 underline",children:"Open Dashboard"})]})]})}function ja(){return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center px-6 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"An unexpected error occurred. Please try again."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(dr,{to:"/",className:"text-blue-600 underline",children:"Go Home"}),e.jsx(dr,{to:"/",className:"text-blue-600 underline",children:"Open Dashboard"})]})]})}function cd(){const{token:t,isAuthenticated:a}=Ht()||{};if(!a){try{window.location.replace("/")}catch{}return null}return e.jsx(zr,{token:t})}function dd(){const[t,a]=s.useState(0),{largeText:r,setLargeText:n,highContrast:o,setHighContrast:l}=Xr(),d=[{id:"welcome",title:"Pick a show name",description:"You can change this later.",render:()=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm",children:"Show name"}),e.jsx("input",{className:"w-full border rounded-[var(--radius)] p-2",placeholder:"My Great Show"})]}),validate:()=>!0,tip:"Short names are easier to remember."},{id:"artwork",title:"Add artwork",description:"Drop in a square image for best results.",render:()=>e.jsx("div",{className:"p-6 border-2 border-dashed rounded-[var(--radius)] text-sm text-muted-foreground",children:"Drag & drop image here"}),validate:()=>!0,tip:"At least 1400x1400px is recommended."},{id:"publish",title:"Choose a publish day",description:"We'll remind you before each release.",render:()=>e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{className:"btn",children:"Mon"}),e.jsx("button",{className:"btn",children:"Wed"}),e.jsx("button",{className:"btn",children:"Fri"})]}),validate:()=>!0,tip:"Consistency beats volume."}];return e.jsx(Li,{steps:d,index:t,setIndex:a,onComplete:()=>alert("Done!"),prefs:{largeText:r,setLargeText:n,highContrast:o,setHighContrast:l}})}const ud=new Date().getFullYear();function Zr({title:t,description:a,html:r}){const n=a||`Read the Podcast Plus Plus ${t}.`;return e.jsxs("div",{className:"min-h-screen bg-slate-100 text-slate-900",children:[e.jsx(Yi,{title:`${t} | Podcast Plus Plus`,description:n}),e.jsx("header",{className:"border-b bg-white",children:e.jsxs("div",{className:"mx-auto flex max-w-5xl items-center justify-between px-6 py-4",children:[e.jsx("a",{href:"/",className:"flex items-center gap-3 text-slate-900 no-underline hover:opacity-80","aria-label":"Podcast Plus Plus home",children:e.jsx(gr,{size:32})}),e.jsx("a",{href:"/?login=1",className:"text-sm font-medium text-blue-600 transition-colors hover:text-blue-700",children:"Sign In"})]})}),e.jsx("main",{className:"mx-auto max-w-5xl px-6 py-16",children:e.jsx("article",{className:"legal-content",dangerouslySetInnerHTML:{__html:r}})}),e.jsx("footer",{className:"border-t bg-white",children:e.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-3 px-6 py-6 text-sm text-slate-500 md:flex-row md:items-center md:justify-between",children:[e.jsxs("span",{children:[" ",ud," Podcast Plus Plus. All rights reserved."]}),e.jsxs("nav",{className:"flex flex-wrap gap-x-4 gap-y-2",children:[e.jsx("a",{href:"/privacy",className:"transition-colors hover:text-slate-700",children:"Privacy Policy"}),e.jsx("a",{href:"/terms",className:"transition-colors hover:text-slate-700",children:"Terms of Use"})]})]})})]})}const md=`<h1>Privacy Policy</h1>\r
<p><em>Last updated: September 16, 2025</em></p>\r
<p>This Privacy Policy explains how <strong>Chainsaw Enterprises</strong>, doing business as <strong>Podcast Plus Plus</strong> (&quot;<strong>Podcast Plus Plus</strong>,&quot; &quot;<strong>we</strong>,&quot; &quot;<strong>us</strong>,&quot; or &quot;<strong>our</strong>&quot;), collects, uses, and shares information when you use <strong>podcastplusplus.com</strong> and related apps, products, and services (the &quot;<strong>Services</strong>&quot;). If you do not agree with this Policy, please do not use the Services.</p>\r
<p>We pair this Policy with our <strong>Terms of Use</strong>. Capitalized terms not defined here have the meanings in the Terms.</p>\r
<hr>\r
<h2>1) What We Collect</h2>\r
<p>We collect information in three ways: (A) you provide it, (B) collected automatically, and (C) from third-party services you connect.</p>\r
<h3>A. Information You Provide</h3>\r
<ul>\r
<li><strong>Account info</strong>: name, email, password or SSO, profile settings.</li>\r
<li><strong>Payment info</strong>: billing address and transaction details (processed by our payment provider; we do not store full card numbers).</li>\r
<li><strong>Content you upload or record</strong>: audio/video files, transcripts, show notes, titles, artwork, and other materials (&quot;<strong>User Content</strong>&quot;).</li>\r
<li><strong>Processing settings</strong>: language, model choices, effects, diarization settings, and other job parameters.</li>\r
<li><strong>Support messages</strong>: feedback, bug reports, emails.</li>\r
</ul>\r
<h3>B. Information Collected Automatically</h3>\r
<ul>\r
<li><strong>Usage data</strong>: pages viewed, features used, buttons clicked, time on page, referring/exit pages.</li>\r
<li><strong>Device &amp; log data</strong>: IP address, browser type/version, OS, device identifiers, timestamps, error logs, and diagnostic data.</li>\r
<li><strong>Cookies &amp; similar tech</strong>: used for authentication, preferences, analytics, and (if enabled) marketing.</li>\r
</ul>\r
<h3>C. Information From Third Parties (You Connect)</h3>\r
<ul>\r
<li><strong>Podcast hosts &amp; distribution platforms</strong> (e.g., Spreaker): access tokens, show metadata, episode IDs/links, limited analytics the platform makes available.</li>\r
<li><strong>Cloud storage</strong> (if you link it): file names, sizes, and content you select to import.</li>\r
<li><strong>Single Sign-On (SSO)</strong> (e.g., Google): name, email, and SSO identifiers authorized by you.</li>\r
</ul>\r
<blockquote>\r
<p><strong>AI Processing Notice.</strong> Our Services may analyze and transform User Content to provide features such as transcription, filler-word removal (&quot;Flubber&quot;), command-based editing (&quot;Intern&quot;), SFX/music insertion, summarization, and publishing automations.</p>\r
</blockquote>\r
<hr>\r
<h2>2) How We Use Information</h2>\r
<p>We use information to:</p>\r
<ul>\r
<li><strong>Provide the Services</strong>: host content, process audio, generate transcripts, run editing/assembly pipelines, publish episodes, and sync with integrated platforms.</li>\r
<li><strong>Operate, maintain, and improve</strong> the Services, including training our systems to perform better for you (e.g., model prompts, presets, failure detection). We do <strong>not</strong> use your User Content to train third-party foundation models.</li>\r
<li><strong>Communicate</strong> with you: service notices, security alerts, and (if you opt in) marketing.</li>\r
<li><strong>Personalize</strong> your experience: remember preferences, suggest workflows.</li>\r
<li><strong>Ensure safety &amp; compliance</strong>: detect abuse, enforce Terms, and comply with law.</li>\r
<li><strong>Billing &amp; accounting</strong>: manage subscriptions, processing minutes, invoices, and taxes.</li>\r
</ul>\r
<h3>Legal Bases (EEA/UK only)</h3>\r
<p>If you are in the EEA/UK, our legal bases include <strong>contract</strong>, <strong>legitimate interests</strong> (e.g., security, improvement), <strong>consent</strong> (where applicable, e.g., non-essential cookies/marketing), and <strong>legal obligation</strong>.</p>\r
<hr>\r
<h2>3) How We Share Information</h2>\r
<p>We do not sell your personal information. We share information as follows:</p>\r
<ul>\r
<li><strong>Service providers / processors</strong>: cloud hosting, storage/CDN, analytics, customer support, payments, email delivery, and AI/transcription/voice services. They may access personal information only to perform services for us and must protect it.</li>\r
<li><strong>Integrations you enable</strong>: when you connect Spreaker or other platforms, we share the data needed to publish episodes or fetch analytics those platforms provide.</li>\r
<li><strong>Business transfers</strong>: merger, acquisition, financing, or sale of assets.</li>\r
<li><strong>Legal &amp; safety</strong>: to comply with law, enforce our Terms, or protect rights, safety, and security.</li>\r
</ul>\r
<blockquote>\r
<p><strong>Third-party AI/Transcription/TTS.</strong> We contractually restrict providers to use your data solely to provide their service to us. Some providers may retain logs for abuse detection and operations per their policies.</p>\r
</blockquote>\r
<hr>\r
<h2>4) Cookies &amp; Analytics</h2>\r
<ul>\r
<li><strong>Essential cookies</strong>: required for login and core features.</li>\r
<li><strong>Preferences &amp; performance</strong>: remember settings, measure performance.</li>\r
<li><strong>Analytics</strong>: understand feature usage to improve the product.</li>\r
<li><strong>Marketing (optional)</strong>: only if we add it and you consent.</li>\r
</ul>\r
<p>You can manage cookies in your browser. Blocking essential cookies may break the Service. Where required, we will show a <strong>cookie banner</strong> for consent.</p>\r
<hr>\r
<h2>5) Your Choices &amp; Rights</h2>\r
<ul>\r
<li><strong>Access/Update</strong> your account info in settings.</li>\r
<li><strong>Delete</strong> content you uploaded (subject to backups/logs and legal requirements).</li>\r
<li><strong>Email preferences</strong>: opt out of non-essential marketing.</li>\r
<li><strong>SSO/Integrations</strong>: disconnect in settings and/or at the provider.</li>\r
</ul>\r
<h3>California (CCPA/CPRA) Rights</h3>\r
<p>If you are a California resident, you may request to <strong>know/access</strong>, <strong>correct</strong>, and <strong>delete</strong> personal information, and to <strong>opt-out of sale or sharing</strong> for cross-context behavioral advertising. We <strong>do not sell</strong> personal information and do <strong>not share</strong> personal information for cross-context behavioral advertising. We honor <strong>Global Privacy Control (GPC)</strong> signals to the extent applicable.</p>\r
<p><strong>Notice at Collection (California):</strong> We collect the following categories of personal information for the purposes described above: <strong>Identifiers</strong> (e.g., name, email, IP), <strong>Customer Records</strong> (billing info), <strong>Commercial Information</strong> (transactions, subscriptions), <strong>Internet/Network Activity</strong> (usage data, logs), <strong>Audio/Visual</strong> (User Content you upload/record), <strong>Geolocation (coarse)</strong> via IP, and <strong>Inferences</strong> (feature preferences). Sources include <strong>you</strong>, <strong>your devices</strong>, and <strong>services you connect</strong>. We retain data as described below. We do not sell or share personal information as defined by CPRA. We do not use or disclose <strong>sensitive personal information</strong> for purposes beyond those permitted by CPRA Section 7027(m).</p>\r
<h3>EEA/UK Rights</h3>\r
<p>Depending on your location, you may have rights to access, correct, delete, restrict/oppose processing, portability, and to withdraw consent. You may also lodge a complaint with your local supervisory authority.</p>\r
<p>To exercise rights, contact <strong><a href="mailto:Scott@thebsgcompany.com">Scott@thebsgcompany.com</a></strong>.</p>\r
<hr>\r
<h2>6) Data Retention</h2>\r
<p>We retain information for as long as needed to provide the Services and for legitimate and lawful purposes, including security, fraud prevention, and record-keeping:</p>\r
<ul>\r
<li><strong>Account data</strong>: for the life of the account, then up to <strong>24 months</strong>.</li>\r
<li><strong>User Content</strong> (audio, transcripts, outputs): until you delete it or your account is closed; backups/logs may persist up to <strong>90 days</strong>.</li>\r
<li><strong>Processing/job logs</strong>: typically <strong>12-18 months</strong> for troubleshooting and abuse prevention.</li>\r
<li><strong>Billing/transactions</strong>: per tax and accounting laws (usually <strong>7 years</strong> in the U.S.).</li>\r
</ul>\r
<p>We may anonymize or aggregate data for analytics and product improvement.</p>\r
<hr>\r
<h2>7) Security</h2>\r
<p>We use technical and organizational measures appropriate to the risk (encryption in transit, access controls, least-privilege policies, isolation of production secrets). No system is 100% secure; you are responsible for safeguarding your account credentials.</p>\r
<hr>\r
<h2>8) International Data Transfers</h2>\r
<p>We are based in the United States. If you use the Services from outside the U.S., your information may be transferred to and processed in the U.S. and other countries with different data-protection laws. Where required, we implement appropriate safeguards.</p>\r
<hr>\r
<h2>9) Children&#39;s Privacy</h2>\r
<p>The Services are <strong>not for children under 13</strong>. If we learn that we have collected personal information from a child under 13, we will delete it. If you believe this has happened, contact us immediately.</p>\r
<hr>\r
<h2>10) AI &amp; Content Processing Details</h2>\r
<ul>\r
<li><strong>Transcription &amp; editing</strong>: Your audio may be transcribed and analyzed to support features like diarization, filler-word removal, SFX insertion, and command-based edits.</li>\r
<li><strong>Models</strong>: We may use a combination of in-house and third-party models. We do <strong>not</strong> permit third-party foundation model providers to use your content to train their general models for others.</li>\r
<li><strong>Human review</strong>: Unless you contact support asking for help, we do not read/listen to your content. If a human review is required to resolve an issue, access is limited and logged.</li>\r
<li><strong>Processing minutes</strong>: We track job duration and resource usage to manage quotas and billing.</li>\r
</ul>\r
<hr>\r
<h2>11) Third-Party Services You May Use</h2>\r
<p>If you enable integrations (e.g., Spreaker), their collection and use of information are governed by their own policies and terms. We are not responsible for third-party practices.</p>\r
<hr>\r
<h2>12) Changes to This Policy</h2>\r
<p>We may update this Policy from time to time. If changes are material, we will provide notice (e.g., email or in-app). The updated Policy is effective when posted unless otherwise stated.</p>\r
<hr>\r
<h2>13) Contact Us</h2>\r
<p><strong>Chainsaw Enterprises (Podcast Plus Plus)</strong><br><strong>121 W Lexington Dr Suite 236, Glendale, CA 91203</strong><br><strong>Email:</strong> <a href="mailto:Scott@thebsgcompany.com">Scott@thebsgcompany.com</a></p>\r
<hr>\r
<h3>Appendix A -- Sub-Processors (Illustrative)</h3>\r
<blockquote>\r
<p>This is an illustrative list only and may change. Current providers will be listed on our site if required.</p>\r
</blockquote>\r
<ul>\r
<li><strong>Cloud hosting &amp; storage/CDN</strong> (e.g., Google Cloud, Cloudflare)</li>\r
<li><strong>Payments</strong> (e.g., Stripe or similar)</li>\r
<li><strong>Transcription/AI</strong> (e.g., AssemblyAI or similar)</li>\r
<li><strong>Text-to-Speech</strong> (e.g., ElevenLabs or similar)</li>\r
<li><strong>Email &amp; support</strong> (e.g., SendGrid/SES, helpdesk)</li>\r
<li><strong>Analytics</strong> (e.g., privacy-respecting product analytics)</li>\r
</ul>\r
<h3>Appendix B -- California Metrics (Optional)</h3>\r
<p>If in the future we sell/share personal information or use targeted advertising, we will update this Policy, provide opt-outs (including GPC), and publish annual metrics as required by CPRA.</p>\r
`;function hd(){return e.jsx(Zr,{title:"Privacy Policy",description:"Learn how Podcast Plus Plus collects, uses, and protects your information.",html:md})}function pd(){return e.jsx(Zr,{title:"Terms of Use",description:"Review the Podcast Plus Plus terms that govern access to our services.",html:Hi})}function xd(){const[t,a]=s.useState("idle"),[r,n]=s.useState(""),o=il(),l=(d,N)=>{if(d==null||d==="")return N;if(typeof d=="string")return d;if(Array.isArray(d))return d.map(u=>{if(!u)return"";if(typeof u=="string")return u;if(u?.msg){const j=Array.isArray(u.loc)?u.loc.join("."):u.loc;return j?`${u.msg} (${j})`:u.msg}try{return JSON.stringify(u)}catch{return String(u)}}).filter(Boolean).join(" ")||N;if(typeof d=="object"){if(d.detail&&d.detail!==d)return l(d.detail,N);if(d.message&&d.message!==d)return l(d.message,N);try{const i=JSON.stringify(d);if(i&&i!=="{}")return i}catch{return N}}return String(d)||N};return s.useEffect(()=>{(async()=>{const N=new URLSearchParams(window.location.search),i=N.get("token")||"",u=N.get("email")||"";if(!i&&!u){a("error"),n("Missing verification token. Please open the link from your email.");return}a("verifying");try{const j=await fetch("/api/auth/confirm-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:i,email:u}),credentials:"include"});if(!j.ok){const c=await j.json().catch(()=>({}));a("error"),n(l(c&&c.detail||c&&c.message,"Verification failed or expired."));return}a("success"),n("Your email has been confirmed. You can continue onboarding.")}catch{a("error"),n("Verification request failed. Check your connection and try again.")}})()},[]),e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(Ce,{className:"w-full max-w-md",children:[e.jsx(Je,{children:e.jsx(Xe,{children:"Email Verification"})}),e.jsxs(Ae,{children:[t==="verifying"&&e.jsx("div",{children:"Verifying…"}),t!=="verifying"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:t==="success"?"text-emerald-700":"text-red-700",children:r}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{onClick:()=>o("/onboarding"),children:"Continue"}),e.jsx(A,{variant:"outline",onClick:()=>o("/"),children:"Home"})]})]})]})]})})}function fd(){const{brand:t}=fr();return e.jsx("footer",{className:"border-t mt-12 py-8 text-sm text-muted-foreground",children:e.jsxs("div",{className:"container mx-auto flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:["© ",new Date().getFullYear()," ",t.name]}),e.jsxs("nav",{className:"flex items-center gap-4",children:[e.jsx("a",{href:"/privacy",className:"hover:text-foreground",children:"Privacy Policy"}),e.jsx("a",{href:"/terms",className:"hover:text-foreground",children:"Terms of Use"})]}),e.jsxs("div",{className:"inline-flex items-center gap-2 text-primary",children:[e.jsxs("span",{className:"font-medium",children:["Made with ",t.shortName]}),e.jsx("span",{"aria-hidden":"true",className:"text-lg leading-none",children:"++"})]})]})})}const gd=[{key:"starter",name:"Starter",monthly:19,annual:null,processing:"120 (2 hrs)",extraRate:"$6/hr",queue:"2 hrs, held 7 days",features:{uploadRecord:!0,basicCleanup:!0,manualPublish:!0,autopublishSpreaker:!1,flubber:!1,intern:!1,advancedIntern:!1,sfxTemplates:!1,analytics:!1,multiUser:!1,priorityQueue:!1,premiumSupport:!1},cta:{label:"Get Started",href:"https://app.podcastpro.plus/signup?plan=starter"}},{key:"creator",name:"Creator",monthly:39,annual:31,processing:"600 (10 hrs)",extraRate:"$5/hr",queue:"10 hrs, held 14 days",features:{uploadRecord:!0,basicCleanup:!0,manualPublish:!0,autopublishSpreaker:!0,flubber:!0,intern:!0,advancedIntern:!1,sfxTemplates:!1,analytics:!1,multiUser:!1,priorityQueue:!1,premiumSupport:!1},cta:{label:"Start Creating",href:"https://app.podcastpro.plus/signup?plan=creator"},popular:!0,badge:"Most Popular"},{key:"pro",name:"Pro",monthly:79,annual:63,processing:"1500 (25 hrs)",extraRate:"$4/hr",queue:"25 hrs, held 30 days",features:{uploadRecord:!0,basicCleanup:!0,manualPublish:!0,autopublishSpreaker:!0,flubber:!0,intern:!0,advancedIntern:!0,sfxTemplates:!0,analytics:!0,multiUser:!1,priorityQueue:!1,premiumSupport:!1},cta:{label:"Go Pro",href:"https://app.podcastpro.plus/signup?plan=pro"}},{key:"enterprise",name:"Enterprise",monthly:null,annual:null,processing:"3600 (60 hrs)",extraRate:"$3/hr",queue:"60 hrs, held 60 days",features:{uploadRecord:!0,basicCleanup:!0,manualPublish:!0,autopublishSpreaker:!0,flubber:!0,intern:!0,advancedIntern:!0,sfxTemplates:!0,analytics:!0,multiUser:!0,priorityQueue:!0,premiumSupport:!0},cta:{label:"Contact Us"},contact:!0}],yd=[{key:"starter",name:"Starter",monthly:19,annual:null,processing:"120 (2 hrs)",extraRate:"$6/hr",queue:"2 hrs, held 7 days",features:{uploadRecord:!0,basicCleanup:!0,manualPublish:!0,autopublishSpreaker:!1,flubber:!1,intern:!1,advancedIntern:!1,sfxTemplates:!1,analytics:!1,multiUser:!1,priorityQueue:!1,premiumSupport:!1},earlyOffers:[{title:"Standard Launch",price:"$19/mo",note:"Available Nov 1"}],cta:{label:"Get Started",href:"https://app.podcastpro.plus/signup?plan=starter"}},{key:"creator",name:"Creator",monthly:39,annual:31,processing:"600 (10 hrs)",extraRate:"$5/hr",queue:"10 hrs, held 14 days",features:{uploadRecord:!0,basicCleanup:!0,manualPublish:!0,autopublishSpreaker:!0,flubber:!0,intern:!0,advancedIntern:!1,sfxTemplates:!1,analytics:!1,multiUser:!1,priorityQueue:!1,premiumSupport:!1},earlyOffers:[{title:"Lifetime Deal",price:"$199 once",badge:"20 seats left"},{title:"Founders Annual",price:"$299/year",note:"Normally $468/yr • Ends Sept 30"},{title:"Partner Rate",price:"$10/mo (1st year)",note:"Invite-only • Converts to standard pricing"}],cta:{label:"Start Creating",href:"https://app.podcastpro.plus/signup?plan=creator"},popular:!0,badge:"Most Popular"},{key:"pro",name:"Pro",monthly:79,annual:63,processing:"1500 (25 hrs)",extraRate:"$4/hr",queue:"25 hrs, held 30 days",features:{uploadRecord:!0,basicCleanup:!0,manualPublish:!0,autopublishSpreaker:!0,flubber:!0,intern:!0,advancedIntern:!0,sfxTemplates:!0,analytics:!0,multiUser:!1,priorityQueue:!1,premiumSupport:!1},earlyOffers:[{title:"Lifetime Deal",price:"$399 once",badge:"20 seats left"},{title:"Founders Annual",price:"$599/year",note:"Normally $948/yr • Ends Sept 30"},{title:"Partner Rate",price:"$10/mo (1st year)",note:"Invite-only • Converts to standard pricing"}],cta:{label:"Go Pro",href:"https://app.podcastpro.plus/signup?plan=pro"}},{key:"enterprise",name:"Enterprise",monthly:null,annual:null,processing:"3600 (60 hrs)",extraRate:"$3/hr",queue:"60 hrs, held 60 days",features:{uploadRecord:!0,basicCleanup:!0,manualPublish:!0,autopublishSpreaker:!0,flubber:!0,intern:!0,advancedIntern:!0,sfxTemplates:!0,analytics:!0,multiUser:!0,priorityQueue:!0,premiumSupport:!0},earlyOffers:[{title:"Custom Partnership",price:"Contact Sales",note:"Let’s tailor an early access plan for your network"}],cta:{label:"Contact Us"},contact:!0}],bd=[{key:"price",label:"Price"},{key:"processing",label:"Processing minutes / mo"},{key:"extraRate",label:"Extra minutes (rollover)"},{key:"queue",label:"Queue storage (unprocessed audio)"},{key:"uploadRecord",label:"Upload & record"},{key:"basicCleanup",label:"Basic cleanup (noise, trim)"},{key:"manualPublish",label:"Manual publish"},{key:"autopublishSpreaker",label:"Auto-publish to Spreaker (+ linked platforms)"},{key:"flubber",label:"Flubber (filler removal)"},{key:"intern",label:"Intern (spoken edits)"},{key:"advancedIntern",label:"Advanced Intern (multi-step edits)"},{key:"sfxTemplates",label:"SFX & templates"},{key:"analytics",label:"Analytics (via Spreaker API)"},{key:"multiUser",label:"Multi-user accounts"},{key:"priorityQueue",label:"Priority processing queue"},{key:"premiumSupport",label:"Premium support"}];function jd({on:t}){return e.jsx("span",{"aria-label":t?"Included":"Not included",className:t?"text-green-600":"text-slate-400",children:t?"✅":"–"})}function En(){const[t,a]=s.useState("standard"),[r,n]=s.useState(!1),[o,l]=s.useState(()=>An());s.useEffect(()=>{if(t!=="early")return;const c=setInterval(()=>l(An()),1e3);return()=>clearInterval(c)},[t]);const d=c=>{if(c.key==="enterprise")return"Contact Us";const m=r?c.annual:c.monthly;return m?`$${m}/mo`+(r?" (billed annually)":""):r?"—":`$${c.monthly}/mo`},N=s.useMemo(()=>t==="early"?yd:gd,[t]),i=c=>{a(c),c!=="standard"&&n(!1)},u=c=>t==="early"?e.jsxs("div",{className:"space-y-3",children:[(c.earlyOffers||[]).map((m,I)=>e.jsxs("div",{className:"rounded-lg border border-blue-100 bg-blue-50/40 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-semibold text-blue-950",children:m.title}),m.badge&&e.jsx(pt,{variant:"secondary",className:"bg-amber-100 text-amber-700",children:m.badge})]}),e.jsx("div",{className:"mt-1 text-lg font-bold text-blue-900",children:m.price}),m.note&&e.jsx("p",{className:"mt-1 text-xs text-blue-700",children:m.note})]},`${c.key}-offer-${I}`)),e.jsx("div",{children:c.contact?e.jsx("a",{href:"/contact",className:"text-blue-600 hover:underline",children:"Contact Sales"}):e.jsx(A,{asChild:!0,variant:c.popular?"default":"secondary",children:e.jsx("a",{href:c.cta.href,className:"no-underline",children:c.cta.label})})})]}):e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-lg font-semibold",children:d(c)}),e.jsx("div",{children:c.contact?e.jsx("a",{href:"/contact",className:"text-blue-600 hover:underline",children:"Contact Sales"}):e.jsx(A,{asChild:!0,variant:c.popular?"default":"secondary",children:e.jsx("a",{href:c.cta.href,className:"no-underline",children:c.cta.label})})})]}),j=o.ended?"Offer ended":`${o.days}d ${o.hours}h ${o.minutes}m ${o.seconds}s`;return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("header",{className:"border-b",children:e.jsxs("div",{className:"container mx-auto max-w-6xl flex items-center justify-between px-4 py-4",children:[e.jsx(gr,{size:28,lockup:!0}),e.jsx("a",{href:"/",className:"text-sm text-blue-600 hover:underline",children:"Back to Home"})]})}),e.jsxs("section",{className:"container mx-auto max-w-4xl px-4 py-10 text-center",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-3",children:t==="early"?"Founders Early Access":"Choose the plan that fits your podcast"}),e.jsx("p",{className:"text-muted-foreground",children:t==="early"?"Lock in founder-only rates before the public launch. These offers disappear after Sept 30.":"All plans include powerful editing tools, publishing to Spreaker, and friendly support. Upgrade anytime."}),e.jsxs("div",{className:"mt-6 inline-flex items-center gap-3 rounded-full border px-3 py-1 text-sm",children:[e.jsx("button",{type:"button",onClick:()=>i("early"),className:t==="early"?"rounded-full bg-blue-600 px-3 py-1 font-semibold text-white":"rounded-full px-3 py-1 text-slate-500 hover:text-slate-900","aria-pressed":t==="early",children:"Founders Pricing"}),e.jsx("span",{className:"text-slate-300",children:"|"}),e.jsx("button",{type:"button",onClick:()=>i("standard"),className:t==="standard"?"rounded-full bg-blue-600 px-3 py-1 font-semibold text-white":"rounded-full px-3 py-1 text-slate-500 hover:text-slate-900","aria-pressed":t==="standard",children:"Standard Pricing (Nov 1)"})]}),t==="standard"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 inline-flex items-center gap-3 rounded-full border px-3 py-1 text-sm",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:r?"text-slate-500":"font-semibold","aria-pressed":!r,children:"Monthly"}),e.jsx("span",{className:"text-slate-300",children:"|"}),e.jsx("button",{type:"button",onClick:()=>n(!0),className:r?"font-semibold":"text-slate-500","aria-pressed":r,children:"Annual (Save 20%)"})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Starter plan does not offer annual pricing."})]})]}),t==="early"&&e.jsxs("section",{className:"container mx-auto max-w-5xl px-4 pb-6",children:[e.jsx("div",{className:"relative overflow-hidden rounded-2xl border border-blue-200 bg-gradient-to-br from-blue-50 via-white to-blue-100 p-6 text-left shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx(pt,{variant:"secondary",className:"bg-blue-600/10 text-blue-800",children:"Limited Window"}),e.jsx("h2",{className:"mt-3 text-2xl font-semibold text-blue-950",children:"Founders who join now keep their rates for life."}),e.jsx("p",{className:"mt-2 text-sm font-semibold uppercase tracking-wide text-blue-800",children:"Ends Sept 30"})]}),e.jsxs("div",{className:"rounded-xl border border-white/60 bg-white/80 px-4 py-3 text-center shadow",children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-blue-600",children:"Countdown to close"}),e.jsx("p",{className:"mt-1 font-mono text-lg text-blue-900",children:j})]})]})}),e.jsxs("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border bg-white p-5 text-left shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Lifetime Deal"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Pay once, own your plan forever. Limited to the first 20 creators across Creator and Pro tiers."}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("p",{className:"font-medium text-slate-900",children:["Creator: ",e.jsx("span",{className:"font-semibold text-blue-700",children:"$199"})," once"]}),e.jsxs("p",{className:"font-medium text-slate-900",children:["Pro: ",e.jsx("span",{className:"font-semibold text-blue-700",children:"$399"})," once"]})]})]}),e.jsxs("div",{className:"rounded-xl border bg-white p-5 text-left shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Private Partner Deal"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"For partner groups you invite personally. Choose Creator or Pro for only $10/mo for the first year, then converts to normal pricing."}),e.jsx("p",{className:"mt-4 text-sm font-medium text-amber-600",children:"Not publicly available."})]})]})]}),e.jsxs("section",{className:"container mx-auto max-w-6xl px-4 pb-12",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 align-bottom",children:" "}),N.map(c=>e.jsx("th",{className:"p-3 text-left align-top",children:e.jsxs("div",{className:`rounded-lg border p-4 ${c.popular?"border-blue-500":"border-slate-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:c.name}),c.popular&&e.jsx(pt,{variant:"secondary",children:c.badge||"Most Popular"})]}),t==="early"?e.jsxs("div",{className:"mt-3 text-left text-sm",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-700",children:"Founder Offer"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:c.earlyOffers?.[0]?.price||d(c)}),c.earlyOffers?.[0]?.title&&e.jsx("p",{className:"text-xs text-blue-700",children:c.earlyOffers[0].title})]}):e.jsx("div",{className:"mt-1 text-2xl font-bold",children:d(c)})]})},c.key))]})}),e.jsx("tbody",{children:bd.map(c=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3 text-sm font-medium",children:c.label}),N.map(m=>e.jsxs("td",{className:"p-3 text-sm",children:[c.key==="price"&&u(m),c.key==="processing"&&m.processing,c.key==="extraRate"&&m.extraRate,c.key==="queue"&&m.queue,c.key!=="price"&&c.key!=="processing"&&c.key!=="extraRate"&&c.key!=="queue"&&e.jsx(jd,{on:!!m.features[c.key]})]},m.key))]},c.key))})]})}),e.jsxs("div",{className:"mt-10 text-xs text-muted-foreground space-y-2",children:[e.jsx("p",{children:"Minutes: monthly plans are “use it or lose it.” A la carte minutes roll over until used. Queue storage is plan-gated; no add-ons."}),e.jsx("p",{children:"Early access deals vanish forever after Sept 30. Lifetime seats are capped at 20 and will show as sold out when they’re gone."}),e.jsx("p",{children:"We’re building more—this table is ready for future add-ons (social posting, clip generation, and more)."})]})]}),e.jsx(fd,{})]})}function An(){const t=new Date,a=t.getFullYear(),n=new Date(a,8,30,23,59,59).getTime()-t.getTime();if(n<=0)return{ended:!0,days:0,hours:0,minutes:0,seconds:0};const o=Math.floor(n/1e3),l=Math.floor(o/(24*3600)),d=Math.floor(o%(24*3600)/3600),N=Math.floor(o%3600/60),i=o%60;return{ended:!1,days:l,hours:d,minutes:N,seconds:i}}const vd=`
  <h1>Podcast Website Builder Access Guide</h1>
  <p>The podcast website builder is exposed through the Podcasts API and serves generated pages via subdomains of the configured base domain.</p>
  <h2>API endpoints</h2>
  <p>All endpoints live under <code>/api/podcasts/{podcast_id}/website</code> and require authentication with the owning user account.</p>
  <table>
    <thead>
      <tr>
        <th>Method &amp; Path</th>
        <th>Purpose</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>GET /api/podcasts/{podcast_id}/website</code></td>
        <td>Fetch the current website metadata, layout JSON, status, and domains.</td>
      </tr>
      <tr>
        <td><code>POST /api/podcasts/{podcast_id}/website</code></td>
        <td>Invoke Gemini to create or refresh the website layout.</td>
      </tr>
      <tr>
        <td><code>POST /api/podcasts/{podcast_id}/website/chat</code></td>
        <td>Send a natural-language instruction to the AI builder and receive the updated layout.</td>
      </tr>
      <tr>
        <td><code>PATCH /api/podcasts/{podcast_id}/website/domain</code></td>
        <td>Set or clear a custom domain (subject to plan tier requirements).</td>
      </tr>
    </tbody>
  </table>
  <p>The JSON response includes the internal <code>subdomain</code> and the computed <code>default_domain</code> that the static site is served from.</p>
  <h2>Viewing the generated site</h2>
  <p>After generation, the site is available at <code>https://&lt;subdomain&gt;.{BASE_DOMAIN}</code> where <code>{BASE_DOMAIN}</code> defaults to <code>podcastplusplus.com</code> but can be overridden through the <code>PODCAST_WEBSITE_BASE_DOMAIN</code> configuration. The API response also includes any configured custom domain when one is attached.</p>
  <h2>Saved prompts</h2>
  <p>Every AI generation request stores the prompt, response, and metadata (when <code>PODCAST_WEBSITE_GCS_BUCKET</code> is configured) under the <code>prompts/</code> prefix of the <code>ppp-websites-us-west1</code> bucket for review.</p>
`;function wd(){return e.jsx(Zr,{title:"Podcast Website Builder Guide",description:"Learn how to access the Podcast Plus Plus AI-powered podcast website builder.",html:vd})}try{if(typeof window<"u"&&window.fetch){const t=window.fetch.bind(window);window.fetch=async(a,r)=>{try{const n=typeof a=="string"?a:a&&a.url||"";if(n&&(n.startsWith("/api/")||n==="/api"||n.startsWith("/api?")||n.startsWith("/api/"))){const o=Hr(n);a instanceof Request?a=new Request(o,a):a=o}}catch{}return t(a,r)}}}catch{}try{if(sessionStorage.getItem("ppp_tab_id")||sessionStorage.setItem("ppp_tab_id",Math.random().toString(36).slice(2)),window.location.hash&&window.location.hash.includes("access_token=")){const a=new URLSearchParams(window.location.hash.substring(1)).get("access_token");if(a){localStorage.setItem("authToken",a);try{window.history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}window.dispatchEvent(new CustomEvent("ppp-token-captured",{detail:{token:a}}))}}}catch(t){console.warn("[auth] token capture failed",t)}const Nd=ll([{path:"/",element:e.jsx(Ta,{}),errorElement:e.jsx(ja,{})},{path:"/admin",element:e.jsx(Ta,{}),errorElement:e.jsx(ja,{})},{path:"/admin/*",element:e.jsx(Ta,{}),errorElement:e.jsx(ja,{})},{path:"/dashboard",element:e.jsx(Ta,{}),errorElement:e.jsx(ja,{})},{path:"/dashboard/*",element:e.jsx(Ta,{}),errorElement:e.jsx(ja,{})},{path:"/ab",element:e.jsx(cd,{})},{path:"/onboarding-demo",element:e.jsx(dd,{})},{path:"/onboarding",element:e.jsx(Ui,{})},{path:"/error",element:e.jsx(ja,{})},{path:"/privacy",element:e.jsx(hd,{})},{path:"/terms",element:e.jsx(pd,{})},{path:"/verify",element:e.jsx(xd,{})},{path:"/pricing",element:e.jsx(En,{})},{path:"/subscriptions",element:e.jsx(En,{})},{path:"/docs/podcast-website-builder",element:e.jsx(wd,{})},{path:"*",element:e.jsx(od,{})}]);ol.createRoot(document.getElementById("root")).render(e.jsx($t.StrictMode,{children:e.jsx(co,{children:e.jsx(go,{children:e.jsx(Ec,{children:e.jsx(hc,{children:e.jsx(cl,{router:Nd})})})})})}));
