displayName: GCS Upload Failures
documentation:
  content: |
    Google Cloud Storage upload failures detected.
    This affects episode assembly, media uploads, and transcript storage.
    
    Common causes:
    - Network connectivity issues
    - GCS bucket permissions misconfigured
    - Ephemeral storage full in Cloud Run container
    - Rate limiting from GCS
    - Invalid file paths or missing parent directories
    
    Recommended actions:
    - Check GCS bucket IAM permissions
    - Review recent GCS-related code changes
    - Check Cloud Run container disk usage
    - Verify GOOGLE_CLOUD_PROJECT environment variable
    - Check for multiprocessing issues (GCS client not thread-safe)
  mimeType: text/markdown

conditions:
  - displayName: GCS Upload Error Rate > 10%
    conditionThreshold:
      filter: |
        resource.type = "cloud_run_revision"
        AND resource.labels.service_name = "podcast-api"
        AND (
          textPayload =~ "GCS upload failed"
          OR textPayload =~ "Failed to upload.*to GCS"
          OR textPayload =~ "google.cloud.storage.*Error"
        )
        AND severity >= ERROR
      aggregations:
        - alignmentPeriod: 300s
          perSeriesAligner: ALIGN_RATE
          crossSeriesReducer: REDUCE_SUM
          groupByFields:
            - resource.service_name
      comparison: COMPARISON_GT
      thresholdValue: 0.1
      duration: 120s

alertStrategy:
  autoClose: 3600s

notificationChannels:
  - projects/podcast612/notificationChannels/7975467987455629516

combiner: OR
enabled: true
